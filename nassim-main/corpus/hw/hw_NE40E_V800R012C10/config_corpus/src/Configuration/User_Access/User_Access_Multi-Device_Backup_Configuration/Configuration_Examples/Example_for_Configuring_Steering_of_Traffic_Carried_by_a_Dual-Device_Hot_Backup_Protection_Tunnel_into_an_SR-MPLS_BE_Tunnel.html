
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Steering of Traffic Carried by a Dual-Device Hot Backup Protection Tunnel into an SR-MPLS BE Tunnel">
<meta name="abstract" content="This section provides an example for configuring steering of traffic carried by a dual-device hot backup protection tunnel into an SR-MPLS BE tunnel.">
<meta name="description" content="This section provides an example for configuring steering of traffic carried by a dual-device hot backup protection tunnel into an SR-MPLS BE tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1001.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_00532_01.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,c00549182,w00556928,l00593348,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="UP Multi-Device Backup">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="User Access Multi-Device Backup">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00593348">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0175388114">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Steering of Traffic Carried by a Dual-Device Hot Backup Protection Tunnel into an SR-MPLS BE Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0175388114"></a><a name="EN-US_TASK_0175388114"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Steering of Traffic Carried by a Dual-Device Hot Backup Protection Tunnel into an SR-MPLS BE Tunnel</h1>
<div class="taskbody"><p>This section provides an example for configuring steering of traffic carried by a dual-device hot backup protection tunnel into an SR-MPLS BE tunnel.</p>
<div class="context"><a name="EN-US_TASK_0175388114__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0175388114__fig_dc_ne_cfg_rui_003101">Figure 1</a>, users are connected to BRAS1 and BRAS2 through SW1 (LAN switch). The two BRASs run the Virtual Router Redundancy Protocol (VRRP) to determine the master and backup status. Basic user access functions are configured on BRAS1 and BRAS2 so that users can go online from the master device. If the master device or the link on the network or user side of the master device fails, service traffic needs to be quickly switched to the backup device.</p>
<p>In the dual-device hot backup scenario, configure an SR-MPLS BE protection tunnel for route recursion so that user traffic can be forwarded over the SR-MPLS BE protection tunnel. This improves the robustness of dual-device hot backup. In this example, an IPv6 address pool is used.</p>
<div class="fignone" id="EN-US_TASK_0175388114__fig_dc_ne_cfg_rui_003101"><a name="EN-US_TASK_0175388114__fig_dc_ne_cfg_rui_003101"></a><a name="fig_dc_ne_cfg_rui_003101"></a><span class="figcap"><b>Figure 1 </b>Configuring steering of traffic carried by a dual-device hot backup protection tunnel into an SR-MPLS BE tunnel</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/2/1</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cfg_rui_003101.png" width="NaN" height="NaN"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.5.1.4.1.1" liSelected="liSelected"><p><strong>Device</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.5.1.4.1.2" liSelected="liSelected"><p><strong>Interface</strong></p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.5.1.4.1.3" liSelected="liSelected"><p><strong>IP Address</strong></p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>BRAS1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>GE <span>0/2/1</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>10.1.1.1/24 (address of the interface running VRRP</p>
<p>and BFD peer)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>BRAS1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>GE<span>0/2/1</span>.2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>10.1.10.1/24 (address of the interface running BFD link)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>BRAS1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>GE<span>0/2/1</span>.333</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>Interface through which users go online</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>BRAS1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>10.1.2.1/32 (IP address of BRAS1's interface with an RBS deployed)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>BRAS2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>GE <span>0/2/1</span>.1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>10.1.1.2/24 (address of the interface running VRRP and BFD peer)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>BRAS2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>GE<span>0/2/1</span>.332</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>Interface through which users go online</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>BRAS2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>10.1.2.2/32 (address of BRAS2's interface with an RBS deployed)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.1 "><p>SW1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.2 "><p>GE<span>0/2/1</span>.2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.1.4.1.3 "><p>10.1.10.2/24 (address of the interface running BFD link)</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0175388114__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure VRRP and BFD on the access side of the master and backup BRASs (BRAS1 and BRAS2) to determine the master/backup status and implement fault association.</p>
</li><li><p>Configure basic user access functions and ensure that the two devices for backup have the same configuration. The configuration includes configuring AAA schemes, a RADIUS server group, and an IPv6 address pool.</p>
</li><li><p>Configure an AAA domain and bind the IPv6 address pool to it.</p>
</li><li><p>Configure a BAS interface and enable IPv6 on the interface.</p>
</li><li><p>Configure a remote backup service (RBS) and a remote backup policy (RBP).</p>
</li><li><p>Configure MPLS and OSPF.</p>
</li><li>Enable segment routing (SR).</li><li><p>Configure a prefix segment ID (SID) for the IP address of a loopback interface.</p>
</li><li><p>Configure a protection tunnel between the master and backup devices. In this example, an SR-MPLS BE protection tunnel defined by a tunnel policy is configured.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0175388114__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VRRP parameters such as a VRID and preemption delay</p>
</li><li><p>BFD parameters such as the local and remote discriminators and expected minimum interval at which BFD control packets are sent and received</p>
</li><li><p>IP address of each interface on BRAS1 and BRAS2</p>
</li><li><p>Backup ID, which works together with an RBS to identify an RBP to which users belong</p>
</li><li><p>User access parameters</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0175388114__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure VRRP and BFD on the access side of the master and backup BRASs (BRAS1 and BRAS2) to determine the master/backup status and implement fault association.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the access-side aggregation switch does not support BFD, skip this step. This example describes only the configuration on this product. For details about how to configure BFD sessions on the switch, see the related manual.</p>
</div></div>
</p><p><p># Configure a BFD session named <strong>bfd-peer</strong> between BRAS1 and BRAS2. The BFD session shares the same link with the access-side VRRP group. The following uses BRAS1 as an example. The configuration of BRAS2 is similar to that of BRAS1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bfd</strong>
[<span class="keyword">*</span>BRAS1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1]  <strong>bfd bfd</strong><strong>-</strong><strong>peer</strong><strong> bind peer-ip 10.1.1.2</strong><strong> source-ip 10.1.1.1</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd-peer] <strong>discriminator local 1</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd-peer] <strong>discriminator remote 1</strong>
[<span class="keyword">*</span>BRAS1-bfd-session-bfd-peer] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bfd-session-bfd-peer] <strong>quit</strong></pre>
<p># Configure a BFD session <strong>bfd-link</strong> between BRAS1 and SW1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>BRAS1] <strong>interface GigabitEthernet<span>0/2/1</span>.2</strong>
[*BRAS1-GigabitEthernet<span>0/2/1</span>.2] <strong>vlan-type dot1q 2</strong>
[*BRAS1-GigabitEthernet<span>0/2/1</span>.2] <strong>ip address </strong><strong>10.1.10.1 </strong><strong>255.255.255.0</strong>
[*BRAS1-GigabitEthernet<span>0/2/1</span>.2] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>BRAS1-GigabitEthernet<span>0/2/1</span>.2] <strong>quit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>BRAS1]<strong>bfd bfd-link bind peer-ip 192.168.2.2 source-ip 192.168.2.1</strong>
[*BRAS1-bfd-session-bfd-link]<strong> discriminator local 2</strong>
[*BRAS1-bfd-session-bfd-link]<strong> discriminator remote 2</strong>
[*BRAS1-bfd-session-bfd-link]<strong> commit </strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>BRAS1-bfd-session-bfd-link]<strong> quit </strong></pre>
<p># Configure a VRRP group on an interface (GE<span>0/2/1</span>.1 is used as an example), and configure VRRP to track the BFD session and network-side interface status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/2/1</span>.1</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>vlan-type dot1q 1</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>ip address 10.1.1.1 255.255.255.0</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>vrrp vrid 1 virtual-ip 10.1.1.100</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>admin-vrrp vrid 1</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>vrrp vrid 1 priority 120</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>vrrp vrid 1 preempt-mode timer delay 60</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>vrrp vrid 1 track interface GigabitEthernet <span>0/2/0</span> reduced 50</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>vrrp vrid 1 track bfd-session 2 link</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>BRAS2] <strong>interface GigabitEthernet <span>0/2/1</span>.1</strong> 
[*BRAS2-GigabitEthernet<span>0/2/1</span>.1] <strong>vlan-type dot1q 1</strong> 
[*BRAS2-GigabitEthernet<span>0/2/1</span>.1] <strong>ip address 10.1.1.2 255.255.255.0</strong>
[*BRAS2-GigabitEthernet<span>0/2/1</span>.1] <strong>vrrp vrid 1 virtual-ip 10.1.1.100</strong> 
[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/2/1</span>.1] <strong>admin-vrrp vrid 1</strong> 
[*BRAS2-GigabitEthernet<span>0/2/1</span>.1] <strong>vrrp vrid 1 track bfd-session 1 peer</strong>
[*BRAS2-GigabitEthernet<span>0/2/1</span>.1] <strong>commit</strong>
[<font style="font-size:8pt" Face="Courier New" >~</font>BRAS2-GigabitEthernet<span>0/2/1</span>.1] <strong>quit</strong></pre>
</p></li><li><span>Configure AAA schemes.</span><ol type="a"><li class="substepexpand"><span>Configure an authentication scheme.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> authentication-scheme radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-radius]<strong> authentication-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-radius]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-authen-radius]<strong> quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an accounting scheme.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> accounting-scheme radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-radius]<strong> accounting-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-radius]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-radius]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
</p></li></ol>
</li><li><span>Configure a RADIUS server group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> radius-server group radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-radius]<strong> radius-server authentication 192.168.7.249 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-radius]<strong> radius-server accounting 192.168.7.249 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-radius]<strong> radius-server shared-key-cipher YsHsjx_202206 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-radius]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> commit</strong></pre>
</p></li><li><span>Configure an IPv6 address pool.</span><ol type="a"><li class="substepexpand"><span>Configure a local IPv6 prefix pool.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 prefix prefix1 local</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre1] <strong>prefix 2001:db8:1::1/64</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pre1] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a local IPv6 address pool named <strong>pool1</strong> and bind the local IPv6 prefix pool to it.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 pool pool1 bas local</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool1] <strong>prefix prefix1</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-pool-pool1] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure an AAA domain and bind the IPv6 address pool to it.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>domain dom1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dom1] <strong>authentication-scheme radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dom1] <strong>accounting-scheme radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dom1] <strong>radius-server group radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-dom1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-dom1] <strong>ipv6-pool pool1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-dom1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure a BAS interface and enable IPv6 on the interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/2/1</span>.333</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>ipv6 nd autoconfig managed-address-flag   </strong>                                      
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>ipv6 nd autoconfig other-flag</strong>  
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>user-vlan 1 10 qinq 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333-vlan-1-10-QinQ-100-100] <strong>bas</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333-bas] <strong>access-type layer2-subscriber default-domain authentication dom1</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333-bas] <strong>authentication-method-ipv6 bind</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333-bas] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333-bas] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>quit</strong></pre>
</p></li><li><span>Configure an RBS and an RBP.</span><p><p># Configure an IP address for the backup channel. The route needs to be advertised.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>BRAS1-loopback1] <strong>ip address 10.1.2.1 255.255.255.255</strong>
[<span class="keyword">*</span>BRAS1-loopback1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-loopback1] <strong>ospf prefix-sid index 10</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-loopback1] <strong>quit</strong></pre>
<p># Configure an RBS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service rui</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-rui] <strong>peer 10.1.2.2 source 10.1.2.1 port 6001</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-rui] <strong>track interface GigabitEthernet<span>0/2/0</span></strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-rui] <strong>ipv6-pool pool1 </strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-rui] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-rui] <strong>quit</strong></pre>
<p># Configure an RBP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>service-type bras</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>backup-id 101 remote-backup-service rui</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>peer-backup hot</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>vrrp-id 1 interface gigabitethernet <span>0/2/1</span>.1</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-prf-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-prf-p1] <strong>quit</strong></pre>
<p># Bind the RBP to the interface through which users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface gigabitethernet <span>0/2/1</span>.333</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>remote-backup-profile p1</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/2/1</span>.333] <strong>quit</strong></pre>
</p></li><li><span>Configure MPLS.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls lsr-id 10.1.2.1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>mpls</strong>
[<span class="keyword">*</span>BRAS1-mpls] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls] <strong>mpls ldp</strong>
[<span class="keyword">*</span>BRAS1-mpls-ldp] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls] <strong>quit</strong></pre>
</p></li><li><span>Configure OSPF.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ospf 1</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>import-route direct </strong>                                                            
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>area 0.0.0.0 </strong>                                                                   
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>network 10.1.2.1 0.0.0.0</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>quit</strong></pre>
</p></li><li><span>Enable SR.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>segment-routing</strong>
[<span class="keyword">*</span>BRAS1-segment-routing] <strong>tunnel-prefer segment-routing</strong>
[<span class="keyword">*</span>BRAS1-segment-routing] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-segment-routing] <strong>quit</strong></pre>
</p></li><li><span>Configure a prefix SID for the IP address of a loopback interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ospf 1</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>opaque-capability enable</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>segment-routing mpls</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>segment-routing </strong><strong>global-block 160000 161000</strong>
[<span class="keyword">*</span>BRAS1-ospf-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>BRAS1-loopback1] <strong>ospf enable 1 area 1</strong>
[<span class="keyword">*</span>BRAS1-loopback1] <strong>ospf prefix-sid index 10</strong>
[<span class="keyword">*</span>BRAS1-loopback1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-loopback1] <strong>quit</strong></pre>
</p></li><li><span>Configure a protection tunnel between the master and backup devices.</span><ul><li>Configure the simplified protection tunnel mode.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Both IPv4 and IPv6 traffic can enter the tunnel.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service rui</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-rui] <strong>protect lsp-tunnel for-all-instance peer-ip 10.1.2.2</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-rui] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-rui] <strong>quit</strong></pre>
</li></ul>
<ul><li>Configure a tunnel policy that selects the SR-MPLS BE tunnel as the protection tunnel.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Only IPv4 public network traffic can enter the tunnel.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service rui</strong>
[<span class="keyword">*</span>BRAS1-rm-backup-srv-rui] <strong>protect tnl-policy p1 peer-ip 10.1.2.2</strong>
[<span class="keyword">*</span>BRAS1] <strong>tunnel-policy p1</strong>
[<span class="keyword">*</span>BRAS1-tunnel-policy-p1] <strong>tunnel select-seq sr-lsp load-balance-number 1</strong>  
[<span class="keyword">*</span>BRAS1-tunnel-policy-p1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-tunnel-policy-p1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>tunnel-selector s1 permit node  10</strong>
[<span class="keyword">*</span>BRAS1-tunnel-selector] <strong>commit</strong><strong> </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-tunnel-selector] <strong>apply tunnel-policy p1</strong>
[<span class="keyword">*</span>BRAS1-tunnel-selector] <strong>com</strong><strong>mit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-tunnel-selector] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bgp 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bgp] <strong>ipv6-family unicast</strong>
[<span class="keyword">*</span>BRAS1-bgp-af-ipv6] <strong>unicast-route recursive-lookup tunnel tunnel-selector s1</strong>
[<span class="keyword">*</span>BRAS1-bgp-af-ipv6] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bgp-af-ipv6] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bgp] <strong>quit</strong></pre>
</li></ul>
</li><li><span>Verify the configuration.</span><p><p># Run the following command. The command output shows that the SR-MPLS BE protection tunnel is successfully established.</p>
<pre class="screen">&lt;BRAS1&gt; <strong>display segment-routing prefix mpls forwarding </strong></pre>
<pre class="screen"> --------------------------------------------------------------------------------------------------------------
 Segment Routing Prefix MPLS Forwarding Information
 --------------------------------------------------------------------------------------------------------------
 Role : I-Ingress, T-Transit, E-Egress, I&amp;T-Ingress And Transit
 Prefix          Label      OutLabel   Interface         NextHop          Role  MPLSMtu   Mtu     State          
 ---------------------------------------------------------------------------------------------------------------
 10.1.2.1/32     160010     160010     GE<span>0/2/1</span>           10.1.2.2         I&amp;T   ---       1500    Active
 10.1.2.2/32     160030     NULL       Loopback1         10.1.2.1         I&amp;T   ---       1500    Active</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0175388114__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>BRAS1 configuration file</p>
<pre class="screen">#
sysname BRAS1
#
bfd
#
bfd bfd-peer bind peer-ip 10.1.1.2 source-ip 10.1.1.1
 discriminator local 1
 discriminator remote 1 
# 
bfd bfd-link bind peer-ip 10.1.10.2 source-ip 10.1.10.1
 discriminator local 2
 discriminator remote 2 
#
mpls lsr-id 10.1.2.1
#
mpls
#
mpls ldp
#
ipv6 prefix prefix1 local
 prefix 2001:db8:1::1/64
#
ipv6 pool pool1 bas local
 prefix prefix1
#
radius-server group radius
 radius-server shared-key-cipher %^%#glhJ;yPG#$=tC&amp;(Is%q!S_";(k.Ef$:978$$e:TY%^%
 radius-server authentication 192.168.7.249 1812 weight 0
 radius-server accounting 192.168.7.249 1813 weight 0
#
aaa
 authentication-scheme radius
 accounting-scheme radius
 #
 domain dom1 
  authentication-scheme radius
  accounting-scheme radius
  radius-server group radius 
  ipv6-pool pool1
#
remote-backup-service rui 
 peer 10.1.2.2 source 10.1.2.1 port 6001 
 protect lsp-tunnel for-all-instance peer-ip 10.1.2.2 
 track interface GigabitEthernet<span>0/2/0</span> 
 ipv6-pool pool1
 protect tnl-policy p1 peer-ip 10.1.2.2
# 
segment-routing
 tunnel-prefer segment-routing
#
tunnel-policy p1
 tunnel select-seq sr-lsp load-balance-number 1
#
tunnel-selector s1 permit node 10
 apply tunnel-policy p1
#
ospf 1
 import-route direct 
 area 0.0.0.0 
 network 10.1.2.1 0.0.0.0
 opaque-capability enable
 segment-routing mpls
 segment-routing global-block 160000 161000
#
bgp 100
#
 ipv6-family unicast
  unicast-route recursive-lookup tunnel tunnel-selector s1
#
remote-backup-profile p1 
 service-type bras 
 backup-id 101 remote-backup-service rui 
 peer-backup hot 
 vrrp-id 1 interface GigabitEthernet<span>0/2/1</span>.1
#
interface GigabitEthernet<span>0/2/1</span>.1 
 vlan-type dot1q 1 
 ip address 10.1.1.1 255.255.255.0 
 vrrp vrid 1 virtual-ip 10.1.1.100 
 admin-vrrp vrid 1 
 vrrp vrid 1 priority 120
 vrrp vrid 1 preempt-mode timer delay 60 
 vrrp vrid 1 track interface GigabitEthernet<span>0/2/0</span> reduced 50 
 vrrp vrid 1 track bfd-session 2 link
#
interface GigabitEthernet<span>0/2/1</span>.2
 vlan-type dot1q 2
 ip address 10.1.10.1 255.255.255.0
#
interface <span>GigabitEthernet</span><span>0/2/1</span>.333            
 ipv6 enable  
 ipv6 address auto link-local                  
 ipv6 nd autoconfig managed-address-flag       
 ipv6 nd autoconfig other-flag                           
 user-vlan 1 10 qinq 100  
 remote-backup-profile p1                       
 bas          
  access-type layer2-subscriber default-domain authentication dom1  
  authentication-method-ipv6 bind
#
interface LoopBack1
 ip address 10.1.2.1 255.255.255.255
 ospf enable 1 area 1
 ospf prefix-sid index 10
#
bfd bfd1 bind peer-ip 10.1.1.2
 discriminator local 8
 discriminator remote 6
 commit 
#
 return </pre>
</li><li><p>BRAS2 configuration file</p>
<pre class="screen">#
sysname BRAS2
#
ipv6
#
bfd
#
bfd bfd-peer bind peer-ip 10.1.1.2 source-ip 10.1.1.1
 discriminator local 1 
 discriminator remote 1 
#
mpls lsr-id 10.1.2.2
#
mpls
#
mpls ldp
#
ipv6 prefix prefix1 local 
 prefix 2001:db8:1::1/64
#
ipv6 pool pool1 bas local rui-slave
 prefix prefix1
#
radius-server group radius
 radius-server shared-key-cipher %^%#glhJ;yPG#$=tC&amp;(Is%q!S_";(k.Ef$:978$$e:TY%^%
 radius-server authentication 192.168.7.249 1812 weight 0
 radius-server accounting 192.168.7.249 1813 weight 0
#
aaa
 authentication-scheme radius
 accounting-scheme radius
 #
 domain dom1   
  authentication-scheme radius
  accounting-scheme radius
  radius-server group radius           
  ipv6-pool pool1
#
remote-backup-service rui
 peer 10.1.2.1 source 10.1.2.2 port 6001
 protect lsp-tunnel for-all-instance peer-ip 10.1.2.1
 track interface GigabitEthernet<span>0/2/0</span>
 ipv6-pool pool1
 protect tnl-policy p1 peer-ip 10.1.2.1 
# 
segment-routing
 tunnel-prefer segment-routing
#
tunnel-policy p1
 tunnel select-seq sr-lsp load-balance-number 1
#
tunnel-selector s1 permit node 10
 apply tunnel-policy p1
#
ospf 1
 import-route direct
 area 0.0.0.0
 network 10.1.2.2 0.0.0.0
 opaque-capability enable
 segment-routing mpls
 segment-routing global-block 160000 161000
#
bgp 100
#
 ipv6-family unicast
  unicast-route recursive-lookup tunnel tunnel-selector s1
#
remote-backup-profile p2
 service-type bras
 backup-id 101 remote-backup-service rui
 peer-backup hot
 vrrp-id 1 interface GigabitEthernet<span>0/2/1</span>.1
#
interface GigabitEthernet<span>0/2/1</span>.1 
 vlan-type dot1q 1 
 ip address 10.1.1.2 255.255.255.0 
 vrrp vrid 1 virtual-ip 10.1.1.100 
 admin-vrrp vrid 1 
 vrrp vrid 1 track bfd-session 1 peer
#
interface <span>GigabitEthernet</span> <span>0/2/1</span>.332          
 ipv6 enable  
 ipv6 address auto link-local                  
 ipv6 nd autoconfig managed-address-flag       
 ipv6 nd autoconfig other-flag                            
 user-vlan 1 10 qinq 100
 remote-backup-profile p2                      
 bas          
  access-type layer2-subscriber default-domain authentication dom1
  authentication-method-ipv6 bind
#
interface LoopBack1
 ip address 10.1.2.2 255.255.255.255
 ospf enable 1 area 1
 ospf prefix-sid index 20
#
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_0050.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_1001.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_rui_00532_01.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>