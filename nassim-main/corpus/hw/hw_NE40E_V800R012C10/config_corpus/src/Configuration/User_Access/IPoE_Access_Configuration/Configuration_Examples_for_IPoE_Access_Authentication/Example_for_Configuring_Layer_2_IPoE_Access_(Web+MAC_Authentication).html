
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Layer 2 IPoE Access (Web+MAC Authentication)">
<meta name="abstract" content="This section provides an example for configuring Layer 2 IPoE access (web+MAC authentication). The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring Layer 2 IPoE access (web+MAC authentication). The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_bras_0009_web.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0148.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,ipoxne,c00549182,w00556928,l00593348,w00606909,w00447999,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="IPoE">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374008">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Layer 2 IPoE Access (Web+MAC Authentication)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374008"></a><a name="EN-US_TASK_0172374008"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Layer 2 IPoE Access (Web+MAC Authentication)</h1>
<div class="taskbody"><p>This section provides an example for configuring Layer 2 IPoE access (web+MAC authentication). The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374008__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Web+MAC authentication is the most common authentication mode for Layer 2 IPoE user access. This authentication mode requires a user to enter the username and password on a portal page when accessing the network for the first time. The RADIUS server associates the automatically recorded terminal MAC address with the username. Later, the user can access the network again without re-entering the username and password within a specified period after the first access.</p>
<p>The authentication process is as follows:</p>
<p>By default, the user enters the MAC authentication domain. If the user accesses the network for the first time, the MAC address fails to be found on the RADIUS server and the authentication fails. The user is forcibly switched to the web authentication domain and can access only the web authentication page. On this page, the user enters the username and password for authentication. After the authentication is successful, the user enters the post-authentication domain <strong>after-auth</strong> and can access network resources. If the user accesses the network not for the first time, the MAC address can be found on the RADIUS server and the authentication succeeds. The user then enters the post-authentication domain <strong>after-auth</strong> and can access network resources.</p>
<div class="fignone"><span class="figcap"><b>Figure 1 </b>Configuring Layer 2 IPoE access (web+MAC authentication)</span><br><span><img class="vsd" src="images/fig_dc_ne_cfg_bras_000901.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374008__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create a MAC authentication domain named <strong>mac-auth</strong>, a web authentication domain named <strong>web-auth</strong>, and a web post-authentication domain named <strong>after-auth</strong>.</p>
</li><li><p>Configure AAA schemes and adopt RADIUS authentication and RADIUS accounting.</p>
</li><li><p>Create a RADIUS server group named <strong>d</strong>. In the RADIUS server group view, configure the device to carry the HW-Auth-Type attribute in Access-Request packets to be sent to the RADIUS server.</p>
</li><li><p>Create an authentication scheme named <strong>mac-auth</strong>, and configure the device to redirect users to the web authentication domain <strong>web-auth</strong> when authentication fails.</p>
</li><li><p>Enable MAC authentication in the MAC authentication domain <strong>mac-auth</strong>, and bind the RADIUS server group <strong>d</strong> and authentication scheme <strong>mac-auth</strong> to the domain.</p>
</li><li><p>Configure forcible redirection to a specified web server in the web authentication domain <strong>web-auth</strong>, and bind a user group, an authentication scheme (none authentication), and an accounting scheme (none accounting) to the domain so that users in the user group can access only limited network resources.</p>
</li><li><p>Bind an authentication scheme (RADIUS authentication) and accounting scheme (RADIUS accounting) to the web post-authentication domain <strong>after-auth</strong>.</p>
</li><li><p>Configure the device to generate a pure username based on the MAC address carried in a user connection request packet in the AAA view.</p>
</li><li><p>Configure a MAC authentication domain and a post-authentication domain on the BAS interface.</p>
</li></ol>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374008__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a MAC authentication domain named <strong>mac-auth</strong>, a web authentication domain named <strong>web-auth</strong>, and a post-authentication domain named <strong>after-auth</strong>.</span><p><p># Create a MAC authentication domain named <strong>mac-auth</strong>, a web authentication domain named <strong>web-auth</strong>, and a web post-authentication domain named <strong>after-auth</strong>.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>domain mac-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>domain web-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>domain after-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure AAA schemes and a RADIUS server group.</span><p><p># Create a RADIUS server group named <strong>d</strong>, configure the device to carry the HW-Auth-Type attribute in Access-Request packets to be sent to the RADIUS server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>radius-server group d</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-d]<strong> radius-server authentication 192.168.8.249 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-d]<strong> radius-server accounting 192.168.8.249 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-d]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-radius-d]<strong> radius-server type standard</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-d]<strong> radius-server shared-key-cipher </strong><strong>YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-d]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-radius-d] <strong>radius-attribute include hw-auth-type</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-d] <strong>radius-server attribute translate</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-d] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-radius-d] <strong>quit</strong></pre>
<p># Create an authentication scheme named <strong>mac-auth</strong>, and configure the device to redirect users to the web authentication domain <strong>web-auth</strong> when authentication fails.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>authentication-scheme mac-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-mac-auth] <strong>authening authen-fail online authen-domain web-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-mac-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-authen-mac-auth] <strong>quit</strong></pre>
<p># Configure an authentication scheme named <strong>auth2</strong>, with RADIUS authentication specified.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth2]<strong> authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-authen-auth2]<strong> quit</strong></pre>
<p># Configure an accounting scheme named <strong>acct2</strong>, with RADIUS accounting specified.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct2]<strong> accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-accounting-acct2]<strong> quit</strong></pre>
<p># Configure an authentication scheme named <strong>auth3</strong>, with none authentication specified.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> authentication-scheme auth3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth3]<strong> authentication-mode none</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-authen-auth3]<strong> quit</strong></pre>
<p># Configure an accounting scheme named <strong>acct3</strong>, with none accounting specified.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> accounting-scheme acct3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct3]<strong> accounting-mode none</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-accounting-acct3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure an address pool.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> ip pool pool2 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> gateway 172.16.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> section 0 172.16.1.2 172.16.1.200</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> dns-server 192.168.8.252</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-ip-pool-pool2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-pool2]<strong> quit</strong></pre>
</p></li><li><span>Enable MAC authentication in the MAC authentication domain <strong>mac-auth</strong>, and bind the RADIUS server group <strong>d</strong> and authentication scheme <strong>mac-auth</strong> to the domain.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>domain mac-auth</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>dom-aaa-domain-mac-auth] <strong>radius-server group d</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>authentication-scheme mac-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>ip-pool pool2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>mac-authentication enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-mac-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure forcible redirection to a specified web server in the web authentication domain <strong>web-auth</strong>, and bind a user group, an authentication scheme (none authentication), and an accounting scheme (none accounting) to the domain so that users in the user group can access only the web authentication page.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> user-group web-before</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> domain web-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth]<strong> authentication-scheme auth3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth]<strong> accounting-scheme acct3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth]<strong> ip-pool pool2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth]<strong> user-group web-before</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth]<strong> web-server 192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth]<strong> web-server url http://192.168.8.251</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth] <strong>web-server url-parameter</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-web-auth] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> </strong><strong>quit</strong></pre>
<p># Configure an IP address used by the device to receive portal packets from the web authentication server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface</strong> <strong>LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-LoopBack0] <strong>ip address 10.6.55.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-LoopBack0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> web-auth-server source-ip 10.6.55.1</strong></pre>
<p># Configure a web authentication server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>web-auth-server enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>web-auth-server source interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> web-auth-server 192.168.8.251 key cipher webvlan</strong></pre>
<p># Configure ACL rules.</p>
<ol type="a"><li># Configure an ACL numbered 6004 to permit the traffic between the user group <strong>web-before</strong> and the web authentication server and between the user group <strong>web-before</strong> and the DNS server.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> acl number 6004</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6004] <strong>rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6004] <strong>rule 10 permit ip source ip-address 192.168.8.251 0 destination user-group web-before</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6004] <strong>rule 15 permit ip source user-group web-before destination ip-address 192.168.8.252 0</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6004] <strong>rule 20 permit ip source ip-address 192.168.8.252 0 destination user-group web-before</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6004] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6004] <strong>quit</strong></pre>
</li><li># Configure an ACL numbered 6005 and create ACL rules to match TCP packets from the user group <strong>web-before</strong> and with a destination port of www or 8080, so that HTTP redirect can be performed for the packets.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> acl number 6005</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6005]<strong> rule 5 permit tcp source user-group web-before destination-port eq www</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6005] <strong>rule 10 permit tcp source user-group web-before destination-port eq 8080</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6005] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6005] <strong>quit</strong></pre>
</li><li># Configure an ACL numbered 6008 to deny all the traffic originating from the user group <strong>web-before</strong>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> acl number 6008</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6008] <strong>rule 5 permit ip source ip-address any destination user-group web-before</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6008] <strong>rule 10 permit ip source user-group web-before destination ip-address any</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6008] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6008] <strong>quit</strong></pre>
</li></ol>
<p># Configure a traffic policy.</p>
<p>a. Configure traffic classifiers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic classifier web-be-permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-web-be-permit]<strong> if-match acl 6004</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-web-be-permit] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-web-be-permit]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic classifier redirect</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-redirect]<strong> if-match acl 6005</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-redirect] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-redirect]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic classifier web-be-deny</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-web-be-deny]<strong> if-match acl 6008</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-web-be-deny] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-web-be-deny]<strong> quit</strong></pre>
<p>b. Configure traffic behaviors.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic behavior perm1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-perm1]<strong> permit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-perm1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-perm1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic behavior redirect</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-redirect]<strong> http-redirect</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-redirect] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-redirect]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic behavior deny1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-deny1]<strong> deny</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-deny1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-deny1]<strong> quit</strong></pre>
<p>c. Configure a traffic policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic policy web</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-web]<strong> share-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-web]<strong> classifier web-be-permit behavior perm1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-web]<strong> classifier redirect behavior redirect</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-web]<strong> classifier web-be-deny behavior deny1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-trafficpolicy-web] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-trafficpolicy-web]<strong> quit</strong></pre>
<p># Apply the traffic policy globally.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> traffic-policy web inbound</strong></pre>
</p></li><li><span>Configure an authentication domain named <strong>after-auth</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa]<strong> domain after-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth]<strong> authentication-scheme auth2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth]<strong> accounting-scheme acct2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth]<strong> radius-server group d</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-after-auth]<strong> quit</strong></pre>
</p></li><li><span>Configure the device to generate a pure username based on the MAC address carried in a user connection request packet in the AAA view.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>default-user-name include mac-address -</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>default-password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure a MAC authentication domain, post-authentication domain, and authentication method on a BAS interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface gigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>-bas] <strong>access-type layer2-subscriber default-domain pre-authentication mac-auth authentication after-auth</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>-bas] <strong>authentication-method web</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>-bas] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374008__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen">#</pre>
<pre class="screen">sysname <span class="keyword">HUAWEI</span></pre>
<pre class="screen">#
radius-server group d
 radius-server shared-key-cipher %^%#W)&lt;2!w*fb2&lt;lJf5$6S|($o\aAaq`_C!FAt*Yk-&lt;!%^%#
 radius-server authentication 192.168.8.249 1812 weight 0
 radius-server accounting 192.168.8.249 1813 weight 0  
 radius-server attribute translate
 radius-attribute include HW-Auth-Type
#
ip pool pool2 bas local
 gateway 172.16.1.1 255.255.255.0
 section 0 172.16.1.2 172.16.1.200
 dns-server 192.168.8.252
#
user-group web-before
#
acl number 6004
 rule 5 permit ip source user-group web-before destination ip-address 192.168.8.251 0
 rule 10 permit ip source ip-address 192.168.8.251 0 destination user-group web-before
 rule 15 permit ip source user-group web-before destination ip-address 192.168.8.252 0
 rule 20 permit ip source ip-address 192.168.8.252 0 destination user-group web-before
#
acl number 6005
 rule 5 permit tcp source user-group web-before destination-port eq www
 rule 10 permit tcp source user-group web-before destination-port eq 8080
#
acl number 6008
 rule 5 permit ip source ip-address any destination user-group web-before
 rule 10 permit ip source user-group web-before destination ip-address any
#
traffic classifier redirect operator or
 if-match acl 6005 precedence 4
#
traffic classifier web-be-deny operator or
 if-match acl 6008 precedence 5
#
traffic classifier web-be-permit operator or
 if-match acl 6004 precedence 3
#
traffic behavior deny1
 deny
#
traffic behavior perm1
#
traffic behavior redirect
 http-redirect
#
traffic policy web
 share-mode
 classifier web-be-permit behavior perm1 precedence 1
 classifier redirect behavior redirect precedence 2  
 classifier web-be-deny behavior deny1 precedence 3
#
aaa
 default-user-name include mac-address -
 default-password cipher %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^%#
 #
 authentication-scheme auth2
 #
 authentication-scheme auth3
  authentication-mode none
 #
 authentication-scheme mac-auth
  authening authen-fail online authen-domain web-auth
 #
 accounting-scheme acct2
 #
 accounting-scheme acct3
  accounting-mode none
 #
 domain after-auth
  authentication-scheme auth2
  accounting-scheme acct2
  radius-server group d
 #
 domain mac-auth
  authentication-scheme mac-auth
  accounting-scheme acct2
  radius-server group d
  ip-pool pool2
  mac-authentication enable
 #
 domain web-auth
  authentication-scheme auth3
  accounting-scheme acct3
  ip-pool pool2
  user-group web-before
  web-server 192.168.8.251
  web-server url http://192.168.8.251
  web-server url-parameter
#
interface GigabitEthernet<span>0/1/0</span>
 bas
 #
  access-type layer2-subscriber default-domain pre-authentication mac-auth authentication after-auth
  authentication-method web
#
interface LoopBack0
 ip address 10.6.55.1 255.255.2555.255
#
web-auth-server enable
web-auth-server source interface LoopBack 0
web-auth-server 192.168.8.251 key cipher %^%#aQL6,Ua&lt;|@sxPQK/1f'4/GBJ6,6)q&gt;$Z^7*,!2yR%^%#
<span>#</span>
<span>undo web-auth-server source-ip all</span>
<span>web-auth-server source-ip 10.6.55.1</span>
<span>#</span>
<span>undo web-auth-server source-ipv6 all</span>
#
traffic-policy web inbound
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0083.html">Configuration Examples for IPoE Access Authentication
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cfg_bras_0009_web.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ipox_cfg_0148.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>