
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an L2TP Tunnel to Access an L3VPN">
<meta name="abstract" content="This section provides an example for configuring an L2TP tunnel to access an L3VPN. A networking diagram is provided to help you understand the configuration procedure. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="description" content="This section provides an example for configuring an L2TP tunnel to access an L3VPN. A networking diagram is provided to help you understand the configuration procedure. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013506.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013508.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013510.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00588052,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="L2TP">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374279">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an L2TP Tunnel to Access an L3VPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172374279"></a><a name="EN-US_TASK_0172374279"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an L2TP Tunnel to Access an L3VPN</h1>
<div class="taskbody"><p>This section provides an example for configuring an L2TP tunnel to access an L3VPN. A networking diagram is provided to help you understand the configuration procedure. The example provides the networking requirements, configuration roadmap, configuration procedure, and configuration files.</p>
<div class="context"><a name="EN-US_TASK_0172374279__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172374279__fig_dc_ne_l2tp_cfg_01350901">Figure 1</a>, <span class="keyword">Device</span>A and <span class="keyword">Device</span>B function as the LAC and LNS, respectively. The headquarters domain name of enterprise01 is isp1 and PC1 is a user of enterprise01. The headquarters domain name of enterprise02 is isp2 and PC2 is a user of enterprise02. Multiple enterprises share the same LNS, and users of different enterprises need to communicate with their headquarters. The network addresses of the headquarters are private addresses. Generally, users cannot directly access the Intranet server through the Internet. By configuring VPNs and multi-instances, users can access the Intranet data.</p>
<div class="fignone" id="EN-US_TASK_0172374279__fig_dc_ne_l2tp_cfg_01350901"><a name="EN-US_TASK_0172374279__fig_dc_ne_l2tp_cfg_01350901"></a><a name="fig_dc_ne_l2tp_cfg_01350901"></a><span class="figcap"><b>Figure 1 </b>Configuring L3VPN access over L2TP tunnels</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/2/0</span>, GE<span>0/1/1</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0172374281.png" width="NaN" height="NaN"></span><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p>Device</p>
</td>
<td valign="top"><p>Interface</p>
</td>
<td valign="top"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span>A</p>
</td>
<td valign="top"><p>GigabitEthernet<span>0/1/1</span>.1</p>
</td>
<td valign="top"><p>11.11.11.1/24</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span>A</p>
</td>
<td valign="top"><p>GigabitEthernet<span>0/2/0</span>.100</p>
</td>
<td valign="top"><p>-</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span>A</p>
</td>
<td valign="top"><p>LoopBack0</p>
</td>
<td valign="top"><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span>B</p>
</td>
<td valign="top"><p>GigabitEthernet<span>0/1/1</span>.1</p>
</td>
<td valign="top"><p>11.11.11.2/24</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span>B</p>
</td>
<td valign="top"><p>GigabitEthernet<span>0/2/0</span>.100</p>
</td>
<td valign="top"><p>-</p>
</td>
</tr>
<tr><td valign="top"><p><span class="keyword">Device</span>B</p>
</td>
<td valign="top"><p>LoopBack0</p>
</td>
<td valign="top"><p>3.3.3.3/32</p>
</td>
</tr>
</table></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374279__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Addresses of different VPN instances can overlap.</p>
</div></div>
<ol><li><p>Configure a dial-up connection on the user side.</p>
</li><li><p>Configure the LAC.</p>
<ul><li>Configure the PPPoE access service for the LAC, including configuring a VT and AAA schemes, binding an interface to the VT, and configuring a BAS interface.</li><li>Enable L2TP.</li><li>Configure an L2TP tunnel connection on the LAC side.</li><li>Configure a tunnel authentication mode.</li><li>Configure L2TP user attributes.</li><li>Configure a routing protocol (static routing in this example) to ensure that routes between the LAC and LNS are reachable.</li></ul>
</li><li><p>Configure the LNS.</p>
<ul><li>Create a VPN instance.</li><li>Configure a VT.</li><li>Configure an L2TP tunnel connection on the LNS.</li><li>Configure a tunnel authentication mode and user authentication mode.</li><li>Configure LNS-side tunnel parameters.</li><li>Configure an address pool for allocating IP addresses to L2TP users and bind the VPN instance to the address pool.</li><li>Configure a domain for L2TP users, specify an address pool for the domain, and bind the VPN instance to the domain.</li><li>Configure a routing protocol (static routing in this example) to ensure that routes between the LAC and LNS are reachable.</li><li>Assign an IP address to the interface connected to the enterprise network and bind the VPN instance to the interface.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172374279__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Usernames and passwords of PC1 and PC2</p>
</li><li><p>Tunnel password, and the local tunnel name and peer tunnel name on the LNS side</p>
</li><li><p>VPN instance name, RD, and RT</p>
</li><li><p>Numbers of two VTs and two L2TP groups</p>
</li><li><p>IDs, address ranges, and address masks of remote address pools</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This section provides only the L2TP-related configuration procedure.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374279__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Perform configuration on the user side.</span><p><p>Establish a dial-up network connection, with the access number of <span class="keyword">Device</span>A specified to receive the address assigned by the LNS.</p>
<p>For PC1, enter the username (user1@isp1) and password, which have been registered at the LNS, in the displayed dial-up terminal window.</p>
<p>For PC2, enter the username (user1@isp2) and password, which have been registered at the LNS, in the displayed dial-up terminal window.</p>
</p></li><li><span>Configure <span class="keyword">Device</span>A (on the LAC side).</span><p><p># Configure VT1.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>&gt; <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Virtual-Template1]<strong> ppp authentication-mode chap</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-Virtual-Template1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-Virtual-Template1]<strong> quit</strong></pre>
<p># Bind VT1 to GE <span>0/2/0</span>.100.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> interface gigabitethernet <span>0/2/0</span>.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100]<strong> pppoe-server bind virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100] <strong>user-vlan 1 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100-vlan-1-100] <strong>quit</strong></pre>
<p># Configure a BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100]<strong> bas</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100-bas]<strong> access-type layer2-subscriber</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100-bas]<strong> authentication-method ppp</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100-bas]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100-bas]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/2/0</span>.100]<strong> quit</strong></pre>
<p># Configure the sub-interface connecting the LAC to the LNS. This sub-interface must be the same as the sub-interface connecting the LNS to the LAC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet<span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 11.11.11.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<p># Create a loopback interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>ip address 1.1.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-LoopBack0] <strong>quit</strong></pre>
<p># Configure an L2TP group and specify the related attributes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> l2tp enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> l2tp-group lac1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-lac1]<strong> tunnel name lac1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-lac1]<strong> start l2tp ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-lac1]<strong> tunnel authentication</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-lac1]<strong> tunnel password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-lac1] <strong>tunnel source loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-l2tp-lac1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-l2tp-lac1]<strong> quit</strong></pre>
<p># Configure a RADIUS server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1]<strong> radius-server authentication 10.20.20.1 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1]<strong> radius-server accounting 10.20.20.1 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1]<strong> radius-server shared-key itellin</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-radius-radius1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-radius-radius1]<strong> quit</strong></pre>
<p># Configure user domains.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa]<strong> domain isp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>l2tp-group lac1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>authentication-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>accounting-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>idle-cut 60 500</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-isp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa] <strong>domain isp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp2]<strong> l2tp-group lac1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp2]<strong> radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp2]<strong> authentication-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp2]<strong> accounting-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp2]<strong> </strong><strong>idle-cut 60 500</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-aaa-domain-isp2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa-domain-isp2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-aaa]<strong> quit</strong></pre>
<p># Configure a route.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ip route-static 3.3.3.3 255.255.255.255 11.11.11.2</strong></pre>
</p></li><li><span>Configure <span class="keyword">Device</span>B (on the LNS side).</span><p><p># Create two VPN instances.</p>
<pre class="screen">&lt;<span class="keyword">Device</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>&gt; <strong>sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>ip vpn-instance vrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-vrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-vrf1] <strong>apply-label per-instance</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-vrf1] <strong>vpn-target 100:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>Bâvpn-instance-vrf1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>Bâvpn-instance-vrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip vpn-instance vrf2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-vrf2] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-vrf2] <strong>apply-label per-instance</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-vpn-instance-vrf2] <strong>vpn-target 100:2 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>Bâvpn-instance-vrf2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>Bâvpn-instance-vrf2] <strong>quit</strong></pre>
<p># Create a sub-interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet<span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>.1] <strong>ip address 11.11.11.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<p># Create a loopback interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>ip address 3.3.3.3 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-LoopBack0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-LoopBack0] <strong>quit</strong></pre>
<p># Create VT1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> interface virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Template1]<strong> ppp authentication-mode chap</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-Virtual-Template1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-Virtual-Template1]<strong> quit</strong></pre>
<p># Enable L2TP and configure an L2TP group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> l2tp enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> l2tp-group lns1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-lns1]<strong> tunnel name lns1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-lns1]<strong> allow l2tp virtual-template 1 remote lac1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-lns1]<strong> tunnel authentication</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-lns1]<strong> tunnel password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-l2tp-lns1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-l2tp-lns1]<strong> quit</strong></pre>
<p># Create and configure the LNS group named <strong>group1</strong>, and bind the tunnel source interface and tunnel board to the LNS group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> lns-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-lns-group-group1]<strong> bind slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-lns-group-group1]<strong> bind source loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-lns-group-group1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-lns-group-group1]<strong> quit</strong></pre>
<p># Configure an address pool from which addresses are assigned to users.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> ip pool pool1 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> gateway 10.10.0.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> section 0 10.10.0.10 10.10.0.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1] <strong>vpn-instance vrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> ip pool pool2 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> gateway 10.10.0.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> section 0 10.10.0.10 10.10.0.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2] <strong>vpn-instance vrf2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-ip-pool-pool2]<strong> quit</strong></pre>
<p># Configure a RADIUS server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1]<strong> radius-server authentication 10.20.20.1 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1]<strong> radius-server accounting 10.20.20.1 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1]<strong> radius-server shared-key itellin</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-radius-radius1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-radius-radius1]<strong> quit</strong></pre>
<p># Configure user domains.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B]<strong> aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa]<strong> domain isp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp1] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp1]<strong> authentication-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp1]<strong> accounting-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp1]<strong> ip-pool pool1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp1] <strong>vpn-instance vrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-isp1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> domain isp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2] <strong>radius-server group radius1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> authentication-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> accounting-scheme default1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> ip-pool pool2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2] <strong>vpn-instance vrf2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa-domain-isp2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-aaa]<strong> quit</strong></pre>
<p># Configure a route.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ip route-static 1.1.1.1 255.255.255.255 11.11.11.1</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ping 3.3.3.3</strong></pre>
<pre class="screen">PING 3.3.3.3: 56  data bytes, press CTRL_C to break                           
    Reply from 3.3.3.3: bytes=56 Sequence=1 ttl=255 time=12 ms                  
    Reply from 3.3.3.3: bytes=56 Sequence=2 ttl=255 time=10 ms                  
    Reply from 3.3.3.3: bytes=56 Sequence=3 ttl=255 time=5 ms                   
    Reply from 3.3.3.3: bytes=56 Sequence=4 ttl=255 time=8 ms                   
                                                                                
  --- 3.3.3.3 ping statistics ---                                               
    4 packet(s) transmitted                                                     
    4 packet(s) received                                                        
    0.00% packet loss                                                           
    round-trip min/avg/max = 5/8/12 ms                           </pre>
<pre class="screen">                </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>test l2tp-tunnel l2tp-group lac1 ip-address 3.3.3.3</strong></pre>
<pre class="screen">Testing L2TP tunnel connectivity now....... </pre>
<pre class="screen">Test L2TP tunnel connectivity success.</pre>
<p># Check that the VPN user can access the headquarters.</p>
<p>PC1 can access Headquarter01 and PC2 can access Headquarter02.</p>
<p>If PC1 enters the username user1@isp2 and the password, PC1 can access Headquarter02 as a user of vrf2.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172374279__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>A</pre>
<pre class="screen">#</pre>
<pre class="screen"> l2tp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">radius-server group radius1</pre>
<pre class="screen"> radius-server authentication 10.20.20.1 1812 </pre>
<pre class="screen"> radius-server accounting 10.20.20.1 1813 </pre>
<pre class="screen"> radius-server shared-key %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^% </pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Template1</pre>
<pre class="screen"> ppp authentication-mode chap</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span>.100</pre>
<pre class="screen"> pppoe-server bind Virtual-Template 1</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> user-vlan 1 100</pre>
<pre class="screen"> bas</pre>
<pre class="screen">  access-type layer2-subscriber</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">l2tp-group lac1</pre>
<pre class="screen"> tunnel password cipher %@%##!!!!!!!!!"!!!!#!!!!(!!!!JMi&amp;5#;qTW7C9)&amp;16<font style="font-size:8pt" Face="Courier New" >~</font>.M{sv*SzKjgN&gt;0b[,G:tb%!!!!!!!!!!1!!!!E'QA&gt;XV7kJ+tIm3UL=c=%@%#</pre>
<pre class="screen"> tunnel name lac1</pre>
<pre class="screen"> start l2tp ip 3.3.3.3</pre>
<pre class="screen"> tunnel source LoopBack0</pre>
<pre class="screen">#</pre>
<pre class="screen">aaa</pre>
<pre class="screen">domain isp1</pre>
<pre class="screen">  authentication-scheme default1</pre>
<pre class="screen">  accounting-scheme default1</pre>
<pre class="screen">  radius-server group radius1</pre>
<pre class="screen">  idle-cut 60 500</pre>
<pre class="screen">  l2tp-group lac1</pre>
<pre class="screen">domain isp2</pre>
<pre class="screen">  authentication-scheme default1</pre>
<pre class="screen">  accounting-scheme default1</pre>
<pre class="screen">  radius-server group radius1</pre>
<pre class="screen">  idle-cut 60 500</pre>
<pre class="screen">  l2tp-group lac1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span>.1</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> vlan-type dot1q 1</pre>
<pre class="screen"> ip address 11.11.11.1 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen"> ip route-static 3.3.3.3 255.255.255.255 11.11.11.2</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname <span class="keyword">Device</span>B</pre>
<pre class="screen">#</pre>
<pre class="screen"> l2tp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">radius-server group radius1</pre>
<pre class="screen"> radius-server authentication 10.20.20.1 1812 </pre>
<pre class="screen"> radius-server accounting 10.20.20.1 1813 </pre>
<pre class="screen"> radius-server shared-key %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^% </pre>
<pre class="screen">#</pre>
<pre class="screen">interface Virtual-Template1</pre>
<pre class="screen"> ppp authentication-mode chap</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance vrf1</pre>
<pre class="screen"> route-distinguisher 100:1</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 100:1 export-extcommunity</pre>
<pre class="screen"> vpn-target 100:1 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">ip vpn-instance vrf2</pre>
<pre class="screen"> route-distinguisher 100:2</pre>
<pre class="screen"> apply-label per-instance</pre>
<pre class="screen"> vpn-target 100:2 export-extcommunity</pre>
<pre class="screen"> vpn-target 100:2 import-extcommunity</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack0</pre>
<pre class="screen"> ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">l2tp-group lns1</pre>
<pre class="screen"> allow l2tp virtual-template 1 remote lac1</pre>
<pre class="screen"> tunnel password cipher %@%##!!!!!!!!!"!!!!#!!!!(!!!!JMi&amp;5#;qTW7C9)&amp;16<font style="font-size:8pt" Face="Courier New" >~</font>.M{sv*SzKjgN&gt;0b[,G:tb%!!!!!!!!!!1!!!!E'QA&gt;XV7kJ+tIm3UL=c=%@%#</pre>
<pre class="screen"> tunnel name lns1</pre>
<pre class="screen">#</pre>
<pre class="screen">lns-group group1</pre>
<pre class="screen"> bind slot <span>1</span> </pre>
<pre class="screen"> bind source LoopBack0</pre>
<pre class="screen">#</pre>
<pre class="screen">ip pool pool1 bas local</pre>
<pre class="screen"> vpn-instance vrf1</pre>
<pre class="screen"> gateway 10.10.0.1 255.255.255.0</pre>
<pre class="screen"> section 0 10.10.0.10 10.10.0.100</pre>
<pre class="screen">#</pre>
<pre class="screen">ip pool pool2 bas local</pre>
<pre class="screen"> vpn-instance vrf2</pre>
<pre class="screen"> gateway 10.10.0.1 255.255.255.0</pre>
<pre class="screen"> section 0 10.10.0.10 10.10.0.100</pre>
<pre class="screen">#</pre>
<pre class="screen">aaa</pre>
<pre class="screen">domain  isp1</pre>
<pre class="screen">  authentication-scheme default1</pre>
<pre class="screen">  accounting-scheme default1</pre>
<pre class="screen">  radius-server group radius1</pre>
<pre class="screen">  vpn-instance vrf1</pre>
<pre class="screen">  ip-pool pool1</pre>
<pre class="screen">domain  isp2</pre>
<pre class="screen">  authentication-scheme default1</pre>
<pre class="screen">  accounting-scheme default1</pre>
<pre class="screen">  radius-server group radius1</pre>
<pre class="screen">  vpn-instance vrf2</pre>
<pre class="screen">  ip-pool pool2</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/1</span>.1</pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> vlan-type dot1q 1</pre>
<pre class="screen"> ip address 11.11.11.2 255.255.255.0</pre>
<pre class="screen">#</pre>
<pre class="screen"> ip route-static 1.1.1.1 255.255.255.255 11.11.11.1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013506.html">Configuration Examples for L2TP Access
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013508.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_l2tp_cfg_013510.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>