
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Example for Configuring PPPoEv6 User Access in a 6PE Scenario">
<meta name="abstract" content="This section provides an example for configuring PPPoEv6 user access in a 6PE scenario. The BRAS uses RADIUS authentication and accounting to implement user access.">
<meta name="description" content="This section provides an example for configuring PPPoEv6 user access in a 6PE scenario. The BRAS uses RADIUS authentication and accounting to implement user access.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppox_cfg_0183.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppoxv6_cfg_0070.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppoxv6_cfg_0057.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,z00588052,c00549182,w00556928,l00593348,w00606909,b00542525,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="dcAudienceJob" content="Configuration">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="featurename" content="PPPoE Access">
<meta name="featuretype" content="User Access">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00588052">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_CONCEPT_0204843995">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring PPPoEv6 User Access in a 6PE Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_CONCEPT_0204843995"></a><a name="EN-US_CONCEPT_0204843995"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring PPPoEv6 User Access in a 6PE Scenario</h1>
<div><p>This section provides an example for configuring PPPoEv6 user access in a 6PE scenario. The BRAS uses RADIUS authentication and accounting to implement user access.</p>
<div class="section"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_CONCEPT_0204843995__fig16472113232919">Figure 1</a>, an IPv4/MPLS network is deployed between two discontinuous IPv6 networks. 6PE can be deployed to allow the two IPv6 networks to communicate with each other. In 6PE mode, IPv4 and IPv6 dual stacks are implemented on the PEs of an ISP. The labels allocated by MP-BGP are used to identify IPv6 routes, and the LSPs established between the PEs are used to implement IPv6 interworking. An IPv6 user terminal connects to PE1 over CE1. After the IPv6 user initiates a PPPoE connection request, PE1 implements RADIUS authentication and accounting. After the IPv6 user passes the authentication, user packets need to traverse the IPv4/MPLS backbone network to reach the destination IPv6 network. PE1 that functions as a 6PE device converts IPv6 packets into the MPLS packets that can be transmitted on the IPv4 backbone network. The MPLS packets are then forwarded to PE2 that also functions as a 6PE device through LSPs. After receiving the MPLS packets, PE2 removes MPLS labels from the packets, checks the IPv6 routing table, and forwards the packets based on the destination address contained in the restored IPv6 packet header. In this manner, CE1 and CE2 can communicate with each other over an IPv4 network.</p>
<div class="fignone" id="EN-US_CONCEPT_0204843995__fig16472113232919"><a name="EN-US_CONCEPT_0204843995__fig16472113232919"></a><a name="fig16472113232919"></a><span class="figcap"><b>Figure 1 </b>Configuring PPPoEv6 user access in a 6PE scenario</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 4 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, loopback 0, and loopback 1, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0207896343.png" width="518.7" height="156.482879" title="Click to enlarge"></span></div>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure user access on PE1.</li><li>Configure OSPF on PE1 and PE2 so that they can learn the IP address of the loopback interface from each other.</li><li>Enable MPLS and MPLS LDP on the backbone network and establish an LDP LSP between PE1 and PE2.</li><li>Establish a 6PE peer relationship between PE1 and PE2.</li><li>Configure BGP4+ between PE1 and CE1 and between PE2 and CE2 to exchange IPv6 routes.</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Number of the AS where each device resides</p>
</li><li>Router ID of each device</li><li><p>Virtual template number</p>
</li><li><p>RADIUS authentication and accounting schemes and their names</p>
</li><li><p>RADIUS server group name and RADIUS server addresses</p>
</li><li><p>Start ID and end ID of a VLAN range created on a BAS interface</p>
</li><li><p>Local prefix pool name</p>
</li><li><p>Assignable IPv6 prefixes and prefix lengths</p>
</li><li><p>Local address pool name</p>
</li><li><p>Domain name</p>
</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Procedure</h4><ol><li>Configure user access on PE1.<ol type="a"><li>Configure a virtual template.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface virtual-template 1</strong>
[<span class="keyword">*</span>PE1-Virtual-Template1]<strong> ppp authentication-mode chap</strong>
[<span class="keyword">*</span>PE1-Virtual-Template1] <strong>quit</strong>
[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
</li><li>Configure authentication and accounting schemes.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa]<strong> authentication-scheme auth1</strong>
[<span class="keyword">*</span>PE1-aaa-authen-auth1] <strong>authentication-mode radius</strong>
[<span class="keyword">*</span>PE1-aaa-authen-auth1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-aaa] <strong>accounting-scheme auth1</strong>
[<span class="keyword">*</span>PE1-aaa-accounting-auth1] <strong>accounting-mode radius</strong>
[<span class="keyword">*</span>PE1-aaa-accounting-auth1]<strong> quit</strong>
[<span class="keyword">*</span>PE1-aaa] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa] <strong>quit</strong></pre>
</li><li>Configure a RADIUS server group.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>PE1-radius-rd1]<strong> radius-server authentication 192.168.7.249 1645</strong>
[<span class="keyword">*</span>PE1-radius-rd1]<strong> radius-server accounting 192.168.7.249 1646</strong>
[<span class="keyword">*</span>PE1-radius-rd1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-radius-rd1]<strong> radius-server type standard</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-radius-rd1]<strong> radius-server shared-key-cipher YsHsjx_202206</strong>
[<span class="keyword">*</span>PE1-radius-rd1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-radius-rd1]<strong> quit</strong></pre>
</li><li>Configure a local IPv6 prefix pool.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ipv6 prefix pre1 local </strong>
[<span class="keyword">*</span>PE1-ipv6-prefix-pre1] <strong>prefix 2001:db8:1::1/64</strong>
[<span class="keyword">*</span>PE1-ipv6-prefix-pre1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ipv6-prefix-pre1] <strong>quit</strong></pre>
</li><li>Configure a local IPv6 address pool and bind the local IPv6 prefix pool to the local IPv6 address pool.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ipv6 pool pool1 bas local</strong> 
[<span class="keyword">*</span>PE1-ipv6-pool-pool1] <strong>prefix pre1</strong>
[<span class="keyword">*</span>PE1-ipv6-pool-pool1] <strong>dns-server 2001:db8:4::1 </strong>
[<span class="keyword">*</span>PE1-ipv6-pool-pool1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ipv6-pool-pool1] <strong>quit</strong> </pre>
</li><li>Configure a domain named <strong>isp1</strong>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa]<strong> domain isp1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1]<strong> authentication-scheme auth1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1]<strong> accounting-scheme acct1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1]<strong> ipv6-pool pool1</strong>
[<span class="keyword">*</span>PE1-aaa-domain-isp1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa-domain-isp1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-aaa]<strong> quit</strong></pre>
</li><li>Configure interfaces.<p># Bind the virtual template to GE <span>0/1/0</span>.1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet </strong><strong><span>0/1/0</span></strong>.<strong>1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> pppoe-server bind virtual-template 1</strong></pre>
<p># Configure a BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> user-vlan 1 100</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1-vlan-1-100]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> bas</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1-bas]<strong> access-type layer2-subscriber default-domain authentication isp1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1-bas]<strong> authentication-method-ipv6 ppp</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1-bas] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1-bas]<strong> quit</strong></pre>
<p># Enable IPv6 on the interface.</p>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong>
[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure an upstream interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:db8:3::1/64 eui-64</strong>
[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
</li></ol>
</li><li>Configure OSPF between PE1 and PE2 so that PE1 and PE2 can learn the routes to each other's loopback interfaces. For configuration details, see Configuration Files.</li><li>Enable MPLS and MPLS LDP on the backbone network and establish an LDP LSP between PE1 and PE2.<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 2.2.2.2 </strong>
[<span class="keyword">*</span>PE1]<strong> mpls</strong>
[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong>
[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 3.3.3.3</strong> 
[<span class="keyword">*</span>PE2] <strong>mpls</strong> 
[<span class="keyword">*</span>PE2] <strong>quit</strong> 
[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong> 
[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong> 
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong> 
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong> 
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong> 
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on PE1. The command output shows that an LDP session has been established between PE1 and PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp session</strong>
  LDP Session(s) in Public Network  Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)  
  An asterisk (*) before a session means the session is being deleted.   
--------------------------------------------------------------------------  
PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------  
3.3.3.3:0         Operational DU   Passive  000:00:35     143/199 
-------------------------------------------------------------------------- 
TOTAL: 1 Session(s) Found.</pre>
</li><li>Establish a 6PE peer relationship between PE1 and PE2.<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> bgp 200</strong> 
[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 200</strong> 
[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack0 </strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family unicast </strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>import-route direct</strong> 
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>peer 3.3.3.3 enable </strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>peer 3.3.3.3 label-route-capability</strong> 
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>quit </strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong> 
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 200 </strong>
[<span class="keyword">*</span>PE2-bgp] <strong>peer 2.2.2.2 as-number 200</strong> 
[<span class="keyword">*</span>PE2-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack0</strong> 
[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family unicast</strong> 
[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>import-route direct</strong> 
[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>peer 2.2.2.2 enable</strong> 
[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>peer 2.2.2.2 label-route-capability</strong> 
[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>commit</strong> 
[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>quit</strong> 
[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong> 
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># After the configuration is complete, run the <strong>display bgp ipv6 peer</strong> command on PE1. The command output shows that a BGP peer relationship has been established between PE1 and PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp ipv6 peer</strong>
  BGP local router ID : 2.2.2.2  
  Local AS number : 200  Total number of peers : 2                 Peers in established state : 2 
  Peer            V          AS  MsgRcvd     MsgSent  OutQ  Up/Down      State     PrefRcv
  3.3.3.3         4         200     1248     1342      0 18:06:28    <strong>Established</strong>      1</pre>
</li><li>Configure BGP4+ between PE1 and CE1 and between PE2 and CE2 to exchange IPv6 routes.<p># Configure CE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>CE1] <strong>bgp 100</strong> 
[*CE1-bgp] <strong>router-id 5.5.5.5</strong> 
[*CE1-bgp] <strong>peer 2001:db8:1::2 as-number 200</strong> 
[*CE1-bgp]<strong> ipv6-family unicast </strong>
[*CE1-bgp-af-ipv6] <strong>peer 2001:db8:1::2 enable</strong> 
[*CE1-bgp-af-ipv6] <strong>network 2001:db8:5::5 128</strong> 
[*CE1-bgp-af-ipv6] <strong>commit</strong> 
[<font style="font-size:8pt" Face="Courier New" >~</font>CE1-bgp-af-ipv6] <strong>quit</strong> 
[<font style="font-size:8pt" Face="Courier New" >~</font>CE1-bgp]<strong> quit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 200</strong> 
[<span class="keyword">*</span>PE1-bgp]<strong> peer 2001:db8:1::1 as-number 100</strong> 
[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family unicast</strong> 
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>peer 2001:db8:1::1 enable </strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>commit</strong> 
[<span class="keyword">*</span>PE1-bgp-af-ipv6] <strong>quit</strong> 
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bgp 200</strong>
[<span class="keyword">*</span>PE2-bgp]<strong> peer 2001:db8:2::1 as-number 300</strong>
[<span class="keyword">*</span>PE2-bgp]<strong> ipv6-family unicast</strong>
[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>peer 2001:db8:2::1 enable</strong>
[<span class="keyword">*</span>PE2-bgp-af-ipv6] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-ipv6]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp]<strong> quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> bgp 300</strong>
[<span class="keyword">*</span>CE2-bgp]<strong> router-id 6.6.6.6</strong>
[<span class="keyword">*</span>CE2-bgp]<strong> peer 2001:db8:2::2 as-number 200</strong>
[<span class="keyword">*</span>CE2-bgp]<strong> ipv6-family unicast</strong>
[<span class="keyword">*</span>CE2-bgp-af-ipv6] <strong>peer 2001:db8:2::2 enable</strong>
[<span class="keyword">*</span>CE2-bgp-af-ipv6]<strong> network 2001:db8:6::6 128</strong>
[<span class="keyword">*</span>CE2-bgp-af-ipv6]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-bgp-af-ipv6]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-bgp]<strong> quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp ipv6 peer</strong> command on PE1. The command output shows that a BGP peer relationship has been established between PE1 and CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp ipv6 peer</strong>
  BGP local router ID : 2.2.2.2 
  Local AS number : 100 
  Total number of peers : 2         Peers in established state : 2    
  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State      PrefRcv   
  3.3.3.3         4         200       59       60     0 00:35:46   <strong>Established</strong>        1   
  2001:db8:1::1   4         100       40       45     0 00:06:16   <strong>Established</strong>        1</pre>
</li><li>Verify the configuration.<p># After completing the configurations, run the <strong>display ipv6 prefix pre1</strong> command to view information about the prefix pool named <strong>pre1</strong>. The command output shows that <strong>pre1</strong> is a local prefix pool and the prefix address is <strong>2001:db8::/64</strong>.</p>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1&gt; <strong>display ipv6 prefix pre1</strong>  
-------------------------------------------------------------  
Prefix Name        : pre1  
Prefix Index       : 4 
Prefix constant index: -  
Prefix Type        : LOCAL  
Prefix Address     : <strong>2001:db8::</strong>  
Prefix Length      : 64 
Reserved Type      : NONE    V
valid Lifetime      : 3 Days 0 Hours 0 Minutes  
Preferred Lifetime : 2 Days 0 Hours 0 Minutes  
IfLocked           : Unlocked 
Vpn instance       : -        
Conflict address   : - 
Free Prefix Count  : 262144  
Used Prefix Count  : 0  
Reserved Prefix Count: 0   </pre>
<p># Run the <strong>display ipv6 pool pool1</strong> command to view information about the address pool named <strong>pool1</strong>. The command output shows that <strong>pool1</strong> is a local address pool on the user side and the local prefix pool <strong>pre1</strong> is bound to the address pool <strong>pool1</strong>.</p>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1&gt; <strong>display ipv6 pool pool1  </strong>
----------------------------------------------------------------------  
Pool name          : pool1  
Pool No            : 4    
Pool-constant-index :-   
Pool type          : BAS LOCAL  
Preference         : 0  
Renew time         : 50  
Rebind time        : 80  
Status              : UNLOCKED  
Refresh interval   : 0 Days 0 Hours 0 Minutes  
Used by domain     : 1  
Dhcpv6 Unicast     : disable  
Dhcpv6 rapid-commit: disable  
Dns list             : -  
Dns server master  : 2001:db8:4::1  
Dns server slave   : - 
AFTR name          : -   
----------------------------------------------------------------------  
Prefix-Name                      Prefix-Type  
----------------------------------------------------------------------  
<strong>pre1</strong>                               LOCAL 
---------------------------------------------------------------------- </pre>
<p># Run the <strong>display domain isp1</strong> command to view information about the domain named <strong>isp1</strong>. The command output shows that the IPv6 address pool named <strong>pool1</strong> is bound to this domain.</p>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1&gt; <strong>display domain isp1 </strong>
------------------------------------------------------------------------------   
Domain-name                     : isp1   
Domain-state                    : Active   
Authentication-scheme-name      : auth1  
Accounting-scheme-name          : acct1   
Authorization-scheme-name       :   
Primary-DNS-IP-address          : -   
Second-DNS-IP-address           : -   
Web-server-URL-parameter        : No   
Slave Web-IP-address            : -   
Slave Web-URL                   : -   
Slave Web-auth-server           : -    
Slave Web-auth-state            : -    
Portal-server-URL-parameter     : No   
Primary-NBNS-IP-address         : -   
Second-NBNS-IP-address          : -   
User-group-name                 : -   
Idle-data-attribute (time,flow) : 0, 60   I
nstall-BOD-Count                : 0   
Report-VSM-User-Count           : 0   
Value-added-service             : default   
User-access-limit               : 279552   
Online-number                   : 0   
Web-IP-address                  : -   
Web-URL                         : -   
Portal-server-IP                : -   
Portal-URL                      : -   
Portal-force-times              : 2   
PPPoE-user-URL                  : Disable     
RADIUS-server-template          : rd1   
Two-acct-template               : -   
HWTACACS-server-template        : -   
Bill Flow                       : Disable   
Tunnel-acct-2867                : Disabled    
Flow Statistic:   
Flow-Statistic-Up               : Yes   
Flow-Statistic-Down             : Yes   
Source-IP-route                 : Disable   
IP-warning-threshold            : -   
IPv6-warning-threshold          : -    
Multicast Forwarding            : Yes   
Multicast Virtual               : No   
Max-multilist num               : 4   
Multicast-profile               : -   
Multicast-profile ipv6          : -     
IPv6-Pool-name                  : <strong>pool1</strong>   
Quota-out                       : Offline   
Service-type                    : -   
User-basic-service-ip-type      : -/-/-   
PPP-ipv6-address-protocol       : Ndra   
IPv6-information-protocol       : Stateless dhcpv6   
IPv6-PPP-assign-interfaceid     : Disable   
Trigger-packet-wait-delay       : 60s   
Peer-backup                     : enable      
------------------------------------------------------------------------------ </pre>
</li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Configuration Files</h4><p># CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface gigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:1::1/64
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:db8:5::5/128
#
bgp 100
 router-id 5.5.5.5
 peer 2001:db8:1::2 as-number 200
 #
 ipv4-family unicast
  undo synchronization 
 #
 ipv6-family unicast
  undo synchronization 
  network 2001:db8:5::5 128
  peer 2001:db8:1::2 enable
#
return</pre>
<p># PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
radius-server group rd1
 radius-server authentication 2001:db8:4::2 1645 weight 0
 radius-server accounting 2001:db8:4::2 1646 weight 0
 radius-server shared-key-cipher %^%#vS%796FO7%C<font style="font-size:8pt" Face="Courier New" >~</font>pB%CR=q;j}gSCqR-X6+P!.DYI@)%^% 
#
interface Virtual-Template1
 ppp authentication-mode chap
#
ipv6 prefix pre1 local
prefix 2001:db8:1::1/64
#
ip pool pool1 bas local
prefix pre1
dns-server 2001:db8:4::1
#
aaa
 authentication-scheme auth1
 authentication-mode radius
 accounting-scheme acct1
 accounting-mode radius
#
domain  isp1
 authentication-scheme auth1
 accounting-scheme acct1
 ipv6-pool pool1
 radius-server group rd1
#
interface gigabitethernet <span>0/1/0</span>.1
 pppoe-server bind Virtual-Template 1
 ipv6 enable
 ipv6 address auto link-local
 bas
 access-type layer2-subscriber default-domain authentication isp1
#
interface gigabitEthernet <span>0/2/0</span>
 ipv6 enable
 ipv6 address 2001:db8:3::1/64 eui-64
 ipv6 address auto link-local
#
return
#
sysname PE1
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface gigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:1::2/64
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.0.0.1 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
bgp 200
 peer 3.3.3.3 as-number 200
 peer 3.3.3.3 connect-interface LoopBack0
 peer 2001:db8:1::1 as-number 100
#
 ipv4-family unicast
  undo synchronization 
  peer 3.3.3.3 enable
 #
 ipv6-family unicast
  undo synchronization 
  import-route direct
  peer 3.3.3.3 enable
  peer 3.3.3.3 label-route-capability
  peer 2001:db8:1::1 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.0.0.0 0.0.0.3
#
return</pre>
<p># PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
interface gigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:2::2/64
#
interface gigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.0.0.2 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
bgp 200
 peer 2.2.2.2 as-number 200
 peer 2.2.2.2 connect-interface LoopBack0
 peer 2001:db8:2::1 as-number 300
#
 ipv4-family unicast
  undo synchronization 
  peer 2.2.2.2 enable
 #
 ipv6-family unicast
  undo synchronization 
  import-route direct
  peer 2.2.2.2 enable
  peer 2.2.2.2 label-route-capability
  peer 2001:db8:2::1 enable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.0.0.0 0.0.0.3
#
return</pre>
<p># CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface gigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:2::1/64
#
interface LoopBack1
 ipv6 enable
 ipv6 address 2001:db8:6::6/128
#
bgp 300
 router-id 6.6.6.6
 peer 2001:db8:2::2 as-number 200
 #
 ipv4-family unicast
  undo synchronization 
 #
 ipv6-family unicast
  undo synchronization 
  network 2001:db8:6::6 128
  peer 2001:db8:2::2 enable
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppox_cfg_0183.html">PPPoE Access Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppoxv6_cfg_0070.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pppoxv6_cfg_0057.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>