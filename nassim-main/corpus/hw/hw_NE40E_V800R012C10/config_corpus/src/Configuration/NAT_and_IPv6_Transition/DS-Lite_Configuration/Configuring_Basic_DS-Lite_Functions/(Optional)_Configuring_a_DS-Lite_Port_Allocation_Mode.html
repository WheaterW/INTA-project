
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring a DS-Lite Port Allocation Mode">
<meta name="abstract" content="Configuring a port allocation mode helps manage port resources.">
<meta name="description" content="Configuring a port allocation mode helps manage port resources.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ds-lite_cfg_0009.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ds-lite_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ds-lite_cfg_00015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="DS-Lite">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="DS-Lite">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="DS-Lite">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="DS-Lite">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="g00814582">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374694">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring a DS-Lite Port Allocation Mode</title>
</head>
<body><a name="EN-US_TASK_0172374694"></a><a name="EN-US_TASK_0172374694"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring a DS-Lite Port Allocation Mode</h1>
<div class="taskbody"><p>Configuring a port allocation mode helps manage port resources.</p>
<div class="context"><a name="EN-US_TASK_0172374694__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">DS-Lite supports the following port allocation modes:<ul><li><p>Dynamic port pre-allocation (Port Dynamic) enables a DS-Lite device to pre-allocate a public IP address and a port range with 64 ports to a private IP address. If the number of used ports exceeds the initial port range size, the DS-Lite device assigns another port range with 64 ports to the user. The allocation process repeats without a limit on the maximum number of extended port ranges. This mode features high usage of public network IP addresses, but involves a huge amount of log information. This requires a log server to handle logs.</p>
</li><li><div class="p">The semi-dynamic port allocation (Semi-Dynamic) mode is an extension of the port range mode. Semi-dynamic port allocation extends a single port segment used in the port range mode to three parameters:<ul><li>Initial port range</li><li>Extended port range</li><li>Maximum number of times a port range can be extended</li></ul>
</div>
<p>Before users go online, a DS-Lite device assigns an initial port segment and ports in the initial segment to users. If the number of used ports exceeds the initial port segment size, the device assigns an extended port segment, which can repeat for a specified maximum number of times.</p>
</li><li><p>Port pre-allocation: A port number range is pre-allocated on a DS-Lite device. When the first flow of a specific user arrives, the DS-Lite device selects a public IP address and associates the configured port number range with the user. Then ports are selected from this port number range to perform address-port replacement for all subsequent traffic of the user. The DS-Lite device records log information during the allocation and reclamation of the port number range. This mode involves a small amount of DS-Lite log information, facilitating log checking.</p>
</li></ul>
</div>
<p>During network deployment, a port allocation mode is configured based on the service scale. </p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374694__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Select a port allocation mode as needed. Perform one of the following operations:</span><p><div class="p"><ul><li><p>Configure a port allocation mode in the DS-Lite instance view.</p>
<ol type="a"><li><p>Run <span><a href="cmdqueryname=ds-lite+instance"><b><span class="cmdname">ds-lite instance</span></b></a> <i><span class="varname">instance-name</span></i> [ <strong><span>id</span></strong> <i><span class="varname">id</span></i> ]</span></p>
<p>The DS-Lite instance view is displayed.</p>
</li><li><p>Configure the port allocation mode.</p>
<p>Run <a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> <i><span class="varname">initial-port-range</span></i> [ <strong><span>extended-port-range</span></strong> <i><span class="varname">extended-port-range</span></i> <strong><span>extended-times</span></strong> <i><span class="varname">extended-times</span></i> ]</p>
<p>The port pre-allocation mode is configured.</p>
<div class="p">After this command is run, ports work in pre-allocation modes.<ul><li>To configure the static port pre-allocation mode, run the <a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> command without <strong><span>extended-port-range</span></strong> <i><span class="varname">extended-port-range</span></i> or <strong><span>extended-times</span></strong> <i><span class="varname">extended-times</span></i> configured.</li><li>To configure the semi-dynamic port pre-allocation mode, run the <a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> command with <strong><span>extended-port-range</span></strong> <i><span class="varname">extended-port-range</span></i> and <strong><span>extended-times</span></strong> <i><span class="varname">extended-times</span></i> configured.</li></ul>
</div>
<p>The port allocation mode takes effect only on new users in a DS-Lite instance.</p>
</li></ol>
</li><li><p>Configure a port allocation mode in a NAT policy template.</p>
<ol type="a"><li><p>Run <span><a href="cmdqueryname=nat-policy+template"><b><span class="cmdname">nat-policy template</span></b></a> <i><span class="varname">template-name</span></i></span></p>
<p>A NAT policy template is created.</p>
</li><li><p>Run <span><a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> <i><span class="varname">initial-port-range</span></i> [ <strong><span>extended-port-range</span></strong> <i><span class="varname">extended-port-range</span></i> <strong><span>extended-times</span></strong> <i><span class="varname">extended-times</span></i> ]</span></p>
<p>The port pre-allocation mode is configured.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> command is run in both the NAT policy template view and DS-Lite instance view, the configuration in the NAT policy template view takes effect. If the <a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> command is not run in the NAT policy template view, the configuration in the DS-Lite instance view takes effect.</p>
<p>If the <a href="cmdqueryname=port-single+enable"><b><span class="cmdname">port-single enable</span></b></a> command is run in the NAT instance view, the per-port allocation mode configured in the instance takes effect, regardless of whether the <a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> command is run in the NAT policy template view. If the <a href="cmdqueryname=port-single+enable"><b><span class="cmdname">port-single enable</span></b></a> command is not run in the NAT instance view, the <a href="cmdqueryname=port-range"><b><span class="cmdname">port-range</span></b></a> command run in the NAT policy template view takes effect.</p>
<p>The configurations in a NAT policy template take effect only after the NAT policy template is issued by a RADIUS server. If packets of users to go online match the NAT policy template, the configuration in the template takes effect on the users.</p>
</div></div>
</li></ul>
</div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=port-reuse+enable"><b><span class="cmdname">port-reuse enable</span></b></a></span><p><p>The port reuse function is enabled for TCP and other protocols.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>By default, sessions of different protocols using the same private IP address cannot share the same public port during port pre-allocation. After port reuse is enabled, for the same private IP address, TCP sessions can share a public port with sessions of other protocols.</li><li>The <a href="cmdqueryname=port-reuse+enable"><b><span class="cmdname">port-reuse enable</span></b></a> and <span><a href="cmdqueryname=port-single"><b><span class="cmdname">port-single</span></b></a> <strong><span>enable</span></strong></span> commands are mutually exclusive.</li></ul>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ds-lite_cfg_0009.html">Configuring Basic DS-Lite Functions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ds-lite_cfg_0010.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_ds-lite_cfg_00015.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>