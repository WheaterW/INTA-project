
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring the NAT Log Function">
<meta name="abstract" content="You can configure the NAT log function to record NAT operation information in real time, which strengthens device maintainability.">
<meta name="description" content="You can configure the NAT log function to record NAT operation information in real time, which strengthens device maintainability.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0046.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0048.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374569">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring the NAT Log Function</title>
</head>
<body><a name="EN-US_TASK_0172374569"></a><a name="EN-US_TASK_0172374569"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring the NAT Log Function</h1>
<div class="taskbody"><p>You can configure the NAT log function to record NAT operation information in real time, which strengthens device maintainability.</p>
<div class="context"><a name="EN-US_TASK_0172374569__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>NAT logs are generated by a NAT device during NAT operation. The information contains basic user information and system information generated during NAT operation. NAT logs also record intranet users' access to external networks and external users' access to intranet servers. When intranet users access an external network through the NAT device, they share an external network address. For this reason, the users cannot be located. The log function helps record intranet users' access to external networks in real time, enhancing network maintainability.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Only <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span> support the configuration of user logs, TCP-based log sending, and log host backup.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374569__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>(Optional) Configure an IPsec tunnel. For details, see <a href="../vrp/dc_vrp_ipsec_cfg_0001.html">Configuration &gt; Security &gt; IPsec Configuration</a>.</span><p><p>For the sake of security, you are advised to configure an IPsec tunnel to implement encrypted NAT log transfer. Particularly, IPsec must be configured on both the master and backup devices in inter-chassis backup scenarios.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+log+tcp+start-port"><b><span class="cmdname">nat log tcp start-port</span></b></a> <i><span class="varname">port</span></i></span><p><p>The start port number used by the NAT device to send user logs to a log host through TCP is set.</p>
</p><p><p>To establish a TCP connection between a NAT device and a log host, run this command to set the start port number used in the TCP connection.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+log+user+keepalive+enable+syslog+type3"><b><span class="cmdname">nat log user keepalive enable syslog type3</span></b></a></span><p><p>The Keepalive log function is enabled for NAT users, with the type 3 log format.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+log+user+keepalive+interval"><b><span class="cmdname">nat log user keepalive interval</span></b></a> <i><span class="varname">interval-num</span></i></span><p><p>The interval for sending Keepalive logs for NAT users is set.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+log+rate"><b><span class="cmdname">nat log rate</span></b></a> <i><span class="varname">rate-value</span></i></span><p><p>The rate at which NAT logs are sent is set.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+log+host+detect+enable"><b><span class="cmdname">nat log host detect enable</span></b></a></span><p><p>Heartbeat detection for the NAT log server is enabled.</p>
</p><p><ul><li><p>To set the detection interval and the maximum number of consecutive detection failures for an ICMP log server, run the <a href="cmdqueryname=nat+log+host+detect+icmp+interval+failed-times+interval"><b><span class="cmdname">nat log host detect icmp</span></b></a> { <strong><span>interval</span></strong> <i><span class="varname">interval-value</span></i> | <strong><span>failed-times</span></strong> <i><span class="varname">detect-failed-times</span></i> | <strong><span>interval</span></strong> <i><span class="varname">interval-value</span></i> <strong><span>failed-times</span></strong> <i><span class="varname">detect-failed-times</span></i> } command on the NAT device.</p>
</li><li><p>To set the detection interval and the maximum number of detection recovery times for a UDP log server, run the <a href="cmdqueryname=nat+log+host+detect+udp+interval+recovery-times+interval"><b><span class="cmdname">nat log host detect udp</span></b></a> { <strong><span>interval</span></strong> <i><span class="varname">interval-value</span></i> | <strong><span>recovery-times</span></strong> <i><span class="varname">recovery-times-value</span></i> | <strong><span>interval</span></strong> <i><span class="varname">interval-value</span></i> <strong><span>recovery-times</span></strong> <i><span class="varname">recovery-times-value</span></i> } command on the NAT device.</p>
</li></ul>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+instance+id"><b><span class="cmdname">nat instance</span></b></a> <i><span class="varname">instance-name</span></i> [ <strong><span>id</span></strong> <i><span class="varname">id</span></i> ]</span><p><p>The NAT instance view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+log+session+enable+elog+syslog+netstream"><b><span class="cmdname">nat log session enable</span></b></a> [ { <strong><span>elog</span></strong> | <strong><span>syslog</span></strong> | <strong><span>netstream</span></strong> } [ <strong><span>secondary</span></strong> { <strong><span>elog</span></strong> | <strong><span>syslog</span></strong> | <strong><span>netstream</span></strong> } ] ]</span><p><p>The NAT log function is enabled.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+log+user+enable+syslog+netstream+secondary+syslog+netstream"><b><span class="cmdname">nat log user enable</span></b></a> [ { <strong><span>syslog</span></strong> | <strong><span>netstream</span></strong> } [ <strong><span>secondary</span></strong> { <strong><span>syslog</span></strong> | <strong><span>netstream</span></strong> } ] ]</span><p><p>The NAT user log function is enabled.</p>
</p></li><li><span>Configure NAT log host information.</span><p><ul><li>To enable the NAT device to send logs to a log host using UDP, run the <a href="cmdqueryname=nat+log+host+source+name+vpn-instance"><b><span class="cmdname">nat log host</span></b></a> <i><span class="varname">host-ip-address</span></i> <i><span class="varname">host-port</span></i> <strong><span>source</span></strong> <i><span class="varname">source-ip-address</span></i> <i><span class="varname">source-port</span></i> [ <strong><span>name</span></strong> <i><span class="varname">name</span></i> ] [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ]<span> [ <strong><span>inside-vpn</span></strong> <i><span class="varname">inside-vpn-instance-name</span></i> ] [ <strong><span>secondary</span></strong> ]</span> command.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <span><strong><span>inside-vpn</span></strong></span> and <span><strong><span>secondary</span></strong></span> parameters are supported only in <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span> dedicated board modes.</p>
</div></div>
</li><li><p>To enable the NAT device to send logs to a log host using TCP for the <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span>, run the <a href="cmdqueryname=nat+log+tcp+host+source+name+vpn-instance"><b><span class="cmdname">nat log tcp</span></b></a> <strong><span>host</span></strong> <i><span class="varname">host-ip-address</span></i> <i><span class="varname">host-port</span></i> <strong><span>source</span></strong> <i><span class="varname">source-ip-address</span></i> [ <strong><span>name</span></strong> <i><span class="varname">name</span></i> ] [ <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> ] command.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This command is mutually exclusive with the <a href="cmdqueryname=nat+log+host"><b><span class="cmdname">nat log host</span></b></a> command. Only one user log transmission mode can be configured in a NAT instance.</p>
<p>Only one log host can be configured in a NAT instance to receive user syslogs in TCP format.</p>
<p>This command takes effect only on <a href="dc_ne_nat_feature_0008.html#EN-US_CONCEPT_0172359138__li1033371595">dedicated boards</a>.</p>
</div></div>
</li></ul>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+log+host+select-mode+match-inside-vpn"><b><span class="cmdname">nat log host select-mode match-inside-vpn</span></b></a></span><p><p>The device is enabled to select a log server based on the user-side VPN in the NAT instance.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+session-log+elog-version+v2"><b><span class="cmdname">nat session-log elog-version v2</span></b></a></span><p><p>The function of sending flow logs in version 2 format is enabled.</p>
</p></li><li><span>Run <a href="cmdqueryname=nat+log+radius+enable"><b><span class="cmdname">nat log radius enable</span></b></a></span><p><p>The NAT device is enabled to send a real-time accounting packet to a RADIUS server to inform the server of a port range change.</p>
</p><p><p>If the semi-dynamic port pre-allocation mode is configured, the available port range is automatically extended after the initial port range is exhausted. In this situation, if the device needs to send RADIUS logs, the function of semi-dynamic allocation of RADIUS logs must be enabled.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+log+send-mode+session-start-only+session-end-only"><b><span class="cmdname">nat log send-mode</span></b></a> { <strong><span>session-start-only</span></strong> | <strong><span>session-end-only</span></strong> <span>| <strong><span>session-inbound</span></strong> | <strong><span>session-outbound</span></strong></span>}</span><p><p>A NAT log sending mode is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <span><strong><span>session-inbound</span></strong></span> and <span><strong><span>session-outbound</span></strong></span> parameters are supported only in <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span> dedicated board modes.</p>
</div></div>
</p></li><li><span>(Optional) Configure a flexible NAT log template.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In the following steps, the <span><strong><span>user</span></strong></span> parameter is supported only on the <span class="keyword">NE40E</span><span class="keyword">-M2K</span> and <span class="keyword">NE40E</span><span class="keyword">-M2K-B</span>.</p>
</div></div>
</p><p><ol type="a"><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Return to the system view.</p>
</li><li><p>Run <a href="cmdqueryname=nat+syslog+flexible+template+session"><b><span class="cmdname">nat syslog flexible template</span></b></a> <span>{ <strong><span>user</span></strong> | </span><strong><span>session</span></strong><span> }</span></p>
<p>A NAT syslog flexible template is created, and its view is displayed.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=nat+time+local"><b><span class="cmdname">nat time local</span></b></a></p>
<p>The local time is displayed in the logs.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=nat+time"><b><span class="cmdname">nat time</span></b></a> { <strong>endtime-second-dec</strong> | <strong>endtime-second-hex</strong> | <strong>starttime-second-dec</strong> | <strong>starttime-second-hex</strong> | <strong>starttime</strong> | <strong>timestamp-second-dec</strong> | <strong>timestamp-second-hex</strong> | <strong>timestamp</strong> } { <strong>local</strong> | <strong>utc</strong> }</p>
<p>The end time, start time, or timestamp in the log is set to the local time or UTC time.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The time format configured using the <strong>nat time</strong> command takes precedence over that configured using the <strong>nat time local</strong> command in the flexible log template view. If the <strong>nat time</strong> command is run, the time format of the end time, start time, or timestamp takes effect according to the configured format. If the <strong>nat time</strong> command is not run, the <strong>nat time local</strong> command takes effect. If neither the <strong>nat time</strong> command nor the <strong>nat time local</strong> command is run, the default UTC time takes effect.</p>
</div></div>
</li><li><p>Run <a href="cmdqueryname=nat+position"><b><span class="cmdname">nat position</span></b></a></p>
<p>A flexible NAT log template is configured.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Return to the system view.</p>
</li><li>Run <a href="cmdqueryname=nat+syslog+descriptive+format+flexible+template+session"><b><span class="cmdname">nat syslog descriptive format flexible template</span></b></a> <span>{ </span><strong><span>session</span></strong><span> | <strong><span>user</span></strong> }</span><p>A flexible log template type is specified.</p>
</li></ol>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=nat+syslog+descriptive+format+cn+type2+type3+local-timezone"><b><span class="cmdname">nat syslog descriptive format</span></b></a> { <strong><span>cn</span></strong> | <strong><span>type2</span></strong> | <strong><span>type3</span></strong> [ <strong><span>local-timezone</span></strong> ] | <strong><span>type4</span></strong> | <strong><span>type5</span></strong> | <strong><span>type6</span></strong> [ <strong><span>dual-sequence</span></strong> ] }</span><p><p>NAT syslogs are configured to be in the extended format.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0046.html">Maintaining NAT
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0048.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>