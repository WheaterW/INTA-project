
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Distributed NAT444 Inter-Chassis Hot Backup (Global VE Interface Scenario)">
<meta name="abstract" content="This section provides an example for configuring NAT inter-chassis hot backup (global VE interface scenario) in distributed deployment mode.">
<meta name="description" content="This section provides an example for configuring NAT inter-chassis hot backup (global VE interface scenario) in distributed deployment mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0024.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0044.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0295928544">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Distributed NAT444 Inter-Chassis Hot Backup (Global VE Interface Scenario)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0295928544"></a><a name="EN-US_TASK_0295928544"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Distributed NAT444 Inter-Chassis Hot Backup (Global VE Interface Scenario)</h1>
<div class="taskbody"><p>This section provides an example for configuring NAT inter-chassis hot backup (global VE interface scenario) in distributed deployment mode.</p>
<div class="context"><a name="EN-US_TASK_0295928544__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In distributed deployment networking shown in <a href="#EN-US_TASK_0295928544__fig144014448151">Figure 1</a>, NAT service boards are installed in slot <span>1</span> on BRAS1 and slot <span>1</span> on BRAS2, respectively. A VRRP channel is established between the two BRASs through global VE interfaces. CPU 0 on the NAT service board in slot <span>1</span> of BRAS1 work with CPU 0 on the NAT service board in slot <span>1</span> of BRAS2 to implement NAT inter-chassis hot backup. The NAT service's master/backup status is determined by VRRP, and the service board status is associated with VRRP.</p>
<div class="fignone" id="EN-US_TASK_0295928544__fig144014448151"><a name="EN-US_TASK_0295928544__fig144014448151"></a><a name="fig144014448151"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of configuring distributed dual-device inter-chassis backup</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1, interface 2.2, interface 3, and interface 4 in this example represent global VE 1.1, GE <span>0/1/2</span>.2, GE <span>0/1/3</span>, and GE <span>0/1/4</span>, respectively.</p>
</div></div>
<br><span><img src="figure/en-us_image_0305262333.png" width="NaN" height="NaN"></span></div>
<h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Set the number of sessions supported by the service board in slot <span>1</span> to 6M.</p>
</li><li><p>Configure HA hot backup, with NAT service information backed up.</p>
</li><li>Assign IP addresses to interfaces, configure routes, and enable MPLS on loopback interfaces.</li><li>Create global VE interfaces on the master and backup devices.</li><li><p>Create a service-location group, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel between BRAS1 and BRAS2.</p>
</li><li><p>Create and configure VRRP groups.</p>
</li><li>Configure BFD and configure the VRRP groups to track the BFD session status.</li><li><p>Associate HA with VRRP.</p>
</li><li><p>Bind the service-location group to the VRRP groups.</p>
</li><li><p>Create a service-instance group and bind it to the service-location group.</p>
</li><li><p>Create NAT instances.</p>
</li><li>Configure user information (user group, IP address pool, user domain, and AAA), configure RADIUS authentication on the BRAS, and bind the user group to the NAT instance.</li><li><p>Configure a NAT traffic diversion policy and a NAT conversion policy on BRAS1 and BRAS2.</p>
</li><li>Configure a user-side VRRP group on BRAS1 and BRAS2 that are connected to the switch.</li><li>Configure an RBS and bind a service-instance group to the RBS.</li><li><p>Configure RUI to back up BRAS information of users.</p>
</li><li>Bind the NAT instance to the service-instance group.</li><li><p>Configure a user-side sub-interface.</p>
</li></ol>
<h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="11.87%" id="mcps1.4.1.9.1.3.1.1" liSelected="liSelected"><p>No.</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="88.13%" id="mcps1.4.1.9.1.3.1.2" liSelected="liSelected"><p>Data</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>1</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Index of a service-location group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>2</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Slot ID and CPU ID of the active CPU on a service board of BRAS1 (CPU 0 in slot <span>1</span> in this example)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>3</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Slot ID and CPU ID of the standby CPU on a service board of BRAS2 (CPU 0 in slot <span>1</span> in this example)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>4</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>IP addresses of interfaces on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>5</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Names of global VE interfaces on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>4</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Names of VRRP interfaces on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>5</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>IP addresses of VRRP interfaces on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>6</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>ID of a VRRP group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>7</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Virtual IP address of a VRRP group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>8</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Priorities of VRRP group members</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>9</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>VRRP preemption delay</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>10</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Name of a service-instance group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>11</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Name and index of a NAT instance</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>12</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>IP address pool, IP address of the address pool gateway, and IP address segment of BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>13</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Names of the user group and user domain, and AAA schemes on the devices at both ends</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>14</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Remote backup identifiers for RUI backup of BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>15</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Names of user-side interfaces on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>16</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>IP addresses of user-side interfaces on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>17</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Index of the user-side VRRP groups on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>18</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Virtual IP address of the user-side VRRP groups on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>19</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>User-side VRRP priorities on BRAS1 and BRAS2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.1.9.1.3.1.1 "><p>20</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.1.9.1.3.1.2 "><p>Preemption delay of the user-side VRRP groups on the devices at both ends</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0295928544__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Set the number of sessions supported by the service boards in slot <span>1</span> on the master and backup devices to 6M.</span><p><div class="p"># Configure BRAS1.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license] <strong>quit</strong></pre>
<div class="p"># Configure BRAS2.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-license] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The method for configuring bandwidth resources varies according to the board type. As such, determine whether to run the <strong>active nat bandwidth-enhance</strong> command and the corresponding parameters based on the board type.</p>
</div></div>
</p></li><li><span>Enable HA hot backup on BRAS1 and BRAS2.</span><p><p># Enable HA hot backup on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Enable HA hot backup on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
</p></li><li><span>Configure IP addresses for interfaces.</span><p><div class="p"># Configure IP addresses for interfaces on BRAS1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-LoopBack0]<strong> ip address 1.1.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-LoopBack0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-LoopBack0] <strong>qui</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>]<strong> ip address 10.2.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
</div>
<p># Configure IP addresses for interfaces on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-LoopBack0]<strong> ip address 1.1.1.2 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-LoopBack0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-LoopBack0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/4</span>]<strong> ip address 10.3.1.2 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/4</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<p># Configure IP addresses for interfaces on the CR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CR] <strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/3</span>] <strong>ip address 10.2.1.2 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR] <strong>interface GigabitEthernet<span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/4</span>] <strong>ip address 10.3.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/4</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR]<strong> commit</strong></pre>
</p></li><li><span>Enable OSPF.</span><p><p># Enable OSPF on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1] <strong>commit</strong></pre>
</p><p><p># Enable OSPF on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> </strong><strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1] <strong>area 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.1] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.1] <strong>network 1.1.1.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1] <strong>commit</strong></pre>
</p><p><p># Enable OSPF on the CR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> </strong><strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1] <strong>area 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.1] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1-area-0.0.0.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ospf-1] <strong>commit</strong></pre>
</p></li><li><span>Enable MPLS.</span><p><p># Configure MPLS on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-mpls-ldp]<strong> </strong><strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-mpls-ldp]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-mpls-ldp-ipv4]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-mpls-ldp-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-l2vpn]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>mpls ldp remote-peer peer-bas</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-mpls-ldp-remote-peer-bas]<strong> remote-ip 1.1.1.2 </strong></pre>
<pre class="screen">[*BRAS1] <strong>commit </strong></pre>
<p># Configure MPLS on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> mpls lsr-id 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-mpls-ldp]<strong> </strong><strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2] <strong>interface GigabitEthernet<span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/4</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/4</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/4</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-mpls-ldp]<strong> ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-mpls-ldp-ipv4]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-mpls-ldp-ipv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-l2vpn]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> </strong><strong>mpls ldp remote-peer peer-bas</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-mpls-ldp-remote-peer-bas]<strong> remote-ip 1.1.1.1 </strong></pre>
<pre class="screen">[*BRAS2] <strong>commit </strong></pre>
<p># Enable MPLS on the CR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CR]<strong> mpls lsr-id 1.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-mpls-ldp]<strong> </strong><strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR] <strong>interface GigabitEthernet<span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/3</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/3</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/3</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR] <strong>interface GigabitEthernet<span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/4</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/4</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR-GigabitEthernet<span>0/1/4</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CR]<strong> commit</strong></pre>
</p></li><li><span>Create global VE interfaces on the master and backup devices.</span><p><p># Create global VE interfaces on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> interface Global-VE0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE0]<strong> ve-group 2001 l2-terminate </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> interface Global-VE0.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE0.1]<strong> vlan-type dot1q 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE0.1]<strong> mpls l2vc 1.1.1.2 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE0.1]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE0.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> interface Global-VE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1]<strong> ve-group 2001 l3-access </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1]<strong> vlan-type dot1q 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1]<strong> ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE1.1]<strong> quit</strong></pre>
<p></p>
<p># Create global VE interfaces on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> interface Global-VE0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE0]<strong> ve-group 2001 l2-terminate </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> interface Global-VE0.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE0.1]<strong> vlan-type dot1q 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE0.1]<strong> mpls l2vc 1.1.1.1 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE0.1]<strong> </strong><strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE0.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> interface Global-VE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1]<strong> ve-group 2001 l3-access </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1]<strong> vlan-type dot1q 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1]<strong> ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE1.1]<strong> quit</strong></pre>
</p></li><li><span>Create a service-location group on BRAS1 and BRAS2, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel.</span><p><p># Create service-location group 1 on BRAS1, add CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to global VE 1.1 and the peer IP address to 10.1.1.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>remote-backup interface Global-VE1.1 peer 10.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-1] <strong>quit</strong></pre>
<p># Create service-location group 1 on BRAS2, add CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to global VE 1.1 and the peer IP address to 10.1.1.1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>remote-backup interface Global-VE1.1 peer 10.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Configure a VRRP group on BRAS1 and BRAS2.</span><p><p># On BRAS1, enter the view of global VE 1.1 interface, create VRRP group 1, and set the virtual IP address of the VRRP group to 10.1.1.3. Configure the VRRP group as an mVRRP group, and set BRAS1's priority in the VRRP group to 200, the VRRP preemption delay to 1500s, and the VRRP recovery delay to 20s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE1.1] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>vrrp vrid 1 priority 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>vrrp vrid 1 preempt-mode timer delay 1500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>vrrp recover-delay 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE1.1] <strong>quit</strong></pre>
<p># On BRAS2, enter the view of global VE 1.1 interface, create VRRP group 1, and set the virtual IP address of the VRRP group to 10.1.1.3. Configure the VRRP group as an mVRRP group, set BRAS2's priority in the VRRP group to 150, and set the VRRP recovery delay to 15s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>vrrp vrid 1 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE1.1] <strong>quit</strong></pre>
</p></li><li><span>Enable BFD on the master and backup devices and configure VRRP groups to track the BFD session status.</span><p><p>In a global VE scenario, associate VRRP with BFD. Otherwise, delayed VRRP switchback may not take effect after the entire chassis is restarted, causing users to be logged out.</p>
</p><p><p># Enable BFD on BRAS1 and configure the VRRP group to track the BFD session status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-bfd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> bfd peer1 bind peer-ip 10.1.1.2 source-ip 10.1.1.1 auto</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-bfd-session-peer1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-bfd-session-peer1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>vrrp vrid 1 timer advertise 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>vrrp vrid 1 track bfd-session session-name peer1 peer</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE1.1] <strong>quit</strong></pre>
<p># Enable BFD on BRAS2 and configure the VRRP group to track the BFD session status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-bfd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> bfd peer1 bind peer-ip 10.1.1.1 source-ip 10.1.1.2 auto</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-bfd-session-peer1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-bfd-session-peer1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>vrrp vrid 1 timer advertise 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>vrrp vrid 1 track bfd-session session-name peer1 peer</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE1.1] <strong>quit</strong></pre>
</p></li><li><span>Associate HA with VRRP on the master and backup devices.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This configuration is optional on the backup device. You can determine whether to perform this step based on network requirements.</p>
</div></div>
</p><p><p># On BRAS1, enter the view of the global VE 1.1 interface, and associate service-location group 1 with VRRP group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE1.1] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Global-VE1.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Global-VE1.1] <strong>quit</strong></pre>
<p># On BRAS2, enter the view of the global VE 1.1 interface, and associate service-location group 1 with VRRP group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE1.1] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-Global-VE1.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-Global-VE1.1] <strong>quit</strong></pre>
<p># Run the <a href="cmdqueryname=display+vrrp+1"><b><span class="cmdname">display vrrp 1</span></b></a> command on BRAS1 and BRAS2 to view the master/backup VRRP status, which reflects the master/backup status of the service-location group. <strong>State</strong> in the command output indicates the BRAS status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display vrrp 1</strong>
Global-VE1.1 | Virtual Router 1                                                                                      
    State                    : Master 
    Virtual IP               : 10.1.1.3  
    Master IP                : 10.1.1.1 
    Local IP                 : 10.1.1.1
    PriorityRun              : 200    
    PriorityConfig           : 200    
    MasterPriority           : 200    
    Preempt                  : YES    Delay Time      : 400 s    
    Hold Multiplier          : 3                                                                            
    TimerRun                 : 1 s    
    TimerConfig              : 1 s   
    Auth Type                : NONE    
    Virtual MAC              : 00e0-fc12-3456 
    Check TTL                : YES      
    Config Type              : admin-vrrp 
    Backup-forward           : disabled   
    Fast-resume              : disabled     
    Track Service-location   : 1   Priority Reduced : 60                                                         
    Service-location State   : UP                                                               
    Create Time              : 2011-10-18 11:14:48 UTC+10:59   
    Last Change Time         : 2011-10-18 14:02:46 UTC+10:59</pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><strong>Master</strong> in the command output indicates that BRAS1 is the master device.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>display vrrp 1</strong>
Global-VE1.1 | Virtual Router 1                                                                                       
    State                   : Backup  
    Virtual IP              : 10.1.1.3   
    Master IP               : 10.1.1.1
    Local IP                : 10.1.1.2
    PriorityRun             : 150      
    PriorityConfig          : 150     
    MasterPriority          : 200    
    Preempt                 : YES     Delay Time    : 0 s  
    Hold Multiplier         : 3                                                              
    TimerRun                : 1 s     
    TimerConfig             : 1 s     
    Auth Type               : NONE    
    Virtual MAC             : 00e0-fc12-3456  
    Check TTL               : YES       
    Config Type             : admin-vrrp   
    Backup-forward          : disabled    
    Fast-resume             : disabled
    Track Service-location  : 1   Priority Reduced : 60                                                         
    Service-location State : UP   
    Create Time            : 2011-10-18 11:26:40 UTC+08:00  
    Last change Time       : 2011-10-18 14:02:22 UTC+08:00</pre>
</p></li><li><span>Bind the service-location group to the VRRP group on BRAS1 and BRAS2.</span><p><p># Bind service-location group 1 to VRRP group 1 on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-1] <strong>vrrp vrid 1 interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-1] <strong>quit</strong></pre>
<p># Bind service-location group 1 to VRRP group 1 on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-location-1] <strong>vrrp vrid 1 interface Global-VE1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Create a service-instance group on BRAS1 and BRAS2 and bind them to the service-location group.</span><p><p># Create a service-instance group named <strong>group1</strong> on BRAS1 and bind it to service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-instance-group-group1] <strong>quit</strong></pre>
<p># Create a service-instance group named <strong>group1</strong> on BRAS2 and bind it to service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-instance-group-group1] <strong>quit</strong></pre>
<p># Run the <a href="cmdqueryname=display+service-location+1"><b><span class="cmdname">display service-location 1</span></b></a> command on BRAS1 and BRAS2 to view HA information. <strong>Vrrp state</strong> in the command output indicates the status of a service-location group, which must be consistent with the BRAS's VRRP status. <strong>Batch-backup state</strong> in the command output indicates whether batch backup has been finished.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display service-location 1</strong>
 service-location 1                                                                                                                
 Backup scene type: inter-box                                                                                                       
 Location slot ID: <span>1</span>                                                                                                    
 Remote-backup interface: Global-VE1.1                                                                                     
 Peer: 10.1.1.2                                                                                                                   
 Vrrp ID: 1                                                                                                                       
 Vrrp bind interface: Global-VE1.1                                                                                         
 Vrrp state: master                                                                                                                 
 Bound service-instance-group number: 1                                                                                             
 Batch-backup state: finished</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>display service-location 1</strong>
 service-location 1                                                                                                                
 Backup scene type: inter-box                                                                                                       
 Location slot ID: <span>1</span>                                                                                                    
 Remote-backup interface: Global-VE1.1                                                                                      
 Peer: 10.1.1.1                                                                                                                   
 Vrrp ID: 1                                                                                                                       
 Vrrp bind interface: Global-VE1.1                                                                                          
 Vrrp state: slave                                                                                                                 
 Bound service-instance-group number: 1                                                                                             
 Batch-backup state: NA</pre>
</p></li><li><span>Create a NAT instance on both master and backup devices.</span><p><p># Create a NAT instance named <strong>nat</strong> on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat] <strong>quit</strong></pre>
<p># Create a NAT instance named <strong>nat</strong> on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-nat-instance-nat] <strong>quit</strong></pre>
</p></li><li><span>Configure user information (user group named <strong>natbras</strong>, IP address pool named <strong>natbras</strong>, user domain named <strong>natbras</strong>, and AAA) and bind the user group to the NAT instance named <strong>nat</strong> on each of the master and backup devices.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>user-group natbras</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ip pool natbras bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-natbras] <strong>gateway 192.168.0.1 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-natbras] <strong>section 0 192.168.0.2 192.168.0.254</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-natbras] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server authentication 192.168.7.249 1645 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server accounting 192.168.7.249 1646 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server shared-key YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> radius-server type plus11</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> radius-server traffic-unit kbyte</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth1] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-authen-auth1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>accounting-scheme acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1] <strong>accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-acct1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-acct1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>domain natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>accounting-scheme </strong><strong>acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-natbras] <strong>ip-pool natbras</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-natbras] <strong>user-group natbras bind nat instance nat</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-natbras] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>user-group natbras</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>ip pool natbras bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ip-pool-natbras] <strong>gateway 192.168.0.1 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-ip-pool-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-ip-pool-natbras] <strong>section 0 192.168.0.2 192.168.0.254</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-ip-pool-natbras] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2]<strong> radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>radius-server authentication 192.168.7.249 1645 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>radius-server accounting 192.168.7.249 1646 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>radius-server shared-key YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-radius-rd1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-radius-rd1]<strong> radius-server type plus11</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-radius-rd1]<strong> radius-server traffic-unit kbyte</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-radius-rd1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-aaa-authen-auth1] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-aaa-authen-auth1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-authen-auth1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa] <strong>accounting-scheme acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-aaa-accounting-acct1] <strong>accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-accounting-acct1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-accounting-acct1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa] <strong>domain natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-aaa-domain-natbras] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-aaa-domain-natbras] <strong>accounting-scheme acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-aaa-domain-natbras] <strong>radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-aaa-domain-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-domain-natbras] <strong>ip-pool natbras</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-domain-natbras] <strong>user-group natbras bind nat instance nat</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa-domain-natbras] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure traffic classification rules, NAT behaviors, and NAT traffic diversion policies, and apply the NAT traffic diversion policies on the master and backup devices. For details, see "Example for Configuring Distributed NAT" in <em>IPv6 Transition &gt; NAT Configuration</em>.</span><p><p># Configure a NAT conversion policy on BRAS1.</p>
<ol type="a"><li><p>Configure an ACL numbered 6001 and an ACL rule numbered 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> acl 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6001] <strong>rule 1 permit ip source user-group natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl-ucl-6001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-acl-ucl-6001] <strong>quit</strong></pre>
</li><li><p>Configure an ACL numbered 3001.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl4-advance-3001] <strong>rule 10 permit ip source 192.168.0.0 0.0.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-acl4-advance-3001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-acl4-advance-3001] <strong>quit</strong></pre>
</li><li><p>Configure a traffic classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic classifier c1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-c1] <strong>if-match acl 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-c1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-classifier-c1] <strong>quit</strong></pre>
</li><li><p>Configure a traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior b1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-b1] <strong>nat bind instance nat</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-b1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-behavior-b1] <strong>quit</strong></pre>
</li><li><p>Define a traffic policy to associate the traffic classifier with the traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-trafficpolicy-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-trafficpolicy-p1] <strong>quit</strong></pre>
</li><li><p>Apply the NAT traffic diversion policy in the system view. </p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic-policy p1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li><p>Configure a NAT conversion policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat] <strong>nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>nat outbound 3001 address-group address-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>commit</strong></pre>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to that of BRAS1. For configuration details, see <a href="#EN-US_TASK_0295928544__config_02">BRAS2 configuration file</a> in this section.</p>
</div></div>
</p></li><li><span>On each of the master and backup devices, configure a user-side VRRP group (between BRAS1/BRAS2 and SWITCH) and enable it to track the service-location group. If the service-location group is not tracked, a CGN board failure cannot trigger a master/backup BRAS switchover. As a result, new distributed NAT users cannot go online.</span><p><p># Configure BRAS1 (between BRAS1 and SWITCH).</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vlan-type dot1q 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>ip address 192.168.2.10 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 virtual-ip 192.168.2.200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>admin-vrrp vrid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 preempt-mode timer delay 1500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp recover-delay 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 track service-location 1 reduced 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
<p># Configure BRAS2 (between BRAS2 and SWITCH).</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vlan-type dot1q 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>ip address 192.168.2.100 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 virtual-ip 192.168.2.200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>admin-vrrp vrid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 track service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
</p></li><li><span>Configure an RBS and bind a service-instance group to the RBS.</span><ol type="a"><li class="substepexpand"><span>Configure an RBS on BRAS1 and BRAS2.</span><p><p># Configure an RBS on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>peer 1.1.1.2 source 1.1.1.1 port 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>protect lsp-tunnel for-all-instance peer-ip 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>ip-pool natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-natbras] <strong>quit</strong></pre>
<p># Configure an RBS on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-srv-natbras] <strong>peer 1.1.1.1 source 1.1.1.2 port 2001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-srv-natbras] <strong>protect lsp-tunnel for-all-instance peer-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-srv-natbras] <strong>ip-pool natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-srv-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-srv-natbras] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Bind the service-instance group to the RBS.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-instance-group-group1]<strong> remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-instance-group-group1] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-instance-group-group1] <strong>remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-instance-group-group1] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure RUI to back up BRAS information of users.</span><p><p># Configure an RBP named <strong>natbras</strong> on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-profile natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>service-type bras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>backup-id 10 remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>peer-backup hot</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>vrrp-id 2 interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-prf-natbras] <strong>quit</strong></pre>
<p># Configure an RBP named <strong>natbras</strong> on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>remote-backup-profile natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>service-type bras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>backup-id 10 remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>peer-backup hot</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>vrrp-id 2 interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-prf-natbras] <strong>quit</strong></pre>
</p></li><li><span>Bind service-instance groups to NAT instances.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat] <strong>quit</strong></pre>
<p># Configure BRAS2.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-nat-instance-nat] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-nat-instance-nat] <strong>quit</strong></pre>
</p></li><li><span>Configure user-side sub-interfaces on BRAS1 and BRAS2.</span><p><p># Configure a user-side sub-interface on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/2</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>user-vlan 2010</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-vlan-2010-2010] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>remote-backup-profile natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>access-type layer2-subscriber default-domain authentication natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>quit</strong></pre>
<p># Configure a user-side sub-interface on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet<span>0/1/2</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.10] <strong>user-vlan 2010</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.10-vlan-2010-2010] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.10] <strong>remote-backup-profile natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.10] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>access-type layer2-subscriber default-domain authentication natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.10] <strong>quit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0295928544__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>BRAS1 configuration file</p>
<pre class="screen">#
sysname BRAS1
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span> 
 active nat bandwidth-enhance 40 slot <span>1</span>
#
radius-server group rd1
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646 weight 0
 radius-server shared-key %^%#x*CgITP4C<font style="font-size:8pt" Face="Courier New" >~</font>;q,*+DEW'JBWe#)"Q&amp;|7bX]b:Y&lt;{w'%^%#
 radius-server type plus11
 radius-server traffic-unit kbyte
#
acl number 3001
 rule 10 permit ip source 192.168.0.0 0.0.255.255
#
acl number 6001
 rule 1 permit ip source user-group natbras
#
traffic classifier c1 operator or
 if-match acl 6001 precedence 1
#
traffic behavior b1
 nat bind instance nat
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
traffic-policy p1 inbound
#
service-ha hot-backup enable
service-ha delay-time 10
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface Global-VE1.1
 remote-backup interface Global-VE1.1 peer 10.1.1.2
#
service-instance-group group1
 service-location 1
 remote-backup-service natbras
#
nat instance nat id 1
 service-instance-group group1
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105
 nat outbound 3001 address-group address-group1
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer peer-bas
 remote-ip 1.1.1.2
#
user-group natbras
#
ip pool natbras bas local
 gateway 192.168.0.1 255.255.0.0
 section 0 192.168.0.2 192.168.0.254
#
aaa
 authentication-scheme auth1
  authentication-mode radius
 accounting-scheme acct1
  accounting-mode radius
 domain natbras
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  ip-pool natbras
  user-group natbras bind nat instance nat
#
bfd peer1 bind peer-ip 10.1.1.2 source-ip 10.1.1.1 auto
#
remote-backup-service natbras
 peer 1.1.1.2 source 1.1.1.1 port 2001
 protect lsp-tunnel for-all-instance peer-ip 1.1.1.2
 ip-pool natbras
#
remote-backup-profile natbras
 service-type bras
 backup-id 10 remote-backup-service natbras
 peer-backup hot
 vrrp-id 2 interface GigabitEthernet<span>0/1/2</span>.2
#
interface Virtual-Template1
 ppp authentication-mode auto
#
interface Global-VE0
 ve-group 2001 l2-terminate
#
interface Global-VE0.1
 undo shutdown
 vlan-type dot1q 2001
 mpls l2vc 1.1.1.2 2001
#
interface Global-VE1
 ve-group 2001 l3-access
#
interface Global-VE1.1
 undo shutdown
 vlan-type dot1q 2001
 ip address 10.1.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 200
 vrrp vrid 1 preempt-mode timer delay 1500
 vrrp recover-delay 20
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp vrid 1 timer advertise 20
 vrrp vrid 1 track bfd-session session-name peer1 peer
#
interface GigabitEthernet<span>0/1/2</span>.10
 user-vlan 2010
 remote-backup-profile natbras
 pppoe-server bind Virtual-Template 1
 bas
  access-type layer2-subscriber default-domain authentication natbras
  authentication-method ppp
#
interface GigabitEthernet<span>0/1/2</span>.2
 vlan-type dot1q 2002
 ip address 192.168.2.10 255.255.255.0
 vrrp vrid 2 virtual-ip 192.168.2.200
 admin-vrrp vrid 2
 vrrp vrid 2 priority 150
 vrrp vrid 2 preempt-mode timer delay 1500
 vrrp recover-delay 20
 vrrp vrid 2 track service-location 1 reduced 50
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.255
 mpls
 mpls ldp
#                
ospf 1            
 area 0.0.0.0
 network 10.2.1.0 0.0.0.255
 network 1.1.1.1 0.0.0.0
#
return</pre>
</li><li><p id="EN-US_TASK_0295928544__config_02"><a name="EN-US_TASK_0295928544__config_02"></a><a name="config_02"></a>BRAS2 configuration file</p>
<pre class="screen">#
sysname BRAS2
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span> 
 active nat bandwidth-enhance 40 slot <span>1</span>
#
radius-server group rd1
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646 weight 0
 radius-server shared-key %^%#x*CgITP4C<font style="font-size:8pt" Face="Courier New" >~</font>;q,*+DEW'JBWe#)"Q&amp;|7bX]b:Y&lt;{w'%^%#
 radius-server type plus11
 radius-server traffic-unit kbyte
#
acl number 3001
 rule 10 permit ip source 192.168.0.0 0.0.255.255
#
acl number 6001
 rule 1 permit ip source user-group natbras
#
traffic classifier c1 operator or
 if-match acl 6001 precedence 1
#
traffic behavior b1
 nat bind instance nat
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
traffic-policy p1 inbound
#
service-ha hot-backup enable
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface Global-VE1.1
 remote-backup interface Global-VE1.1 peer 10.1.1.1
#
service-instance-group group1
 service-location 1
 remote-backup-service natbras
#
nat instance nat id 1
 service-instance-group group1
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105
 nat outbound 3001 address-group address-group1
#
bfd
#
mpls lsr-id 1.1.1.2
#
mpls
#
mpls l2vpn
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer peer-bas
 remote-ip 1.1.1.1
#
user-group natbras
#
ip pool natbras bas local
 gateway 192.168.0.1 255.255.0.0
 section 0 192.168.0.2 192.168.0.254
#
aaa
 authentication-scheme auth1
  authentication-mode radius
 accounting-scheme acct1
  accounting-mode radius
 domain natbras
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  ip-pool natbras
  user-group natbras bind nat instance nat
#
bfd peer1 bind peer-ip 10.1.1.1 source-ip 10.1.1.2 auto
#
remote-backup-service natbras
 peer 1.1.1.1 source 1.1.1.2 port 2001
 protect lsp-tunnel for-all-instance peer-ip 1.1.1.1
 ip-pool natbras
#
remote-backup-profile natbras
 service-type bras
 backup-id 10 remote-backup-service natbras
 peer-backup hot
 vrrp-id 2 interface GigabitEthernet<span>0/1/2</span>.2
#
interface Virtual-Template1
 ppp authentication-mode auto
#
interface Global-VE0
 ve-group 2001 l2-terminate
#
interface Global-VE0.1
 undo shutdown
 vlan-type dot1q 2001
 mpls l2vc 1.1.1.1 2001
#
interface Global-VE1
 ve-group 2001 l3-access
#
interface Global-VE1.1
 undo shutdown
 vlan-type dot1q 2001
 ip address 10.1.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 150
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15
 vrrp vrid 1 timer advertise 20
 vrrp vrid 1 track bfd-session session-name peer1 peer
#
interface GigabitEthernet<span>0/1/2</span>.10
 user-vlan 2010
 pppoe-server bind Virtual-Template 1
 remote-backup-profile natbras
 bas
  access-type layer2-subscriber default-domain authentication natbras
  authentication-method ppp
#
interface GigabitEthernet<span>0/1/2</span>.2
 vlan-type dot1q 2002
 ip address 192.168.2.100 255.255.255.0
 vrrp vrid 2 virtual-ip 192.168.2.200
 admin-vrrp vrid 2
 vrrp vrid 2 priority 120
 vrrp vrid 2 track service-location 1
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.255
 mpls
 mpls ldp
#                
ospf 1            
 area 0.0.0.0
area 1
 network 10.3.1.0 0.0.0.255
 network 1.1.1.2 0.0.0.0
#
return</pre>
</li><li>CR configuration file<pre class="screen">#
sysname CR
#
mpls lsr-id 1.1.1.3
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.255
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.255
 mpls
 mpls ldp
#            
ospf 1            
 area 0.0.0.0
 network 10.2.1.0 0.0.0.255
 area 0.0.0.1
area 1 
 network 10.3.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">Inter-Chassis Hot Backup
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0024.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0044.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>