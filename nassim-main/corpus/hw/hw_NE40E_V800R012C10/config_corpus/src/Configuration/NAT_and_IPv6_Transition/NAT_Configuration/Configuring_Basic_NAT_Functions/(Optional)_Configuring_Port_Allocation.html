
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring Port Allocation">
<meta name="abstract" content="Configuring a port allocation mode helps manage port resources.">
<meta name="description" content="Configuring a port allocation mode helps manage port resources.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0112_1.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0016_1.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001139835245">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring Port Allocation</title>
</head>
<body><a name="EN-US_TASK_0000001139835245"></a><a name="EN-US_TASK_0000001139835245"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring Port Allocation</h1>
<div class="taskbody"><p>Configuring a port allocation mode helps manage port resources.</p>
<div class="context"><a name="EN-US_TASK_0000001139835245__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_context12214120151714"><div class="p" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p719658754214109">The available port allocation modes are dynamic allocation, static pre-allocation, semi-dynamic pre-allocation, and per-port allocation. During network deployment, a port allocation mode is configured based on the service deployment scale.<ul id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ul1544098706214109"><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li992062578214109"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p532713138214109"><a name="EN-US_TASK_0000001139835245__en-us_task_0172374497_li992062578214109"></a><a name="en-us_task_0172374497_li992062578214109"></a>Port pre-allocation, also called the port range mode, enables a CGN device to pre-allocate a public IP address and port range to a private IP address for the CGN device to map the private IP address to the public IP address and a port in the port range.</p>
</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li592742420214109"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p45214507214109"><a name="EN-US_TASK_0000001139835245__en-us_task_0172374497_li592742420214109"></a><a name="en-us_task_0172374497_li592742420214109"></a>The semi-dynamic port allocation (semi-dynamic) mode is an extension of the port range mode. Semi-dynamic port allocation extends a single port segment used in the port range mode to three parameters: initial port range, extended port range, and maximum number of times a port range can be extended. Before users go online, a CGN device assigns an initial port segment and ports in the initial segment to users. If the number of used ports exceeds the initial port segment size, the device assigns an extended port segment, which can repeat for a specified maximum number of times.</p>
</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li278366677214109"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1289357173214109"><a name="EN-US_TASK_0000001139835245__en-us_task_0172374497_li278366677214109"></a><a name="en-us_task_0172374497_li278366677214109"></a>Dynamic port pre-allocation (port dynamic) enables a CGN device to pre-allocate a public IP address and a port range with 64 ports to a private IP address. If the number of used ports exceeds the initial port range size, the CGN device assigns another port range with 64 ports to the user. The allocation process repeats without a limit on the maximum number of extended port ranges. This mode features high usage of public network IP addresses, but involves a huge amount of log information. This requires a log server to handle logs.</p>
</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li277330755214109"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1058485295214109"><a name="EN-US_TASK_0000001139835245__en-us_task_0172374497_li277330755214109"></a><a name="en-us_task_0172374497_li277330755214109"></a>Per-port allocation, a type of dynamic port mode, enables a device to assign a port, not a port range each time the device creates a session. With per-port allocation enabled, port usage of public IP addresses is maximized. The per-port allocation mode applies when a few IPv4 or IPv6 public addresses are available.</p>
</li></ul>
<div class="note" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_note4372081449"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1137158848">Only the <span class="keyword" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_keyword1152414571330">NE40E</span><span class="keyword" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_keyword3501321048">-M2K</span> and <span class="keyword" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_keyword84407551658">NE40E</span><span class="keyword" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_keyword18823101016414">-M2K-B</span> support this configuration.</p>
</div></div>
<div class="note" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_note2370457121412"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1370135719143">Only <a href="dc_ne_nat_feature_0008.html#EN-US_CONCEPT_0172359138__li1033371595">dedicated boards</a> support this function.</p>
</div></div>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001139835245__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol id="EN-US_TASK_0000001139835245__en-us_task_0172374497_steps213575970214109"><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step1491064960214109"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd1668954401214415">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1104932587214109">system-view</span></b></a></span><p><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p589532751214415">The system view is displayed.</p>
</p></li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step1705248274214109"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd245384885214415">Run <a href="cmdqueryname=nat+instance+id"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1070078865214109">nat instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname1207788750214109">instance-name</span></i> [ <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname1261188021214109">id</span></strong> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname2053469673214109">id</span></i> ]</span><p><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p922591037214415">The NAT instance view is displayed.</p>
</p></li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step906779842214109"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd1704845382214109">(Optional) Run <a href="cmdqueryname=nat+ip+access-user+limit"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1448201388214109">nat ip access-user limit</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname822559952214109">max-number</span></i></span><p><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1698365141219">The maximum number of users sharing the same NAT public IP address in PAT mode is set.</p>
</p><p><div class="note" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_note500205889214109"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p81871320209">The <a href="cmdqueryname=nat+ip+access-user+limit"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname548136889214109">nat ip access-user limit</span></b></a> command is mandatory in per-port allocation mode and is recommended in dynamic port allocation mode and semi-dynamic port allocation mode. Otherwise, a large number of users use the same public IP address, affecting subsequent user services.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step1297428101214109"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd325141869214109">Configure a port allocation mode. Modes 1 and 2 are mutually exclusive for a NAT instance. Before changing the port allocation mode, disable the existing mode first.</span><p><ul id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ul237698235214109"><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li166289415214109">Mode 1: <span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ph143172853911">To configure the port pre-allocation mode, run the <a href="cmdqueryname=port-range+extended-port-range+extended-times"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname273209756214109">port-range</span></b></a> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname1523009173214109">initial-port-range</span></i> [ <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname1869719737214109">extended-port-range</span></strong> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname623409753214109">extended-port-range</span></i> <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname590753600214109">extended-times</span></strong> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname570963892214109">extended-times</span></i> ] command.</span><div class="p" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1237788431214109">Note the following when running the preceding command:<ul id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ul865307375214109"><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li368227529214109">For port pre-allocation, the command does not need to carry the <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname283020627214415">extended-port-range</span></strong> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname112045647214415">extended-port-range</span></i> or <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname433761542214415">extended-times</span></strong> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname1500499303214415">extended-times</span></i> parameters.</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li1650868008214109">For semi-dynamic pre-allocation, the command must carry the <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname1010920834214415">extended-port-range</span></strong> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname1048491068214415">extended-port-range</span></i> and <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname547081107214415">extended-times</span></strong> <i><span class="varname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_varname261027599214415">extended-times</span></i> parameters.</li></ul>
</div>
</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li18113383214109">Mode 2: <span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ph720717049214109">To configure the per-port allocation mode, run the <a href="cmdqueryname=port-single+enable"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1079174879214109">port-single</span></b></a> <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname325517713214109">enable</span></strong> command.</span></li></ul>
<div class="note" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_note23342080214109"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ul1468314806214109"><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li1887857687214109">By default, the dynamic port allocation mode is used. In this case, the number of ports to be allocated is not limited.</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li1812487346214109">A port allocation mode works only for new online users in a NAT instance.</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li104691263214109">After a NAT instance is bound to a service board, the <a href="cmdqueryname=port-single+enable"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname371374008214109">port-single</span></b></a> <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname2082416712214109">enable</span></strong> and <a href="cmdqueryname=undo+port-single+enable"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1320877926214109">undo port-single</span></b></a> <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname1837252268214109">enable</span></strong> commands cannot both be run within 1 minute.</li></ul>
</div></div>
</p></li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step1584563494016"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd1086515011910">(Optional) Run <a href="cmdqueryname=port-reuse+enable"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname18859135714405">port-reuse enable</span></b></a></span><p><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1379935411818">The port multiplexing function is enabled for TCP and other protocols.</p>
</p><p><div class="note" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_note15385155574113"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ul101257318478"><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li101381660474">By default, sessions of different protocols using the same private IP address cannot share the same public port during port pre-allocation. After the port multiplexing function is enabled, for the same private IP address, TCP sessions can share a public port with sessions of other protocols.</li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_li1112510314472">The <a href="cmdqueryname=port-reuse+enable+enable"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1660014811425">port-reuse enable</span></b></a> and <span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_ph246845474213"><a href="cmdqueryname=port-single+enable"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname124681554174218">port-single</span></b></a> <strong><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdparmname846815549428">enable</span></strong></span> commands are mutually exclusive.</li></ul>
</div></div>
</p></li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step1461832029214109"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd1797989723214109">(Optional) Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname574589650214109">quit</span></b></a></span><p><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p372994071414">Return to the system view.</p>
</p></li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step1662900854214109"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd1022471120214109">(Optional) Run <a href="cmdqueryname=nat+port-range+algorithm+round-robin"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1213469797214109">nat port-range algorithm round-robin</span></b></a></span><p><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p1248195119146">The round-robin algorithm is configured for port range allocation.</p>
</p><p><div class="note" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_note1906397228214109"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p362197756214109">A port range specified in the port-range command that is assigned in cursor-based port allocation mode will not be immediately used after being released. In some special scenarios, such a port range may be used immediately after being released.</p>
</div></div>
</p></li><li id="EN-US_TASK_0000001139835245__en-us_task_0172374497_step57791645872"><span id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmd137794451273">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0000001139835245__en-us_task_0172374497_cmdname1001491729214109">commit</span></b></a></span><p><p id="EN-US_TASK_0000001139835245__en-us_task_0172374497_p34975489264">The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0010.html">Configuring Basic NAT Functions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0112_1.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat_cfg_0016_1.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>