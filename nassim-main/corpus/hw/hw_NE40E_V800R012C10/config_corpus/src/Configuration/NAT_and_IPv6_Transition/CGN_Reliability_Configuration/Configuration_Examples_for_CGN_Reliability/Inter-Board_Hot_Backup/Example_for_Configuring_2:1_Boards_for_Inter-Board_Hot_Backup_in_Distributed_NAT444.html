
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring 2:1 Boards for Inter-Board Hot Backup in Distributed NAT444">
<meta name="abstract" content="This section provides an example for configuring 2:1 boards for inter-board hot backup in distributed NAT444.">
<meta name="description" content="This section provides an example for configuring 2:1 boards for inter-board hot backup in distributed NAT444.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0042.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00390128">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362461">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring 2:1 Boards for Inter-Board Hot Backup in Distributed NAT444</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362461"></a><a name="EN-US_TASK_0172362461"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring 2:1 Boards for Inter-Board Hot Backup in Distributed NAT444</h1>
<div class="taskbody"><p>This section provides an example for configuring 2:1 boards for inter-board hot backup in distributed NAT444.</p>
<div class="context"><a name="EN-US_TASK_0172362461__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In a distributed networking scenario shown in <a href="#EN-US_TASK_0172362461__fig16647104911398">Figure 1</a>, a BRAS is equipped with three CGN boards in slots <span>1</span>, <span>2</span>, and <span>3</span>. CPU 0 in slot <span>1</span> and CPU 0 in slot <span>2</span> perform inter-board hot backup for NAT444 services. Users get online using PPPoE. The BRAS assigns a private IP address range to each CPE, and each CPE assigns IP addresses from the range to terminal PCs. After the CPEs perform NAT for user traffic, the BRAS performs NAT again. As the user traffic is in a large volume, capacity expansion is required. Based on the 1:1 master/backup NAT board solution, a service board is added to slot <span>3</span> and its backup board is in slot <span>2</span>. In 1:1 solution, the service board in <span>1</span> is the master, and that in <span>2</span> is the backup.</p>
<div class="fignone" id="EN-US_TASK_0172362461__fig16647104911398"><a name="EN-US_TASK_0172362461__fig16647104911398"></a><a name="fig16647104911398"></a><span class="figcap"><b>Figure 1 </b>2:1 board expansion for inter-board hot backup in distributed NAT444</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1 in this example represents GE <span>0/2/0</span>.10.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0205135985.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362461__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Networking Solution</h4><ul><li>Traffic diversion policy: The routes of the public address pool are advertised by BGP using the <strong>network</strong> command.</li><li>Port allocation policy: Ports are allocated in semi-dynamic mode, which flexibly increases the number of user ports.</li><li>User source tracing policy: RADIUS user logs are used to reduce the load on the BRAS and RADIUS server.</li><li>Backup policy: 2:1 board expansion for inter-board hot backup on a single device is used to ensure the reliability of NAT services.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362461__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Apply and load a GTL license that enables NAT and configure NAT sessions on service boards.</li><li>Enable HA hot backup.</li><li>Configure a RADIUS service group named <strong>nat-pppoe-radius</strong>.</li><li>Configure user information and RADIUS authentication on the BRAS.</li><li>Configure a private network address pool named <strong>nat-pppoe-pool-1</strong>.</li><li>Create a basic ACL used to match against the private address pool.</li><li>Configure basic functions of the NAT instance named <strong>nat444-1</strong>.</li><li>Configure a distributed NAT traffic diversion policy.</li><li>Enable the device to advertise public routes.</li><li>Configure a private network domain and bind a NAT instance to it.</li></ol>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362461__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Apply and load a GTL license that enables NAT and configure NAT sessions on service boards.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS]<strong> vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>display license</strong></pre>
<pre class="screen">Item name Item type Value Description
-------------------------------------------------------------
LME0CONN01 Resource 64 Concurrent Users(1k)
LME0NATDS00 Resource 16 2M NAT Session
Item name (View)Resource License Command-line
-------------------------------------------------------------
LME0NATDS00 (Sys)nat session-table size table-size slot slot-id
Master board license state: Normal.</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-license] <strong>active nat session-table size 6 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-license] <strong>active nat session-table size 6 slot <span>2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-license] <strong>active nat session-table size 6 slot <span>3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-license] <strong>active nat bandwidth-enhance 40 slot</strong> <strong><span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-license] <strong>active nat bandwidth-enhance 40 slot</strong> <strong><span>2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-license] <strong>active nat bandwidth-enhance 40 slot</strong><strong> <span>3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-license] <strong>quit</strong></pre>
</p></li><li><span>Enable HA hot backup.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS] <strong>commit</strong></pre>
</p></li><li><span>Configure a RADIUS service group named <strong>nat-pppoe-radius</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>radius-server group nat-pppoe-radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-radius-nat-pppoe-radius] <strong>radius-server authentication 192.168.10.10 1824 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-radius-nat-pppoe-radius] <strong>radius-server accounting 192.168.10.10 1825 weight 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-radius-nat-pppoe-radius] <strong>radius-server shared-key-cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-radius-nat-pppoe-radius] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-radius-nat-pppoe-radius] <strong>quit</strong></pre>
</p></li><li><span>Configure a private network address pool named <strong>nat-pppoe-pool-1</strong> and bind it to a DNS server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>ip pool nat-pppoe-pool-1 bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-ip-pool-nat-pppoe-pool-1] <strong>gateway 10.1.0.1 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-ip-pool-nat-pppoe-pool-1] <strong>section 0 10.1.0.2 10.1.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-ip-pool-nat-pppoe-pool-1] <strong>dns-server 192.168.224.68 192.168.225.68</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-ip-pool-nat-pppoe-pool-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-ip-pool-nat-pppoe-pool-1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In consideration of the planned number of online private network users, configure an address pool using the <a href="cmdqueryname=ip+pool"><b><span class="cmdname">ip pool</span></b></a> command and multiple sections in the pool. In capacity expansion, add sections in the private address pool or private address pools.</p>
</div></div>
</p></li><li><span>Create a basic ACL used to match against the private address pool.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>acl number 2011</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-acl-basic-2011] <strong>rule permit source 10.1.0.0 0.0.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-acl-basic-2011] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-acl-basic-2011] <strong>quit</strong></pre>
</p></li><li><span>Configure basic functions of the NAT instance named <strong>nat444-1</strong>.</span><p><ol type="a"><li><p>Bind a service-location to a service board for capacity expansion.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-location-1] <strong>location slot <span>1</span> backup slot <span>2</span></strong>//Slot <span>1</span> houses the active service board, and slot <span>2</span> houses the standby service board.</pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-service-location-1] <strong>quit</strong></pre>
</li><li><p>Create a service-instance group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>service-instance-group nat444-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-instance-group-nat444-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-instance-group-nat444-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-service-instance-group-nat444-group1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>service-instance-group nat444-group2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-instance-group-nat444-group2] <strong>service-location 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-instance-group-nat444-group2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-service-instance-group-nat444-group2] <strong>quit</strong></pre>
</li><li><p>Create a NAT instance and bind it to a service-instance group to specify service board resources.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>nat instance nat444-1 id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1] <strong>service-instance-group nat444-group1</strong></pre>
</li><li><p>Start the port semi-dynamic allocation mode to enable the device to pre-allocate 4096 ports to a single user for the first time and allocate 1024 incrementally each time out of the maximum of three times.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1] <strong>port-range 4096 extended-port-range 1024 extended-times 3</strong></pre>
</li><li><p>Configure a private network address pool named <strong>pppoe-public-1</strong>.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1] <strong>nat address-group pppoe-public-1 group-id 1</strong></pre>
</li><li><p>Configure a public IP address.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>section 0 1.1.1.0 mask 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Specifying a mask to configure public IP addresses enables the device to advertise a UNR to the network segment, without summarizing the routes. In this example, a UNR to 1.1.1.0/24 is advertised.</p>
</div></div>
</li><li><p>Configure a translation policy for the NAT address pool.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1] <strong>nat outbound 2011 address-group pppoe-public-1</strong></pre>
</li><li><p>Enable the ALG function for all protocols, including FTP, PPTP, RTSP, and SIP.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1] <strong>nat alg all</strong></pre>
</li><li><p>Configure the 3-tuple mode.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1] <strong>nat filter mode full-cone</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-nat-instance-nat444-1] <strong>quit</strong></pre>
</li><li><p>Configure a user group of which users access the Internet.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>user-group pppoe-nat-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure basic functions of the NAT instance named <strong>nat444-2</strong>.</span><p><ol type="a"><li><p>Bind a service-location to a service board for capacity expansion.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>service-location 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-location-2] <strong>location slot <span>3</span> backup slot <span>2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-location-2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-service-location-2] <strong>quit</strong></pre>
</li><li><p>Create a service-instance group.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>service-instance-group nat444-group2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-instance-group-nat444-group2] <strong>service-location 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-service-instance-group-nat444-group2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-service-instance-group-nat444-group2] <strong>quit</strong></pre>
</li><li><p>Create a NAT instance and bind it to a service-instance group to specify service board resources.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>nat instance nat444-2 id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2] <strong>service-instance-group nat444-group2</strong></pre>
</li><li><p>Start the port semi-dynamic allocation mode to enable the device to pre-allocate 4096 ports to a single user for the first time and allocate 1024 incrementally each time out of the maximum of three times.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2] <strong>port-range 4096 extended-port-range 1024 extended-times 3</strong></pre>
</li><li><p>Configure a private network address pool named <strong>pppoe-public-2</strong>. </p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2] <strong>nat address-group pppoe-public-2 group-id 1</strong></pre>
</li><li><p>Configure a public IP address.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2-nat-address-group-pppoe-public-2] <strong>section 0 1.1.2.0 mask 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2-nat-address-group-pppoe-public-2] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Specifying a mask to configure public IP addresses enables the device to advertise a UNR to the network segment, without summarizing the routes. In this example, a UNR to 1.1.2.0/24 is advertised.</p>
</div></div>
</li><li><p>Configure a translation policy for the NAT address pool.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2] <strong>nat outbound 2011 address-group pppoe-public-1</strong></pre>
</li><li><p>Enable the ALG function for all protocols, including FTP, PPTP, RTSP, and SIP.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2] <strong>nat alg all</strong></pre>
</li><li><p>Configure the 3-tuple mode.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2] <strong>nat filter mode full-cone</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-nat-instance-nat444-2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-nat-instance-nat444-2] <strong>quit</strong></pre>
</li><li><p>Configure a user group of which users access the Internet.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>user-group pppoe-nat-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure a distributed NAT traffic diversion policy.</span><p><ol type="a"><li><p>Create an ACL for directing distributed NAT traffic to service boards.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>acl 7001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-acl-ucl-7001] <strong>rule permit ip source user-group pppoe-nat-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-acl-ucl-7001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-acl-ucl-7001] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>acl 7002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-acl-ucl-7002] <strong>rule permit ip source user-group pppoe-nat-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-acl-ucl-7002] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-acl-ucl-7002] <strong>quit</strong></pre>
</li><li><p>Configure a traffic classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>traffic classifier pppoe-nat-1 operator or</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-classifier-pppoe-nat-1] <strong>if-match acl 7001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-classifier-pppoe-nat-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-classifier-pppoe-nat-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>traffic classifier pppoe-nat-2 operator or</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-classifier-pppoe-nat-2] <strong>if-match acl 7002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-classifier-pppoe-nat-2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-classifier-pppoe-nat-2] <strong>quit</strong></pre>
</li><li><p>Configure a traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>traffic behavior pppoe-nat-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-behavior-pppoe-nat-1] <strong>nat bind instance nat444-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-behavior-pppoe-nat-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-behavior-pppoe-nat-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>traffic behavior pppoe-nat-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-behavior-pppoe-nat-2] <strong>nat bind instance nat444-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-behavior-pppoe-nat-2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-behavior-pppoe-nat-2] <strong>quit</strong></pre>
</li><li><p>Bind a C-B pair to a global traffic distribution policy.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If no traffic distribution policy is used globally, add one and apply it in the system view. If a traffic distribution policy is used globally, bind the C-B pair to it. If multiple C-B pairs are configured in a traffic distribution policy, packets are matched against them in a top-to-bottom order.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>traffic policy global-policy</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-trafficpolicy-global-policy] <strong>classifier pppoe-nat-1 behavior pppoe-nat-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-trafficpolicy-global-policy] <strong>classifier pppoe-nat-2 behavior pppoe-nat-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-trafficpolicy-global-policy] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-trafficpolicy-global-policy] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Enable the device to advertise public routes. In the following example, BGP is used.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>bgp 64640</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-bgp-64640] <strong>network 1.1.1.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-bgp-64640] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-bgp-64640] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Select a proper routing protocol to advertise public network routes. In this example, BGP is used to advertise the route to the public address pool in network mode. If a public address pool is configured using a mask, run the <strong>network</strong> command to advertise a route. Do not configure a black-hole summary route, which prevents a failure to forward reverse traffic.</p>
</div></div>
</p></li><li><span>Configure a private network domain and bind a NAT instance to it.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-aaa] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-authen-auth1] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-authen-auth1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-aaa-authen-auth1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-aaa] <strong>accounting-scheme acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-accounting-acct1] <strong>accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-aaa-accounting-acct1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-aaa-accounting-acct1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS-aaa] <strong>domain nat-pppoe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-domain-nat-pppoe] <strong>ip-pool nat-pppoe-pool-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-domain-nat-pppoe] <strong>user-group pppoe-nat-1 bind nat instance nat444-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-domain-nat-pppoe] <strong>user-group pppoe-nat-2 bind nat instance nat444-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-domain-nat-pppoe] <strong>radius-server group nat-pppoe-radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-domain-nat-pppoe] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS-aaa-domain-nat-pppoe] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Verify that the public network routes are properly advertised.</p>
<pre class="screen">&lt;BRAS&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen">Route Flags: R - relay, D - download to fib
---------------------------------------------------------------------
Routing Table: Public
Destinations : 2 Routes : 2
Destination/Mask Proto Pre Cost Flags NextHop Interface
10.1.0.0/16 Unr 61 10 D 127.0.0.1 NULL0
1.1.1.0/24 Unr 64 10 D 127.0.0.1 InLoopBack0</pre>
<p># Verify that the master/backup status in the service-location is correct.</p>
<pre class="screen">&lt;BRAS&gt; <strong>display service-location 1</strong></pre>
<pre class="screen">service-location 1
Location slot ID: <span>1</span> 
Current location slot ID: <span>1</span> 
Backup slot ID: <span>2</span> 
Current backup slot ID: <span>2</span> 
Bound service-instance-group number: 1
Batch-backup state: finished</pre>
<pre class="screen">&lt;BRAS&gt; <strong>display service-location 2</strong></pre>
<pre class="screen">service-location 1
Location slot ID: <span>3</span> 
Current location slot ID: <span>3</span> 
Backup slot ID: <span>2</span> 
Current backup slot ID: <span>2</span> 
Bound service-instance-group number: 1
Batch-backup state: finished</pre>
<p># Verify that user table information on the master and slave service boards is correct.</p>
<pre class="screen">&lt;BRAS&gt; <strong>display nat user-information slot <span>1</span> verbose</strong></pre>
<pre class="screen">This operation will take a few minutes. Press 'Ctrl+C' to break
Slot: <span>1</span> 
Total number: 1.
----------------------------------------------------------------
User Type                             : NAT444
CPE IP                                : 10.1.0.253
User ID                               : 1132
VPN Instance                          : -
Address Group                         : pppoe-public-1
NAT Instance                          : nat444-1
Public IP                             : 192.0.2.0
Start Port                            : 1024
Port Range                            : 4096
Port Total                            : 4096
Extend Port Alloc Times               : 0
Extend Port Alloc Number              : 0
First/Second/Third Extend Port Start  : 0/0/0
Total/TCP/UDP/ICMP Session Limit      : 8192/10240/10240/512
Total/TCP/UDP/ICMP Session Current    : 709/0/709/0
Total/TCP/UDP/ICMP Rev Session Limit  : 8192/10240/10240/512
Total/TCP/UDP/ICMP Rev Session Current: 0/0/0/0
Total/TCP/UDP/ICMP Port Limit         : 0/0/0/0
Total/TCP/UDP/ICMP Port Current       : 709/0/709/0
Nat ALG Enable                        : ALL
Token/TB/TP                           : 0/0/0
Port Forwarding Flag                  : Non Port Forwarding
Port Forwarding Ports                 : 0 0 0 0 0
Aging Time(s)                         : -
Left Time(s)                          : -
Port Limit Discard Count              : 0
Session Limit Discard Count           : 0
Fib Miss Discard Count                : 0
--&gt;Transmit Packets                   : 5041
--&gt;Transmit Bytes                     : 2272053
--&gt;Drop Packets                       : 0
&lt;--Transmit Packets                   : 3330
&lt;--Transmit Bytes                     : 1794897
&lt;--Drop Packets                       : 0
-----------------------------------------------------------------</pre>
<pre class="screen">&lt;BRAS&gt; <strong>display nat user-information slot <span>2</span> verbose</strong></pre>
<pre class="screen">This operation will take a few minutes. Press 'Ctrl+C' to break
Slot: <span>2</span> 
Total number: 1.
----------------------------------------------------------------
User Type                            : NAT444
CPE IP                               : 10.1.0.253
User ID                              : 1132
VPN Instance                         : -
Address Group                        : pppoe-public-1
NAT Instance                         : nat444-1
Public IP                            : 192.0.2.0
Start Port                           : 1024
Port Range                           : 4096
Port Total                           : 4096
Extend Port Alloc Times              : 0
Extend Port Alloc Number             : 0
First/Second/Third Extend Port Start : 0/0/0
Total/TCP/UDP/ICMP Session Limit     : 8192/10240/10240/512
Total/TCP/UDP/ICMP Session Current   : 709/0/709/0
Total/TCP/UDP/ICMP Rev Session Limit : 8192/10240/10240/512
Total/TCP/UDP/ICMP Rev Session Current: 0/0/0/0
Total/TCP/UDP/ICMP Port Limit        : 0/0/0/0
Total/TCP/UDP/ICMP Port Current      : 709/0/709/0
Nat ALG Enable                       : ALL
Token/TB/TP                          : 0/0/0
Port Forwarding Flag                 : Non Port Forwarding
Port Forwarding Ports                : 0 0 0 0 0
Aging Time(s)                        : -
Left Time(s)                         : -
Port Limit Discard Count             : 0
Session Limit Discard Count          : 0
Fib Miss Discard Count               : 0
--&gt;Transmit Packets                  : 0
--&gt;Transmit Bytes                    : 0
--&gt;Drop Packets                      : 0
&lt;--Transmit Packets                  : 0
&lt;--Transmit Bytes                    : 0
&lt;--Drop Packets                      : 0
-----------------------------------------------------------------</pre>
<p># Verify that session table information on the master and backup service boards is correct.</p>
<pre class="screen">&lt;BRAS&gt; <strong>display nat session table slot <span>1</span></strong></pre>
<pre class="screen">This operation will take a few minutes. Press 'Ctrl+C' to break
Slot: <span>1</span> 
Current total sessions: 709.
udp: 10.1.0.253:28195[192.0.2.0:1723]--&gt;*:*
udp: 10.1.0.253:20069[192.0.2.0:1727]--&gt; *:*
udp: 10.1.0.253:59556[192.0.2.0:1085]--&gt; *:*
udp: 10.1.0.253:28384[192.0.2.0:2047]--&gt; *:*</pre>
<pre class="screen">&lt;BRAS&gt; <strong>display nat session table slot <span>2</span></strong></pre>
<pre class="screen">This operation will take a few minutes. Press 'Ctrl+C' to break
Slot: <span>2</span> 
Current total sessions: 709.
udp: 10.1.0.253:28195[192.0.2.0:1723]--&gt;*:*
udp: 10.1.0.253:20069[192.0.2.0:1727]--&gt; *:*
udp: 10.1.0.253:59556[192.0.2.0:1085]--&gt; *:*
udp: 10.1.0.253:28384[192.0.2.0:2047]--&gt; *:*</pre>
<p># Run the <strong>display nat statistics</strong> command to view the number of sent and received packets on the master service board.</p>
<pre class="screen">&lt;BRAS&gt; <strong>display nat statistics received slot <span>1</span></strong></pre>
<pre class="screen">This operation will take a few minutes. Press 'Ctrl+C' to break
Slot: <span>1</span> 
---------------------------------------------------------------------
Packets received from interface :632014772
Packets received from mainboard :29450
Packets received by nat entry :255587842
receive hrp packets from peer device :0
receive boardhrp packets from peer board :0
---------------------------------------------------------------------------</pre>
<pre class="screen">&lt;BRAS&gt; <strong>display nat statistics transmitted slot <span>1</span></strong></pre>
<pre class="screen">This operation will take a few minutes. Press 'Ctrl+C' to break
Slot: <span>1</span> 
---------------------------------------------------------------------
Packets transmitted to interface   :159142427
Packets transmitted to mainboard   :22219
Seclog packets transmitted         :0
Syslog packets transmitted         :0
Userinfo log msg transmitted to cp :0
Transparent packet with nat        :65080312
Transparent packet without nat     :0
sessions sent by hrp               :0
UserTbl sent by hrp                :0
UserTbl sent by Boardhrp           :0
sessions sent by Boardhrp          :0
-----------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362461__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>BRAS configuration file</p>
<pre class="screen">#
sysname BRAS
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span> 
 active nat session-table size 6 slot <span>2</span> 
 active nat session-table size 6 slot <span>3</span> 
 active nat bandwidth-enhance 40 slot <span>1</span>
 active nat bandwidth-enhance 40 slot <span>2</span>
 active nat bandwidth-enhance 40 slot <span>3</span>
#
radius-server group nat-pppoe-radius
 radius-server authentication 192.168.10.10 1824 weight 0
 radius-server accounting 192.168.10.10 1825 weight 0
 radius-server shared-key-cipher %^%#x*CgITP4C<font style="font-size:8pt" Face="Courier New" >~</font>;q,*+DEW'JBWe#)"Q&amp;|7bX]b:Y&lt;{w'%^%#
#
ip pool nat-pppoe-pool-1 bas local
 gateway 10.1.0.1 255.255.0.0
 section 0 10.1.0.2 10.1.0.255
 dns-server 192.168.224.68 192.168.225.68
#
acl number 2011
 rule permit source 10.1.0.0 0.0.255.255
#
acl number 7001
 rule permit ip source user-group pppoe-nat-1
#
acl number 7002
 rule permit ip source user-group pppoe-nat-2
#
traffic classifier pppoe-nat-1 operator or
 if-match acl 7001 precedence 1
#
traffic classifier pppoe-nat-2 operator or
 if-match acl 7002 precedence 1
#
traffic behavior pppoe-nat-1
 nat bind instance nat444-1
#
traffic behavior pppoe-nat-2
 nat bind instance nat444-2
#
traffic policy global-policy
 share-mode
 classifier pppoe-nat-1 behavior pppoe-nat-1 precedence 1
 classifier pppoe-nat-2 behavior pppoe-nat-2 precedence 2
#
traffic-policy global-policy inbound
#
bgp 64640
 network 1.1.1.0 24
#
service-ha hot-backup enable
service-ha delay-time 10
#
service-location 1
 location slot <span>1</span> backup slot <span>2</span>  
#
service-location 2
 location slot <span>3</span> backup slot <span>2</span>  
#
service-instance-group nat444-group1
 service-location 1
#
service-instance-group nat444-group2
 service-location 2
#
nat instance nat444-1 id 1
 service-instance-group nat444-group1
 port-range 4096 extended-port-range 1024 extended-times 3
 nat address-group pppoe-public-1 group-id 1
  section 0 1.1.1.0 mask 24
 nat outbound 2011 address-group pppoe-public-1
 nat alg all
 nat filter mode full-cone
#
nat instance nat444-2 id 1
 service-instance-group nat444-group2
 port-range 4096 extended-port-range 1024 extended-times 3
 nat address-group pppoe-public-2 group-id 1
  section 0 1.1.2.0 mask 24
 nat outbound 2011 address-group pppoe-public-2
 nat alg all
 nat filter mode full-cone
#
user-group pppoe-nat-1
user-group pppoe-nat-2
#
ip pool natbras bas local
 gateway 192.168.0.1 255.255.0.0
 section 0 192.168.0.2 192.168.0.254
#
aaa
 authentication-scheme auth1
  authentication-mode radius
 accounting-scheme acct1
  accounting-mode radius
 domain nat-pppoe
  authentication-scheme auth1
  accounting-scheme acct1
  ip-pool nat-pppoe-pool-1
  user-group pppoe-nat-1 bind nat instance nat444-1 
  user-group pppoe-nat-2 bind nat instance nat444-2
  radius-server group nat-pppoe-radius
#
interface Virtual-Template1
 ppp authentication-mode auto
#
interface GigabitEthernet<span>0/2/0</span>.10
 user-vlan 2010
 pppoe-server bind Virtual-Template 1
 bas
  access-type layer2-subscriber default-domain authentication nat-pppoe
  authentication-method ppp
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0042.html">Inter-Board Hot Backup
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0032.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>