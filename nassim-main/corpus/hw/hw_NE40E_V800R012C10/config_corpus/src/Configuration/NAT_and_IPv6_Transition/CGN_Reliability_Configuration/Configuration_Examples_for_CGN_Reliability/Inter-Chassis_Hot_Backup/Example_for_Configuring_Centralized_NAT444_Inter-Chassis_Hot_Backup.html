
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Centralized NAT444 Inter-Chassis Hot Backup">
<meta name="abstract" content="This section provides an example for configuring NAT444 inter-chassis hot backup in centralized deployment mode.">
<meta name="description" content="This section provides an example for configuring NAT444 inter-chassis hot backup in centralized deployment mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0024.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00390128">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362481">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Centralized NAT444 Inter-Chassis Hot Backup</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362481"></a><a name="EN-US_TASK_0172362481"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Centralized NAT444 Inter-Chassis Hot Backup</h1>
<div class="taskbody"><p>This section provides an example for configuring NAT444 inter-chassis hot backup in centralized deployment mode.</p>
<div class="context"><a name="EN-US_TASK_0172362481__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In the centralized networking scenario shown in <a href="#EN-US_TASK_0172362481__fig_01">Figure 1</a>, a NAT service board is deployed in slot <span>1</span> on CGN1 and another NAT service board is deployed in slot <span>1</span> on CGN2. CGN1 and CGN2, between which a VRRP channel is established over GE interfaces, are deployed close to two SRs on the MAN core as standalone devices. CPU0 of the NAT service board in slot <span>1</span> on CGN1 and CPU0 of the NAT service board in slot <span>1</span> on CGN2 implement NAT inter-chassis hot backup. VRRP enabled for the channel determines the master/backup status of the CGN devices, and the service board status is associated with VRRP.</p>
<div class="fignone" id="EN-US_TASK_0172362481__fig_01"><a name="EN-US_TASK_0172362481__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for centralized NAT444 inter-chassis hot backup</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cgn-reliability_cfg_0002.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362481__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Set the number of sessions supported by the service board in slot <span>1</span> to 6M.</p>
</li><li><p>Enable HA hot backup.</p>
</li><li><p>Create a service-location group, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel.</p>
</li><li><p>Create and configure a VRRP group.</p>
</li><li><p>Associate HA with VRRP.</p>
</li><li><p>Bind the service-location group to the VRRP group.</p>
</li><li><p>Create a service-instance group and bind it to the service-location group.</p>
</li><li>Create a remote backup service (RBS) and bind the service-instance group to the RBS.</li><li><p>Create a NAT instance and bind it to the service-instance group.</p>
</li><li><p>Configure a NAT traffic policy and a NAT conversion policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362481__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="11.87%" id="mcps1.4.3.3.1.3.1.1" liSelected="liSelected"><p>No.</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="88.13%" id="mcps1.4.3.3.1.3.1.2" liSelected="liSelected"><p>Data</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>1</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Index of a service-location group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>2</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>CPU ID and slot ID of the active CPU on CGN1's service board (CPU 0 in slot <span>1</span> in this example)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>3</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>CPU ID and slot ID of the standby CPU on CGN2's service board (CPU 0 in slot <span>1</span> in this example)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>4</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Names of VRRP interfaces on CGN1 and CGN2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>5</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>IP addresses of VRRP interfaces on CGN1 and CGN2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>6</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>ID of a VRRP group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>7</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Virtual IP address of a VRRP group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>8</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Priorities of VRRP group members</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>9</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>VRRP preemption delay</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>10</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Name of a service-instance group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="11.87%" headers="mcps1.4.3.3.1.3.1.1 "><p>11</p>
</td>
<td class="cellrowborder" valign="top" width="88.13%" headers="mcps1.4.3.3.1.3.1.2 "><p>Name and index of a NAT instance</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362481__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses. For configuration details, see <a href="#EN-US_TASK_0172362481__li650430118214025">Configuration Files</a> in this section.</span></li><li><span>Set the number of sessions supported by the service boards in slot <span>1</span> to 6M on CGN1 and CGN2.</span><p><div class="p"># Configure the master device CGN1.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CGN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-license] <strong>quit</strong></pre>
</div>
<div class="p"># Configure the backup device CGN2.<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CGN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-license] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The method for configuring bandwidth resources varies according to the board type. As such, determine whether to run the <strong>active nat bandwidth-enhance</strong> command and the corresponding parameters based on the board type.</p>
</div></div>
</div>
</p></li><li><span>Enable HA hot backup on CGN1 and CGN2.</span><p><p># Enable HA hot backup on CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1] <strong>commit</strong></pre>
<p># Enable HA hot backup on CGN2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2] <strong>commit</strong></pre>
</p></li><li><span>Create a service-location group on CGN1 and CGN2, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel.</span><p><p># Create service-location group 1 on CGN1, add CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/1/1</span> and the peer IP address to 10.1.1.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>quit</strong></pre>
<p># Create service-location group 1 on CGN2, add CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/1/1</span> and the peer IP address to 10.1.1.1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Configure a VRRP group on CGN1 and CGN2.</span><p><p># On CGN1, enter the view of GE<span>0/1/1</span>, create VRRP group 1, and set the virtual IP address of the VRRP group to 10.1.1.3. Configure the VRRP group as an mVRRP group, and set CGN1's priority in the VRRP group to 200, the VRRP preemption delay to 1500s, and the VRRP recovery delay to 15s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 priority 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 preempt-mode timer delay 1500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># On CGN2, enter the view of GE<span>0/1/1</span>, create VRRP group 1, and set the virtual IP address of the VRRP group to 10.1.1.3. Configure the VRRP group as an mVRRP group, set CGN2's priority in the VRRP group to 150, and set the VRRP recovery delay to 15s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</p></li><li><span>Associate the service-location group with the VRRP group on each device.</span><p><p># On CGN1, enter the view of GE<span>0/1/1</span>, and associate service-location group 1, user-side interface, and network-side interface with VRRP group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 track interface GigabitEthernet <span>0/1/2</span> reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 track interface GigabitEthernet <span>0/1/3</span> reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># On CGN2, enter the view of GE <span>0/1/1</span>, and associate service-location group 1 with VRRP group 1.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This step is optional on the backup device. You can determine whether to perform this step based on network requirements.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Run the <a href="cmdqueryname=display+vrrp+1"><b><span class="cmdname">display vrrp 1</span></b></a> command on CGN1 and CGN2 to view the master/backup VRRP status, which reflects the master/backup status of the service-location group. <strong>State</strong> in the command output indicates the CGN device's status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>display vrrp 1</strong>
GigabitEthernet <span>0/1/1</span> | Virtual Router 1                                                                                      
    State                  : Master  
    Virtual IP             : 10.1.1.3 
    Master IP              : 10.1.1.1  
    Local IP               : 10.1.1.1
    PriorityRun            : 200   
    PriorityConfig         : 200  
    MasterPriority         : 200  
    Preempt                : YES    Delay Time  : 1500 s  
    Hold Multiplier        : 3
    TimerRun               : 1 s   
    TimerConfig            : 1 s     
    Auth Type              : NONE  
    Virtual MAC            : 00e0-fc12-3456 
    Check TTL              : YES         
    Config Type            : admin-vrrp     
    Backup-forward         : disabled   
    Fast-resume            : disabled 
    Track IF               : GigabitEthernet<span>0/1/2</span>    Priority Reduced : 60
    IF State               : UP
    Track IF               : GigabitEthernet<span>0/1/3</span>    Priority Reduced : 60
    IF State               : UP
    Track Service-location : 1    Priority Reduced : 60                                                                              
    Service-location State : UP                                                                                                     
    Create Time            : 2011-10-18 11:14:48 UTC+10:59 
    Last Change Time       : 2011-10-18 14:02:46 UTC+10:59
</pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><strong>Master</strong> in the command output indicates that CGN1 is the master device.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>display vrrp 1</strong>
GigabitEthernet<span>0/1/1</span> | Virtual Router 1                                                                                       
    State                  : Backup  
    Virtual IP             : 10.1.1.3  
    Master IP              : 10.1.1.1 
    Local IP               : 10.1.1.2
    PriorityRun            : 150     
    PriorityConfig         : 150     
    MasterPriority         : 200      
    Preempt                : YES     Delay Time    : 0 s     
    Hold Multiplier        : 3                                                                                           
    TimerRun               : 1 s 
    TimerConfig            : 1 s    
    Auth Type              : NONE  
    Virtual MAC            : 00e0-fc12-3456 
    Check TTL              : YES         
    Config Type            : admin-vrrp  
    Backup-forward         : disabled   
    Fast-resume            : disabled
    Track Service-location : 1   Priority Reduced : 60                                                                              
    Service-location State : UP 
    Create Time            : 2011-10-18 11:26:40 UTC+08:00  
    Last Change Time       : 2011-10-18 14:02:22 UTC+08:00
</pre>
</p></li><li><span>Bind the service-location group to the VRRP group on CGN1 and CGN2.</span><p><p># Bind service-location group 1 to VRRP group 1 on CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>quit</strong></pre>
<p># Bind service-location group 1 to VRRP group 1 on CGN2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-location-1] <strong>vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Create a service-instance group on CGN1 and CGN2 and bind them to the service-location group.</span><p><p># Create a service-instance group named <strong>group1</strong> on CGN1 and bind it to service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-instance-group-group1] <strong>quit</strong></pre>
<p># Create a service-instance group named<strong> group1</strong> on CGN2 and bind it to service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-instance-group-group1] <strong>quit</strong></pre>
<p># Run the <a href="cmdqueryname=display+service-location+1"><b><span class="cmdname">display service-location 1</span></b></a> command on CGN1 and CGN2 to view HA information. <strong>Vrrp state</strong> in the command output indicates the status of a service-location group, which must be consistent with the CGN device's VRRP status. <strong>Batch-backup state</strong> in the command output indicates whether batch backup has been finished.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>display service-location 1</strong>
 service-location 1                                                                                                                
 Backup scene type: inter-box                                                                                                       
 Location slot ID: <span>1</span>                                                                                                  
 Remote-backup interface: GigabitEthernet<span>0/1/1</span>                                                                                      
 Peer: 10.1.1.2                                                                                                                   
 Vrrp ID: 1                                                                                                                       
 Vrrp bind interface: GigabitEthernet<span>0/1/1</span>                                                                                          
 Vrrp state: master                                                                                                                 
 Bound service-instance-group number: 1                                                                                             
 Batch-backup state: finished
</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>display service-location 1</strong>
 service-location 1                                                                                                                
 Backup scene type: inter-box                                                                                                       
 Location slot ID: <span>1</span>                                                                                                   
 Remote-backup interface: GigabitEthernet<span>0/1/1</span>                                                                                      
 Peer: 10.1.1.1                                                                                                                   
 Vrrp ID: 1                                                                                                                       
 Vrrp bind interface: GigabitEthernet<span>0/1/1</span>                                                                                          
 Vrrp state: slave                                                                                                                 
 Bound service-instance-group number: 1                                                                                             
 Batch-backup state: NA
</pre>
</p></li><li><span>Create a remote backup service (RBS) and bind the service-instance group to the RBS.</span><p><p># Configure CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>remote-backup-service natrbs</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-rm-backup-srv-natrbs] <strong>peer 10.1.1.2 source 10.1.1.1 port 1024</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-rm-backup-srv-natrbs] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-rm-backup-srv-natrbs] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-instance-group-group1]<strong> remote-backup-service natrbs</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-instance-group-group1] <strong>quit</strong></pre>
<p># Configure CGN2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>remote-backup-service natrbs</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-rm-backup-srv-natrbs] <strong>peer 10.1.1.1 source 10.1.1.2 port 1024</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-rm-backup-srv-natrbs] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-rm-backup-srv-natrbs] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-instance-group-group1]<strong> remote-backup-service natrbs</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-instance-group-group1] <strong>quit</strong></pre>
</p></li><li><span>Create a NAT instance on each of CGN1 and CGN2 and bind the instances to a service-instance group.</span><p><p># Create a NAT instance named <strong>nat</strong> on CGN1 and bind it to the service-instance group named <strong>group1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat-instance-nat] <strong>quit</strong></pre>
<p># Create a NAT instance named <strong>nat</strong> on CGN2 and bind it to the service-instance group named <strong>group1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-nat-instance-nat] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-nat-instance-nat] <strong>nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-nat-instance-nat] <strong>quit</strong></pre>
</p></li><li><span>Configure a NAT traffic diversion policy and a NAT conversion policy on CGN1 and CGN2. For details, see "Example for Configuring Centralized NAT" in <em>NAT and IPv6 Transition &gt; NAT Configuration</em>.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>CGN inter-chassis hot backup is mutually exclusive with outbound-interface NAT.</p>
</div></div>
<p># Configure a NAT traffic diversion policy and a NAT conversion policy on CGN1.</p>
<ol type="a"><li><p>Configure a NAT traffic diversion policy.</p>
<ol class="substepthirdol"><li><div class="p">Configure an ACL numbered 3001 and an ACL rule numbered 1 in an ACL-based traffic classification policy to allow only hosts with a network segment address of 192.168.10.0/24 to access the Internet.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-acl4-advance-3001] <strong>rule 1 permit ip source 192.168.10.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-acl4-advance-3001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-acl4-advance-3001] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Configure a traffic classifier.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic classifier classifier1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-classifier-classifier1] <strong>if-match acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-classifier-classifier1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-classifier-classifier1] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Define a traffic behavior <strong>behavior1</strong> and bind it to the NAT instance <strong>nat1</strong>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic behavior behavior1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-behavior-behavior1] <strong>nat bind instance nat</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-behavior-behavior1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-behavior-behavior1] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Create a traffic policy <strong>policy1</strong> to associate all ACL rules with the traffic behaviors.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-policy-policy1] <strong>classifier classifier1 behavior behavior1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-policy-policy1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-policy-policy1] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Apply the NAT traffic diversion policy in the GE <span>0/1/2</span> interface view.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface gigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>ip address 192.168.10.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>traffic-policy policy1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
</div>
</li></ol>
</li><li><p>Configure a NAT conversion policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>nat instance nat</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat-instance-nat] <strong>nat outbound 3001 address-group address-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat-instance-nat] <strong>quit</strong></pre>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of CGN2 is similar to that of CGN1. For configuration details, see <a href="#EN-US_TASK_0172362481__config_02">CGN2 configuration file</a> in this section.</p>
</div></div>
<p># Run the <a href="cmdqueryname=display+nat+instance+nat"><b><span class="cmdname">display nat instance nat</span></b></a> command on CGN1 and CGN2 to view NAT configurations.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>display nat instance nat</strong></pre>
<pre class="screen">nat instance nat id 1                                                                                                               
 service-instance-group group1                                                                                                        
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105                                                                     
 nat outbound 3001 address-group address-group1</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>display nat instance nat</strong></pre>
<pre class="screen">nat instance nat id 1                                                                                                               
 service-instance-group group1                                                                                                         
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105                                                                     
 nat outbound 3001 address-group address-group1</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362481__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li id="EN-US_TASK_0172362481__li650430118214025"><p><a name="EN-US_TASK_0172362481__li650430118214025"></a><a name="li650430118214025"></a>CGN1 configuration file</p>
<pre class="screen">#
sysname CGN1
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span> 
<strong> </strong>active nat bandwidth-enhance 40 slot <span>1</span>
#
acl number 3001
 rule 1 permit ip source 192.168.10.0 0.0.0.255
#
traffic classifier classifier1 operator or
 if-match acl 3001 precedence 1
#
traffic behavior behavior1
 nat bind instance nat
#
traffic policy policy1
 share-mode
 classifier classifier1 behavior behavior1 precedence 1
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span>
 remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.2
#
service-instance-group group1
 service-location 1
 remote-backup-service natrbs
#
remote-backup-service natrbs          
 peer 10.1.1.2 source 10.1.1.1 port 1024
#
nat instance nat id 1
 service-instance-group group1                                                              
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105                           
 nat outbound 3001 address-group address-group1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 200
 vrrp vrid 1 preempt-mode timer delay 1500
<strong> </strong>vrrp vrid 1 track interface GigabitEthernet <span>0/1/2</span> reduced 60
<strong> </strong>vrrp vrid 1 track interface GigabitEthernet <span>0/1/3</span> reduced 60
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15  
#
interface GigabitEthernet <span>0/1/2</span>
 undo shutdown
 ip address 192.168.10.1 255.255.255.0
 traffic-policy policy1 inbound
#
interface GigabitEthernet <span>0/1/3</span>
 ip address 11.2.1.1 255.255.0.0
#
ospf 10
 default cost inherit-metric
 import-route unr
 opaque-capability enable
 area 0.0.0.0
  network 11.2.0.0 0.0.255.255
  network 192.168.0.0 0.0.255.255
#
return</pre>
</li><li><p id="EN-US_TASK_0172362481__config_02"><a name="EN-US_TASK_0172362481__config_02"></a><a name="config_02"></a>CGN2 configuration file</p>
<pre class="screen">#
sysname CGN2
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span> 
 active nat bandwidth-enhance 40 slot <span>1</span>
#
acl number 3001
 rule 1 permit ip source 192.168.10.0 0.0.0.255
#
traffic classifier classifier1 operator or
 if-match acl 3001 precedence 1
#
traffic behavior behavior1
 nat bind instance nat
#
traffic policy policy1
 share-mode
 classifier classifier1 behavior behavior1 precedence 1
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span>
 remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.1
#
service-instance-group group1
 service-location 1
 remote-backup-service natrbs
#
remote-backup-service natrbs          
 peer 10.1.1.1 source 10.1.1.2 port 1024
#
nat instance nat id 1
 service-instance-group group1                
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105                           
 nat outbound 3001 address-group address-group1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 150
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15
#
interface GigabitEthernet <span>0/1/2</span>
 undo shutdown
 ip address 192.168.20.1 255.255.255.0
 traffic-policy policy1 inbound
#
interface GigabitEthernet <span>0/1/3</span>
 ip address 11.4.1.1 255.255.0.0
#
ospf 10
 default cost inherit-metric
 import-route unr
 opaque-capability enable
 area 0.0.0.0
  network 11.4.0.0 0.0.255.255
  network 192.169.0.0 0.0.255.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">Inter-Chassis Hot Backup
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0024.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>