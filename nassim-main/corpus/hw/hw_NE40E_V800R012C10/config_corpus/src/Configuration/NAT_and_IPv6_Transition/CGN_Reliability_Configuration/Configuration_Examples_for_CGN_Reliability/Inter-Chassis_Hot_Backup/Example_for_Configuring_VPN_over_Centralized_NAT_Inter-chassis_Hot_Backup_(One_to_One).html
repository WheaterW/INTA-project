
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VPN over Centralized NAT Inter-chassis Hot Backup (One to One)">
<meta name="abstract" content="This section provides an example for configuring VPN over centralized NAT inter-chassis hot backup.">
<meta name="description" content="This section provides an example for configuring VPN over centralized NAT inter-chassis hot backup.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0026.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0036.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00390128">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362487">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring VPN over Centralized NAT Inter-chassis Hot Backup (One to One)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362487"></a><a name="EN-US_TASK_0172362487"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VPN over Centralized NAT Inter-chassis Hot Backup (One to One)</h1>
<div class="taskbody"><p>This section provides an example for configuring VPN over centralized NAT inter-chassis hot backup.</p>
<div class="context"><a name="EN-US_TASK_0172362487__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172362487__fig_dc_ne_cfg_nat_005701">Figure 1</a>, one-to-one address translation is performed on user traffic between one network-side VPN and one user-side VPN. A VRRP channel is established between CGN1 and CGN2 over GE interfaces. CGN1 and CGN2 work in master/backup mode and their master/backup status is determined by VRRP. HA is associated with VRRP. CGN1 is equipped with a service board in slot <span>1</span>, and CGN2 is equipped with a service board in slot <span>1</span>. It is required that VPN over inter-chassis hot backup be implemented between CPU 0 of the service board in slot <span>1</span> on CGN1 and CPU 0 of the service board in slot <span>1</span> on CGN2.</p>
<div class="fignone" id="EN-US_TASK_0172362487__fig_dc_ne_cfg_nat_005701"><a name="EN-US_TASK_0172362487__fig_dc_ne_cfg_nat_005701"></a><a name="fig_dc_ne_cfg_nat_005701"></a><span class="figcap"><b>Figure 1 </b>VPN over centralized NAT inter-chassis hot backup</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 represent GE <span>0/2/0</span>, GE <span>0/2/1</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cgn-reliability_cfg_0004.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362487__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Enable the license function on CGN devices and configure NAT session table resources.</li><li>Configure a user-side VPN instance and a network-side VPN instance on each CGN device and bind the VPN instances.</li><li>Enable HA hot backup.</li><li>Create a service-location group, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel.</li><li>Create a VRRP group and associate HA with VRRP.</li><li>Bind the service-location group to the VRRP group.</li><li>Create a service-instance group and bind the service-location group to the service-instance group.</li><li>Create a NAT instance, enable the VPN NAT function, bind the NAT instance to the service-instance group and allowed VPN instance, and configure an address pool and a traffic conversion policy.</li><li>Configure a NAT traffic diversion policy. </li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362487__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.3.2.1.3.1.1" liSelected="liSelected"><p>No.</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.3.2.1.3.1.2" liSelected="liSelected"><p>Data</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>1</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>User-side VPN and network-side VPN on CGN devices</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>2</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>ACL name and rule</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>1</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>Index of the service-location group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>2</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>CPU ID and slot ID of the active CPU on CGN1's service board (CPU 0 in slot <span>1</span> in this example)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>3</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>CPU ID and slot ID of the standby CPU on CGN2's service board (CPU 0 in slot <span>1</span> in this example)</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>4</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>VRRP interfaces on CGN1 and CGN2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>5</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>IP addresses of VRRP interfaces on CGN1 and CGN2</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>6</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>ID of a VRRP group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>7</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>Virtual IP address of the VRRP group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>8</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>Priorities of VRRP group members</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>9</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>VRRP preemption delay</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>10</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>Name of a service-instance group</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>11</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>NAT instance name and index</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>12</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>NAT address pool name and index</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>13</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>Name of a private VPN instance</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>14</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>Name of a public VPN instance</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>15</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>RDs of the VPN instances</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.1 "><p>16</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.3.2.1.3.1.2 "><p>VPN-Target of the VPN instances</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362487__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable the license function on CGN devices and configure NAT session table resources.</span><p><p># Configure CGN1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CGN1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-license] <strong>quit</strong></pre>
<p># Configure CGN2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CGN2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-license] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The method for configuring bandwidth resources varies according to the board type. As such, determine whether to run the <strong>active nat bandwidth-enhance</strong> command and the corresponding parameters based on the board type.</p>
</div></div>
</p></li><li><span>Configure a user-side VPN instance and a network-side VPN instance on each CGN device and bind the VPN instances.</span><p><p># Configure CGN1.</p>
<ol type="a"><li><p>Configure a user-side VPN instance named <strong>inside-vpn</strong> on CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>ip vpn-instance inside-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-inside-vpn] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-inside-vpn-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-inside-vpn-af-ipv4] <strong>vpn-target 101:101 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-inside-vpn-af-ipv4] <strong>vpn-target 101:101 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-inside-vpn-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-vpn-instance-inside-vpn-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-vpn-instance-inside-vpn] <strong>quit</strong></pre>
</li><li><p>Configure a network-side VPN instance named <strong>global-vpn</strong> on CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>ip vpn-instance global-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-global-vpn] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-global-vpn-af-ipv4] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-global-vpn-af-ipv4] <strong>vpn-target 102:102 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-global-vpn-af-ipv4] <strong>vpn-target 102:102 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-vpn-instance-global-vpn-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-vpn-instance-global-vpn-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-vpn-instance-global-vpn] <strong>quit</strong></pre>
</li><li><p>On CGN1, bind the VPN instance named <strong>inside-vpn</strong> on the user side.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/2/1</span>] <strong>ip binding vpn-instance inside-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/1</span>] <strong>ip address 172.16.10.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong></pre>
</li><li><p>On CGN1, bind the VPN instance named <strong>global-vpn</strong> on the network side.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/3/0</span>] <strong>ip binding vpn-instance global-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/3/0</span>] <strong>ip address 172.16.9.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/3/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
</li></ol>
<p># Configure CGN2.</p>
<ol type="a"><li><p>Configure a user-side VPN instance named <strong>inside-vpn</strong> on CGN2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>ip vpn-instance inside-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-inside-vpn] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-inside-vpn-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-inside-vpn-af-ipv4] <strong>vpn-target 101:101 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-inside-vpn-af-ipv4] <strong>vpn-target 101:101 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-inside-vpn-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-vpn-instance-inside-vpn-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-vpn-instance-inside-vpn] <strong>quit</strong></pre>
</li><li><p>Configure a network-side VPN instance named <strong>global-vpn</strong> on CGN2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>ip vpn-instance global-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-global-vpn] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-global-vpn-af-ipv4] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-global-vpn-af-ipv4] <strong>vpn-target 102:102 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-global-vpn-af-ipv4] <strong>vpn-target 102:102 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-vpn-instance-global-vpn-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-vpn-instance-global-vpn-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-vpn-instance-global-vpn] <strong>quit</strong></pre>
</li><li><p>On CGN2, bind the VPN instance named <strong>inside-vpn</strong> on the user side.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>interface GigabitEthernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/2/1</span>] <strong>ip binding vpn-instance inside-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/1</span>] <strong>ip address 172.16.7.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong></pre>
</li><li><p>On CGN2, bind the VPN instance named <strong>global-vpn</strong> on the network side.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>interface GigabitEthernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/3/0</span>] <strong>ip binding vpn-instance global-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/3/0</span>] <strong>ip address 172.16.8.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/3/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Enable HA hot backup.</span><p><p># Configure CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration on CGN2 is similar to that on CGN1. </p>
</div></div>
</p></li><li><span>Create a service-location group, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel.</span><p><p># Create service-location group 1 on CGN1, add CPU 0 of the service board in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/2/0</span> and the peer IP address to 172.16.5.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/2/0</span> peer 172.16.5.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>quit</strong></pre>
</p><p><p># Create service-location group 1 on CGN2, add CPU 0 of the service board in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/2/0</span> and the peer IP address to 172.16.5.1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/2/0</span> peer 172.16.5.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Create a VRRP group and configure HA and VRRP association. Set the VRRP preemption delay to 1500s to ensure that the NAT information is backed up completely. Set the VRRP recovery delay to 15s.</span><p><p># Configure CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 172.16.5.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 virtual-ip 172.16.5.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 preempt-mode timer delay 1500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 track interface GigabitEthernet <span>0/2/1</span> reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 track interface GigabitEthernet <span>0/3/0</span> reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure CGN2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 172.16.5.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 virtual-ip 172.16.5.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p>After the configuration, the master/backup status of CGN1 and CGN2 can be determined by VRRP. You can run the <a href="cmdqueryname=display+vrrp+1"><b><span class="cmdname">display vrrp 1</span></b></a> command to check the master/backup VRRP status, which reflects the master/backup status of the service-location groups on CGN1 and CGN2. <strong>State</strong> in the command output indicates the CGN device's status.</p>
<p>The following example uses the command output on CGN1:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>display vrrp 1</strong></pre>
<pre class="screen">GigabitEthernet <span>0/2/0</span> | Virtual Router 1                                                                                      
    State                    : Master  
    Virtual IP               : 172.16.5.100   
    Master IP                : 172.16.5.1    
    Local IP                 : 172.16.5.1
    PriorityRun              : 200     
    PriorityConfig           : 200    
    MasterPriority           : 200    
    Preempt                  : YES   Delay Time   : 300 s  
    Hold Multiplier          : 3                                                                             
    TimerRun                 : 1 s      
    TimerConfig              : 1 s     
    Auth Type                : NONE       
    Virtual MAC              : 00e0-fc12-3456   
    Check TTL                : YES      
    Config Type              : admin-vrrp   
    Backup-forward           : disabled   
    Fast-resume              : disabled     
    Track IF                 : GigabitEthernet<span>0/2/1</span>    Priority Reduced :60
    IF State                 : UP           
    Track Service-location   : 1   Priority Reduced : 60                                                
    Service-location State   : UP 
    Create Time              : 2016-10-18 11:14:48 UTC+10:59   
    Last Change Time         : 2016-10-18 14:02:46 UTC+10:59</pre>
</p></li><li><span>Bind the service-location group to the VRRP group.</span><p><p># Configure CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>vrrp vrid 1 interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-location-1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration on CGN2 is similar to that on CGN1. </p>
</div></div>
</p></li><li><span>Create a service-instance group and bind the service-location group to the service-instance group.</span><p><p># Configure CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-service-instance-group-group1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration on CGN2 is similar to that on CGN1. </p>
</div></div>
<p>Run the <a href="cmdqueryname=display+service-location+1"><b><span class="cmdname">display service-location 1</span></b></a> command on the CGN devices to check the HA information. <strong>VRRP State</strong> in the command output indicates the status of the HA backup group, which must be consistent with the CGN devices' VRRP status. <strong>Batch-backup state</strong> in the command output indicates whether batch backup has completed.</p>
<p>The following example uses the command output on CGN1:</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>display service-location 1</strong></pre>
<pre class="screen">service-location 1                                                                                                                
 Backup scene type    : inter-box      
 Location slot ID     : <span>1</span>        
 Remote-backup interface: GigabitEthernet<span>0/2/0</span>                                                                                      
 Peer: 172.16.5.2                                                                                                                   
 Vrrp ID: 1                                                                                                                       
 Vrrp bind interface: GigabitEthernet<span>0/2/0</span>                                                                                          
 Vrrp state: master                                                                                                                 
 Bound service-instance-group number: 1                                                                                             
 Batch-backup state: finished
</pre>
</p></li><li><span>Create a NAT instance, enable the VPN NAT function, bind the NAT instance to the service-instance group and allowed VPN instance, and configure an address pool and a traffic conversion policy.</span><p><p># Configure CGN1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>port-range 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>nat address-group group1 group-id 1 vpn-instance global-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat-nat-address-group-group1] <strong>section 0 11.11.11.0 mask 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat-nat-address-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat-instance-nat-nat-address-group-group1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat-instance-nat] <strong>nat allow-access inside vpn-instance inside-vpn global vpn-instance global-vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>nat outbound any address-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-nat-instance-nat] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p">The configuration on CGN2 is similar to that on CGN1. Pay attention to the following points:<ul><li>Ensure that the VPN instance before NAT is the same as that bound to the user-side inbound interface (GE <span>0/2/1</span> on PE1).</li><li>Ensure that the VPN instance after NAT is the same as that bound to the network-side outbound interface (GE <span>0/3/0</span> on PE2).</li></ul>
</div>
</div></div>
</p></li><li><span>Configure a NAT traffic diversion policy.</span><p><p># Configure an ingress NAT traffic diversion policy on CGN1.</p>
<ol type="a"><li><p>Configure an ACL numbered 3001, an ACL rule numbered 5, and an ACL-based traffic classification rule to allow only hosts with a network segment address of 10.1.1.0/24 to access the Internet.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>acl number 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-acl-adv-3001] <strong>rule 5 permit ip source 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-acl-adv-3001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-acl-adv-3001] <strong>quit</strong></pre>
</li><li><p>Configure a traffic classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic classifier vpn_nat1 operator or</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-classifier-vpn_nat1] <strong>if-match acl 3001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-classifier-vpn_nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-classifier-vpn_nat1] <strong>quit</strong></pre>
</li><li><p>Define a traffic behavior named <strong>vpn_nat1</strong> and bind it to the NAT instance named <strong>nat</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic behavior vpn_nat1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-behavior-vpn_nat1] <strong>nat bind instance nat</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-behavior-vpn_nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-behavior-vpn_nat1] <strong>quit</strong></pre>
</li><li><p>Define a NAT traffic policy named <strong>vpn_nat1</strong> to associate all ACL rules with the traffic behaviors.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>traffic policy vpn_nat1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-policy-vpn_nat1] <strong>classifier vpn_nat1 behavior vpn_nat1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-policy-vpn_nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-policy-vpn_nat1] <strong>quit</strong></pre>
</li><li><p>Apply the NAT traffic policy on the user side.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1] <strong>interface GigabitEthernet <span>0/2/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/2/1</span>] <strong>traffic-policy vpn_nat1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CGN1-GigabitEthernet<span>0/2/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CGN1-GigabitEthernet<span>0/2/1</span>] <strong>quit</strong></pre>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration on CGN2 is similar to that on CGN1. </p>
</div></div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362487__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>CGN1 configuration file<pre class="screen">#
sysname CGN1
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span> 
 active nat bandwidth-enhance 40 slot <span>1</span>
#
ip vpn-instance inside-vpn
 ipv4-family
  route-distinguisher 200:1 
  apply-label per-instance 
  vpn-target 101:101 export-extcommunity                  
  vpn-target 101:101 import-extcommunity                        
#
ip vpn-instance global-vpn
 ipv4-family
  route-distinguisher 200:2   
  apply-label per-instance 
  vpn-target 102:102 export-extcommunity                                                     
  vpn-target 102:102 import-extcommunity                                                   
#
ospf 101 vpn-instance inside-vpn
 default cost inherit-metric
 import-route direct
 opaque-capability enable
 area 0.0.0.0
  network 172.16.10.0 0.0.0.255
#              
bgp 300                                                                                                                             
 private-4-byte-as enable                                                                                                    
 #                                                                                                                                  
 ipv4-family unicast                                                                                                                
  undo synchronization                                                                                                              
 #                                                                                                                                  
 ipv4-family vpn-instance global-vpn                                                                                                
  import-route direct                                                                                                               
  import-route unr                                                                                                                  
  peer 172.16.9.2 as-number 400                                                                                                     
  peer 172.16.9.2 connect-interface GigabitEthernet<span>0/3/0</span>
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/2/0</span>
 remote-backup interface GigabitEthernet <span>0/2/0</span> peer 172.16.5.2
#
service-instance-group group1
 service-location 1
#
nat instance nat id 1
 port-range 64
 service-instance-group group1
 nat address-group group1 group-id 1 vpn-instance global-vpn
  section 0 11.11.11.0 mask 24
 nat allow-access inside vpn-instance inside-vpn global vpn-instance global-vpn
 nat outbound any address-group group1
#
acl number 3001 
 rule 5 permit ip source 10.1.1.0 0.0.0.255 
#
traffic classifier vpn_nat1 operator or
 if-match acl 3001 precedence 1
#
traffic behavior vpn_nat1
  nat bind instance nat
#
traffic policy vpn_nat1
 share-mode
 classifier vpn_nat1 behavior vpn_nat1 precedence 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 172.16.5.1 255.255.255.0
 vrrp vrid 1 virtual-ip 172.16.5.100
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 120
 vrrp vrid 1 preempt-mode timer delay 1500
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp vrid 1 track interface GigabitEthernet <span>0/2/1</span> reduced 60
 vrrp vrid 1 track interface GigabitEthernet <span>0/3/0</span> reduced 60
 vrrp recover-delay 15
#
interface GigabitEthernet<span>0/3/0</span>
 ip binding vpn-instance global-vpn
 ip address 172.16.9.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/1</span>
 ip binding vpn-instance inside-vpn
 ip address 172.16.10.1 255.255.255.0
 traffic-policy vpn_nat1 inbound
#
return</pre>
</li><li><p>CGN2 configuration file</p>
<pre class="screen">#
sysname CGN2
#
vsm on-board-mode disable
#
license
 active nat session-table size 6 slot <span>1</span> 
 active nat bandwidth-enhance 40 slot <span>1</span>
#
ip vpn-instance inside-vpn
 ipv4-family
  route-distinguisher 200:1    
  apply-label per-instance 
  vpn-target 101:101 export-extcommunity                                                                                              
  vpn-target 101:101 import-extcommunity                                                                                              
#
ip vpn-instance global-vpn
 ipv4-family
  route-distinguisher 200:2    
  apply-label per-instance 
  vpn-target 102:102 export-extcommunity                                                                                              
  vpn-target 102:102 import-extcommunity                                                                                             
#
ospf 101 vpn-instance inside-vpn
 default cost inherit-metric
 import-route direct
 opaque-capability enable
 area 0.0.0.0
  network 172.16.7.0 0.0.0.255
#                                 
bgp 200                                                                                                                             
 private-4-byte-as enable                                                                                                           
 #                                                                                                                                  
 ipv4-family unicast                                                                                                                
  undo synchronization                                                                                                              
 #                                                                                                                                  
 ipv4-family vpn-instance global-vpn                                                                                                
  import-route direct                                                                                                               
  import-route unr                                                                                                                  
  peer 172.16.8.2 as-number 400                                                                                                     
  peer 172.16.8.2 connect-interface GigabitEthernet<span>0/3/0</span>
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/2/0</span>
 remote-backup interface GigabitEthernet <span>0/2/0</span> peer 172.16.5.1
#
service-instance-group group1
 service-location 1
#
nat instance nat id 1
 port-range 64
 service-instance-group group1
 nat address-group group1 group-id 1 vpn-instance global-vpn
  section 0 11.11.11.0 mask 24
 nat allow-access inside vpn-instance inside-vpn global vpn-instance global-vpn
 nat outbound any address-group group1
#
acl number 3001 
 rule 5 permit ip source 10.1.1.0 0.0.0.255 
#
traffic classifier vpn_nat1 operator or
 if-match acl 3001 precedence 1
#
traffic behavior vpn_nat1
  nat bind instance nat
#
traffic policy vpn_nat1
 share-mode
 classifier vpn_nat1 behavior vpn_nat1 precedence 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 172.16.5.2 255.255.255.0
 vrrp vrid 1 virtual-ip 172.16.5.100
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 150
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15
#
interface GigabitEthernet<span>0/3/0</span>
 ip binding vpn-instance global-vpn
 ip address 172.16.8.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/1</span>
 ip binding vpn-instance inside-vpn
 ip address 172.16.7.1 255.255.255.0
 traffic-policy vpn_nat1 inbound
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">Inter-Chassis Hot Backup
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0026.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0036.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>