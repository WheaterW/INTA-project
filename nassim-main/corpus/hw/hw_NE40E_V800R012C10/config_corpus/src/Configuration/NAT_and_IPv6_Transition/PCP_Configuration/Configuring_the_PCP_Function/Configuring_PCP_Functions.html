
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring PCP Functions">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pcp_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pcp_cfg_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="PCP">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PCP">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="PCP">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="PCP">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00390128">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172374859">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring PCP Functions</title>
</head>
<body><a name="EN-US_TASK_0172374859"></a><a name="EN-US_TASK_0172374859"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring PCP Functions</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0172374859__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>PCP is enabled by default in a NAT or DS-Lite instance. A CGN device (PCP server) must be assigned an IP address so that a CPE (PCP client) can send a request to establish a PCP connection to the CGN device.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172374859__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=vsm+on-board-mode+disable"><b><span class="cmdname">vsm on-board-mode disable</span></b></a></span><p><p>The dedicated board working mode is specified.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=license"><b><span class="cmdname">license</span></b></a></span></span><p><p>The license view is displayed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=active+pcp+vsuf"><b><span class="cmdname">active pcp vsuf</span></b></a> <strong><span>slot</span></strong> <i><span class="varname">slot-id</span></i></span></span><p><p>PCP is enabled on a specified service board.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the license view.</p>
</p></li><li><span>Perform the following operations based on whether the CPE and CGN devices are deployed in a NAT444 or DS-Lite scenario:</span><ul><li>In a NAT444 scenario, perform the following steps:<ol type="a"><li><p>Run <span><a href="cmdqueryname=nat+instance"><b><span class="cmdname">nat instance</span></b></a> <i><span class="varname">instance-name</span></i> <strong><span>id</span></strong> <i><span class="varname">id</span></i></span></p>
<p>The NAT instance view is displayed.</p>
</li><li><p>Run <span><a href="cmdqueryname=pcp+enable"><b><span class="cmdname">pcp enable</span></b></a></span></p>
<p>The PCP function is enabled in the NAT instance.</p>
</li><li>Run <a href="cmdqueryname=pcp+server"><b><span class="cmdname">pcp server</span></b></a> <strong><span>ipv4</span></strong> <i><span class="varname">ipv4âaddress</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-len</span></i> }<div class="p">An IPv4 address is configured for the PCP server.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>Only one IPv4 address can be configured for a PCP server in each NAT instance, and the specified address cannot be used as a physical interface address, a loopback interface address, or an address in an address pool.</p>
</li><li><p>Static routes need to be configured when a CPE device is deployed on a VPN network.</p>
</li></ul>
</div></div>
</div>
</li><li><p>(Optional) Run <a href="cmdqueryname=pcp+version1+ignore+prefer-failure"><b><span class="cmdname">pcp version1 ignore prefer-failure</span></b></a></p>
<p>The device is configured to send PCPv1 response packets without the prefer_failure option.</p>
<p>A non-Huawei CPE may fail to identify PCPv1 response packets carrying the prefer_failure option. As a result, the non-Huawei CPE cannot communicate with the CGN device in this situation. To prevent this issue, run the <a href="cmdqueryname=pcp+version1+ignore+prefer-failure"><b><span class="cmdname">pcp version1 ignore prefer-failure</span></b></a> command to enable the CGN device to send PCPv1 response packets without the prefer_failure option.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=port-reservation"><b><span class="cmdname">port-reservation</span></b></a> <i><span class="varname">start-port</span></i> <strong><span>to</span></strong> <i><span class="varname">end-port</span></i><span> [ <strong><span>extend well-known-port</span></strong> ]</span></p>
<p>The port reservation function is enabled.</p>
<p>If the port requested by the PCP client is not within the port range, the PCP client can apply for port preemption from the reserved port range.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When users go offline and then go online again, to allow the users to obtain the same ports or port range as that before the users go offline, perform the following operations: Configure the port reservation function, and configure the RADIUS server to carry the HW-NAT-Start-Port (162) and HW-NAT-End-Port (163) private attributes and deliver the reserved ports or port range to the users.</p>
</div></div>
</li><li><p>(Optional) Run <a href="cmdqueryname=nat+log+session+port-reservation"><b><span class="cmdname">nat log session port-reservation</span></b></a></p>
<p>The device is enabled to record PCP port reservation logs.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>The flow and user log functions must be enabled in the NAT instance and the log host information must be configured. For configuration details, see <a href="dc_ne_nat_cfg_0047.html">Configuring the NAT Log Function</a>.</p>
</li><li><p>When the port that the PCP client preempts is within the reserved port range and the device is enabled to send port reservation log messages in the instance, the device sends flow log messages. In the other situations, the device does not send flow log messages. User log messages can be used for source tracing.</p>
</li></ul>
</div></div>
</li><li><p>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></p>
<p>The configuration is committed.</p>
</li><li><p>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></p>
<p>Exit the NAT instance view.</p>
</li></ol>
</li><li>In a DS-Lite scenario, perform the following steps:<ol type="a"><li><p>Run <span><a href="cmdqueryname=ds-lite+instance"><b><span class="cmdname">ds-lite instance</span></b></a> <i><span class="varname">instance-name</span></i> <strong><span>id</span></strong> <i><span class="varname">id</span></i></span></p>
<p>The DS-Lite instance view is displayed.</p>
</li><li><p>Run <span><a href="cmdqueryname=pcp+enable"><b><span class="cmdname">pcp enable</span></b></a></span></p>
<p>The PCP function is enabled in the DS-Lite instance.</p>
</li><li>Run <a href="cmdqueryname=pcp+server"><b><span class="cmdname">pcp server</span></b></a> { <strong><span>ipv4</span></strong> <i><span class="varname">ipv4âaddress</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-len</span></i> } | <strong><span>ipv6</span></strong> <i><span class="varname">ipv6âaddress</span></i> <i><span class="varname">prefix-length</span></i> }<div class="p">The IP address of the PCP server is configured.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A single PCP server IPv4 address and a single PCP server IPv6 address can be specified in each DS-Lite instance, and the specified address cannot be used as a physical interface address, a loopback interface address, or an address in an address pool.</p>
</div></div>
</div>
</li><li><p>(Optional) Run <a href="cmdqueryname=pcp+version1+ignore+prefer-failure"><b><span class="cmdname">pcp version1 ignore prefer-failure</span></b></a></p>
<p>The device is configured to send PCPv1 response packets without the prefer_failure option.</p>
<p>A non-Huawei CPE may fail to identify PCPv1 response packets carrying the prefer_failure option. As a result, the non-Huawei CPE cannot communicate with the CGN device in this situation. To prevent this issue, run the <a href="cmdqueryname=pcp+version1+ignore+prefer-failure"><b><span class="cmdname">pcp version1 ignore prefer-failure</span></b></a> command to enable the CGN device to send PCPv1 response packets without the prefer_failure option.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=port-reservation"><b><span class="cmdname">port-reservation</span></b></a> <i><span class="varname">start-port</span></i> <strong><span>to</span></strong> <i><span class="varname">end-port</span></i><span> [ <strong><span>extend well-known-port</span></strong> ]</span></p>
<p>The port reservation function is enabled.</p>
<p>If the port requested by the PCP client is not within the port range, the PCP client can apply for port preemption from the reserved port range.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When users go offline and then go online again, to allow the users to obtain the same ports or port range as that before the users go offline, perform the following operations: Configure the port reservation function, and configure the RADIUS server to carry the HW-NAT-Start-Port (162) and HW-NAT-End-Port (163) private attributes and deliver the reserved ports or port range to the users.</p>
</div></div>
</li><li>(Optional) Run <a href="cmdqueryname=pcp+port-set+max-size"><b><span class="cmdname">pcp port-set max-size</span></b></a> <i><span class="varname">size-value</span></i><p>The maximum size of a port set is configured.</p>
<p>If a PCP request packet sent by a client carries the Port Set Option field, you can run this command to apply for a group of public network ports.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>This function applies only to PCP request packets of the MAP protocol type.</li><li>This function applies only to the DS-Lite scenario.</li></ul>
</div></div>
</li><li><p>(Optional) Run <a href="cmdqueryname=ds-lite+log+session+port-reservation"><b><span class="cmdname">ds-lite log session port-reservation</span></b></a></p>
<p>The device is enabled to record PCP port reservation logs.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>The flow and user log functions must be enabled in the DS-Lite instance and the log host information must be configured. For configuration details, see <a href="dc_ne_ds-lite_cfg_0048.html">Configuring the DS-Lite Log Function</a>.</p>
</li><li><p>When the port that the PCP client preempts is within the reserved port range and the device is enabled to send port reservation log messages in the instance, the device sends flow log messages. In the other situations, the device does not send flow log messages. User log messages can be used for source tracing.</p>
</li></ul>
</div></div>
</li><li><p>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></p>
<p>The configuration is committed.</p>
</li><li><p>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></p>
<p>Exit the DS-Lite instance view.</p>
</li></ol>
</li></ul>
</li><li><span>(Optional) Specify a PCP server name in a DHCP Option field.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Perform the following operations based on whether the CPE and CGN/BRAS are deployed on an IPv4 or IPv6 network:</span><p><ul><li>On an IPv4 network, perform the following steps:<ol class="substepthirdol"><li><p>Run <span><a href="cmdqueryname=ip+pool"><b><span class="cmdname">ip pool</span></b></a> <i><span class="varname">pool-name</span></i> <strong><span>bas</span></strong> <strong><span>local</span></strong></span></p>
<p>The IPv4 address pool view is displayed.</p>
</li><li><p>Run <span><a href="cmdqueryname=option"><b><span class="cmdname">option</span></b></a> <i><span class="varname">code</span></i> { { <strong><span>ip</span></strong> <i><span class="varname">ip-address</span></i> } &amp;&lt;1-2&gt; | <strong><span>string</span></strong> <i><span class="varname">string</span></i> | { <strong><span>suboption</span></strong> <i><span class="varname">subcode</span></i> { <strong><span>ip</span></strong> <i><span class="varname">ip-address</span></i> | <strong><span>string</span></strong> <i><span class="varname">string</span></i> } } &amp;&lt;1-16&gt; }</span></p>
<p>The PCP server name is specified in a specified DHCPv4 Option field.</p>
</li></ol>
</li><li>On an IPv6 network, perform the following steps:<ol class="substepthirdol"><li><p>Run <span><a href="cmdqueryname=ipv6+pool"><b><span class="cmdname">ipv6 pool</span></b></a> <i><span class="varname">pool-name</span></i> <strong><span>bas</span></strong> <strong><span>local</span></strong></span></p>
<p>The IPv6 address pool view is displayed.</p>
</li><li><p>Run <span><a href="cmdqueryname=option"><b><span class="cmdname">option</span></b></a> <i><span class="varname">code</span></i> { { <strong><span>ipv6</span></strong> <i><span class="varname">ipv6-address</span></i> } &amp;&lt;1-2&gt; | <strong><span>string</span></strong> <i><span class="varname">string</span></i> | <strong><span>hex</span></strong> <i><span class="varname">hex</span></i> | { <strong><span>suboption</span></strong> <i><span class="varname">subcode</span></i> { <strong><span>ipv6</span></strong> <i><span class="varname">ipv6-address</span></i> | <strong><span>string</span></strong> <i><span class="varname">string</span></i> | <strong><span>hex</span></strong> <i><span class="varname">hex</span></i> } } &amp;&lt;1-16&gt; }</span></p>
<p>The PCP server name is specified in a specified DHCPv6 Option field.</p>
</li></ol>
</li></ul>
</p></li></ol>
</li><li><span>(Optional) Specify a PCP server name to be delivered by a RADIUS server.</span><ol type="a"><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=radius-server+group"><b><span class="cmdname">radius-server group</span></b></a> <i><span class="varname">group-name</span></i></span></span><p><p>The RADIUS server group view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=radius-attribute+assign"><b><span class="cmdname">radius-attribute assign</span></b></a> <strong>hw-pcp-server-name</strong> { <a href="cmdqueryname=dhcp"><b><span class="cmdname">dhcp</span></b></a> <em><i><span class="varname">dhcp-option-code</span></i></em> | <a href="cmdqueryname=dhcpv6"><b><span class="cmdname">dhcpv6</span></b></a> <em><i><span class="varname">dhcpv6-option-code</span></i></em> }</span><p><p>The HW-PCP-Server-Name attribute in a RADIUS Access-Accept packet is encapsulated into the DHCP/DHCPv6 Option field.</p>
</p><p></p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the RADIUS server group view.</p>
</p></li></ol>
</li><li><span>(Optional) Run <a href="cmdqueryname=pcp+prefer-failure+enhance+enable"><b><span class="cmdname">pcp prefer-failure enhance enable</span></b></a></span><p><p>PCP prefer_failure enhancement is enabled.</p>
</p><p><p>For PCP MAP request packets carrying the prefer_failure option and non-0 public network IP addresses, PCP prefer_failure enhancement is enabled to allow the PCP server to randomly assign a public IP address.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=pcp+lifetime"><b><span class="cmdname">pcp lifetime</span></b></a> <strong><span>min-time</span></strong> <i><span class="varname">min-value</span></i> <strong><span>max-time</span></strong> <i><span class="varname">max-value</span></i></span><p><p>The minimum and maximum lifetime values for PCP connections are set.</p>
</p><p><p>After the lifetime elapses, a CGN device terminates PCP connections to release resources. You can set the minimum and maximum lifetime values based on the network traffic volume and the number of resources.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pcp_cfg_0010.html">Configuring the PCP Function
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_pcp_cfg_0009.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>