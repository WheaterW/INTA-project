
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring RUI+Distributed NAT Dual-Device Hot Backup in Shared Address Pool Mode">
<meta name="abstract" content="This section provides an example for configuring Redundancy User Information (RUI) and distributed network address translation (NAT) dual-device hot backup in shared address pool mode.">
<meta name="description" content="This section provides an example for configuring Redundancy User Information (RUI) and distributed network address translation (NAT) dual-device hot backup in shared address pool mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0036.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0038.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="CGN Reliability">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362495">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring RUI+Distributed NAT Dual-Device Hot Backup in Shared Address Pool Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362495"></a><a name="EN-US_TASK_0172362495"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring RUI+Distributed NAT Dual-Device Hot Backup in Shared Address Pool Mode</h1>
<div class="taskbody"><p>This section provides an example for configuring Redundancy User Information (RUI) and distributed network address translation (NAT) dual-device hot backup in shared address pool mode.</p>
<div class="context"><a name="EN-US_TASK_0172362495__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172362495__fig_01">Figure 1</a>, in distributed deployment mode, a terminal user dials up through PPPoE, and BRAS1 and BRAS2 are interconnected through a switch. Dual-device RUI is used to achieve user information backup in shared address pool mode. A NAT service board is deployed in slot <span>1</span> on BRAS1 and another NAT service board is deployed in slot <span>1</span> on BRAS2. A VRRP channel is established between BRAS1 and BRAS2 through GE interfaces. CPU 0 of the NAT service board in slot <span>1</span> on BRAS1 and CPU 0 of the NAT service board in slot <span>1</span> on BRAS2 implement NAT inter-chassis hot backup. The NAT service's master/backup status is determined by VRRP, and the service board status is associated with VRRP. The two devices work in master/backup status by running VRRP.</p>
<div class="fignone" id="EN-US_TASK_0172362495__fig_01"><a name="EN-US_TASK_0172362495__fig_01"></a><a name="fig_01"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring distributed dual-device inter-chassis backup</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/1</span>, GE <span>0/1/2</span>, and GE <span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_ne_cgn-reliability_cfg_0003.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP address plan</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25.91%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="35.55%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="38.54%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address and Mask</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" valign="top" width="25.91%" headers="mcps1.4.1.4.2.4.1.1 "><p>BRAS1</p>
</td>
<td class="cellrowborder" valign="top" width="35.55%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="38.54%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/2</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.2.10/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.12.1.0/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.10.10.100/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" valign="top" width="25.91%" headers="mcps1.4.1.4.2.4.1.1 "><p>BRAS2</p>
</td>
<td class="cellrowborder" valign="top" width="35.55%" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="38.54%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/2</span>.2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.2.100/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.12.2.0/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.10.10.99/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362495__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable HA hot backup on BRAS1 and BRAS2.</p>
</li><li><p>Configure a session table size for the NAT service board's CPU on BRAS1 and BRAS2.</p>
</li><li><p>Create a service-location group on BRAS1 and BRAS2, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel.</p>
</li><li><p>Configure a VRRP group on BRAS1 and BRAS2.</p>
</li><li><p>Associate HA with VRRP on the direct-connect interfaces on the master and backup devices.</p>
</li><li><p>Bind the service-location group to the VRRP group on BRAS1 and BRAS2.</p>
</li><li><p>Create a service-instance group on BRAS1 and BRAS2 and bind them to the service-location group.</p>
</li><li><p>Create a NAT instance on BRAS1 and BRAS2 and bind it to the service-instance group and NAT address pool.</p>
</li><li><p>Configure a NAT conversion policy on BRAS1 and BRAS2.</p>
</li><li><p>Configure PPPoE user access and RADIUS authentication on the BRASs and bind the user groups to NAT instances.</p>
</li><li><p>Configure the route of the NAT address pool as a static blackhole route and advertise it to a routing protocol. Set the ID of an OSPF process to 1.</p>
</li><li><p>Configure a user-side VRRP group on BRAS1 and BRAS2 that are connected to the switch.</p>
</li><li><p>Establish a BFD session named <strong>bfd</strong> on BRAS1 and BRAS2 to quickly detect interface or link exceptions and trigger a master/backup VRRP switchover.</p>
</li><li><p>Configure RUI backup on BRAS1 and BRAS2 and back up BRAS information in shared address pool mode.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362495__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>Index of a service-location group</p>
</li><li><p>Active CPU IDs and slot IDs of the service boards on BRAS1 and BRAS2 (CPU 0 in slot <span>1</span> in this example)</p>
</li><li><p>Interface and its IP address of a VRRP channel over the direct link between BRAS1 and BRAS2</p>
</li><li><p>Index, virtual IP address, member priorities, and preemption delay of a VRRP group over the direct link</p>
</li><li><p>Name of a service-instance group</p>
</li><li><p>Index of a service-location group</p>
</li><li><p>Index and name of a NAT instance, NAT address pool name, and address range</p>
</li><li><p>ACL number, traffic classifier name, traffic behavior name, and traffic policy name of the NAT traffic conversion policy</p>
</li><li><p>IPv4 address pool, IP address of the address pool gateway, and IP address segment allocated for user access</p>
</li><li><p>User group name, user domain name, and AAA authentication scheme and accounting scheme</p>
</li><li><p>Name and IP address of a RADIUS server group</p>
</li><li><p>Remote backup identifier for RUI backup</p>
</li><li><p>User-side interfaces and their IP addresses on BRAS1 and BRAS2</p>
</li><li><p>Interface and its IP address of a user-side VRRP channel</p>
</li><li><p>Index, virtual IP address, member priorities, and preemption delay of the user-side VRRP group</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362495__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable HA hot backup on the master and backup devices.</span><p><p># Configure BRAS1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure BRAS2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname BRAS2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-ha hot-backup enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure a session table size for the NAT service board's CPU on BRAS1 and BRAS2.</span><p><p># Set the number of session tables supported by the NAT service board's CPU in slot <span>1</span> on BRAS1 to 6M.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-license] <strong>quit</strong></pre>
<p># Set the number of session tables supported by the NAT service board's CPU in slot <span>1</span> on BRAS2 to 6M.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-license] <strong>active nat session-table size 6 slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-license] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The method for configuring bandwidth resources varies according to the board type. As such, determine whether to run the <strong>active nat bandwidth-enhance</strong> command and the corresponding parameters based on the board type.</p>
</div></div>
</p></li><li><span>Create a service-location group on BRAS1 and BRAS2, configure members for HA dual-device inter-chassis backup, and configure a VRRP channel.</span><p><p># Create service-location group 1 on BRAS1, add CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/1/1</span> and the peer IP address to 10.1.1.2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-1] <strong>quit</strong></pre>
<p># Create service-location group 1 on BRAS2, add CPU 0 in slot <span>1</span> as an HA dual-device inter-chassis backup member, and set the local VRRP outbound interface to GE <span>0/1/1</span> and the peer IP address to 10.1.1.1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>location slot <span>1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Configure a VRRP group on BRAS1 and BRAS2.</span><p><p># On BRAS1, enter the view of GE <span>0/1/1</span>, create VRRP group 1, and set the virtual IP address of the VRRP group to 10.1.1.3. Configure the VRRP group as an mVRRP group, and set BRAS1's priority in the VRRP group to 200, the VRRP preemption delay to 1500s, and the VRRP recovery delay to 15s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 priority 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 preempt-mode timer delay 1500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># On BRAS2, enter the view of GE <span>0/1/1</span>, create VRRP group 1, and set the virtual IP address of the VRRP group to 10.1.1.3. Configure the VRRP group as an mVRRP group, set BRAS2's priority in the VRRP group to 150, and set the VRRP recovery delay to 15s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 virtual-ip 10.1.1.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>admin-vrrp vrid 1 ignore-if-down</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp recover-delay 15</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</p></li><li><span>Associate HA with VRRP on the direct-connect interfaces on the master and backup devices.</span><p><p># On BRAS1, enter the view of GE <span>0/1/1</span>, and associate service-location group 1 with VRRP group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># On BRAS2, enter the view of GE <span>0/1/1</span>, and associate service-location group 1 with VRRP group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>vrrp vrid 1 track service-location 1 reduced 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Run the <a href="cmdqueryname=display+vrrp+1"><b><span class="cmdname">display vrrp 1</span></b></a> command on BRAS1 and BRAS2 to view the master/backup VRRP status, which reflects the master/backup status of the service-location group. <strong>State</strong> in the command output indicates the BRAS status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display vrrp 1</strong>
GigabitEthernet <span>0/1/1</span> | Virtual Router 1                                                                                      
    State                    : Master  
    Virtual IP               : 10.1.1.3  
    Master IP                : 10.1.1.1
    Local IP                 : 10.1.1.1
    PriorityRun              : 200   
    PriorityConfig           : 200     
    MasterPriority           : 200     
    Preempt                  : YES   Delay Time      : 400 s    
    Hold Multiplier          : 3                                                                    
    TimerRun                 : 1 s    
    TimerConfig              : 1 s    
    Auth Type                : NONE     
    Virtual MAC              : 00e0-fc12-3456  
    Check TTL                : YES      
    Config Type              : admin-vrrp  
    Backup-forward           : disabled   
    Fast-resume              : disabled     
    Track Service-location   : 1   Priority Reduced : 60                                                      
    Service-location State   : UP                                                                            
    Create Time              : 2011-10-18 11:14:48 UTC+10:59   
    Last Change Time         : 2011-10-18 14:02:46 UTC+10:59</pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><strong>Master</strong> in the command output indicates that BRAS1 is the master device.</p>
</div></div>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>display vrrp 1</strong>
GigabitEthernet<span>0/1/1</span> | Virtual Router 1                                                                                       
    State                   : Backup  
    Virtual IP              : 10.1.1.3                                                               
    Master IP               : 10.1.1.1 
    Local IP                : 10.1.1.2
    PriorityRun             : 150      
    PriorityConfig          : 150   
    MasterPriority          : 200     
    Preempt                 : YES    Delay Time              : 0 s  
    Hold Multiplier         : 3                                                                   
    TimerRun                : 1 s       
    TimerConfig             : 1 s   
    Auth Type               : NONE     
    Virtual MAC             : 00e0-fc12-3456   
    Check TTL               : YES         
    Config Type             : admin-vrrp       
    Backup-forward          : disabled     
    Fast-resume             : disabled
    Track Service-location  : 1   Priority Reduced : 60                                                           
    Service-location State : UP     
    Create Time            : 2011-10-18 11:26:40 UTC+08:00   
    Last Change Time       : 2011-10-18 14:02:22 UTC+08:00</pre>
</p></li><li><span>Bind the service-location group to the VRRP group on BRAS1 and BRAS2.</span><p><p># Bind service-location group 1 to VRRP group 1 on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-location-1] <strong>quit</strong></pre>
<p># Bind service-location group 1 to VRRP group 1 on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Create a service-instance group on BRAS1 and BRAS2 and bind them to the service-location group.</span><p><p># Create a service-instance group named <strong>group1</strong> on BRAS1 and bind it to service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-instance-group-group1] <strong>quit</strong></pre>
<p># Create a service-instance group named <strong>group1</strong> on BRAS2 and bind it to service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-instance-group-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-service-instance-group-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-service-instance-group-group1] <strong>quit</strong></pre>
<p># Run the <a href="cmdqueryname=display+service-location+1"><b><span class="cmdname">display service-location 1</span></b></a> command on BRAS1 and BRAS2 to view HA information. <strong>Vrrp state</strong> in the command output indicates the status of the service-location group, which must be consistent with the BRAS's VRRP status. <strong>Batch-backup state</strong> in the command output indicates whether batch backup is completed.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display service-location 1</strong>
 service-location 1                                                                                                                
 Backup scene type: inter-box                                                                                                       
 Location slot ID: <span>1</span>                                                                                                    
 Remote-backup interface: GigabitEthernet<span>0/1/1</span>                                                                                      
 Peer: 10.1.1.2                                                                                                                   
 Vrrp ID: 1                                                                                                                       
 Vrrp bind interface: GigabitEthernet<span>0/1/1</span>                                                                                          
 Vrrp state: master                                                                                                                 
 Bound service-instance-group number: 1                                                                                             
 Batch-backup state: finished
</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>display service-location 1</strong>
 service-location 1                                                                                                                
 Backup scene type: inter-box                                                                                                       
 Location slot ID: <span>1</span>                                                                                                    
 Remote-backup interface: GigabitEthernet<span>0/1/1</span>                                                                                      
 Peer: 10.1.1.1                                                                                                                   
 Vrrp ID: 1                                                                                                                       
 Vrrp bind interface: GigabitEthernet<span>0/1/1</span>                                                                                          
 Vrrp state: slave                                                                                                                 
 Bound service-instance-group number: 1                                                                                             
 Batch-backup state: NA
</pre>
</p></li><li><span>Create a NAT instance on BRAS1 and BRAS2 and bind it to the service-instance group and NAT address pool.</span><p><p># Create a NAT instance named <strong>nat</strong> on BRAS1, bind it to the service-instance group named <strong>group1</strong>, and configure the IP addresses in the NAT address pool to range from 11.11.11.100 to 11.11.11.105.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>nat outbound any address-group address-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-nat-instance-nat] <strong>quit</strong></pre>
<p># Create a NAT instance named <strong>nat</strong> on BRAS2, bind it to the service-instance group named <strong>group1</strong>, and configure the IP addresses in the NAT address pool to range from 11.11.11.100 to 11.11.11.105.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>nat instance nat id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-nat-instance-nat] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-nat-instance-nat] <strong>nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-nat-instance-nat] <strong>nat outbound any address-group address-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-nat-instance-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-nat-instance-nat] <strong>quit</strong></pre>
<p># Run the <a href="cmdqueryname=display+nat+instance+nat"><b><span class="cmdname">display nat instance nat</span></b></a> command on BRAS1 and BRAS2 to view NAT configurations.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display nat instance nat</strong></pre>
<pre class="screen">nat instance nat id 1                                                                                                               
 service-instance-group group1                                                                                                        
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105                                                                     
 nat outbound any address-group address-group1 </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>display nat instance nat</strong></pre>
<pre class="screen">nat instance nat id 1                                                                                                               
 service-instance-group group1                                                                                                        
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105                                                                     
 nat outbound any address-group address-group1 </pre>
</p></li><li><span>Configure PPPoE user access on BRAS1 and BRAS2 and bind the user group to the NAT instance.</span><p><p>For details about how to configure a user group and IP address pool in a domain, see <a href="dc_ne_pppoe_cfg_0004.html">Configuring PPPoE Access</a> in <em>User Access-PPPoE Access Configuration</em>.</p>
<div class="p"># On BRAS1, configure user information (user group named <strong>natbras</strong>, IP address pool named <strong>natbras</strong>, user domain named <strong>natbras</strong>, and AAA) and bind the user group to the NAT instance named <strong>nat</strong>.<ol type="a"><li><p>Configure VT 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Virtual-Template1] <strong>ppp authentication-mode chap</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-Virtual-Template1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Virtual-Template1] <strong>quit</strong></pre>
</li><li><p>Configure the authentication scheme named <strong>auth1</strong> and the accounting scheme named <strong>acct1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth1] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-authen-auth1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa] <strong>accounting-scheme acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1] <strong>accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-accounting-acct1] <strong>quit</strong></pre>
</li><li><p>Configure a RADIUS server group named <strong>rd1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server authentication 192.168.7.249 1645</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>radius-server accounting 192.168.7.249 1646</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1] <strong>radius-server type plus11</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1] <strong>radius-server shared-key-cipher YsHsjx_202206 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1] <strong>quit</strong></pre>
</li><li><p>Configure an address pool named <strong>natbras</strong> for users to go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ip pool natbras bas local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-natbras] <strong>gateway 192.168.0.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ip-pool-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-natbras] <strong>section 0 192.168.0.2 192.168.0.254</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-natbras] <strong>quit</strong></pre>
</li><li><p>Configure a user group named <strong>natbras</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>user-group natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li><p>Configure a user domain named <strong>natbras</strong> and bind it to the NAT instance named <strong>nat</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>domain natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>accounting-scheme acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>radius-server group rd1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-aaa-domain-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-natbras] <strong>ip-pool natbras</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-natbras] <strong>user-group natbras bind nat instance nat</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-natbras] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa] <strong>quit</strong></pre>
</li><li><p>Configure a VLAN for the user-side sub-interface GE <span>0/1/2</span>.10, specify a VT interface for the sub-interface, and configure the BAS interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/2</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>user-vlan 2010</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-user-vlan-2010] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>pppoe-server bind virtual-template 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>access-type layer2-subscriber</strong><strong> default-domain authentication natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>authentication-method ppp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10-bas] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>quit</strong></pre>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to that of BRAS1. For configuration details, see <a href="#EN-US_TASK_0172362495__config_02">BRAS2 configuration file</a> in this section.</p>
</div></div>
</div>
</p></li><li><span>Configure a NAT conversion policy on BRAS1 and BRAS2.</span><p><p># Configure a traffic classification rule, NAT behavior, and a NAT traffic policy on BRAS1. Then apply the NAT traffic policy.</p>
<ol type="a"><li><p>Configure an ACL numbered 6001 and an ACL rule numbered 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ucl-6001] <strong>rule 1 permit ip source user-group natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ucl-6001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ucl-6001] <strong>quit</strong></pre>
</li><li><p>Configure a traffic classifier.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic classifier c1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-c1] <strong>if-match acl 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-classifier-c1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-classifier-c1] <strong>quit</strong></pre>
</li><li><p>Configure a traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior b1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-b1] <strong>nat bind instance nat</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-behavior-b1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-behavior-b1] <strong>quit</strong></pre>
</li><li><p>Define a NAT traffic policy to associate the traffic classifier with the traffic behavior.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-trafficpolicy-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-trafficpolicy-p1] <strong>quit</strong></pre>
</li><li><p>Apply the NAT traffic diversion policy in the system view.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic-policy p1 inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to that of BRAS1. For configuration details, see <a href="#EN-US_TASK_0172362495__config_02">BRAS2 configuration file</a> in this section.</p>
</div></div>
</p></li><li><span>Configure the route of the NAT address pool as a static blackhole route and advertise it to a routing protocol. Set the ID of an OSPF process to 1. OSPF is used as an IGP to advertise routes.</span><p><p># Configure BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ip route-static 11.11.11.0 27 null 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1] <strong>import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to that of BRAS1. For configuration details, see <a href="#EN-US_TASK_0172362495__config_02">BRAS2 configuration file</a> in this section.</p>
</div></div>
</p></li><li><span>On each of the master and backup devices, configure a user-side VRRP group (between BRAS1/BRAS2 and SWITCH) and enable it to track the service-location group. If the service-location group is not tracked, a CGN board failure cannot trigger a master/backup BRAS switchover. As a result, new distributed NAT users cannot go online.</span><p><p># On BRAS1, enter the view of GE <span>0/1/2</span>.2, create VRRP group 2, and set the virtual IP address of the VRRP group to 192.168.2.200. Configure the VRRP group as an mVRRP group, set BRAS1's priority in the VRRP group to 150 and the VRRP preemption delay to 1500s, and associate the VRRP group with service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vlan-type dot1q 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>ip address 192.168.2.10 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 virtual-ip 192.168.2.200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>admin-vrrp vrid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 preempt-mode timer delay 1500</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 track service-location 1 reduced 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
<p># On BRAS2, enter the view of GE <span>0/1/2</span>.2, create VRRP group 2, and set the virtual IP address of the VRRP group to 192.168.2.200. Configure the VRRP group as an mVRRP group, set BRAS1's priority in the VRRP group to 120, and associate the VRRP group with service-location group 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vlan-type dot1q 2002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>ip address 192.168.2.100 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 virtual-ip 192.168.2.200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>admin-vrrp vrid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 priority 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 track service-location 1 reduced 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
</p></li><li><span>Establish a BFD session named <strong>bfd</strong> on BRAS1 and BRAS2 to quickly detect interface or link exceptions and trigger a master/backup VRRP switchover.</span><p><p># Configure a BFD session on BRAS1 and associate a VRRP group with the BFD session.</p>
<ol type="a"><li><p>Establish a BFD session named <strong>bfd</strong> at the access side to rapidly detect interface or link faults and trigger a master/backup VRRP switchover. The IP address of GE <span>0/1/2</span>.2 on BRAS2 is 192.168.2.100.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>bfd bfd bind peer-ip 192.168.2.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-bfd-session-bfd] <strong>discriminator local 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-bfd-session-bfd] <strong>discriminator remote 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-bfd-session-bfd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-bfd-session-bfd] <strong>quit</strong></pre>
</li><li><p>On GE <span>0/1/2</span>.2, associate the VRRP group with the BFD session.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 track bfd-session 100 peer</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
</li></ol>
<p># Configure a BFD session on BRAS2 and associate a VRRP group with the BFD session.</p>
<ol type="a"><li><p>Establish a BFD session named <strong>bfd</strong> at the access side to rapidly detect interface or link faults and trigger a master/backup VRRP switchover. The IP address of GE <span>0/1/2</span>.2 on BRAS2 is 192.168.2.100.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2] <strong>bfd bfd bind peer-ip 192.168.2.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-bfd-session-bfd] <strong>discriminator local 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-bfd-session-bfd] <strong>discriminator remote 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-bfd-session-bfd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-bfd-session-bfd] <strong>quit</strong></pre>
</li><li><p>On GE <span>0/1/2</span>.2, associate the VRRP group with the BFD session.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>vrrp vrid 2 track bfd-session 200 peer</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-GigabitEthernet<span>0/1/2</span>.2] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Configure RUI backup on BRAS1 and BRAS2 and back up BRAS information in shared address pool mode.</span><ol type="a"><li class="substepexpand"><span>Configure an RBS on BRAS1 and BRAS2.</span><p><p># Configure an RBS named <strong>natbras</strong> on BRAS1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>peer 10.1.1.2 source 10.1.1.1 port 7000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>protect redirect ip-nexthop 10.1.1.2 interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>ip-pool natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-srv-natbras] <strong>quit</strong></pre>
<p># Configure an RBS named <strong>natbras</strong> on BRAS2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2] <strong>remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-srv-natbras] <strong>peer 10.1.1.1 source 10.1.1.2 port 7000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-srv-natbras] <strong>protect redirect ip-nexthop 10.1.1.1 interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-srv-natbras] <strong>ip-pool natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-srv-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-srv-natbras] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a remote backup profile (RBP) on each of BRAS1 and BRAS2.</span><p><p># Configure an RBS named <strong>natbras</strong> on BRAS1 and enable BRAS user backup.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>remote-backup-profile natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>service-type bras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>backup-id 10 remote-backup-service natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>peer-backup hot</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>vrrp-id 2 interface GigabitEthernet<span>0/1/2</span>.2</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to that of BRAS1. For configuration details, see <a href="#EN-US_TASK_0172362495__config_02">BRAS2 configuration file</a> in this section.</p>
</div></div>
</p></li><li class="substepexpand"><span>On BRAS1 and BRAS2, configure NAS parameters and the traffic backup interval in the RBS view.</span><p><p># On BRAS1, configure the logical IP address of NAS as 1.2.3.4, the logical interface as GE <span>0/1/2</span>, logical hostname as <strong>huawei</strong>, and the user traffic backup interval as 10 minutes.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>nas logic-ip 1.2.3.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>nas logic-port GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>nas logic-sysname huawei</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>traffic backup interval 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-rm-backup-prf-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-rm-backup-prf-natbras] <strong>quit</strong></pre>
<p># On BRAS2, configure the logical IP address of NAS as 1.2.3.4, the logical interface as GE <span>0/1/2</span>, logical host name as <strong>huawei</strong>, and the user traffic backup interval as 10 minutes.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>nas logic-ip 1.2.3.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>nas logic-port GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>nas logic-sysname huawei</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>traffic backup interval 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS2-rm-backup-prf-natbras] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS2-rm-backup-prf-natbras] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure the user-side sub-interface on BRAS1 and BRAS2 and bind the sub-interface to an RBP.</span><p><p># On BRAS1, configure GE <span>0/1/2</span>.10 as the user-side sub-interface and bind the sub-interface to the RBP named <strong>natbras</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface GigabitEthernet<span>0/1/2</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>remote-backup-profile natbras</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-GigabitEthernet<span>0/1/2</span>.10] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure routes to be advertised by OSPF.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>peer-backup route-cost auto-advertising</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>default cost 10 tag 100 type 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1] <strong>import-route unr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>BRAS1-ospf-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ospf-1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration of BRAS2 is similar to that of BRAS1. For configuration details, see <a href="#EN-US_TASK_0172362495__config_02">BRAS2 configuration file</a> in this section.</p>
</div></div>
</p></li></ol>
</li><li><span>Check the configuration result of BRAS user information backup.</span><p><p># After successfully configuring the RBP, run the <strong>display remote-backup-profile</strong> command. The RBS type is <strong>bras</strong>. The RBP named <strong>natbras</strong> is bound to GE <span>0/1/2</span>.10 from which users attempt to get online. BRAS1 is in the <strong>Master</strong> state, and the TCP connection is in the <strong>Connected</strong> state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display remote-backup-profile natbras</strong>
-----------------------------------------------
 Profile-Index        : 0x802
 Profile-Name         : natbras
 <strong>Service              : bras</strong>
 Remote-backup-service: natbras
 Backup-ID            : 10
 track protocol       : VRRP
 VRRP-ID              : 1
 VRRP-Interface       : GigabitEthernet<span>0/1/2</span>.2
 <strong>State           	 : Master</strong>
 <strong>Peer-state      	 : Slave</strong>
 Backup mode          : hot
 Slot-Number          : <span>1</span>
 Card-Number          : 0
 Port-Number          : 0
 Nas logic-port       : Gigabitethernet <span>0/1/2</span>
 Nas logic-ip         : 1.2.3.4
 Nas logic-sysname    : huawei
 Traffic interval     : 10(minutes)</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display remote-backup-service natbras</strong>
----------------------------------------------------------
 Service-Index    : 0
 Service-Name     : natbras
 <strong>TCP-State        : Connected</strong>
 Peer-ip          : 10.1.1.2
 Source-ip        : 10.1.1.1
 TCP-Port         : 7000
 Track-BFD        : --
 Track-interface0 : GigabitEthernet<span>0/1/1</span>
 Track-interface1 : --
 Last up time     : 2016-06-02 16:15:8 
 Last down time   : 2016-06-02 16:3:36 
 Last down reason : TCP closed for packet error. 
--------------------------------------------------------</pre>
<p># After the user goes online, check user backup information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display backup-user</strong></pre>
<pre class="screen">  Remote-backup-service: natbras
  Total Users Number: 10
------------------------------------------------------------------------
 100     101     102     103     104     105     106     107     108     109
------------------------------------------------------------------------</pre>
<p># Display information about the online user on the specified interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>display access-user interface GigabitEthernet <span>0/1/2</span>.10</strong></pre>
<pre class="screen">------------------------------------------------------------------------------
  UserID  Username                Interface      IP address       MAC          IPv6 address
  ------------------------------------------------------------------------------
  --------------------------------------------------------------------------
  100      user@lsh                GE<span>0/1/2</span>.10      192.168.0.10         00e0-fc12-0101          -
  101      user@lsh                GE<span>0/1/2</span>.10      192.168.0.9          00e0-fc12-0102          -
  102      user@lsh                GE<span>0/1/2</span>.10      192.168.0.8          00e0-fc12-0103          -
  103      user@lsh                GE<span>0/1/2</span>.10      192.168.0.7          00e0-fc12-0104          -
  104      user@lsh                GE<span>0/1/2</span>.10      192.168.0.6          00e0-fc12-0105          -
  105      user@lsh                GE<span>0/1/2</span>.10      192.168.0.5          00e0-fc12-0106          -
  106      user@lsh                GE<span>0/1/2</span>.10      192.168.0.4          00e0-fc12-0107          -
  107      user@lsh                GE<span>0/1/2</span>.10      192.168.0.3          00e0-fc12-0108          -
  108      user@lsh                GE<span>0/1/2</span>.10      192.168.0.2          00e0-fc12-0109          -
  109      user@lsh                GE<span>0/1/2</span>.10      192.168.0.11         00e0-fc12-0110          -
  --------------------------------------------------------------------------
  Total users                        : 10</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362495__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>BRAS1 configuration file</p>
<pre class="screen">#
sysname BRAS1
#
vsm on-board-mode disable
#
ip route-static 11.11.11.0 27 null 0
#
peer-backup route-cost auto-advertising
#
ospf 1
 import-route static
 default cost 10 tag 100 type 2
 import-route unr
#
bfd
#
bfd bfd bind peer-ip 192.168.2.100
 discriminator local 100
 discriminator remote 200
#
license
 active nat session-table size 6 slot <span>1</span> 
<strong> </strong>active nat bandwidth-enhance 40 slot <span>1</span>
#
radius-server group rd1
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646
 radius-server shared-key %^%#x*CgITP4C<font style="font-size:8pt" Face="Courier New" >~</font>;q,*+DEW'JBWe#)"Q&amp;|7bX]b:Y&lt;{w'%^%#
 radius-server type plus11
#
interface Virtual-Template1
 ppp authentication-mode chap
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span>
 remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.2
#
service-instance-group group1
 service-location 1
#
nat instance nat id 1
 service-instance-group group1
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105
 nat outbound any address-group address-group1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 200
 vrrp vrid 1 preempt-mode timer delay 1500
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15
#
user-group natbras
#
acl number 6001
 rule 1 permit ip source user-group natbras
#
traffic classifier c1 operator or
 if-match acl 6001 precedence 1
#
traffic behavior b1
 nat bind instance nat
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
traffic-policy p1 inbound
#
ip pool natbras bas local
 gateway 192.168.0.1 255.255.255.0
 section 0 192.168.0.2 192.168.0.254
#
aaa
 #
  authentication-scheme auth1
    authentication-mode radius
 #
  accounting-scheme acct1
    accounting-mode radius
 #
 domain natbras
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  ip-pool natbras
  user-group natbras bind nat instance nat
#
remote-backup-service natbras
 peer 10.1.1.2 source 10.1.1.1 port 7000
 protect redirect ip-nexthop 10.1.1.2 interface gigabitethernet<span>0/1/1</span>
 ip-pool natbras
#
remote-backup-profile natbras
 service-type bras
 backup-id 10 remote-backup-service natbras
 peer-backup hot
 vrrp-id 2 interface GigabitEthernet<span>0/1/2</span>.2
 nas logic-ip 1.2.3.4
 nas logic-port GigabitEthernet<span>0/1/2</span>
 nas logic-sysname huawei
 traffic backup interval 10
#
interface GigabitEthernet<span>0/1/2</span>.10
 user-vlan 2010
 pppoe-server bind virtual-template 1
 remote-backup-profile natbras
 bas
  access-type layer2-subscriber default-domain authentication natbras
  authentication-method ppp
#
interface GigabitEthernet<span>0/1/2</span>.2
 vrrp vrid 2 track bfd-session 200 peer
 vlan-type dot1q 2002
 ip address 192.168.2.10 255.255.255.0
 vrrp vrid 2 virtual-ip 192.168.2.200
 admin-vrrp vrid 2
 vrrp vrid 2 priority 150
 vrrp vrid 2 preempt-mode timer delay 1500
 vrrp vrid 2 track service-location 1 reduced 50
 vrrp vrid 2 track bfd-session 100 peer
#
interface loopback0
 ip address 10.10.10.100 255.255.255.255
#
return
</pre>
</li><li><p>BRAS2 configuration file</p>
<a name="EN-US_TASK_0172362495__config_02"></a><a name="config_02"></a><pre class="screen" id="EN-US_TASK_0172362495__config_02">#
sysname BRAS2
#
vsm on-board-mode disable
#
ip route-static 11.11.11.0 27 null 0
#
peer-backup route-cost auto-advertising
#
ospf 1
 import-route static
 default cost 10 tag 100 type 2
 import-route unr
#
bfd
#
bfd bfd bind peer-ip 192.168.2.10
 discriminator local 200
 discriminator remote 100
#
license
 active nat session-table size 6 slot <span>1</span> 
<strong> </strong>active nat bandwidth-enhance 40 slot <span>1</span>
#
radius-server group rd1
 radius-server authentication 192.168.7.249 1645 weight 0
 radius-server accounting 192.168.7.249 1646
 radius-server shared-key YsHsjx_202206
 radius-server type plus11
#
interface Virtual-Template1
 ppp authentication-mode chap
#
service-ha hot-backup enable
#
service-location 1
 location slot <span>1</span> 
 vrrp vrid 1 interface GigabitEthernet <span>0/1/1</span>
 remote-backup interface GigabitEthernet <span>0/1/1</span> peer 10.1.1.1
#
service-instance-group group1
 service-location 1
#
nat instance nat id 1
 service-instance-group group1
 nat address-group address-group1 group-id 1 11.11.11.100 11.11.11.105
 nat outbound any address-group address-group1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 vrrp vrid 1 virtual-ip 10.1.1.3
 admin-vrrp vrid 1 ignore-if-down
 vrrp vrid 1 priority 150
 vrrp vrid 1 track service-location 1 reduced 60
 vrrp recover-delay 15
#
user-group natbras
#
acl number 6001
 rule 1 permit ip source user-group natbras
#
traffic classifier c1 operator or
 if-match acl 6001 precedence 1
#
traffic behavior b1
 nat bind instance nat
#
traffic policy p1
 share-mode
 classifier c1 behavior b1 precedence 1
#
traffic-policy p1 inbound
#
ip pool natbras bas local
 gateway 192.168.0.1 255.255.255.0
 section 0 192.168.0.2 192.168.0.254
#
aaa
 #
  authentication-scheme auth1
    authentication-mode radius
 #
  accounting-scheme acct1
    accounting-mode radius
 #
 domain natbras
  authentication-scheme auth1
  accounting-scheme acct1
  radius-server group rd1
  ip-pool natbras
  user-group natbras bind nat instance nat
#
remote-backup-service natbras
 peer 10.1.1.1 source 10.1.1.2 port 7000
 protect redirect ip-nexthop 10.1.1.1 interface gigabitethernet<span>0/1/1</span>
 ip-pool natbras
#
remote-backup-profile natbras
 service-type bras
 backup-id 10 remote-backup-service natbras
 peer-backup hot
 vrrp-id 2 interface GigabitEthernet<span>0/1/2</span>.2
 nas logic-ip 1.2.3.4
 nas logic-port GigabitEthernet<span>0/1/2</span>
 nas logic-sysname huawei
 traffic backup interval 10
#
interface GigabitEthernet<span>0/1/2</span>.10
 user-vlan 2010
 pppoe-server bind virtual-template 1
 remote-backup-profile natbras
 bas
  access-type layer2-subscriber default-domain authentication natbras
  authentication-method ppp
#
interface GigabitEthernet<span>0/1/2</span>.2
 vrrp vrid 2 track bfd-session 200 peer
 vlan-type dot1q 2002
 ip address 192.168.2.100 255.255.255.0
 vrrp vrid 2 virtual-ip 192.168.2.200
 admin-vrrp vrid 2
 vrrp vrid 2 priority 120
 vrrp vrid 2 track service-location 1
#
interface loopback0
 ip address 10.10.10.99 255.255.255.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0043.html">Inter-Chassis Hot Backup
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0036.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_cgn-reliability_cfg_0038.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>