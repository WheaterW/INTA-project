
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring NAT64 (Prefix-based Traffic Diversion)">
<meta name="abstract" content="This section provides an example for configuring NAT64 to implement multiple-to-multiple translation from internal IPv6 addresses of enterprise users to external IPv4 addresses and allow only PCs on a specified network segment to access the IPv4 Internet.">
<meta name="description" content="This section provides an example for configuring NAT64 to implement multiple-to-multiple translation from internal IPv6 addresses of enterprise users to external IPv4 addresses and allow only PCs on a specified network segment to access the IPv4 Internet.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat64_cfg_0041.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat64_cfg_0042.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat64_cfg_0061.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="c00549182">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="NAT64">
<meta name="featuretype" content="NAT and IPv6 Transition">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="NAT64">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT64">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="featurename" content="NAT64">
<meta name="featuretype" content="NAT and IPv6 Transition">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001457501349">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring NAT64 (Prefix-based Traffic Diversion)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001457501349"></a><a name="EN-US_TASK_0000001457501349"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring NAT64 (Prefix-based Traffic Diversion)</h1>
<div class="taskbody"><p>This section provides an example for configuring NAT64 to implement multiple-to-multiple translation from internal IPv6 addresses of enterprise users to external IPv4 addresses and allow only PCs on a specified network segment to access the IPv4 Internet.</p>
<div class="context"><a name="EN-US_TASK_0000001457501349__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001457501349__fig_dc_ne_cfg_nat64_004201">Figure 1</a>, DeviceA connects to a CR attached to a NAT64 device.  An IPv6 user is assigned an IPv6 address from the CPE through DeviceA. When the IPv6 user needs to access the IPv4 Internet over the IPv6 network, the NAT64 device translates the user's IPv6 address to an external IPv4 address.</p>
<div class="fignone" id="EN-US_TASK_0000001457501349__fig_dc_ne_cfg_nat64_004201"><a name="EN-US_TASK_0000001457501349__fig_dc_ne_cfg_nat64_004201"></a><a name="fig_dc_ne_cfg_nat64_004201"></a><span class="figcap"><b>Figure 1 </b>NAT64 networking diagram</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface1 in this example represents GE<span>0/2/1</span>.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001457421001.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001457501349__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure basic NAT64 functions.</li><li>Configure a NAT64 IPv6 prefix to divert traffic to a NAT64 instance.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001457501349__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><ul><li>Slot ID and CPU ID of the service board</li><li>ID of a service-location group</li><li>NAT64 instance name and ID</li><li>NAT64 address pool number and start and end IP addresses</li><li>NAT64 IPv6 prefix (64:FF9B::/96)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001457501349__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure the NAT64 license function on a service board.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> vsm on-board-mode disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-license] <strong>active nat64 vsuf slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-license] <strong>active nat session-table size 16 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-license] <strong>active nat bandwidth-enhance 40 slot <span>1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-license] <strong>quit</strong></pre>
</p></li><li><span>Configure a service-location group and bind the CPU of the service board to it.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-location-1]<strong> location</strong><strong> slot <span><span>1</span></span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-service-location-1] <strong>quit</strong></pre>
</p></li><li><span>Create a service-instance group and bind it to the service-location group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>service-instance-group instance-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-instance-group-instance-group1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-instance-group-instance-group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-instance-group-instance-group1] <strong>quit</strong></pre>
</p></li><li><span>Configure a NAT64 instance and bind it to the service-instance group so that the NAT64 instance is bound to the CPU of the service board.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>nat64 instance nat1 id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat64-instance-nat1] <strong>service-instance-group instance-group1</strong></pre>
</p></li><li><span>Configure a NAT64 public address pool ranging from 11.11.11.100 to 11.11.11.105.</span><p><pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat64-instance-nat1] <strong>nat64 address-group address-group1 group-id 1 11.11.11.100 11.11.11.105</strong></pre>
</p></li><li><span>Configure the NAT64 IPv6 prefix 64:FF9B::/96 to divert traffic to the NAT64 instance. The prefix must be the same as the DNS64 server prefix.</span><p><pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat64-instance-nat1] <strong>nat64 prefix 64:FF9B:: prefix-length 96 1</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>This IPv6 prefix is set according to a standard. The prefix of the DNS64 server must be the same as the IPv6 prefix.</p>
</div></div>
</p></li><li><span>Configure a NAT64 conversion policy so that the addresses of the packets that are diverted by an interface board to the service board are converted using the addresses in the NAT64 address pool.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>nat64 instance nat1 id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat64-instance-nat1] <strong>nat64 outbound any address-group address-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat64-instance-nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-nat64-instance-nat1] <strong>quit</strong></pre>
</p></li><li><span>Configure a static route to forward return traffic.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> ipv6 route-static 2001:DB8::1:1112 126 2001:DB8::1:110F</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Verify NAT64 user information.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display nat user-information slot <span>3</span> verbose</strong></pre>
<pre class="screen">This operation will take a few minutes. Press 'Ctrl+C' to break ...
  Slot: <span>3</span>
Total number:  1.
  ---------------------------------------------------------------------------
  User Type                             :  NAT64
  IPv6Address                           :  2001:db8::1:1112
  User ID                               :  -
  VPN Instance                          :  -
  Address Group                         :  address-group1
  NAT64   Instance                      :  nat1
  Public IP                             :  11.11.11.100
  NoPAT Public IP                       :  0.0.0.0
  Start Port                            :  1024
 <strong> </strong>Port Range                            :  0
  Port Total                            :  64
  MTU                                   :  1500
  Extend Port Alloc Times               :  1
  Extend Port Alloc Number              :  128
  First/Second/Third Extend Port Start  :  0/0/0
  Total/TCP/UDP/ICMP Session Limit      :  0/0/0/0
  Total/TCP/UDP/ICMP Session Current    :  1/0/1/0
  Total/TCP/UDP/ICMP Rev Session Limit  :  0/0/0/0
  Total/TCP/UDP/ICMP Rev Session Current:  0/0/0/0
  Nat ALG Enable                        :  ALL
  Token/TB/TP                           :  0/0/0
  Port Forwarding Flag                  :  Non Port Forwarding
  Port Forwarding Ports                 :  0 0 0 0 0
  Aging Time(s)                         :  0
  Left Time(s)                          :  0
  Port Limit Discard Count              :  0
  Session Limit Discard Count           :  0
  Fib Miss Discard Count                :  0
  --&gt;Transmit Packets                   :  3597637
  --&gt;Transmit Bytes                     :  784284866
  --&gt;Drop Packets                       :  0
  &lt;--Transmit Packets                   :  0
  &lt;--Transmit Bytes                     :  0
  &lt;--Drop Packets                       :  0
  ---------------------------------------------------------------------------
</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001457501349__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><pre class="screen">#
sysname <span class="keyword">HUAWEI</span>
#
#
vsm on-board-mode disable
license
 active nat session-table size 16 slot <span>1</span>
 active nat bandwidth-enhance 40 slot <span>1</span>
 active nat64 vsuf slot <span>1</span>
#
service-location 1
 location<span> slot <span><span>3</span></span></span>
#
service-instance-group instance-group1
 service-location 1
#
nat64 instance nat1 id 1
 service-instance-group instance-group1
 nat64 address-group address-group1 group-id 1 11.11.11.100 11.11.11.105
 nat64 prefix 64:FF9B:: prefix-length 96 1
#
interface GigabitEthernet<span>0/2/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8::1:110e 126
#
ipv6 route-static 2001:DB8::1:1112 126 2001:DB8::1:110F
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat64_cfg_0041.html">Configuration Examples for NAT64
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat64_cfg_0042.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_nat64_cfg_0061.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>