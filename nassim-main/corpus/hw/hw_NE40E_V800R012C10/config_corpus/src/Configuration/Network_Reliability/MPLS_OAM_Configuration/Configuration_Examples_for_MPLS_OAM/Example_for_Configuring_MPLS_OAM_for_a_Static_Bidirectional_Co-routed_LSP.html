
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MPLS OAM for a Static Bidirectional Co-routed LSP">
<meta name="abstract" content="This section provides an example for configuring MPLS OAM to check the connectivity of a static bidirectional co-routed LSP.">
<meta name="description" content="This section provides an example for configuring MPLS OAM to check the connectivity of a static bidirectional co-routed LSP.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,mpls-oam-vrp,jwx1168690,w00556928,w00437000,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="q00824768">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362370">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring MPLS OAM for a Static Bidirectional Co-routed LSP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362370"></a><a name="EN-US_TASK_0172362370"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MPLS OAM for a Static Bidirectional Co-routed LSP</h1>
<div class="taskbody"><p>This section provides an example for configuring MPLS OAM to check the connectivity of a static bidirectional co-routed LSP.</p>
<div class="context"><a name="EN-US_TASK_0172362370__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Static bidirectional co-routed LSPs are widely used on transport networks but their OAM capabilities are insufficient to support network management required for public telecom networks. MPLS OAM can be used to detect faults on a static bidirectional co-routed LSP.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172362370__fig_dc_vrp_mplsoam_cfg_001801">Figure 1</a>, establish a static bidirectional co-routed LSP between LSRA and LSRC to carry OAM packets so that any intermediate node can send back a response packet along the original path.</p>
<div class="fignone" id="EN-US_TASK_0172362370__fig_dc_vrp_mplsoam_cfg_001801"><a name="EN-US_TASK_0172362370__fig_dc_vrp_mplsoam_cfg_001801"></a><a name="fig_dc_vrp_mplsoam_cfg_001801"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for a tunnel protection group consisting of static bidirectional co-routed CR-LSPs</span><br><span><img src="figure/en-us_image_0000001675925732.png"></span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example are GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="10.66893310668933%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="53.664633536646335%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="35.666433356664335%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="10.66893310668933%" headers="mcps1.4.1.4.2.4.1.1 "><p>LSRA</p>
</td>
<td class="cellrowborder" valign="top" width="53.664633536646335%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="35.666433356664335%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="10.66893310668933%" headers="mcps1.4.1.4.2.4.1.1 "><p>LSRB</p>
</td>
<td class="cellrowborder" valign="top" width="53.664633536646335%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="35.666433356664335%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="10.66893310668933%" headers="mcps1.4.1.4.2.4.1.1 "><p>LSRC</p>
</td>
<td class="cellrowborder" valign="top" width="53.664633536646335%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="35.666433356664335%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362370__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish a static bidirectional co-routed LSP between LSRA and LSRC.</p>
</li><li><p>Enable MPLS OAM globally.</p>
</li><li><p>Configure MPLS OAM parameters in MPLS-OAM view on the nodes at both ends of the static bidirectional co-routed LSP.</p>
</li><li><p>(Optional) Enable MPLS OAM on the nodes at both ends of the static bidirectional co-routed LSP.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362370__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Tunnel interface numbers, tunnel interface IP addresses, destination addresses, and tunnel IDs on LSRA and LSRC</p>
</li><li><p>Next-hop address and outgoing label on the ingress of the static bidirectional co-routed LSP</p>
</li><li><p>Inbound interface name, next-hop address, and outgoing label on the transit node</p>
</li><li><p>Inbound interface on the egress</p>
</li><li><p>OAM detection packet type and interval at which OAM detection packets are sent</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362370__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a static bidirectional co-routed LSP.</span><p><p>Configure a static bidirectional co-routed LSP between LSRA and LSRB. The configuration details are not provided here. For details, see <a href="dc_vrp_te-p2p_cfg_0168.html">Example for Configuring a Static Bidirectional Co-routed CR-LSP</a> in <em><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span></em> Configuration Guide - MPLS or Configuration Files in this section.</p>
</p></li><li><span>Enable MPLS OAM globally.</span><p><div class="p"># Enable MPLS OAM globally on LSRA.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls]<strong> quit</strong></pre>
</div>
<div class="p"># Enable MPLS OAM globally on LSRC.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-mpls]<strong> mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls]<strong> quit</strong></pre>
</div>
</p></li><li><span>Configure MPLS OAM parameters in the MPLS-OAM view on the nodes at both ends of the static bidirectional co-routed LSP.</span><p><p># Configure MPLS OAM parameters on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls-oam]<strong> mpls oam bidirectional-tunnel Tunnel10 type ffd frequency 10 auto-protocol</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls-oam]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls-oam]<strong> quit</strong></pre>
<p># Configure MPLS OAM parameters for the egress on LSRC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC]<strong> mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls-oam]<strong> mpls oam bidirectional-tunnel Tunnel20 type ffd frequency 10 auto-protocol</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-mpls-oam]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls-oam]<strong> quit</strong></pre>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <strong><span>auto-protocol</span></strong> is not configured, go to Step 4. Otherwise, skip Step 4 and go to the next step.</p>
</div></div>
</p></li><li><span>(Optional) Enable MPLS OAM on the nodes at both ends of the static bidirectional co-routed LSP.</span><p><p># Enable LSRA to send OAM detection packets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls-oam]<strong> mpls oam bidirectional-tunnel enable send Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls-oam]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls-oam]<strong> quit</strong></pre>
<p># Enable LSRC to receive OAM detection packets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC]<strong> mpls-oam</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls-oam]<strong> mpls oam bidirectional-tunnel enable receive Tunnel20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-mpls-oam]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls-oam]<strong> quit</strong></pre>
</p></li><li><span>Verify the configurations.</span><p><p>After completing the configuration, run the <strong>display mpls oam bidirectional-tunnel</strong> command on LSRA to view MPLS OAM information of the static bidirectional co-routed LSP.</p>
<p># Check the configuration results on LSRA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display mpls oam bidirectional-tunnel all verbose</strong>
--------------------------------------------------------------------------------
Total OAM Num:                    1
Total Start OAM Num:              0
Total Defect OAM Num:             0
Total Unavailable OAM Num:        0
--------------------------------------------------------------------------------
Verbose information about NO.1 OAM
--------------------------------------------------------------------------------
Bidirectional Tunnel basic information:
-------------------------------------------------
Tunnel-name             : Tunnel10
Lsp signal status       : Up 
Lsp establish type      : Static-cr-lsp 
Lsp ingress lsr-id      : 10.1.1.1 
Lsp tnl-id              : 100 
Lsp incoming Label      : 20 
-------------------------------------------------
OAM basic information:
-------------------------------------------------
OAM Index               : 4
OAM Select Board        : 3
OAM Enable Direction    : Send &amp; Receive
Auto Protocol           : Enable 
Auto Overtime (s)       : 300 
Compatibility Mode      : Router Mode 
-------------------------------------------------
OAM detect information:
-------------------------------------------------
Send Type               : FFD
Send Frequency          : 10 ms 
Receive Type            : CV 
Receive Frequency       : 1 s 
Detect State            : Start 
Defect State            : Non-defect 
BDI Defect State        : -- 
Bdi-frequency           : Detect frequency 
Available State         : Available 
Unavailable Time (s)    : 0 
Hardware Error Info     : No error
Packet-priority         : 7</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362370__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#
sysname LSRA
#
mpls lsr-id 10.1.1.1
#
mpls
 mpls te
 mpls oam
#
bidirectional static-cr-lsp ingress Tunnel10
 forward nexthop 10.1.2.2 out-label 20
 backward in-label 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 mpls
 mpls te
#
interface LoopBack1
 ip address 10.1.1.1 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 10.1.1.3
 mpls te signal-protocol cr-static
 mpls te tunnel-id 100
 mpls te bidirectional
#
ip route-static 10.1.1.2 255.255.255.255 10.1.2.2
ip route-static 10.1.1.3 255.255.255.255 10.1.2.2
#
mpls-oam
 mpls oam bidirectional-tunnel Tunnel10 type ffd frequency 10 auto-protocol 
# 
return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#
sysname LSRB
#
mpls lsr-id 10.1.1.2
#
mpls
 mpls te
 mpls oam
#
bidirectional static-cr-lsp transit lsp1
 forward in-label 20 nexthop 10.1.3.2 out-label 40
 backward in-label 16 nexthop 10.1.2.1 out-label 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 mpls
 mpls te
#
interface LoopBack1
 ip address 10.1.1.2 255.255.255.255
#
ip route-static 10.1.1.1 255.255.255.255 10.1.2.1
ip route-static 10.1.1.3 255.255.255.255 10.1.3.2
#
return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#
sysname LSRC
#
mpls lsr-id 10.1.1.3
#
mpls
 mpls te
 mpls oam
#
bidirectional static-cr-lsp egress lsp1
 forward in-label 40 lsrid 10.1.1.1 tunnel-id 100
 backward nexthop 10.1.3.1 out-label 16
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 mpls
 mpls te
#
interface LoopBack1
 ip address 10.1.1.3 255.255.255.255
#
interface Tunnel20
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 10.1.1.1
 mpls te signal-protocol cr-static
 mpls te tunnel-id 200
 mpls te passive-tunnel
 mpls te binding bidirectional static-cr-lsp egress lsp1
#               
ip route-static 10.1.1.1 255.255.255.255 10.1.3.1
ip route-static 10.1.1.2 255.255.255.255 10.1.3.1
#
mpls-oam
 mpls oam bidirectional-tunnel Tunnel20 type ffd frequency 10 auto-protocol
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0016.html">Configuration Examples for MPLS OAM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0019.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>