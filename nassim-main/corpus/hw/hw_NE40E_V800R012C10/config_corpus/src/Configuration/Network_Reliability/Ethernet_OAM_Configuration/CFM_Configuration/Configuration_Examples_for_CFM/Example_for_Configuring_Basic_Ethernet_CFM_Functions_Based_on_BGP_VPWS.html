
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Basic Ethernet CFM Functions Based on BGP VPWS">
<meta name="abstract" content="Configure a BGP VLL on two PEs, and configure CFM on the two PEs' access interfaces. The BGP VLL can use CFM to monitor VC connectivity.">
<meta name="description" content="Configure a BGP VLL on two PEs, and configure CFM on the two PEs' access interfaces. The BGP VLL can use CFM to monitor VC connectivity.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000021.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000032.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,c00376497,z00603461,w00800033,jwx1168690,w00556928,w00437000,eoam-vrp,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172361988">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Basic Ethernet CFM Functions Based on BGP VPWS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172361988"></a><a name="EN-US_TASK_0172361988"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Basic Ethernet CFM Functions Based on BGP VPWS</h1>
<div class="taskbody"><p>Configure a BGP VLL on two PEs, and configure CFM on the two PEs' access interfaces. The BGP VLL can use CFM to monitor VC connectivity.</p>
<div class="context"><a name="EN-US_TASK_0172361988__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172361988__fig_dc_vrp_vpws_cfg_606101">Figure 1</a>, CE1 and CE2 connect to different PEs. A remote BGP VPWS connection needs to be established between PE1 and PE2 for the two CEs to communicate. Configure a BGP VLL on PE1 and PE2. The VLL is up. Configure CFM on the access interfaces of PE1 and PE2. The remote MEP is up. If the VC in the VLL fails, the remote MEP goes down.</p>
<div class="fignone" id="EN-US_TASK_0172361988__fig_dc_vrp_vpws_cfg_606101"><a name="EN-US_TASK_0172361988__fig_dc_vrp_vpws_cfg_606101"></a><a name="fig_dc_vrp_vpws_cfg_606101"></a><span class="figcap"><b>Figure 1 </b>Configuring a remote BGP VPWS connection</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li><p>In this example, interface1 and interface2 represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpws_cfg_606101.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361988__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a routing protocol on the PEs and P of the backbone network to ensure IP connectivity and configure basic MPLS functions and LDP.</p>
</li><li><p>Configure PEs to exchange VPWS information as BGP peers.</p>
</li><li><p>Enable MPLS L2VPN on PEs and create a remote BGP VPWS connection from CE1 and CE2.</p>
</li><li><p>Associate an MA with a VPWS on PE1 and PE2.</p>
</li><li><p>Establish a remote BGP VPWS connection between PE1 and PE2.</p>
</li><li><p>Configure CFM on PE1 and PE2.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361988__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>BGP AS number</p>
</li><li><p>MPLS L2VPN instance name on PEs</p>
</li><li><p>MPLS L2VPN instance RD and VPN targets on PEs</p>
</li><li><p>CE names and IDs on PEs</p>
</li><li><p>MA and MD names on PE1 and PE2</p>
</li><li><p>L2VPN names on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172361988__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.10.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.9 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[*PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.10.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure an IGP. In this example, OSPF is used.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 192.168.10.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 192.168.10.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure basic MPLS functions and establish LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure PEs to exchange VPWS information as BGP peers.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 3.3.3.9 signaling vpws</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 1.1.1.9 signaling vpws</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure remote BGP VPWS connections.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls l2vpn vpn1 encapsulation ethernet</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-l2vpn-vpn1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-l2vpn-vpn1] <strong>vpn-target 200:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-l2vpn-vpn1] <strong>ce ce1 id 1 range 10</strong> <strong>default-offset 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-l2vpn-vpn1-ce-ce1] <strong>connection ce-offset 2 interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-l2vpn-vpn1-ce-ce1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls l2vpn vpn1 encapsulation ethernet</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-l2vpn-vpn1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-l2vpn-vpn1] <strong>vpn-target 200:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-l2vpn-vpn1] <strong>ce ce2 id 2 range 10</strong> <strong>default-offset 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-l2vpn-vpn1-ce-ce2] <strong>connection ce-offset 1 interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-l2vpn-vpn1-ce-ce2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-l2vpn-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure Ethernet CFM on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>cfm md md1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>ccm-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>map mpls l2vpn vpn1 ce 1 ce-offset 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>mep mep-id 1 interface gigabitethernet <span>0/1/0</span> inward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>remote-mep mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>mep ccm-send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>cfm md md1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma1] <strong>ccm-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma1] <strong>map mpls l2vpn vpn1 ce 2 ce-offset 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma1] <strong>mep mep-id 2 interface gigabitethernet <span>0/1/0</span> inward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma1] <strong>remote-mep mep-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma1] <strong>mep ccm-send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma1] <strong>remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+cfm+remote-mep"><b><span class="cmdname">display cfm remote-mep</span></b></a> command on PE1 to check that the remote MEP is up.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong>display cfm remote-mep</strong>                                             
The total number of RMEPs is : 1
The status of RMEPs : 1 up, 0 down, 0 disable
--------------------------------------------------
 MD Name            : md1
 Level              : 0
 MA Name            : ma1
 RMEP ID            : 2
 VLAN ID            : --
 VSI Name           : --
 L2VC ID            : --
<span> L2VPN Name         : vpn1  CE ID              : 1  CE Offset          : 1</span>
<span>  L2TPV3 Tunnel Name            : --</span>
<span> L2TPV3 Local Connection Name  : --</span>
 MAC                : 00e0-fc12-7890
 CCM Receive        : enabled
 Trigger-If-Down    : enabled
 CFM Status         : up
 Alarm Status       : none
 Interface TLV      : --
 Port Status TLV    : --</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172361988__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
<strong> </strong>ip address 10.1.1.1 24
 undo shutdown
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
<strong> </strong>ip address 10.1.1.2 24
 undo shutdown
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls l2vpn
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.1.1 255.255.255.0
 mpls           
 mpls ldp       
#               
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#               
mpls l2vpn vpn1 encapsulation ethernet
 route-distinguisher 100:1
 vpn-target 200:1 import-extcommunity
 vpn-target 200:1 export-extcommunity
 ce ce1 id 1 range 10 default-offset 0
  connection ce-offset 2 interface GigabitEthernet<span>0/1/0</span>
#               
bgp 100         
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #              
 l2vpn-ad-family
  policy vpn-target
  peer 3.3.3.9 enable
  peer 3.3.3.9 signaling vpws
#               
ospf 1          
 area 0.0.0.0   
  network 1.1.1.9 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
cfm enable
 cfm md md1
 ma ma1
 map mpls l2vpn vpn1 ce 1 ce-offset 2
 ccm-interval 100
 mep mep-id 1 interface GigabitEthernet<span>0/1/0</span> inward 
 mep ccm-send mep-id 1 enable
 remote-mep mep-id 2
 remote-mep ccm-receive mep-id 2 enable
#
return </pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
 ip address 192.168.1.2 255.255.255.0
 mpls           
 mpls ldp       
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.10.1 255.255.255.0
 mpls           
 mpls ldp       
#               
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#               
ospf 1          
 area 0.0.0.0   
  network 2.2.2.9 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.10.0 0.0.0.255
#               
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls l2vpn
#
mpls ldp
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown  
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 192.168.10.2 255.255.255.0
 mpls           
 mpls ldp       
#               
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#               
mpls l2vpn vpn1 encapsulation ethernet
 route-distinguisher 100:1
 vpn-target 200:1 import-extcommunity
 vpn-target 200:1 export-extcommunity
 ce ce2 id 2 range 10 default-offset 0
  connection ce-offset 1 interface GigabitEthernet<span>0/1/0</span>
#               
bgp 100         
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
 #              
 l2vpn-ad-family
  policy vpn-target
  peer 1.1.1.9 enable
  peer 1.1.1.9 signaling vpws
#               
ospf 1          
 area 0.0.0.0   
  network 3.3.3.9 0.0.0.0
  network 192.168.10.0 0.0.0.255
#
cfm enable
 cfm md md1
 ma ma1
 map mpls l2vpn vpn1 ce 2 ce-offset 1
 ccm-interval 100
 mep mep-id 2 interface GigabitEthernet<span>0/1/0</span> inward 
 mep ccm-send mep-id 2 enable
 remote-mep mep-id 1
 remote-mep ccm-receive mep-id 1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000021.html">Configuration Examples for CFM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000032.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>