
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Associating MAC-Layer SD Alarms with E-PW APS">
<meta name="abstract" content="In E-PW APS scenarios, MPLS-TP OAM is used to monitor the status of a static single-segment (SS) PW. An E-Trunk is configured to determine the master/backup PE status. This section provides an example for associating MAC-layer SD alarms with E-PW APS.">
<meta name="description" content="In E-PW APS scenarios, MPLS-TP OAM is used to monitor the status of a static single-segment (SS) PW. An E-Trunk is configured to determine the master/backup PE status. This section provides an example for associating MAC-layer SD alarms with E-PW APS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_ngmvpn_0002.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128,q00824768,z00545680">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Bit-Error-Triggered Protection Switching">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="z00545680">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362314">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Associating MAC-Layer SD Alarms with E-PW APS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362314"></a><a name="EN-US_TASK_0172362314"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Associating MAC-Layer SD Alarms with E-PW APS</h1>
<div class="taskbody"><p>In E-PW APS scenarios, MPLS-TP OAM is used to monitor the status of a static single-segment (SS) PW. An E-Trunk is configured to determine the master/backup PE status. This section provides an example for associating MAC-layer SD alarms with E-PW APS.</p>
<div class="context"><a name="EN-US_TASK_0172362314__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the public network shown in <a href="#EN-US_TASK_0172362314__fig_dc_ne_cfg_error-code_000501">Figure 1</a>, three PEs belong to the same IGP domain, and static bidirectional co-routed LSPs must be deployed. In addition, CE1 and CE2 need to reliably communicate through the three PEs on the public network.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, and interface1.1 represent <span>GE</span> <span>0/1/0</span>, GE <span>0/1/1</span>, GE <span>0/1/2</span>, and GE <span>0/1/0</span>.1, respectively.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172362314__fig_dc_ne_cfg_error-code_000501"><a name="EN-US_TASK_0172362314__fig_dc_ne_cfg_error-code_000501"></a><a name="fig_dc_ne_cfg_error-code_000501"></a><span class="figcap"><b>Figure 1 </b>Associating MAC-layer SD alarms with E-PW APS</span><br><span><img class="vsd" src="images/fig_dc_ne_cfg_error-code_000501.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362314__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each interface and configure a routing protocol.</p>
</li><li><p>Configure MPLS and public network tunnels.</p>
<p>In this example, a static bidirectional co-routed LSP is established between PE1 and PE2, between PE1 and PE3, and between PE2 and PE3. The required configurations include:</p>
<ul><li><p>Configure basic MPLS functions and enable MPLS TE.</p>
</li><li><p>Configure an MPLS TE tunnel interface.</p>
</li><li><p>Configure the ingress and egress for each static bidirectional co-routed LSP.</p>
</li><li><p>Bind tunnel interfaces on PE2 and PE3 to static bidirectional co-routed LSPs.</p>
</li></ul>
</li><li><p>Configure AC dual-homing protection, which requires the following:</p>
<ul><li>Configure an Eth-Trunk on PE2, PE3, and CE2.</li><li>Configure an E-Trunk on PE2 and PE3 to determine the master/backup status.</li></ul>
</li><li><p>Configure PWs in a PW APS/E-PW APS group. This example uses static PWs and requires the following:</p>
<ul><li><p>Configure a primary PW between PE1 and PE2.</p>
</li><li><p>Configure a secondary PW between PE1 and PE3.</p>
</li><li><p>Configure a bypass PW between PE2 and PE3.</p>
</li></ul>
</li><li><p>Configure PW APS/E-PW APS, which requires the following:</p>
<ul><li><p>Configure a common PW APS instance on PE1.</p>
</li><li><p>Configure an E-PW APS instance on PE2 and PE3.</p>
</li><li><p>Bind PWs to the PW APS/E-PW APS instances.</p>
</li></ul>
</li><li><p>Configure MPLS-TP OAM to monitor the PW status, which requires the following:</p>
<ul><li><p>Create ME instances and bind them to PWs.</p>
</li><li><p>Enable CC and CV functions for PWs.</p>
</li></ul>
</li><li><p>Configure MPLS-TP OAM to monitor the LSP status, which requires the following:</p>
<ul><li><p>Create an ME instance and bind it to TE tunnels.</p>
</li><li><p>Enable CC and CV functions for PWs.</p>
</li></ul>
</li><li><p>Enable the MAC-layer SD alarm function, configure alarm generation and clearing thresholds, and associate bit error alarms with E-PW APS. These require the following:</p>
<ul><li>Enable the AIS function globally on PE1, PE2, and PE3.</li><li>Enable the MAC-layer SD alarm function on PE1, PE2, and PE3, configure alarm generation and clearing thresholds, and associate bit error alarms with E-PW APS.</li></ul>
</li></ol>
<h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>PEs' interface numbers and IP addresses, and OSPF process numbers</p>
</li><li><p>PEs' LSR IDs, tunnel interface numbers and IP addresses, incoming and outgoing tunnel labels, next hop address or outbound interface name on the ingress of each static bidirectional co-routed LSP, and inbound interface name on the egress of each static bidirectional co-routed LSP</p>
</li><li><p>L2VC destination IP addresses, VC IDs, VC types, and transmit/receive labels of static PWs</p>
</li><li><p>APS instance number on PE1, and roles, local numbers, and remote numbers of the E-PW APS instances on PE2 (backup) and PE3 (master)</p>
</li><li><p>MPLS-TP OAM MEG name, and local and remote MEG IDs</p>
</li><li><p>Eth-Trunk number, and E-Trunk LACP system ID and priority</p>
</li><li><p>MAC-layer SD alarm generation and clearing thresholds</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362314__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface and configure a routing protocol.</span><p><p>Configure an IP address and mask for each interface based on <a href="#EN-US_TASK_0172362314__fig_dc_ne_cfg_error-code_000501">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0172362314__example1261734848214025">Configuration Files</a> in this section.</p>
<p>In this example, OSPF is used as an IGP for PE1, PE2, and PE3 to communicate at the network layer. For configuration details, see <a href="#EN-US_TASK_0172362314__example1261734848214025">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure MPLS and public network tunnels.</span><p><p>In this example, a static bidirectional co-routed LSP is established between PE1 and PE2, between PE1 and PE3, and between PE2 and PE3.</p>
</p><ol type="a"><li class="substepexpand"><span>Configure basic MPLS functions and enable MPLS TE.</span><p><p>Enable MPLS and MPLS TE both globally and on specific interfaces of nodes along the MPLS TE tunnel.</p>
<p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p>Repeat this step for PE2 and PE3. For configuration details, see <a href="#EN-US_TASK_0172362314__example1261734848214025">Configuration Files</a> in this section. </p>
</p></li><li class="substepexpand"><span>Configure an MPLS TE tunnel interface.</span><p><p># Configure an MPLS TE tunnel from PE1 to both PE2 and PE3.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure an MPLS TE tunnel from PE2 to both PE1 and PE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>mpls te tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>quit</strong></pre>
<p># Configure an MPLS TE tunnel from PE3 to both PE1 and PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>destination 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>ip address unnumbered interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>mpls te tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure the ingress and egress for each static bidirectional co-routed LSP.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>A static bidirectional co-routed LSP on an ingress can go up only when the LSP name is the same as the tunnel interface name on the ingress. Note that the first letter of the tunnel interface name must be uppercase. This restriction does not apply to transit nodes or the egress.</p>
</div></div>
<p># Configure PE1 as the ingress for the static bidirectional co-routed LSP from PE1 to PE2 and from PE1 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bidirectional static-cr-lsp ingress Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel10] <strong>forward nexthop 10.1.2.2 out-label 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel10] <strong>backward in-label 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bidirectional static-cr-lsp ingress Tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel20] <strong>forward nexthop 10.1.3.2 out-label 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel20] <strong>backward in-label 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bi-static-ingress-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2 as the egress of the static bidirectional co-routed LSP from PE2 to PE1 and as the ingress of the static bidirectional co-routed LSP from PE2 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bidirectional static-cr-lsp egress tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel10] <strong>forward in-label 20 lsrid 1.1.1.1 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel10] <strong>backward nexthop 10.1.2.1 out-label 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bidirectional static-cr-lsp ingress Tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel30] <strong>forward nexthop 10.1.4.2 out-label 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel30] <strong>backward in-label 70</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bi-static-ingress-Tunnel30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3 as the egress for the static bidirectional co-routed LSP from PE1 to PE3 and from PE2 to PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bidirectional static-cr-lsp egress tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-ingress-Tunnel20] <strong>forward in-label 40 lsrid 1.1.1.1 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-ingress-Tunnel20] <strong>backward nexthop 10.1.3.1 out-label 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-ingress-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bidirectional static-cr-lsp egress tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-ingress-Tunnel30] <strong>forward in-label 60 lsrid 2.2.2.2 tunnel-id 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-ingress-Tunnel30] <strong>backward nexthop 10.1.4.1 out-label 70</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bi-static-ingress-Tunnel30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
</p></li><li class="substepexpand"><span>Bind tunnel interfaces on PE2 and PE3 to static bidirectional co-routed LSPs.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te binding bidirectional static-cr-lsp egress tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>mpls te binding bidirectional static-cr-lsp egress tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>mpls te binding bidirectional static-cr-lsp egress tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
<p>Run the <strong>display mpls te bidirectional static-cr-lsp</strong> command on each PE to check information about the static bidirectional co-routed LSPs.</p>
<p># Check the configuration results on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls te bidirectional static-cr-lsp</strong></pre>
<pre class="screen">TOTAL          : 2     STATIC CRLSP(S)
UP             : 2     STATIC CRLSP(S)
DOWN           : 0     STATIC CRLSP(S)
Name                FEC                I/O Label    I/O If                Status
tunnel 10           2.2.2.2/32         NULL/20      -/GE<span>0/1/1</span>
                                       30/NULL      GE<span>0/1/1</span>/-             <strong>Up</strong>
tunnel 20           3.3.3.3/32         NULL/40      -/GE<span>0/1/2</span>
                                       50/NULL      GE<span>0/1/2</span>/-             <strong>Up</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display mpls te bidirectional static-cr-lsp</strong></pre>
<pre class="screen">TOTAL          : 2     STATIC CRLSP(S)
UP             : 2     STATIC CRLSP(S)
DOWN           : 0     STATIC CRLSP(S)
Name                FEC                I/O Label    I/O If                Status
tunnel 10           -/32               20/NULL      GE<span>0/1/0</span>/-
                                       NULL/30      -/GE<span>0/1/0</span>             <strong>Up</strong>
tunnel 30           3.3.3.3/32         NULL/60      -/GE<span>0/1/1</span>
                                       70/NULL      GE<span>0/1/1</span>/-             <strong>Up</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display mpls te bidirectional static-cr-lsp</strong></pre>
<pre class="screen">TOTAL          : 2     STATIC CRLSP(S)
UP             : 2     STATIC CRLSP(S)
DOWN           : 0     STATIC CRLSP(S)
Name                FEC                I/O Label    I/O If                Status
tunnel 20           -/32               40/NULL      GE<span>0/1/0</span>/-
                                       NULL/50      -/GE<span>0/1/0</span>             <strong>Up</strong>
tunnel 30           -/32               60/NULL      GE<span>0/1/1</span>/-
                                       NULL/300     -/GE<span>0/1/1</span>             <strong>Up</strong></pre>
</p></li></ol>
</li><li><span>Configure AC dual-homing protection.</span><ol type="a"><li class="substepexpand"><span>Configure an Eth-Trunk.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/0</span> to <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an E-Trunk.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>lacp e-trunk system-id 00e0-fc12-7890</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>lacp e-trunk priority 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-10] <strong>priority 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-10] <strong>peer-address 3.3.3.3 source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>lacp e-trunk system-id 00e0-fc12-7890</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>lacp e-trunk priority 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-e-trunk-10] <strong>priority 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-e-trunk-10] <strong>peer-address 2.2.2.2 source-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-e-trunk-10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>e-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure a PW protection group.</span><p><p>This example uses static PWs.</p>
</p><ol type="a"><li class="substepexpand"><span>Configure VPN tunnel binding.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1] <strong>tunnel binding destination 2.2.2.2 te tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.3 te tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.3 te tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-Tunnel20] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel30] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.1 te tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-policy1] <strong>tunnel binding destination 2.2.2.2 te tunnel 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure static PWs.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When configuring a static PW, you must specify the VC ID. If you do not specify the VC ID, the PW cannot be bound to a PW APS instance.</p>
</div></div>
<p># Configure the primary and secondary PWs on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 2.2.2.2 1 transmit-vpn-label 100 receive-vpn-label 200 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls static-l2vc destination 3.3.3.3 2 transmit-vpn-label 300 receive-vpn-label 400 tunnel-policy policy1 control-word secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the primary and bypass PWs on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>mpls static-l2vc destination 1.1.1.1 1 transmit-vpn-label 200 receive-vpn-label 100 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>mpls static-l2vc destination 3.3.3.3 3 transmit-vpn-label 500 receive-vpn-label 600 tunnel-policy policy1 control-word bypass</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure the secondary and bypass PWs on PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>mpls static-l2vc destination 1.1.1.1 2 transmit-vpn-label 400 receive-vpn-label 300 tunnel-policy policy1 control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>mpls static-l2vc destination 2.2.2.2 3 transmit-vpn-label 600 receive-vpn-label 500 tunnel-policy policy1 control-word bypass</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure E-PW APS.</span><ol type="a"><li class="substepexpand"><span>Configure PW APS instances.</span><p><p>Configure a common PW APS instance on PE1. Configure an E-PW APS instance on PE2 and PE3.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pw-aps 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-aps-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pw-aps 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-aps-2] <strong>role slave</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-aps-2] <strong>remote-aps 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-aps-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>pw-aps 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-aps-3] <strong>role master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-aps-3] <strong>remote-aps 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-aps-3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Bind the PW protection group to PW APS instances.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn pw-aps 1 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>mpls l2vpn pw-aps 2 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface eth-trunk 10.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>mpls l2vpn pw-aps 3 admin</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>Run the <strong>display mpls l2vpn pw-aps verbose</strong> command on each PE. The command output shows information about PW APS instances and their associated PWs. The following example uses the command output on PE1 and PE2.</p>
<p># Check the configuration results on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen">                                                                                
 APS Information:                                                               
   Description            :                                                     
   Local Id               : 1                                                   
   Status                 : <strong>NR</strong>                                                  
   Far End Status         : NR                                                  
   Request Result         : Work                                                
   Wtr Interval(s)        : 300                                                 
   HoldOff Interval(ms)   : 0                                                   
   Operation Type         : Revertive                                           
   Role                   : --                                                  
   Remote Id              : --                                                  
   Alarm Info             : None                                                
   Total VPN Number       : 1                                                   
 ----------------------------------------                                       
 PW Information:                                                                
   Number                 : 1                                                   
   Client Interface       : GigabitEthernet<span>0/1/0</span>.1                              
   Bind Type              : <strong>admin</strong>                                               
  Primary PW:                                                                   
    VC ID                 : 1                                                   
    VC Type               : VLAN                                                
    Destination           : 2.2.2.2                                             
    VC State              : up                                                  
  Secondary PW:                                                                 
    VC ID                 : 2                                                   
    VC Type               : VLAN                                                
    Destination           : 3.3.3.3                                             
    VC State              : up     </pre>
<p># Check the configuration results on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen"> APS Information:
   Description            :
   Local Id               : 1
   Status                 : <strong>SF_P</strong>
   Far End Status         : NR
   Request Result         : Work
   Wtr Interval(s)        : 300
   HoldOff Interval(ms)   : 0
   Operation Type         : Revertive
   Role                   : <strong>Slave</strong>
   Remote Id              : 3
   Alarm Info             : None
   Total VPN Number       : 1
 ----------------------------------------
 PW Information:
   Number                 : 1
   Client Interface       : Eth-Trunk10.1
   Bind Type              : <strong>admin</strong>
  Primary PW:
    VC ID                 : 1
    VC Type               : VLAN
    Destination           : 1.1.1.1
    VC State              : up
  Secondary PW:
    VC ID                 : 3
    VC Type               : VLAN
    Destination           : 3.3.3.3
    VC State              : up  </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display mpls l2vpn pw-aps verbose</strong></pre>
<pre class="screen"> APS Information:
   Description            :
   Local Id               : 1
   Status                 : <strong>NR</strong>
   Far End Status         : NR
   Request Result         : Work
   Wtr Interval(s)        : 300
   HoldOff Interval(ms)   : 0
   Operation Type         : Revertive
   Role                   : <strong>Master</strong>
   Remote Id              : 2
   Alarm Info             : None
   Total VPN Number       : 1
 ----------------------------------------
 PW Information:
   Number                 : 1
   Client Interface       : Eth-Trunk10.1
   Bind Type              : <strong>admin</strong>
  Primary PW:
    VC ID                 : 2
    VC Type               : VLAN
    Destination           : 1.1.1.1
    VC State              : up
  Secondary PW:
    VC ID                 : 3
    VC Type               : VLAN
    Destination           : 2.2.2.2
    VC State              : up   </pre>
</p></li></ol>
</li><li><span>Configure MPLS-TP OAM to monitor the PW status.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>MPLS-TP OAM goes up only when the same MEG name is configured at both ends of a PW.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls-tp meg primary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-primary] <strong>me l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan mep-id 1 remote-mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-primary] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-primary] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-primary] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls-tp meg secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-secondary] <strong>me l2vc peer-ip 3.3.3.3 vc-id 2 vc-type vlan mep-id 3 remote-mep-id 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-secondary] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-secondary] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-secondary] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls-tp meg primary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-primary] <strong>me l2vc peer-ip 1.1.1.1 vc-id 1 vc-type vlan mep-id 2 remote-mep-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-primary] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-primary] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-primary] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls-tp meg secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-secondary] <strong>me l2vc peer-ip 1.1.1.1 vc-id 2 vc-type vlan mep-id 4 remote-mep-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-secondary] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-secondary] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-secondary] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>Check MPLS-TP OAM configurations on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls-tp oam meg</strong></pre>
<pre class="screen">--------------------------------------------------                                                                                  
MEG primary                                                                                                                             
--------------------------------------------------                                                                                  
MEG Name                      : primary                                                                                                 
MEG Level                     : 7                                                                                                   
ME Count                      : 1                                                                                                   
CC Send                       : enable                                                                                              
CC Receive                    : enable                                                                                              
CC Interval                   : 1000                                                                                                 
CC Exp                        : 7                                                                                                   
RDI                           : enable                                                                                              
AIS                           : disable                                                                                             
AIS Interval                  : 1000                                                                                                
AIS Exp                       : 7                                                                                                   
Lock                          : disable                                                                                             
Lock Interval                 : 1000                                                                                                
Lock Exp                      : 7                                                                                                   
CSF                           : disable                                                                                             
CSF Interval                  : 1000                                                                                                
CSF Exp                       : 7                                                                                                   
LM Single-end Receive         : disable                                                                                             
LM Single-end Proactive       : disable                                                                                             
LM Single-end SD1 Threshold   : 999999                                                                                              
LM Single-end SD2 Threshold   : 1000000                                                                                             
LM Ring SD1 Threshold         : 0                                                                                                   
LM Ring SD2 Threshold         : 0                                                                                                   
LM Dual-end                   : disable                                                                                             
LM Dual-end SD1 Threshold     : 1                                                                                                   
LM Dual-end SD2 Threshold     : 10                                                                                                  
LM Oam-packet SD1 Threshold   : 0                                                                                                   
LM Oam-packet SD2 Threshold   : 0                                                                                                   
                                                                                                                                    
[ME 1]                                                                                                                              
Index                         : 0                                                                                                  
Direction                     : dual                                                                                                
MEP ID                        : 1                                                                                                   
Remote MEP ID                 : 2                                                                                                   
Status Board                  : 1                                                                                                   
Service Type                  : vll-pw                                                                                              
Peer IP                       : 2.2.2.2                                                                                             
Remote Peer IP                : -                                                                                                   
VC ID                         : 1                                                                                               
VC Type                       : VLAN                                                                                                
TTL                           : 255                                                                                                 
State                         : UP                                                                                                  
Local State                   : Near-End Available                                                                                  
                                Far-End Available                                                                                   
Alarm Indicate                : no alarm                                                                                            
Hardware Resource             : -                                                                                                   
GAL                           : disable                                                                                             
Hardware Error Info           : None                                                                                                
-------------------------------------------------- 
                                                                                 
--------------------------------------------------                                                                                  
MEG secondary                                                                                                                            
--------------------------------------------------                                                                                  
MEG Name                      : secondary                                                                                                 
MEG Level                     : 7                                                                                                   
ME Count                      : 1                                                                                                   
CC Send                       : enable                                                                                              
CC Receive                    : enable                                                                                              
CC Interval                   : 1000                                                                                                 
CC Exp                        : 7                                                                                                   
RDI                           : enable                                                                                              
AIS                           : disable                                                                                             
AIS Interval                  : 1000                                                                                                
AIS Exp                       : 7                                                                                                   
Lock                          : disable                                                                                             
Lock Interval                 : 1000                                                                                                
Lock Exp                      : 7                                                                                                   
CSF                           : disable                                                                                             
CSF Interval                  : 1000                                                                                                
CSF Exp                       : 7                                                                                                   
LM Single-end Receive         : disable                                                                                             
LM Single-end Proactive       : disable                                                                                             
LM Single-end SD1 Threshold   : 999999                                                                                              
LM Single-end SD2 Threshold   : 1000000                                                                                             
LM Ring SD1 Threshold         : 0                                                                                                   
LM Ring SD2 Threshold         : 0                                                                                                   
LM Dual-end                   : disable                                                                                             
LM Dual-end SD1 Threshold     : 1                                                                                                   
LM Dual-end SD2 Threshold     : 10                                                                                                  
LM Oam-packet SD1 Threshold   : 0                                                                                                   
LM Oam-packet SD2 Threshold   : 0                                                                                                   
                                                                                                                                    
[ME 1]                                                                                                                              
Index                         : 1                                                                                                  
Direction                     : dual                                                                                                
MEP ID                        : 3                                                                                                   
Remote MEP ID                 : 4                                                                                                   
Status Board                  : 1                                                                                                   
Service Type                  : vll-pw                                                                                              
Peer IP                       : 3.3.3.3                                                                                             
Remote Peer IP                : -                                                                                                   
VC ID                         : 1                                                                                               
VC Type                       : VLAN                                                                                                
TTL                           : 255                                                                                                 
State                         : UP                                                                                                  
Local State                   : Near-End Available                                                                                  
                                Far-End Available                                                                                   
Alarm Indicate                : no alarm                                                                                            
Hardware Resource             : -                                                                                                   
GAL                           : disable                                                                                             
Hardware Error Info           : None                                                                                                
-------------------------------------------------- 

--------------------------------------------------                              
Total MEG number: 2                                                             
Total ME number : 2, 0 init, 2 up, 0 down</pre>
</p></li><li><span>Configure MPLS-TP OAM to monitor the LSP status.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>MPLS-TP OAM goes up only when the same MEG name is configured at both ends of an LSP.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls-tp meg 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-1] <strong>me te interface Tunnel <span>0/1/0</span> mep-id 1 remote-mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-1] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-1] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls-tp meg 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-2] <strong>me te interface Tunnel <span>0/1/1</span> mep-id 3 remote-mep-id 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-2] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-2] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-tp-meg-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls-tp meg 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-1] <strong>me te interface Tunnel <span>0/1/0</span> mep-id 2 remote-mep-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-1] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-1] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-tp-meg-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls-tp meg 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-2] <strong>me te interface Tunnel <span>0/1/1</span> mep-id 4 remote-mep-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-2] <strong>cc send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-2y] <strong>cc receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-tp-meg-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>Check MPLS-TP OAM configurations on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls-tp oam meg</strong></pre>
<pre class="screen">--------------------------------------------------                                                                                  
MEG 1                                                                                                                             
--------------------------------------------------                                                                                  
MEG Name                      : 1                                                                                                 
MEG Level                     : 7                                                                                                   
ME Count                      : 1                                                                                                   
CC Send                       : enable                                                                                              
CC Receive                    : enable                                                                                              
CC Interval                   : 1000                                                                                                 
CC Exp                        : 7                                                                                                   
RDI                           : enable                                                                                              
AIS                           : disable                                                                                             
AIS Interval                  : 1000                                                                                                
AIS Exp                       : 7                                                                                                   
Lock                          : disable                                                                                             
Lock Interval                 : 1000                                                                                                
Lock Exp                      : 7                                                                                                   
CSF                           : disable                                                                                             
CSF Interval                  : 1000                                                                                                
CSF Exp                       : 7                                                                                                   
LM Single-end Receive         : disable                                                                                             
LM Single-end Proactive       : disable                                                                                             
LM Single-end SD1 Threshold   : 999999                                                                                              
LM Single-end SD2 Threshold   : 1000000                                                                                             
LM Ring SD1 Threshold         : 0                                                                                                   
LM Ring SD2 Threshold         : 0                                                                                                   
LM Dual-end                   : disable                                                                                             
LM Dual-end SD1 Threshold     : 1                                                                                                   
LM Dual-end SD2 Threshold     : 10                                                                                                  
LM Oam-packet SD1 Threshold   : 0                                                                                                   
LM Oam-packet SD2 Threshold   : 0                                                                                                   
                                                                                                                                    
[ME 1]                                                                                                                              
Index                         : 0                                                                                                  
Direction                     : dual                                                                                                
MEP ID                        : 1                                                                                                  
Remote MEP ID                 : 2                                                                                                  
Status Board                  : 1                                                                                                   
Service Type                  : te (cr-static-lsp)                                                                                  
Tunnel-name                   : tunnel 10                                                                                         
LSP Name                      : -                                                                                                   
State                         : UP                                                                                                  
Local State                   : Near-End Available                                                                                  
                                Far-End Available                                                                                   
Alarm Indicate                : no alarm                                                                                            
Hardware Resource             : -                                                                                                   
GAL                           : 13                                                                                                  
Hardware Error Info           : None                                                                                                
--------------------------------------------------                                                                                  
--------------------------------------------------                                                                                  
MEG 2                                                                                                                             
--------------------------------------------------                                                                                  
MEG Name                      : 2                                                                                                 
MEG Level                     : 7                                                                                                   
ME Count                      : 1                                                                                                   
CC Send                       : enable                                                                                              
CC Receive                    : enable                                                                                              
CC Interval                   : 1000                                                                                                 
CC Exp                        : 7                                                                                                   
RDI                           : enable                                                                                              
AIS                           : disable                                                                                             
AIS Interval                  : 1000                                                                                                
AIS Exp                       : 7                                                                                                   
Lock                          : disable                                                                                             
Lock Interval                 : 1000                                                                                                
Lock Exp                      : 7                                                                                                   
CSF                           : disable                                                                                             
CSF Interval                  : 1000                                                                                                
CSF Exp                       : 7                                                                                                   
LM Single-end Receive         : disable                                                                                             
LM Single-end Proactive       : disable                                                                                             
LM Single-end SD1 Threshold   : 999999                                                                                              
LM Single-end SD2 Threshold   : 1000000                                                                                             
LM Ring SD1 Threshold         : 0                                                                                                   
LM Ring SD2 Threshold         : 0                                                                                                   
LM Dual-end                   : disable                                                                                             
LM Dual-end SD1 Threshold     : 1                                                                                                   
LM Dual-end SD2 Threshold     : 10                                                                                                  
LM Oam-packet SD1 Threshold   : 0                                                                                                   
LM Oam-packet SD2 Threshold   : 0                                                                                                   
                                                                                                                                    
[ME 1]                                                                                                                              
Index                         : 0                                                                                                  
Direction                     : dual                                                                                                
MEP ID                        : 3                                                                                                  
Remote MEP ID                 : 4                                                                                                  
Status Board                  : 1                                                                                                   
Service Type                  : te (cr-static-lsp)                                                                                  
Tunnel-name                   : tunnel 20
                                                                                         
LSP Name                      : -                                                                                                   
State                         : UP                                                                                                  
Local State                   : Near-End Available                                                                                  
                                Far-End Available                                                                                   
Alarm Indicate                : no alarm                                                                                            
Hardware Resource             : -                                                                                                   
GAL                           : 13                                                                                                  
Hardware Error Info           : None                                                                                                
--------------------------------------------------

--------------------------------------------------                              
Total MEG number: 2                                                             
Total ME number : 2, 0 init, 2 up, 0 down                                                                                                                                    
 

=============================================================</pre>
</p></li><li><span>Enable the MAC-layer SD alarm function, configure alarm generation and clearing thresholds, and associate bit error alarms with E-PW APS.</span><ol type="a"><li class="substepexpand"><span>Enable the AIS function globally on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls-tp ais enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls-tp ais enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls-tp ais enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Enable the MAC-layer SD alarm function, configure alarm generation and clearing thresholds, and associate bit error alarms with E-PW APS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>trap-threshold crc-error mac-fcs-sd alarm-threshold 1 5 resume-threshold 1 6 trigger-lsp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong>
</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>trap-threshold crc-error mac-fcs-sd alarm-threshold 1 5 resume-threshold 1 6 trigger-lsp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>trap-threshold crc-error mac-fcs-sd alarm-threshold 1 5 resume-threshold 1 6 trigger-lsp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Verify the configuration.</span><p><p># Run the <strong>display port-error-info</strong> command. The command output shows that <strong>alarm status</strong> is <strong>Yes</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display port-error-info interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">GigabitEthernet<span>0/1/1</span> port-error information
==============================================================================
 input-error                            | output-error
--------------------------------------------------------------------------------
 trap enable    : Yes                   | trap enable    : Yes
 trigger down   : No                    | trigger down   : No
 alarm status   : No                    | alarm status   : No
 threshold high : 1000                  | threshold high : 1000
 threshold low  : 100                   | threshold low  : 100
 interval       : 10    sec.            | interval       : 10    sec.
 stat(h)        : 0                     | stat(h)        : 0
 stat(l)        : 0                     | stat(l)        : 0
================================================================================
 crc-error                              | symbol-error
--------------------------------------------------------------------------------
 trap enable    : No                    | trap enable    : Yes
 trigger down   : No                    | trigger down   : No
 alarm status   : No                    | alarm status   : No
 threshold high : 3                     | threshold high : 1000
 threshold low  : 3                     | threshold low  : 100
 percent        : 0                     | N/A            : N/A
 interval       : 10    sec.            | interval       : 10    sec.
 stat(h)        : 0                     | stat(h)        : 0
 stat(l)        : 0                     | stat(l)        : 0
================================================================================
 mac-fcs-sd                             |  mac-fcs-exc
--------------------------------------------------------------------------------
 trap enable     : Yes                  | trap enable       : No
 trigger lsp     : No                   | trigger lsp      : No
 <strong>alarm status    : Yes</strong>                  | alarm status      : No
 alarm threshold : 1E-5                 | alarm threshold   : 0E-0
 resume threshold: 1E-6                 | resume threshold  : 0E-0
 current value   : 1E-2                 | current value     : 1E-2
 simulation      : Yes                  | simulation        : Yes</pre>
</p><p><p># Run the <strong>display mpls-tp oam meg</strong> command in the view of PE2's GE <span>0/1/0</span>. The command output shows that <strong>Alarm Indicate</strong> is <strong>CRC-AIS</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>display mpls-tp oam meg primary</strong></pre>
<pre class="screen">--------------------------------------------------                                                                                  
MEG primary                                                                                                                             
--------------------------------------------------                                                                                  
MEG Name                      : primary                                                                                                 
MEG Level                     : 7                                                                                                   
ME Count                      : 1                                                                                                   
CC Send                       : enable                                                                                              
CC Receive                    : enable                                                                                              
CC Interval                   : 1000                                                                                                 
CC Exp                        : 7                                                                                                   
RDI                           : enable                                                                                              
AIS                           : disable                                                                                             
AIS Interval                  : 1000                                                                                                
AIS Exp                       : 7                                                                                                   
Lock                          : disable                                                                                             
Lock Interval                 : 1000                                                                                                
Lock Exp                      : 7                                                                                                   
CSF                           : disable                                                                                             
CSF Interval                  : 1000                                                                                                
CSF Exp                       : 7                                                                                                   
LM Single-end Receive         : disable                                                                                             
LM Single-end Proactive       : disable                                                                                             
LM Single-end SD1 Threshold   : 999999                                                                                              
LM Single-end SD2 Threshold   : 1000000                                                                                             
LM Ring SD1 Threshold         : 0                                                                                                   
LM Ring SD2 Threshold         : 0                                                                                                   
LM Dual-end                   : disable                                                                                             
LM Dual-end SD1 Threshold     : 1                                                                                                   
LM Dual-end SD2 Threshold     : 10                                                                                                  
LM Oam-packet SD1 Threshold   : 0                                                                                                   
LM Oam-packet SD2 Threshold   : 0                                                                                                   
                                                                                                                                    
[ME 1]                                                                                                                              
Index                         : 0                                                                                                  
Direction                     : dual                                                                                                
MEP ID                        : 1                                                                                                   
Remote MEP ID                 : 2                                                                                                   
Status Board                  : 1                                                                                                   
Service Type                  : vll-pw                                                                                              
Peer IP                       : 2.2.2.2                                                                                             
Remote Peer IP                : -                                                                                                   
VC ID                         : 1                                                                                               
VC Type                       : VLAN                                                                                                
TTL                           : 255                                                                                                 
State                         : DOWN                                                                                                 
Local State                   : Near-End Available                                                                                  
                                Far-End Available                                                                                   
<strong>Alarm Indicate                : CRC-AIS</strong>                                                                                           
Hardware Resource             : -                                                                                                   
GAL                           : disable                                                                                             
Hardware Error Info           : None                                                                                                
-------------------------------------------------- 
                                                                                 
--------------------------------------------------                              
Total MEG number: 1                                                             
Total ME number : 1, 0 init, 0 up, 1 down</pre>
</p><p><p># Run the <strong>display mpls l2vpn pw-aps</strong> command in the view of PE1's GE <span>0/1/2</span>. The command output shows that <strong>Request Result</strong> is <strong>Protect</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>display mpls l2vpn pw-aps</strong></pre>
<pre class="screen"> Total APSNumber: 1                                                            
 Local Id    Remote Id    Status    <strong>Request Result</strong>    Role    Total VPN Number  
 ------------------------------------------------------------------------------ 
 1           --           SF        <strong>Protect </strong>             --      2                 
</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172362314__example1261734848214025"><a name="EN-US_TASK_0172362314__example1261734848214025"></a><a name="example1261734848214025"></a><a name="EN-US_TASK_0172362314__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#                                                                               
sysname CE1                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 10                                                             
 ip address 10.1.1.1 255.255.255.0                                              
#                                                                               
return                 </pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#                                                                               
sysname PE1                                                                     
#
mpls-tp ais enable                                                              
#
mpls lsr-id 1.1.1.1                                                             
mpls                                                                            
 mpls te                                                                        
#                                                                               
mpls l2vpn                                                                      
#                                                                               
pw-aps 1                                                                        
#                                                                               
bidirectional static-cr-lsp ingress tunnel 10                                 
 forward nexthop 10.1.2.2 out-label 20                      
 backward in-label 30                                                           
#                                                                               
bidirectional static-cr-lsp ingress tunnel 20                                 
 forward nexthop 10.1.3.2 out-label 40                      
 backward in-label 50                                                           
#                                                                               
interface GigabitEthernet<span>0/1/0</span>.1                                                
 vlan-type dot1q 10                                                             
 mpls static-l2vc destination 2.2.2.2 1 transmit-vpn-label 100 receive-vpn-label 200 tunnel-policy policy1 control-word    
 mpls static-l2vc destination 3.3.3.3 2 transmit-vpn-label 300 receive-vpn-label 400 tunnel-policy policy1 control-word secondary    
 mpls l2vpn pw-aps 1 admin                                                      
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.2.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                          
 trap-threshold crc-error mac-fcs-sd alarm-threshold 1 5 resume-threshold 1 6 trigger-lsp
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.3.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface LoopBack0                                                             
 ip address 1.1.1.1 255.255.255.255                                             
#                                                                               
interface tunnel 10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 2.2.2.2                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 100                                                          
 mpls te bidirectional                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
interface tunnel 20                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 3.3.3.3                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 200                                                          
 mpls te bidirectional                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 10.1.2.0 0.0.0.255                                                    
  network 1.1.1.1 0.0.0.0                                                       
  network 10.1.3.0 0.0.0.255                                                    
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 2.2.2.2 te tunnel 10                              
 tunnel binding destination 3.3.3.3 te tunnel 20                              
#                                                                               
mpls-tp meg primary                                                             
 me l2vc peer-ip 2.2.2.2 vc-id 1 vc-type vlan mep-id 1 remote-mep-id 2          
 cc send enable                                                                 
 cc receive enable                                                              
#                                                                               
mpls-tp meg secondary                                                           
 me l2vc peer-ip 3.3.3.3 vc-id 2 vc-type vlan mep-id 3 remote-mep-id 4          
 cc send enable                                                                 
 cc receive enable                                                              
#
mpls-tp meg 1                                                             
 me te interface  Tunnel <span>0/1/0</span> mep-id 1 remote-mep-id 2          
 cc send enable                                                                 
 cc receive enable                                                              
#                                                                               
mpls-tp meg 2                                                          
 me te interface  Tunnel <span>0/1/1</span> mep-id 3 remote-mep-id 4          
 cc send enable                                                                 
 cc receive enable                                                              
#
return   </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#                                                                               
sysname PE2                                                                     
#
mpls-tp ais enable                                                           
#                                                                               
lacp e-trunk system-id 00e0-fc12-7890                                           
lacp e-trunk priority 100                                                       
#                                                                               
mpls lsr-id 2.2.2.2                                                             
mpls                                                                            
 mpls te                                                                        
#                                                                               
mpls l2vpn                                                                      
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
 trap-threshold crc-error mac-fcs-sd alarm-threshold 1 5 resume-threshold 1 6 trigger-lsp
#                                                                               
pw-aps 2                                                                        
 role slave                                                                     
 remote-aps 3                                                                   
#                                                                               
bidirectional static-cr-lsp ingress tunnel 30                                 
 forward nexthop 10.1.4.2 out-label 60                      
 backward in-label 70                                                           
#                                                                               
bidirectional static-cr-lsp egress tunnel 10                                  
 forward in-label 20 lsrid 1.1.1.1 tunnel-id 100                                
 backward nexthop 10.1.2.1 out-label 30                     
#                                                                               
e-trunk 10                                                                      
 priority 10                                                                    
 peer-address 3.3.3.3 source-address 2.2.2.2                                    
#                                                                               
interface Eth-Trunk10                                                           
 mode lacp-static
 trunkport gigabitethernet <span>0/1/2</span>                                                               
 e-trunk 10                                                                     
#                                                                               
interface Eth-Trunk10.1                                                         
 vlan-type dot1q 10                                                             
 mpls static-l2vc destination 1.1.1.1 1 transmit-vpn-label 200 receive-vpn-label 100 tunnel-policy policy1 control-word 
 mpls static-l2vc destination 3.3.3.3 3 transmit-vpn-label 500 receive-vpn-label 600 tunnel-policy policy1 control-word bypass  
 mpls l2vpn pw-aps 2 admin                                                      
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.2.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.4.1 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                             
#                                                                               
interface tunnel 10                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 100                                                          
 mpls te passive-tunnel                                                         
 mpls te binding bidirectional static-cr-lsp egress tunnel 10                 
 mpls te reserved-for-binding                                                   
#                                                                               
interface tunnel 30                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 3.3.3.3                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 300                                                          
 mpls te bidirectional                                                          
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 2.2.2.2 0.0.0.0                                                       
  network 10.1.4.0 0.0.0.255                                                    
  network 10.1.2.0 0.0.0.255                                                    
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te tunnel 10                              
 tunnel binding destination 3.3.3.3 te tunnel 30                              
#                                                                               
mpls-tp meg primary                                                             
 me l2vc peer-ip 1.1.1.1 vc-id 1 vc-type vlan mep-id 2 remote-mep-id 1          
 cc send enable                                                                 
 cc receive enable                                                              
 me te peer-ip 1.1.1.1 vc-id 1 vc-type vlan mep-id 2 remote-mep-id 1          
 cc send enable                                                                 
 cc receive enable                                                              
#
mpls-tp meg 1                                                             
 me te interface  Tunnel <span>0/1/0</span> mep-id 2 remote-mep-id 1          
 cc send enable                                                                 
 cc receive enable                                                              
#
return </pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#                                                                               
sysname PE3                                                                     
#
mpls-tp ais enable                                                           
#                                                                               
lacp e-trunk system-id 00e0-fc12-7890                                           
lacp e-trunk priority 100                                                       
#                                                                               
mpls lsr-id 3.3.3.3                                                             
mpls                                                                            
 mpls te                                                                        
#                                                                               
mpls l2vpn                                                                      
#                                                                               
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
pw-aps 3                                                                        
 role master                                                                    
 remote-aps 2                                                                   
#                                                                               
bidirectional static-cr-lsp egress tunnel 20                                  
 forward in-label 40 lsrid 1.1.1.1 tunnel-id 200                                
 backward nexthop 10.1.3.1 out-label 50                     
#                                                                               
bidirectional static-cr-lsp egress tunnel 30                                  
 forward in-label 60 lsrid 2.2.2.2 tunnel-id 300                                
 backward nexthop 10.1.4.1 out-label 70                     
#                                                                               
#                                                                               
e-trunk 10                                                                      
 priority 20                                                                    
 peer-address 2.2.2.2 source-address 3.3.3.3                                    
#                                                                               
interface Eth-Trunk10                                                           
 mode lacp-static
 trunkport gigabitethernet <span>0/1/2</span>                                                               
 e-trunk 10                                                                     
#                                                                               
interface Eth-Trunk10.1                                                         
 vlan-type dot1q 10                                                             
 mpls static-l2vc destination 1.1.1.1 2 transmit-vpn-label 400 receive-vpn-label 300 tunnel-policy policy1 control-word    
 mpls static-l2vc destination 2.2.2.2 3 transmit-vpn-label 600 receive-vpn-label 500 tunnel-policy policy1 control-word bypass 
 mpls l2vpn pw-aps 3 admin                                                      
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.3.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
 trap-threshold crc-error mac-fcs-sd alarm-threshold 1 5 resume-threshold 1 6 trigger-lsp
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.4.2 255.255.255.0                                              
 mpls                                                                           
 mpls te                                                                                                                           
#                                                                               
interface LoopBack0                                                             
 ip address 3.3.3.3 255.255.255.255                                             
#                                                                               
interface tunnel 20                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 1.1.1.1                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 200                                                          
 mpls te passive-tunnel                                                         
 mpls te binding bidirectional static-cr-lsp egress tunnel 20                 
 mpls te reserved-for-binding                                                   
#                                                                               
interface tunnel 30                                                           
 ip address unnumbered interface LoopBack0                                      
 tunnel-protocol mpls te                                                        
 destination 2.2.2.2                                                            
 mpls te signal-protocol cr-static                                              
 mpls te tunnel-id 300                                                          
 mpls te passive-tunnel                                                         
 mpls te binding bidirectional static-cr-lsp egress tunnel 30                 
 mpls te reserved-for-binding                                                   
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 3.3.3.3 0.0.0.0                                                       
  network 10.1.3.0 0.0.0.255                                                    
  network 10.1.4.0 0.0.0.255                                                    
#                                                                               
static-cr-lsp egress 1to2 incoming-interface GigabitEthernet<span>0/1/1</span> in-label 20   
#                                                                               
tunnel-policy policy1                                                           
 tunnel binding destination 1.1.1.1 te tunnel 20                              
 tunnel binding destination 2.2.2.2 te tunnel 30                              
#                                                                               
mpls-tp meg secondary                                                           
 me l2vc peer-ip 1.1.1.1 vc-id 2 vc-type vlan mep-id 4 remote-mep-id 3          
 cc send enable                                                                 
 cc receive enable                                                              
#                                                                               
mpls-tp meg 2                                                          
 me te interface Tunnel <span>0/1/1</span> mep-id 3 remote-mep-id 4          
 cc send enable                                                                 
 cc receive enable                                                              
#
return  </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#                                                                               
sysname CE2                                                                     
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   

#                                                                               
interface Eth-Trunk10                                                           
 portswitch                                                                     
 port trunk allow-pass vlan 10
 trunkport gigabitethernet <span>0/1/0</span> to <span>0/1/1</span>                                                  
 mode lacp-static                                                               
#
vlan10
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 eth-trunk 10                                                                   
#                                                                               
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_000010.html">Configuration Examples for Bit-Error-Triggered Protection Switching
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_error-code_ngmvpn_0002.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>