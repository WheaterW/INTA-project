
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VPLS-based CFM">
<meta name="abstract" content="This section provides an example for configuring virtual private LAN service (VPLS)-based connectivity fault management (CFM).">
<meta name="description" content="This section provides an example for configuring virtual private LAN service (VPLS)-based connectivity fault management (CFM).">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000021.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000025.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,c00376497,z00603461,w00800033,jwx1168690,w00556928,w00437000,eoam-vrp,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="Ethernet OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172361974">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring VPLS-based CFM</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172361974"></a><a name="EN-US_TASK_0172361974"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VPLS-based CFM</h1>
<div class="taskbody"><p>This section provides an example for configuring virtual private LAN service (VPLS)-based connectivity fault management (CFM).</p>
<div class="context"><a name="EN-US_TASK_0172361974__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172361974__fig121351749393">Figure 1</a>, the UPEs are connected to the PE-AGG over a VPLS network. Configure VPLS-based CFM to detect link faults on the network.</p>
<div class="fignone" id="EN-US_TASK_0172361974__fig121351749393"><a name="EN-US_TASK_0172361974__fig121351749393"></a><a name="fig121351749393"></a><span class="figcap"><b>Figure 1 </b>VPLS-based CFM</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<p><span><img class="vsd" src="figure/en-us_image_0000001186268902.png"></span></p>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="10.66893310668933%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="14.378562143785622%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="74.95250474952505%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="10.66893310668933%" headers="mcps1.4.1.4.2.4.1.1 "><p>UPE1</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="14.378562143785622%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback</p>
</td>
<td class="cellrowborder" valign="top" width="74.95250474952505%" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="10.66893310668933%" headers="mcps1.4.1.4.2.4.1.1 "><p>UPE2</p>
</td>
<td class="cellrowborder" valign="top" width="14.378562143785622%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback</p>
</td>
<td class="cellrowborder" valign="top" width="74.95250474952505%" headers="mcps1.4.1.4.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="10.66893310668933%" headers="mcps1.4.1.4.2.4.1.1 "><p>UPE3</p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="14.378562143785622%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback</p>
</td>
<td class="cellrowborder" valign="top" width="74.95250474952505%" headers="mcps1.4.1.4.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="10.66893310668933%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE-AGG</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="14.378562143785622%" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback</p>
</td>
<td class="cellrowborder" valign="top" width="74.95250474952505%" headers="mcps1.4.1.4.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Interface3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>192.168.4.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361974__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an Interior Gateway Protocol (IGP) on the backbone network to enable communication between devices on the backbone network.</p>
</li><li><p>Configure an Interior Gateway Protocol (IGP) on the backbone network and enable basic Multiprotocol Label Switching (MPLS) functions.</p>
</li><li><p>Create a virtual switching instance (VSI) and bind it to an attachment circuit (AC) interface.</p>
</li><li><p>Configure VPLS-based CFM.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172361974__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface IP addresses</p>
</li><li><p>Label switching router (LSR) IDs used for basic MPLS functions</p>
</li><li><p>VSI name and ID</p>
</li><li><p>MD name, MA name, MEP ID and type, and name of the interface on which the MEP resides</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172361974__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p># Configure UPE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-LoopBack0]<strong> ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/1</span>]<strong> ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/0</span>]<strong> ip address 192.168.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/0</span>]<strong> commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-LoopBack0]<strong> ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-LoopBack0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/1</span>]<strong> ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/0</span>]<strong> ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/0</span>]<strong> quit </strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/0</span>]<strong> commit</strong></pre>
<p># Configure UPE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname UPE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE3]<strong> interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-LoopBack0] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-LoopBack0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/0</span>]<strong> ip address 192.168.3.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/1</span>]<strong> ip address 192.168.4.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/1</span>]<strong> commit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PEAGG</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PEAGG]<strong> interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-LoopBack0] <strong>ip address 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-LoopBack0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/0</span>]<strong> ip address 192.168.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/2</span>]<strong> ip address 192.168.4.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/2</span>]<strong> commit</strong></pre>
</p></li><li><span>Configure an IGP on the backbone network. This example uses Open Shortest Path First (OSPF).</span><p><p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> commit</strong></pre>
<p># Configure UPE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE3]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-ospf-1-area-0.0.0.0]<strong> network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-ospf-1-area-0.0.0.0]<strong> network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-ospf-1-area-0.0.0.0]<strong> network 192.168.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> commit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PEAGG]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-ospf-1-area-0.0.0.0]<strong> network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-ospf-1-area-0.0.0.0]<strong> network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-ospf-1-area-0.0.0.0]<strong> network 192.168.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> commit</strong></pre>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command. The command output shows that an OSPF route exists between Loopback0 interfaces of each UPE and the PE-AGG.</p>
<p>The following example uses the command output on UPE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>UPE1] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>                                     
------------------------------------------------------------------------------  
Routing Table: Public                                                          
         Destinations : 26       Routes : 27                                    
                                                                                
Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface      
                                                                                
        1.1.1.1/32  Direct  0    0           D   127.0.0.1       LoopBack0      
        2.2.2.2/32  OSPF    10   1           D   192.168.1.2     GigabitEthernet
<span>0/1/1</span>                                                                           
        3.3.3.3/32  OSPF    10   1           D   192.168.3.2     GigabitEthernet
<span>0/1/0</span>                                                                           
        4.4.4.4/32  OSPF    10   2           D   192.168.1.2     GigabitEthernet
<span>0/1/1</span>                                                                           
                    OSPF    10   2           D   192.168.3.2     GigabitEthernet
<span>0/1/0</span>                                                                           
      127.0.0.0/8   Direct  0    0           D   127.0.0.1       InLoopBack0    
      127.0.0.1/32  Direct  0    0           D   127.0.0.1       InLoopBack0    
127.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0    
    192.168.1.0/24  Direct  0    0           D   192.168.1.1     GigabitEthernet
<span>0/1/1</span>                                                                           
    192.168.1.1/32  Direct  0    0           D   127.0.0.1       GigabitEthernet
<span>0/1/1</span>                                                                           
  192.168.1.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet
<span>0/1/1</span>                                                                           
    192.168.2.0/24  OSPF    10   2           D   192.168.1.2     GigabitEthernet
<span>0/1/1</span>                                                                           
    192.168.3.0/24  Direct  0    0           D   192.168.3.1     GigabitEthernet
<span>0/1/0</span>                                                                           
    192.168.3.1/32  Direct  0    0           D   127.0.0.1       GigabitEthernet
<span>0/1/0</span>                                                                           
  192.168.3.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet
<span>0/1/0</span>                                                                           
    192.168.4.0/24  OSPF    10   2           D   192.168.3.2     GigabitEthernet
<span>0/1/0</span>                                                                           
    255.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Enable basic MPLS functions and LDP on the backbone network.</span><p><p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> interface gigabitethernet <span>0/1/1</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>UPE2]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Gigabitethernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> commit</strong></pre>
<p># Configure UPE3.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>UPE3]<strong> mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-Gigabitethernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3]<strong> commit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PEAGG]<strong> mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/2</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/2</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-Gigabitethernet<span>0/1/2</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG]<strong> commit</strong></pre>
<p>After the configuration is complete, an LDP session is set up between each UPE and the PE. Run the <strong>display mpls ldp session</strong> command. The command output shows that <strong>Status</strong> is <strong>Operational</strong>.</p>
<p>The following example uses the command output on UPE1.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>UPE1]<strong> display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 <span>An asterisk (*) before a session means the session is being deleted.</span>
 ------------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 ------------------------------------------------------------------------------
 2.2.2.2:0          Operational DU   Passive  0000:00:46  187/187
 3.3.3.3:0          Operational DU   Passive  0000:00:44  177/177
 ------------------------------------------------------------------------------
 TOTAL: 2 session(s) Found.                                     </pre>
</p></li><li><span>Create a VSI and specify LDP as its signaling protocol.</span><p><p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-vsi-ldp1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-vsi-ldp1-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-vsi-ldp1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-vsi-ldp1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-vsi-ldp1-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-vsi-ldp1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-vsi-ldp1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-vsi-ldp1-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-vsi-ldp1-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-vsi-ldp1-ldp] <strong>peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-vsi-ldp1-ldp] <strong>commit</strong></pre>
<p># Configure UPE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE3] <strong>vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-vsi-ldp1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-vsi-ldp1-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-vsi-ldp1-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-vsi-ldp1-ldp] <strong>peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE3-vsi-ldp1-ldp] <strong>commit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PEAGG] <strong>vsi ldp1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-vsi-ldp1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-vsi-ldp1-ldp] <strong>vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-vsi-ldp1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-vsi-ldp1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-vsi-ldp1-ldp] <strong>commit</strong></pre>
</p></li><li><span>Bind the VSI to an AC interface.</span><p><p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>interface gigabitethernet <span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/2</span>.1] <strong>l2 binding vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/2</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PEAGG] <strong>interface gigabitethernet <span>0/1/1</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-GigabitEthernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-GigabitEthernet<span>0/1/1</span>.1] <strong>l2 binding vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-GigabitEthernet<span>0/1/1</span>.1] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-GigabitEthernet<span>0/1/1</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display vsi name ldp1 verbose</strong> command to view detailed information about the VSI named <strong>ldp1</strong>.</p>
<p>The following example uses the command output on UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>display vsi name ldp1 verbose</strong></pre>
<pre class="screen">                                                                               
 ***VSI Name               : ldp1                                               
    Administrator VSI      : no                                                 
    Isolate Spoken         : disable                                            
    VSI Index              : 0                                                  
    PW Signaling           : ldp                                                
    Member Discovery Style : static                                             
<span>    Bridge-domain Mode     : disable</span>
    PW MAC Learn Style     : unqualify                                          
    Encapsulation Type     : vlan                                               
    MTU                    : 1500                                               
    Diffserv Mode          : uniform                                            
    Service Class          : --                                                 
    Color                  : --                                                 
    DomainId               : 255                                                
    Domain Name            :                                                    
    Ignore AcState         : disable                                            
    P2P VSI                : disable                                            
    Create Time            : 0 days, 0 hours, 38 minutes, 30 seconds            
    VSI State              : up                                                 
    Resource Status        : Valid                                              
                                                                                
    VSI ID                 : 1                                                  
   *Peer Router ID         : 2.2.2.2                                            
    primary or secondary   : primary                                            
    ignore-standby-state   : no                                                 
    VC Label               : 4099                                               
    Peer Type              : dynamic                                            
    Session                : up                                                 
    Tunnel ID              : 0x41004000                                         
    Broadcast Tunnel ID    : 0x41004000                                         
    Broad BackupTunnel ID  : 0x0                                                
    CKey                   : 2                                                  
    NKey                   : 1                                                  
    Stp Enable             : 0                                                  
    PwIndex                : 0                                              
    Control Word           : enable
   *Peer Router ID         : 3.3.3.3                                            
    primary or secondary   : primary                                            
    ignore-standby-state   : no                                                 
    VC Label               : 4100                                               
    Peer Type              : dynamic                                            
    Session                : up                                                 
    Tunnel ID              : 0x41004001                                         
    Broadcast Tunnel ID    : 0x41004001                                         
    Broad BackupTunnel ID  : 0x0                                                
    CKey                   : 4                                                  
    NKey                   : 3                                                  
    Stp Enable             : 0                                                  
    PwIndex                : 0
    Control Word           : enable                                                  
                                                                                
    Interface Name         : GigabitEthernet<span>0/1/2</span>.1                             
    State                  : up                                                 
    Access Port            : false                                              
    Last Up Time           : 2012/04/26 15:47:02                                
    Total Up Time          : 0 days, 0 hours, 15 minutes, 38 seconds            
                                                                                
  **PW Information:                                                             
                                                                                
   *Peer Ip Address        : 2.2.2.2                                            
    PW State               : up                                                 
    Local VC Label         : 4099                                               
    Remote VC Label        : 4099 
    Remote Control Word    : enable                                              
    PW Type                : label                                              
    Tunnel ID              : 0x41004000                                         
    Broadcast Tunnel ID    : 0x41004000                                         
    Broad BackupTunnel ID  : 0x0                                                
    Ckey                   : 0x2                                                
    Nkey                   : 0x1                                                
    Main PW Token          : 0x41004000                                         
    Slave PW Token         : 0x0                                                
    Tnl Type               : LSP                                                
    OutInterface           : GigabitEthernet<span>0/1/1</span>                               
    Backup OutInterface    :                                                    
    Stp Enable             : 0                                                  
    Mac Flapping           : 0                                                  
    PW Last Up Time        : 2012/04/26 15:47:02                                
    PW Total Up Time       : 0 days, 0 hours, 15 minutes, 9 seconds             
   *Peer Ip Address        : 3.3.3.3                                            
    PW State               : up                                                 
    Local VC Label         : 4100                                               
    Remote VC Label        : 4099
    Remote Control Word    : enable                                              
    PW Type                : label                                              
    Tunnel ID              : 0x41004001                                         
    Broadcast Tunnel ID    : 0x41004001                                         
    Broad BackupTunnel ID  : 0x0                                                
    Ckey                   : 0x4                                                
    Nkey                   : 0x3                                                
    Main PW Token          : 0x41004001                                         
    Slave PW Token         : 0x0                                                
    Tnl Type               : LSP                                                
    OutInterface           : GigabitEthernet<span>0/1/0</span>                               
    Backup OutInterface    :                                                    
    Stp Enable             : 0                                                  
    Mac Flapping           : 0                                                  
    PW Last Up Time        : 2012/04/26 15:47:10                                
    PW Total Up Time       : 0 days, 0 hours, 6 minutes, 37 seconds  </pre>
</p></li><li><span>Configure Ethernet CFM on UPE1 and the PE-AGG.</span><p><p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>cfm md md1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1-ma-ma1] <strong>ccm-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1-ma-ma1] <strong>map vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1-ma-ma1] <strong>mep mep-id 1 interface gigabitethernet <span>0/1/2</span>.1 inward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1-ma-ma1] <strong>remote-mep mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1-ma-ma1] <strong>mep ccm-send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1-ma-ma1] <strong>remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1-ma-ma1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-md-md1] <strong>commit</strong></pre>
<p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PEAGG] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG] <strong>cfm md md1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1-ma-ma1] <strong>ccm-interval 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1-ma-ma1] <strong>map vsi ldp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1-ma-ma1] <strong>mep mep-id 2 interface gigabitethernet <span>0/1/1</span>.1 inward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1-ma-ma1] <strong>remote-mep mep-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1-ma-ma1] <strong>mep ccm-send enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1-ma-ma1] <strong>remote-mep ccm-receive enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1-ma-ma1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PEAGG-md-md1] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display cfm mep</strong> and <strong>display cfm remote-mep</strong> commands on UPE1 or the PE-AGG. The command output shows that VPLS-based CFM has been established.</p>
<p>The following example uses the command output on UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>display cfm mep md md1</strong></pre>
<pre class="screen">The total number of MEPs is : 1
--------------------------------------------------
 MD Name            : md1
 MD Name Format     : string
 Level              : 0
 MA Name            : ma1
 MEP ID             : 1
 VLAN ID            : -- 
 VSI Name           : ldp1
 L2VC ID            : -- 
<span> L2VPN Name         : --  CE ID              : --  CE Offset          : --</span>
<span>  L2TPV3 Tunnel Name            : --</span>
<span> L2TPV3 Local Connection Name  : --</span>
 Interface Name     : GigabitEthernet<span>0/1/2</span>.1
 CCM Send           : enabled
 Direction          : inward
 MAC Address        : 00e0-fc12-7880
 MEP Pe-vid         : --
 MEP Ce-vid         : --
 MEP Vid            : -- 
 Alarm Status       : none
 Alarm RDI          : enabled<span>
 Bandwidth Receive  : false
 Bandwidth          : --</span></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>display cfm remote-mep</strong></pre>
<pre class="screen">The total number of RMEPs is : 1
The status of RMEPs : 1 up, 0 down, 0 disable
--------------------------------------------------
 MD Name            : md1
 Level              : 0
 MA Name            : ma1
 RMEP ID            : 2
 VLAN ID            : -- 
 VSI Name           : ldp1
 L2VC ID            : -- 
<span> L2VPN Name         : --  CE ID              : --  CE Offset          : --</span>
<span>  L2TPV3 Tunnel Name            : --</span>
<span> L2TPV3 Local Connection Name  : --</span>
  CCM Send           : enabled
 MAC                : 00e0-fc12-7890
 Trigger-If-Down    : disabled
 CFM Status         : up
 Alarm Status       : none
 Interface TLV      : --
 Port Status TLV    : --</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172361974__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE1 configuration file</p>
<pre class="screen">#                                                                               
sysname UPE1                                                                    
#                                                                               
vlan batch 2                                                                    
#                                                                               
cfm version standard                                                            
cfm enable                                                                      
#
mpls lsr-id 1.1.1.1                                                             
mpls                                                                            
#                                                                               
mpls l2vpn                                                                      
#                                                                               
vsi ldp1 static                                                                 
 pwsignal ldp                                                                   
  vsi-id 2                                                                      
  peer 2.2.2.2                                                                  
  peer 3.3.3.3                                                                  
#                                                                               
mpls ldp                                                                        
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.3.1 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                       
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.1.1 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                       
#
interface GigabitEthernet<span>0/1/2</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/2</span>.1                                                
 vlan-type dot1q 2                                                              
 l2 binding vsi ldp1                                                            
#                                                                               
interface LoopBack0                                                             
 ip address 1.1.1.1 255.255.255.255                                             
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 1.1.1.1 0.0.0.0                                                       
  network 192.168.1.0 0.0.0.255                                                 
  network 192.168.3.0 0.0.0.255                                                 
#                                                                               
cfm md md1                                                                      
 ma ma1                                                                         
  map vsi ldp1
  ccm-interval 100                                                                
  mep mep-id 1 interface GigabitEthernet<span>0/1/2</span>.1 inward
  mep ccm-send enable                                                  
  remote-mep mep-id 2                                                           
  remote-mep ccm-receive enable                                        
#
return   </pre>
</li><li><p>UPE2 configuration file</p>
<pre class="screen">#                                                                               
sysname UPE2                                                                    
#                                                                               
cfm version standard                                                            
cfm enable                                                                      
#                                                                               
mpls lsr-id 2.2.2.2                                                             
mpls                                                                            
#                                                                               
mpls l2vpn                                                                      
#                                                                               
vsi ldp1 static                                                                 
 pwsignal ldp                                                                   
  vsi-id 2                                                                      
  peer 1.1.1.1                                                                  
  peer 4.4.4.4                                                                  
#                                                                               
mpls ldp                                                                        
#
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.2.1 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                       
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.1.2 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                       
#                                                                           
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                             
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 2.2.2.2 0.0.0.0                                                       
  network 192.168.1.0 0.0.0.255                                                 
  network 192.168.2.0 0.0.0.255                                                 
#                                                                               
return</pre>
</li><li><p>UPE3 configuration file</p>
<pre class="screen">#                                                                               
sysname UPE3                                                                  
#
mpls lsr-id 3.3.3.3                                                             
mpls                                                                            
#                                                                               
mpls l2vpn                                                                      
#                                                                               
vsi ldp1 static                                                                 
 pwsignal ldp                                                                   
  vsi-id 2                                                                      
  peer 1.1.1.1                                                                  
  peer 4.4.4.4                                                                  
#                                                                               
mpls ldp                                                                        
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.3.2 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.4.1 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                       
#                                                                               
interface LoopBack0                                                             
 ip address 3.3.3.3 255.255.255.255                                             
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 1.1.1.1 0.0.0.0                                                       
  network 3.3.3.3 0.0.0.0                                                       
  network 192.168.3.0 0.0.0.255                                                 
  network 192.168.4.0 0.0.0.255                                                 
#
return </pre>
</li><li><p>PE-AGG configuration file</p>
<pre class="screen">#                                                                               
sysname PEAGG                                                                    
#                                                                               
cfm version standard                                                            
cfm enable                                                                      
#                                                                               
mpls lsr-id 4.4.4.4                                                             
mpls                                                                            
#                                                                               
mpls l2vpn                                                                      
#                                                                               
vsi ldp1 static                                                                 
 pwsignal ldp                                                                   
  vsi-id 2                                                                      
  peer 2.2.2.2                                                                  
  peer 3.3.3.3                                                                  
#                                                                               
mpls ldp                                                                        
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 192.168.2.2 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                       
#                                                                               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown                                                                  
 ip address 192.168.4.2 255.255.255.0                                           
 mpls                                                                           
 mpls ldp                                                                       
#
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
#                                                                               
interface GigabitEthernet<span>0/1/1</span>.1                                                
 vlan-type dot1q 2                                                              
 l2 binding vsi ldp1                                                            
#                                                                            
interface LoopBack0                                                             
 ip address 4.4.4.4 255.255.255.255                                             
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 4.4.4.4 0.0.0.0                                                       
  network 192.168.2.0 0.0.0.255                                                 
  network 192.168.4.0 0.0.0.255                                                 
#                                                                               
interface LoopBack0                                                             
 ip address 4.4.4.4 255.255.255.255                                             
#                                                                               
ospf 1                                                                          
 area 0.0.0.0                                                                   
  network 4.4.4.4 0.0.0.0                                                       
  network 192.168.2.0 0.0.0.255                                                 
  network 192.168.4.0 0.0.0.255                                                 
#                                                                               
cfm md md1                                                                      
 ma ma1                                                                         
  map vsi ldp1  
  ccm-interval 100                                                                
  mep mep-id 2 interface GigabitEthernet<span>0/1/1</span>.1 inward
  mep ccm-send enable                                                  
  remote-mep mep-id 1                                                           
  remote-mep ccm-receive enable                                        
#
return   </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000021.html">Configuration Examples for CFM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000023.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfm_cfg_000025.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>