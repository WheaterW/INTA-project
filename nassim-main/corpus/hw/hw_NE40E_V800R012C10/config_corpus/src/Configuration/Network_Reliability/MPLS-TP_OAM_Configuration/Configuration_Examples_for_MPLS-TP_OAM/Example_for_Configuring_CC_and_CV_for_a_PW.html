
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring CC and CV for a PW">
<meta name="abstract" content="This section provides an example for configuring continuity check (CC) and connectivity verification (CV) for a pseudo wire (PW).">
<meta name="description" content="This section provides an example for configuring continuity check (CC) and connectivity verification (CV) for a pseudo wire (PW).">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-tp_oam_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-tp_oam_cfg_0027.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-tp_oam_cfg_0030.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z50024784,z00603461,w00800033,jwx1168690,tpoam_vrp,w00556928,w00437000,w00606909,m00390128,l00455378,wwx1270540">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS-TP OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS-TP OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS-TP OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS-TP OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="q00824768">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172362435">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring CC and CV for a PW</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172362435"></a><a name="EN-US_TASK_0172362435"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring CC<span> and CV</span> for a PW</h1>
<div class="taskbody"><p>This section provides an example for configuring continuity check (CC)<span> and connectivity verification (CV)</span> for a pseudo wire (PW).</p>
<div class="context"><a name="EN-US_TASK_0172362435__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">On the network shown in <a href="#EN-US_TASK_0172362435__fig_dc_vrp_mpls-tp_oam_cfg_002401">Figure 1</a>, LSRA, LSRB, and LSRC are connected using a PW built over a bidirectional label switched path (LSP). The following deployment is made to ensure connectivity and correct packet forwarding between LSRA and LSRC:<ul><li>LSRA and LSRC serve as MEPs.</li><li>LSRB serves as a MIP.</li></ul>
</div>
<div class="p">CC<span> and CV</span> must be enabled on the MEPs. <span>CC is a proactive OAM operation that detects loss of continuity (LOC) between any two MEPs in a maintenance entity group (MEG). A MEP periodically sends continuity check messages (CCMs) to its remote MEP (RMEP). If the RMEP does not receive CCMs within a period 3.5 times the specified interval, it considers that the connectivity between the two MEPs is abnormal and reports an alarm. At the same time, the RMEP enters the Down state and triggers automatic protection switching (APS). After receiving a CCM from the MEP, the RMEP clears the alarm and exits the Down state.</span><ul><li><p>CC detects LOC between any two MEPs in a MEG. A MEP sends CCMs to its RMEP at a specified interval. If the RMEP does not receive CCMs within a period of 3.5 times as long as the specified interval, the RMEP considers that the connectivity between the MEPs is abnormal, reports an alarm, and enters the Down state. After that, APS is triggered on both MEPs. Upon receipt of a CCM from the MEP, the RMEP clears the alarm and exits the Down state.</p>
</li><li><p>CV enables a MEP to report alarms when receiving unexpected packets. For example, if a CV-enabled device receives a packet from a PW and finds that this packet is incorrectly transmitted through the PW, the device reports an alarm indicating a forwarding error.</p>
<p>Transport networks have strict requirements on the correctness of data forwarding. In addition, MPLS-TP requires that the data plane should be able to work without IP support, which means that packet forwarding is based on label switching only. Therefore, the correctness of label-based forwarding must be ensured.</p>
</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0172362435__fig_dc_vrp_mpls-tp_oam_cfg_002401"><a name="EN-US_TASK_0172362435__fig_dc_vrp_mpls-tp_oam_cfg_002401"></a><a name="fig_dc_vrp_mpls-tp_oam_cfg_002401"></a><span class="figcap"><b>Figure 1 </b>PW over a bidirectional LSP</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-tp_oam_cfg_002401.png" width="NaN" height="NaN"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="10.66893310668933%" id="mcps1.4.1.5.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="53.664633536646335%" id="mcps1.4.1.5.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="35.666433356664335%" id="mcps1.4.1.5.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="10.66893310668933%" headers="mcps1.4.1.5.2.4.1.1 "><p>LSRA</p>
</td>
<td class="cellrowborder" valign="top" width="53.664633536646335%" headers="mcps1.4.1.5.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="35.666433356664335%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="10.66893310668933%" headers="mcps1.4.1.5.2.4.1.1 "><p>LSRB</p>
</td>
<td class="cellrowborder" valign="top" width="53.664633536646335%" headers="mcps1.4.1.5.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="35.666433356664335%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.1.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="10.66893310668933%" headers="mcps1.4.1.5.2.4.1.1 "><p>LSRC</p>
</td>
<td class="cellrowborder" valign="top" width="53.664633536646335%" headers="mcps1.4.1.5.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="35.666433356664335%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.1.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GigabitEthernet<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.3.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362435__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create a maintenance entity (ME) instance and bind it to a PW.</p>
</li><li><p>(Optional) Configure an interval at which CCMs are sent and a priority for CCMs.</p>
</li><li><p>Enable CC and CV.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172362435__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MEG name</p>
</li><li><p>ID of the virtual circuit (VC) bound to the ME instance</p>
</li><li><p>(Optional) Interval at which CCMs are sent and priority of CCMs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172362435__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a PW over a bidirectional LSP.</span><p><p>For configuration details, see "<a href="dc_vrp_vpws_cfg_3012.html">Configuration Examples</a>" in <em><span class="keyword">HUAWEI NE40E-M2 series</span><span class="keyword">Universal Service Router</span> Configuration Guide - VPN</em> or Configuration Files.</p>
</p></li><li><span>Create an ME instance and bind it to the PW.</span><p><div class="p"># Create an ME instance named <strong>test</strong> on LSRA and bind it to the PW.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>mpls-tp meg test</strong>
[<span class="keyword">*</span>LSRA-mpls-tp-meg-test] <strong>me l2vc peer-ip 10.1.1.3 vc-id 30000 vc-type vlan mep-id 1 remote-mep-id 2</strong></pre>
</div>
<div class="p"># Create an ME instance named <strong>test</strong> on LSRC and bind it to the PW.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC] <strong>mpls-tp meg test</strong>
[<span class="keyword">*</span>LSRC-mpls-tp-meg-test] <strong>me l2vc peer-ip 10.1.1.1 vc-id 30000 vc-type vlan mep-id 2 remote-mep-id 1</strong></pre>
</div>
</p></li><li><span>Enable CC and CV.</span><p><div class="p"># Enable CC and CV on LSRA.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls-tp-meg-test] <strong>cc send enable</strong>
[<span class="keyword">*</span>LSRA-mpls-tp-meg-test] <strong>cc receive enable</strong>
[<span class="keyword">*</span>LSRA-mpls-tp-meg-test] <strong>return</strong></pre>
</div>
<div class="p"># Enable CC and CV on LSRC.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls-tp-meg-test] <strong>cc send enable</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls-tp-meg-test] <strong>cc receive enable</strong>
[<span class="keyword">*</span>LSRC-mpls-tp-meg-test] <strong>return</strong></pre>
</div>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+mpls-tp+oam+meg"><b><span class="cmdname">display mpls-tp oam meg</span></b></a> command on LSRA to view MEG information.</p>
<pre class="screen">&lt;LSRA&gt;<strong> display mpls-tp oam meg test</strong>
--------------------------------------------------
MEG abc
--------------------------------------------------
meg name                      : test                 
meg level                     : 7                   
me count                      : 1                   
cc send                       : enable              
cc receive                    : enable              
cc interval                   : 1000                
cc exp                        : 7                   
RDI                           : down 
ais                           : disable             
ais interval                  : 1000                
ais exp                       : 7                   
lock                          : disable             
lock interval                 : 1000                
lock exp                      : 7                   
csf                           : disable             
csf interval                  : 1000                
csf exp                       : 7                   
lm single-end receive         : disable             
lm single-end pro-active      : enable              
lm single-end SD1 threshold   : 999999                   
lm single-end SD2 threshold   : 1000000                  
lm ring SD1 threshold         : 0
lm ring SD2 threshold         : 0
lm dual-end                   : disable             
lm dual-end SD1 threshold     : 1
lm dual-end SD2 threshold     : 10
lm oam-packet SD1 threshold   : 0
lm oam-packet SD2 threshold   : 0

[ME 1]
index                         : 0                   
direction                     : dual                
mep id                        : 1                   
remote mep id                 : 2                   
status board                  : 3                   
service type                  : vll-pw              
peer ip                       : 10.1.1.3             
remote peer ip                : -             
vc id                         : 30000               
vc type                       : VLAN                
ttl                           : 2                   
state                         : UP                  
local state                   : near-end defect-unavailable far-end available        
alarm indicate                : no alarm            
hardware resource             : -
gal                           : disable
hardware error info           : none
--------------------------------------------------
</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172362435__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#
sysname LSRA
#
mpls lsr-id 10.1.1.1
 mpls
  mpls te
#
mpls l2vpn
#
 bidirectional static-cr-lsp ingress Tunnel10
  forward nexthop 10.1.2.2 out-label 20
  backward in-label 20
#
pw-template tpatoc
 peer-address 10.1.1.3
 control-word
 tnl-policy tpatoc
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/3/0</span>.1
 vlan-type dot1q 1
 mpls
 mpls static-l2vc pw-template tpatoc 30000 transmit-vpn-label 101 receive-vpn-label 101 control-word
#
interface LoopBack1
 ip address 10.1.1.1 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 10.1.1.3
 mpls te signal-protocol cr-static
 mpls te tunnel-id 100
 mpls te bidirectional
 mpls te reserved-for-binding
#
ip route-static 10.1.1.2 255.255.255.255 10.1.2.2
ip route-static 10.1.1.3 255.255.255.255 10.1.2.2
#
tunnel-policy tpatoc
 tunnel binding destination 10.1.1.3 te Tunnel10
#
 mpls-tp meg test
  me l2vc peer-ip 10.1.1.3 vc-id 30000 vc-type vlan mep-id 1 remote-mep-id 2
  cc send enable
  cc receive enable
#
return </pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#
sysname LSRB
#
mpls lsr-id 10.1.1.2
 mpls
  mpls te
#
 bidirectional static-cr-lsp transit lsp1
  forward in-label 20 nexthop 10.1.3.2 out-label 40
  backward in-label 16 nexthop 10.1.2.1 out-label 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 mpls
 mpls te
 ais enable
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 mpls
 mpls te
 ais enable
#
interface LoopBack1
 ip address 10.1.1.2 255.255.255.255
#
 ip route-static 10.1.1.2 255.255.255.255 10.1.2.1
 ip route-static 10.1.1.3 255.255.255.255 10.1.3.2
#
return  </pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#
sysname LSRC
#
mpls lsr-id 10.1.1.3
 mpls
  mpls te
#
mpls l2vpn
#
 bidirectional static-cr-lsp egress lsp1
  forward in-label 40 lsrid 10.1.1.1 tunnel-id 100
  backward nexthop 10.1.3.1 out-label 16
#
pw-template tpctoa
 peer-address 10.1.1.1
 control-word
 tnl-policy tpctoa
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 mpls
 mpls te
#
interface GigabitEthernet<span>0/3/0</span>.1
 vlan-type dot1q 1
 mpls static-l2vc pw-template tpctoa 30000 transmit-vpn-label 101 receive-vpn-label 101 control-word
#
interface LoopBack1
 ip address 10.1.1.3 255.255.255.255
#
interface Tunnel20
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 10.1.1.1
 mpls te signal-protocol cr-static
 mpls te tunnel-id 200
 mpls te passive-tunnel
 mpls te binding bidirectional static-cr-lsp egress lsp1
 mpls te reserved-for-binding
#
ip route-static 10.1.1.1 255.255.255.255 10.1.3.1
ip route-static 10.1.1.2 255.255.255.255 10.1.3.1
#
tunnel-policy tpctoa
 tunnel binding destination 10.1.1.1 te Tunnel20
#
mpls-tp meg test
  me l2vc peer-ip 10.1.1.1 vc-id 30000 vc-type vlan mep-id 2 remote-mep-id 1
  cc send enable
  cc receive enable
#
return  </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-tp_oam_cfg_0023.html">Configuration Examples for MPLS-TP OAM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-tp_oam_cfg_0027.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-tp_oam_cfg_0030.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>