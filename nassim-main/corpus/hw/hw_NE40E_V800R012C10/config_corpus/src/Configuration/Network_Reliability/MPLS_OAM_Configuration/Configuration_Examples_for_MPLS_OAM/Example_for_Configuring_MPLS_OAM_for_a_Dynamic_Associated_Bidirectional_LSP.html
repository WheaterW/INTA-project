
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MPLS OAM for a Dynamic Associated Bidirectional LSP">
<meta name="abstract" content="This section provides an example for configuring MPLS OAM to check the connectivity of a dynamic associated bidirectional LSP.">
<meta name="description" content="This section provides an example for configuring MPLS OAM to check the connectivity of a dynamic associated bidirectional LSP.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="featurename" content="MPLS OAM">
<meta name="featuretype" content="Network Reliability">
<meta name="OWNER" content="z00545680">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="q00824768">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001842733617">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring MPLS OAM for a Dynamic Associated Bidirectional LSP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001842733617"></a><a name="EN-US_TASK_0000001842733617"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MPLS OAM for a Dynamic Associated Bidirectional LSP</h1>
<div class="taskbody"><p>This section provides an example for configuring MPLS OAM to check the connectivity of a dynamic associated bidirectional LSP.</p>
<div class="context"><a name="EN-US_TASK_0000001842733617__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001842733617__fig10148142971313">Figure 1</a>, two dynamic LSPs in opposite directions exist between LSRA and LSRB on the network. To implement bidirectional protection switching, bind each LSP to the ingress of its reverse LSP to form an associated bidirectional LSP.</p>
<p>IS-IS runs between LSRA and LSRB, which belong to Level-1.</p>
<h4 class="sectiontitle"></h4><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0000001842733617__fig10148142971313"><a name="EN-US_TASK_0000001842733617__fig10148142971313"></a><a name="fig10148142971313"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for an RSVP-TE tunnel</span><br><span><img src="figure/en-us_image_0000001796033258.png"></span></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001842733617__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish a dynamic associated bidirectional LSP from LSRA to LSRB.</p>
</li><li><p>Enable MPLS OAM globally.</p>
</li><li><p>Configure MPLS OAM parameters in the system view on the nodes at both ends of the dynamic associated bidirectional LSP.</p>
</li><li><p>(Optional) Enable MPLS OAM on the nodes at both ends of the dynamic associated bidirectional LSP.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001842733617__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IS-IS area ID, originating system ID, and IS-IS level of each node</p>
</li><li><p>Tunnel interface number, IP address, destination IP address, and tunnel ID</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001842733617__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure dynamic associated bidirectional LSPs.</span><p><p>Configure a dynamic associated bidirectional LSP between LSRA and LSRB. The configuration details are not provided here. For configuration details, see the configuration files.</p>
</p></li><li><span>Enable MPLS OAM globally.</span><p><div class="p"># Enable MPLS OAM globally on LSRA.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls]<strong> quit</strong></pre>
</div>
<div class="p"># Enable MPLS OAM globally on LSRB.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls]<strong> mpls oam</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-mpls]<strong> quit</strong></pre>
</div>
</p></li><li><span>Configure MPLS OAM in the system view on the nodes at both ends of the dynamic associated bidirectional LSP.</span><p><p># Configure MPLS OAM for the ingress on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls oam ingress Tunnel1 backward-lsp lsr-id 2.2.2.2 tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls oam ingress enable Tunnel1</strong></pre>
<p># Configure MPLS OAM for the egress on LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> mpls oam egress lsr-id 1.1.1.1 tunnel-id 1 type cv backward-lsp Tunnel1</strong></pre>
<p># Configure MPLS OAM for the egress on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls oam egress lsr-id 2.2.2.2 tunnel-id 1 type cv backward-lsp Tunnel1</strong></pre>
<p># Configure MPLS OAM for the ingress on LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> mpls oam ingress Tunnel1 backward-lsp lsr-id 1.1.1.1 tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> mpls oam ingress enable Tunnel</strong></pre>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <strong><span>auto-protocol</span></strong> parameter has been configured for the egress, Step 4 does not need to be performed.</p>
</div></div>
</p></li><li><span>(Optional) Enable MPLS OAM on the nodes at both ends of the dynamic associated bidirectional LSP.</span><p><p># Enable MPLS OAM for the egress on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls oam egress enable lsr-id 2.2.2.2 tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> commit</strong></pre>
<p># Enable MPLS OAM for the egress on LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> </strong><strong>mpls oam egress enable lsr-id 1.1.1.1 tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configuration, run the <strong>display mpls oam ingress all verbose</strong> command to view MPLS OAM parameter and status information on the ingress end of the dynamic associated bidirectional LSP.</p>
<p># Check the configuration on LSRA.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display mpls oam ingress all verbose</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------

Verbose information about NO.1 OAM at the ingress
--------------------------------------------------------------------------------


LSP basic information:                   OAM basic information:
--------------------------------------- ----------------------------------------
Tunnel-name         : Tunnel1            OAM-Index           : 3
Tunnel-name Index   : 1                  MEG-name Index      : 2147483651
Lsp signal status   : Up                 OAM select board    : 2
Lsp establish type  : Rsvp lsp           Enable-state        : Manual enable 
Lsp ingress lsr-id  : 1.1.1.1            Ttsi/lsr-id         : 1.1.1.1 
Lsp tnl-id          : 1                  Ttsi/tunnel-id      : 1 
Lsp-id              : 2730               Compatibility Mode  : Router Mode 

OAM detect information:                  OAM backward information:
--------------------------------------- ----------------------------------------
Type                : CV                 Share attribute     : Private 
Frequency           : 1 s                Lsp-name            : -- 
Detect State        : Start              Lsp ingress lsr-id  : 2.2.2.2 
Defect State        : Non-defect         Lsp tnl-id          : 1 
Available-state     : Available          Lsp-id              : 2732 
Unavailable time (s): 0                  Lsp-inLabel         : 2112 
Packet-priority     : 7                  Lsp signal status   : Up 
Bdi-frequency       : Detect frequency   
Hardware Error Info : No error 
BDI Defect State    : -- 

--------------------------------------------------------------------------------

Total OAM Num:                1
Total Start OAM Num:          1
Total Defect OAM Num:         0
Total Unavailable OAM Num:    0</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001842733617__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><div class="p">LSRA configuration file<pre class="screen">#
sysname LSRA
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
 mpls oam
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 traffic-eng level-1
#
interface GigabitEthernet0/2/0
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 2.2.2.2 tunnel-id 1
 mpls te tunnel-id 1
#
mpls oam ingress Tunnel1 backward-lsp lsr-id 2.2.2.2 tunnel-id 1
mpls oam ingress enable Tunnel1
mpls oam egress lsr-id 2.2.2.2 tunnel-id 1 type cv backward-lsp Tunnel1
mpls oam egress enable lsr-id 2.2.2.2 tunnel-id 1
#
return</pre>
</div>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#
sysname LSRB
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
 mpls oam
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-1
#
interface GigabitEthernet0/2/0
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.1
 mpls te reverse-lsp protocol rsvp-te ingress-lsr-id 1.1.1.1 tunnel-id 1
 mpls te tunnel-id 1
#
mpls oam ingress Tunnel1 backward-lsp lsr-id 1.1.1.1 tunnel-id 1
mpls oam ingress enable Tunnel1
mpls oam egress lsr-id 1.1.1.1 tunnel-id 1 type cv backward-lsp Tunnel1
mpls oam egress enable lsr-id 1.1.1.1 tunnel-id 1
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0016.html">Configuration Examples for MPLS OAM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mplsoam_cfg_0017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>