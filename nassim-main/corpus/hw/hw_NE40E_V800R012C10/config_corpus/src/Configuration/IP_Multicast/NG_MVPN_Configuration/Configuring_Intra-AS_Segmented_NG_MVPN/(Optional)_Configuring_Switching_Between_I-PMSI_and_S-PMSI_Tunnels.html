
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="(Optional) Configuring Switching Between I-PMSI and S-PMSI Tunnels">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0090.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0092.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0095.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001225673404">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>(Optional) Configuring Switching Between I-PMSI and S-PMSI Tunnels</title>
</head>
<body><a name="EN-US_TASK_0000001225673404"></a><a name="EN-US_TASK_0000001225673404"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">(Optional) Configuring Switching Between I-PMSI and S-PMSI Tunnels</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0000001225673404__1.3.1"></a><a name="1.3.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>On an NG MVPN, multicast data traffic is transmitted through an inclusive-provider multicast service interface (I-PMSI) tunnel to multicast users. The I-PMSI tunnel transmits multicast traffic to all PEs on the same MVPN, regardless of whether these PEs have receivers. If some PEs do not have receivers, this implementation will cause redundant traffic, wasting bandwidth resources and increasing PEs' burdens. Selective-PMSI (S-PMSI) tunnels can address the preceding issue. After multicast traffic data is switched from an I-PMSI tunnel to an S-PMSI tunnel, only PEs that have receivers can receive the traffic. Therefore, S-PMSI tunnels can prevent redundant traffic, reduce bandwidth consumption, and relieve the workload of PEs.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001225673404__1.3.2"></a><a name="1.3.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Perform the following steps on a PE to be configured as a sender PE:</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=multicast+routing-enable"><b><span class="cmdname">multicast routing-enable</span></b></a></span><p><p>Multicast routing is enabled in the VPN instance IPv4 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mvpn"><b><span class="cmdname">mvpn</span></b></a></span><p><p>The VPN instance IPv4 address family MVPN view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ipmsi-to-spmsi+switch+immediately"><b><span class="cmdname">ipmsi-to-spmsi switch immediately</span></b></a></span><p><p>Immediate switching is enabled from an I-PMSI tunnel to an S-PMSI tunnel.</p>
</p><p><p>After immediate switching from an I-PMSI tunnel to an S-PMSI tunnel is configured, upon the generation of an (S, G) entry with an MTI as the outbound interface on the sender PE, an S-PMSI tunnel is created and traffic is immediately switched from an I-PMSI tunnel to the S-PMSI tunnel.</p>
<p>Compared with the original implementation, immediate switching from an I-PMSI tunnel to an S-PMSI tunnel allows traffic corresponding to an (S, G) entry to be switched to an S-PMSI tunnel earlier, thereby reducing multicast traffic loss.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After this command is run, the switching threshold configured in the MVPN S-PMSI view does not take effect.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=spmsi-tunnel"><b><span class="cmdname">spmsi-tunnel</span></b></a></span><p><p>The MVPN S-PMSI view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=group+MVPN+S-PMSI"><b><span class="cmdname">group</span></b></a> <i><span class="varname">group-address</span></i> { <i><span class="varname">group-mask</span></i> | <i><span class="varname">group-mask-length</span></i> } [ <strong><span>source</span></strong> <i><span class="varname">source-address</span></i> { <i><span class="varname">source-mask</span></i> | <i><span class="varname">source-mask-length</span></i> } ] [ <strong><span>threshold</span></strong> <i><span class="varname">threshold-value</span></i> ] { <strong><span>mldp</span></strong> | <strong><span>rsvp-te p2mp-template</span></strong> <i><span class="varname">p2mp-te-template-name</span></i> } [ <strong><span>limit</span></strong> <i><span class="varname">number</span></i> ]</span><p><p>An address pool range and criteria for switching between I-PMSI and S-PMSI tunnels are configured.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=switch-delay"><b><span class="cmdname">switch-delay</span></b></a> <i><span class="varname">switch-delay</span></i></span><p><p>A delay is set to switch multicast traffic of the VPN instance from the I-PMSI tunnel to an S-PMSI tunnel.</p>
</p><p><p>The device starts a switchover delay timer when using the I-PMSI tunnel to transmit multicast traffic. The device keeps monitoring the multicast traffic forwarding rate before the switchover delay timer expires. If the forwarding rate is consistently higher than the specified switchover threshold throughout the timer lifecycle, the device switches multicast traffic from the I-PMSI tunnel to an S-PMSI tunnel. If the forwarding rate is consistently lower than the specified switchover threshold throughout the timer lifecycle, the device still uses the I-PMSI tunnel to transmit multicast traffic.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=holddown-time"><b><span class="cmdname">holddown-time</span></b></a> <i><span class="varname">interval</span></i></span><p><p>A delay is set for switching traffic from an S-PMSI tunnel back to the I-PMSI tunnel.</p>
</p><p><p>In some cases, the multicast traffic forwarding rate may fluctuate around the specified switchover threshold. To prevent multicast data traffic from being frequently switched between S-PMSI and I-PMSI tunnels, the device starts the switchback delay timer when the forwarding rate falls below the specified threshold rather than performing an immediate switchback. The device keeps monitoring the forwarding rate before the delay timer for the switchback from the S-PMSI tunnel expires. If the rate remains consistently lower than the threshold throughout the timer period, the device switches multicast traffic back to the I-PMSI tunnel. Otherwise, the device still uses the S-PMSI tunnel to forward multicast traffic.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Perform the following steps on each receiver PE:</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></span><p><p>The VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=multicast+routing-enable"><b><span class="cmdname">multicast routing-enable</span></b></a></span><p><p>Multicast routing is enabled in the VPN instance IPv4 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mvpn"><b><span class="cmdname">mvpn</span></b></a></span><p><p>The VPN instance IPv4 address family MVPN view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=tunnel-detect-delay"><b><span class="cmdname">tunnel-detect-delay</span></b></a> <i><span class="varname">tunnel-detect-delay</span></i></span><p><p>A delay for checking tunnel status when the bearer tunnel of VPN instance multicast data changes is configured.</p>
</p><p><p>In RSVP-TE P2MP tunnel dual-root 1+1 protection scenarios, multicast data may be switched from the primary I-PMSI tunnel to the backup I-PMSI tunnel if the S-PMSI tunnel is not ready during data switching. To resolve this problem, a tunnel status check delay timer needs to be started on the leaf PE. Before the timer expires, the leaf PE deletes the tunnel protection group and does not check the status of the primary I-PMSI or S-PMSI tunnel. When the timer expires, the leaf nodes start to check the status of the primary I-PMSI or S-PMSI tunnel again.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0090.html">Configuring Intra-AS Segmented NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0092.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0095.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>