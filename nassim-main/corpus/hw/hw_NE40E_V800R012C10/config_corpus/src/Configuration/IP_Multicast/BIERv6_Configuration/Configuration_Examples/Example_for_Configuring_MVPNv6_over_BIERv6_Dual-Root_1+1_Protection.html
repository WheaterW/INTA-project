
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MVPNv6 over BIERv6 Dual-Root 1+1 Protection">
<meta name="abstract" content="This section describes how to configure MVPNv6 over BIERv6 dual-root 1+1 protection. In this example, the unicast network type is EVPN L3VPNv6 over SRv6. Configuring multicast services on other types of unicast networks is similar to this procedure.">
<meta name="description" content="This section describes how to configure MVPNv6 over BIERv6 dual-root 1+1 protection. In this example, the unicast network type is EVPN L3VPNv6 over SRv6. Configuring multicast services on other types of unicast networks is similar to this procedure.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0051.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0313027063">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring MVPNv6 over BIERv6 Dual-Root 1+1 Protection</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0313027063"></a><a name="EN-US_TASK_0313027063"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MVPNv6 over BIERv6 Dual-Root 1+1 Protection</h1>
<div class="taskbody"><p>This section describes how to configure MVPNv6 over BIERv6 dual-root 1+1 protection. In this example, the unicast network type is EVPN L3VPNv6 over SRv6. Configuring multicast services on other types of unicast networks is similar to this procedure.</p>
<div class="context"><a name="EN-US_TASK_0313027063__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In <a href="#EN-US_TASK_0313027063__fig35284409229">Figure 1</a>, EVPN L3VPNv6 over SRv6 has been deployed. CE1 is dual-homed to the public network in active-active mode. It is required that MVPNv6 over BIERv6 services and dual-root 1+1 protection be deployed on the existing network.</p>
<div class="fignone" id="EN-US_TASK_0313027063__fig35284409229"><a name="EN-US_TASK_0313027063__fig35284409229"></a><a name="fig35284409229"></a><span class="figcap"><b>Figure 1 </b>MVPNv6 over BIERv6 dual-root 1+1 protection networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0313027064.png" width="515.8811198573228" height="421.02080127488784" title="Click to enlarge"></span></div>
<p></p>
</div></div>
<div class="context"><a name="EN-US_TASK_0313027063__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>(Optional) Configure EVPN L3VPNv6 over SRv6 and ensure that the unicast VPN runs properly. If the unicast network has been configured, skip this step.</p>
</li><li><p>Configure basic BIERv6 functions and enable IS-ISv6 for BIERv6 on Root1, Root2, P1, P2, and PE1.</p>
</li><li><p>Establish a BGP MVPN peer relationship between Root1 and PE1 and between Root2 and PE1.</p>
</li><li>Configure multicast traffic forwarding over two BIERv6 I-PMSI tunnels.</li><li>Enable the BIERv6 S-PMSI tunnel function and configure switching criteria.</li><li><p>Enable PIM on Root1, Root2, and PE1.</p>
</li><li>Configure dual-root 1+1 protection.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0313027063__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Addresses of key interfaces on each device, as shown in <a href="#EN-US_TASK_0313027063__fig35284409229">Figure 1</a></li><li>ID (1) of the public network IS-IS process, in a Level-2 area</li><li>VPN instance name (VPNA) on Root1, Root2, and PE1</li><li>PE1's BFR-ID (1), sub-domain ID (0), BSL (256), and Max-SI (0)</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0313027063__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>(Optional) Configure L3VPNv6 over SRv6.</span><p><p>This step is a part of configuring the unicast network, and its content is for reference only. In most cases, the unicast network has been configured before multicast services are deployed. If this is the case, skip this step and contact the configuration personnel for the configuration data related to the multicast services. For details about how to configure a unicast network, see <span class="uicontrol"><b>Segment Routing IPv6 Configuration</b></span> in the Configuration Guide.</p>
<p># Enable IPv6 forwarding on each interface and configure an IPv6 address for each interface. The configuration of Root1 is used as an example. The configurations of Root2, P1, P2, and PE1 are similar to the configuration of Root1. For configuration details, see <a href="#EN-US_TASK_0313027063__postreq24192593172748">Configuration Files</a> in this section. Similar details will be omitted in the rest of the document.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname Root1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:DB8:3::1 112</strong>
[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>Root1] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>Root1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>Root1-LoopBack1] <strong>ipv6 address </strong><strong>2001:db8:111::1 128</strong>
[<span class="keyword">*</span>Root1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>Root1] <strong>commit</strong></pre>
<p># Configure IS-IS. The configuration of Root1 is used as an example. The configurations of Root2, P1, P2, and PE1 are similar to the configuration of Root1. </p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>is-level level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>ipv6 enable topology ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-LoopBack1] <strong>isis ipv6 enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-LoopBack1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-LoopBack1] <strong>quit</strong></pre>
<p># Configure a VPN instance on PEs, enable the IPv6 L3VPN address family for the instance, and bind the interfaces that connect the PEs to a CE to the VPN instance. The configuration of Root1 is used as an example. The configurations of Root2 and PE1 are similar to the configuration of Root1. The <strong>vpn-target evpn</strong> and <strong>advertise l2vpn evpn</strong> commands allow EVPN routes to be used in an L3VPN and must be configured on an EVPN L3VPN network.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>multicast ipv6 mvpn ipv6-underlay </strong><strong>2001:db8:111::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>vpn-target 111:1 both evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>multicast ipv6 routing-enable</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 address 2001:DB8:1::2 112</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>router-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>ipv6-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>advertise l2vpn evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>commit</strong></pre>
<p># Establish EBGP peer relationships between the roots and CEs and between PEs and the CEs. The peer relationship establishment between Root1 and CE1 is used as an example. The peer relationship establishment between Root2 and CE1, and between PE1 and CE2 is similar to that between Root1 and CE1. </p>
<p>Establish an EBGP peer relationship on CE1.</p>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet</strong> <strong><span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 address</strong> <strong>2001:DB8:2::1 112</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>router-id 11.11.11.11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 2001:DB8:1::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>peer 2001:DB8:1::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af] <strong>quit</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>Establish an EBGP peer relationship on Root1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>ipv6-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>peer 2001:DB8:1::1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>quit</strong></pre>
<p># Establish an MP-IBGP peer relationship between Root1 and PE1 and between Root2 and PE1. The configuration of Root1 is used as an example. The configurations of Root2 and PE1 are similar to the configuration of Root1. After you run the <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer enable</span></b></a> command, enter <span class="uicontrol"><b>Y</b></span> at the system prompt to confirm the action.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-bgp] <strong>peer 2001:db8:115::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>peer </strong><strong>2001:db8:115::1</strong><strong> connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-af-evpn] <strong>peer </strong><strong>2001:db8:115::1</strong><strong> enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-af-evpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-bgp] <strong>quit</strong></pre>
<p># Configure SRv6 SIDs, and configure PEs to add SIDs to the VPN routes to be advertised. The configurations of Root1 and P1 are used as an example. The configurations of Root2 and PE1 are similar to the configuration of Root1, and the configurations of P2 are similar to the configurations of P1. The <a href="cmdqueryname=encapsulation+source-address"><b><span class="cmdname">encapsulation source-address</span></b></a> command does not need to be run on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-segment-routing-ipv6] <strong>encapsulation source-address 2001:db8:111::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-segment-routing-ipv6] <strong>locator Root1 ipv6-prefix </strong><strong>2001:db8:11::</strong><strong> 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-af-evpn] <strong>peer </strong><strong>2001:db8:115::1</strong><strong> advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>ipv6-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>segment-routing ipv6</strong><strong> </strong><strong>best-effort</strong> <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>segment-routing ipv6 locator Root1</strong> <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-6-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-bgp-6-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-isis-1] <strong>segment-routing ipv6 locator Root1 auto-sid-disable</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>segment-routing ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>encapsulation source-address </strong><strong>2001:db8:113::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>locator P1 ipv6-prefix <span>2001:db8:13::</span> 64 static 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6-locator] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing ipv6 locator P</strong><strong>1 auto-sid-disable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-isis-1] <strong>quit</strong></pre>
<p># Perform other unicast network configurations based on unicast service requirements.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In an MVPNv6 over BIERv6 scenario, if routes sent by a multicast source CE to a root node carry Source AS Extended Community and VRF Route Import Extended Community attributes and the root node needs to advertise only locally configured Source AS Extended Community and VRF Route Import Extended Community attributes among extended community attributes in the routes to be sent to a leaf node, run the <a href="cmdqueryname=attr-set"><b><span class="cmdname">attr-set</span></b></a> command in the BGP-VPN instance IPv6 address family view on the root node.</p>
</div></div>
</p></li><li><span>Configure basic BIERv6 functions and enable IS-ISv6 for BIERv6 on Root1, Root2, P1, P2, and PE1.</span><p><div class="p"># Configure Root1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier-sub-domain-0-ipv6] <strong>bfr-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier-sub-domain-0-ipv6] <strong>end-bier locator Root1 sid 2001:db8:11::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure Root2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root2] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier-sub-domain-0-ipv6] <strong>bfr-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier-sub-domain-0-ipv6] <strong>end-bier locator Root2 sid 2001:db8:12::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2] <strong>commit</strong></pre>
</div>
<div class="p"># Configure P1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bier-sub-domain-0-ipv6] <strong>end-bier locator P1 sid 2001:db8:13::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
</div>
<div class="p"># Configure P2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bier-sub-domain-0-ipv6] <strong>end-bier locator P2 sid 2001:db8:14::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
</div>
<div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>bfr-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>end-bier locator PE1 sid 2001:db8:15::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
</p></li><li><span>Establish a BGP MVPN peer relationship between Root1 and PE1 and between Root2 and PE1.</span><p><p># Configure Root1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-af-mvpn6] <strong>peer 2001:db8:115::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp-af-mvpn6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>commit</strong></pre>
<p># Configure Root2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root2-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bgp-af-mvpnv6] <strong>peer 2001:db8:115::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bgp-af-mvpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpnv6] <strong>peer 2001:db8:111::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpnv6] <strong>peer 2001:db8:112::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Check information about BGP MVPN peers. The command output shows that a BGP MVPN peer relationship has been established between PE1 and Root1 and between PE1 and Root2.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong> display bgp mvpn vpnv6 all peer</strong>

 BGP local router ID : 1.1.1.5
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:111::1                  4         100   41      43    0 00:08:08        <strong>Established</strong>      0
  2001:DB8:112::1                  4         100   29      32    0 00:07:15        <strong>Established</strong>      0</pre>
</p></li><li><span>Configure multicast traffic forwarding over two BIERv6 I-PMSI tunnels.</span><p><p># Configure Root1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>ipv6 underlay enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>src-dt6 locator Root1 sid 2001:db8:11::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>bier sub-domain 0 bsl 256</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>commit</strong></pre>
<p># Configure Root2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>ipv6 underlay enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>src-dt6 locator Root2 sid 2001:db8:12::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>bier sub-domain 0 bsl 256</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>ipv6 underlay enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Check I-PMSI tunnel information of MVPN services in a specified VPN instance. The command output shows that two I-PMSI tunnels have been established, with Root1 and Root2 as the root nodes and PE1 as a leaf node.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong>display mvpn ipv6 vpn-instance VPNA ipmsi</strong>
MVPN local I-PMSI information for VPN-Instance: VPNA
Tunnel type: BIER IPv6
Tunnel state: --
Src-dt6 SID: 2001:DB8:11::2
Sub-domain ID: 0
BFR-ID: --
BFR prefix: 2001:DB8:111::1
Root: 2001:DB8:111::1
Leaf: 
  1: 2001:DB8:115::1 (BFR-ID: 1, BFR prefix: 2001:DB8:115::1) (local)

Tunnel type: BIER IPv6
Tunnel state: --
Src-dt6 SID: 2001:DB8:12::2
Sub-domain ID: 0
BFR-ID: --
BFR prefix: 2001:DB8:112::1
Root: 2001:DB8:112::1
Leaf: 
  1: 2001:DB8:115::1 (BFR-ID: 1, BFR prefix: 2001:DB8:115::1) (local)</pre>
</p></li><li><span>Enable the BIERv6 S-PMSI tunnel function and configure switching criteria.</span><p><p># Configure Root1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>spmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>group FF3E::0 112 source 2001:db8:555::0 112 threshold 10 bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>switch-delay 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>holddown-time 80</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>commit</strong></pre>
<p># Configure Root2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>spmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>group FF3E::0 112 source 2001:db8:555::0 112 threshold 10 bier</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>switch-delay 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>holddown-time 80</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn-spmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2] <strong>commit</strong></pre>
</p></li><li><span>Enable PIM on Root1, Root2, and PE1.</span><p><p># Configure Root1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root1-GigabitEthernet<span>0/1/1</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root1] <strong>commit</strong></pre>
<p># Configure Root2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root2-GigabitEthernet<span>0/1/1</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root2] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure dual-root 1+1 protection.</span><p><p># Configure VPN FRR on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-VPNA-af-ipv6] <strong>vpn frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure C-multicast FRR in flow-based detection mode on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>acl ipv6 2111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl6-basic-2111] <strong>rule permit source any</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-acl6-basic-2111] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>c-multicast frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>c-multicast frr flow-detection-based 2111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>multicast wtr 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Check S-PMSI tunnel information of MVPN services in a specified VPN instance. The command output on PE1 shows S-PMSI tunnel and multicast user information.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1]<strong>display mvpn ipv6 vpn-instance VPNA spmsi</strong> <strong>verbose</strong>
MVPN local S-PMSI information for VPN-Instance : VPNA 
 Total number of tunnel: 2 
 S-PMSI A-D Route Type: -- 
 Tunnel type: BIER IPv6 
 Tunnel state: -- 
 Src-dt6 SID: 2001:DB8:11::1 
 Sub-domain ID: 0 
 BFR-ID: -- 
 BFR prefix: 2001:DB8:111::1 
 Root: 2001:DB8:111::1 
 Leaf: 
   1: 2001:DB8:115::1 (BFR-ID: 2, BFR prefix: 2001:DB8:115::1)(local)
 Total number of (S, G): 2 
     1. (2001:db8:555::0, FF3E::3) 
     2. (2001:db8:555::0, FF3E::4)

 Total number of tunnel: 2 
 S-PMSI A-D Route Type: -- 
 Tunnel type: BIER IPv6 
 Tunnel state: -- 
 Src-dt6 SID: 2001:DB8:12::1 
 Sub-domain ID: 0 
 BFR-ID: -- 
 BFR prefix: 2001:DB8:112::1 
 Root: 2001:DB8:112::1 
 Leaf: 
   1: 2001:DB8:115::1 (BFR-ID: 2, BFR prefix: 2001:DB8:115::1)(local)
 Total number of (S, G): 2 
     1. (2001:db8:555::0, FF3E::3) 
     2. (2001:db8:555::0, FF3E::4)</pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display pim ipv6 vpn-instance routing-table</strong> command to check the IPv6 PIM routing table. The command output shows that a backup upstream interface exists.</p>
<pre class="screen">[<font style="font-size:8pt" Face="Courier New" >~</font>PE1] display pim ipv6 all-instance routing-table mode sm outgoing-interface-number  
VPN-Instance: VPNA  
Total 0 (*, G) entries; 2 (S, G) entry   
(2001:db8:555::0, FF3E::1)           
   Protocol: pim-sm, Flag: SG_RCVRR      
   UpTime: 00:00:04      
   Upstream interface: through-BGP, Refresh time: 00:00:04          
       Upstream neighbor: 2001:DB8:111::1           
       RPF prime neighbor: 2001:DB8:111::1
   Backup upstream interface: through-BGP          
       Upstream neighbor: 2001:DB8:112::1           
       RPF prime neighbor: 2001:DB8:112::1
   Downstream interface(s) information:      
   Total number of downstreams: 1  

(2001:db8:555::0, FF3E::2)           
   Protocol: pim-sm, Flag: SG_RCVR      
   UpTime: 00:00:05      
   Upstream interface: Register, Refresh time: 00:00:05          
       Upstream neighbor: NULL          
       RPF prime neighbor: NULL      
   Backup upstream interface: through-BGP          
       Upstream neighbor: 2001:DB8:112::1           
       RPF prime neighbor: 2001:DB8:112::1
   Downstream interface(s) information:      
   Total number of downstreams: 1
</pre>
</p></li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0313027063__postreq24192593172748"></a><a name="postreq24192593172748"></a><a name="EN-US_TASK_0313027063__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p>CE1 configuration file</p>
<pre class="screen">#   
sysname CE1 
# 
multicast ipv6 routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:1::1/112
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2::1/112
 pim ipv6 sm
#
bgp 65410
 router-id 11.11.11.11
 peer 2001:DB8:1::2 as-number 100
 peer 2001:DB8:2::2 as-number 100
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:DB8:1::2 enable
  peer 2001:DB8:2::2 enable
#
return</pre>
<p>CE2 configuration file</p>
<pre class="screen"># 
sysname CE2
#
multicast ipv6 routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:9::2/112
 pim ipv6 sm
 mld enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:7::2/112
 pim ipv6 sm
#
bgp 65411
 router-id 12.12.12.12
 peer 2001:DB8:7::1 as-number 100
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:DB8:7::1 enable
#
return</pre>
<p>Root1 configuration file</p>
<pre class="screen">#                                                                               
sysname Root1                                                                   
# 
multicast ipv6 mvpn ipv6-underlay 2001:DB8:111::1                                    
#
ip vpn-instance VPNA                                                            
 ipv6-family                                                                    
  route-distinguisher 100:1                                                     
  apply-label per-instance                                                      
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 export-extcommunity                                          
  vpn-target 111:1 import-extcommunity evpn
  vpn-target 111:1 import-extcommunity                                          
  multicast ipv6 routing-enable                                                      
  mvpn                                                                          
   ipv6 underlay enable                                                         
   sender-enable                                                                
   src-dt6 locator Root1 sid 2001:DB8:11::2                                     
   ipmsi-tunnel                                                                 
    bier                                                                        
   spmsi-tunnel                                                                 
    holddown-time 80                                                            
    switch-delay 20                                                             
    group FF3E::0 112 source 2001:DB8:555::0 112 threshold 10 bier 
# 
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:111::1                                   
 locator Root1 ipv6-prefix 2001:DB8:11:: 64 static 32                                                                                 
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0001.00                                            
 bier enable                                                                    
 #                                               
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator Root1 auto-sid-disable                            
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                         
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:3::1/112                                                  
 isis ipv6 enable 1
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                         
 undo shutdown                                                                  
 ip binding vpn-instance VPNA
 ipv6 enable                                                   
 ipv6 address 2001:DB8:1::2/112                                           
 pim ipv6 sm
# 
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:111::1/128                                               
 isis ipv6 enable 1                                                             
# 
bgp 100                                                                         
 router-id 1.1.1.1                                                             
 peer 2001:DB8:115::1 as-number 100                                             
 peer 2001:DB8:115::1 connect-interface LoopBack1                               
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization                                                          
 #                                                                              
 ipv6-family mvpn                                                               
  policy vpn-target                                                             
  peer 2001:DB8:115::1 enable
 #                                                                              
 ipv6-family vpn-instance VPNA                                                  
  import-route direct
  advertise l2vpn evpn                                                           
  segment-routing ipv6 locator Root1 evpn                                            
  segment-routing ipv6 best-effort evpn
  peer 2001:DB8:1::1 as-number 65410
 #
 l2vpn-family evpn                                                              
   policy vpn-target                                                             
   peer 2001:DB8:115::1 enable
   peer 2001:DB8:115::1 advertise encap-type srv6
#
bier                                                                            
 sub-domain 0 ipv6
  bfr-id 2                                                              
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator Root1 sid 2001:DB8:11::1                                     
  encapsulation-type ipv6 bsl 256 max-si 0                                      
# 
return</pre>
<p>Root2 configuration file</p>
<pre class="screen">#                                                                               
sysname Root2                                                                   
# 
multicast ipv6 mvpn ipv6-underlay 2001:DB8:112::1                                    
#
ip vpn-instance VPNA                                                            
 ipv6-family                                                                    
  route-distinguisher 100:1                                                     
  apply-label per-instance
  vpn-target 111:1 export-extcommunit evpn
  vpn-target 111:1 import-extcommunit evpn                                         
  multicast ipv6 routing-enable                                                      
  mvpn                                                                          
   vpn-target 111:1 export-extcommunity
   vpn-target 111:1 import-extcommunity
   ipv6 underlay enable                                                         
   sender-enable                                                                
   src-dt6 locator Root2 sid 2001:DB8:12::2                                     
   ipmsi-tunnel                                                                 
    bier                                                                        
   spmsi-tunnel                                                                 
    holddown-time 80                                                            
    switch-delay 20                                                             
    group FF3E::0 112 source 2001:DB8:555::0 112 threshold 10 bier 
# 
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:112::1                                   
 locator Root2 ipv6-prefix 2001:DB8:12:: 64 static 32 
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0002.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator Root2 auto-sid-disable                            
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                         
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:4::1/112                                                  
 isis ipv6 enable 1
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                         
 undo shutdown
 ip binding vpn-instance VPNA
 ipv6 enable                                                    
 ipv6 address 2001:DB8:2::2/112                                           
 pim ipv6 sm
# 
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:112::1/128                                               
 isis ipv6 enable 1                                                             
# 
bgp 100                                                                         
 router-id 1.1.1.2                                                              
 peer 2001:DB8:115::1 as-number 100                                             
 peer 2001:DB8:115::1 connect-interface LoopBack1                               
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization                                                          
 #                                                                              
 ipv6-family mvpn                                                               
  policy vpn-target                                                             
  peer 2001:DB8:115::1 enable                                                   
 #                                                                              
 ipv6-family vpn-instance VPNA                                                  
  import-route direct
  advertise l2vpn evpn                                                           
  segment-routing ipv6 locator Root2 evpn                                            
  segment-routing ipv6 best-effort evpn 
  peer 2001:DB8:2::1 as-number 65410
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:115::1 enable
  peer 2001:DB8:115::1 advertise encap-type srv6                                             
# 
bier                                                                            
 sub-domain 0 ipv6
  bfr-id 3                                                              
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator Root2 sid 2001:DB8:12::1                                     
  encapsulation-type ipv6 bsl 256 max-si 0                                      
# 
return</pre>
<p>P1 configuration file</p>
<pre class="screen">#                                                                               
sysname P1                                                                      
# 
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:113::1                                   
 locator P1 ipv6-prefix 2001:DB8:13:: 64 static 32                              
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0003.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator P1 auto-sid-disable                               
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                         
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:3::2/112
 isis ipv6 enable 1                                                             
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                         
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:5::1/112                                                  
 isis ipv6 enable 1                                                             
# 
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:113::1/128                                               
 isis ipv6 enable 1                                                             
# 
bier                                                                            
 sub-domain 0 ipv6                                                              
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator P1 sid 2001:DB8:13::1                                        
  encapsulation-type ipv6 bsl 256 max-si 0                                      
#
return</pre>
<p>P2 configuration file</p>
<pre class="screen">#                                                                               
sysname P2                                                                      
# 
segment-routing ipv6                                                            
 encapsulation source-address 2001:DB8:114::1                                   
 locator P2 ipv6-prefix 2001:DB8:14:: 64 static 32                              
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0004.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator P2 auto-sid-disable                               
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                         
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:4::2/112
 isis ipv6 enable 1                                                             
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                         
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:6::1/112                                                  
 isis ipv6 enable 1                                                             
# 
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:114::1/128                                               
 isis ipv6 enable 1                                                             
# 
bier                                                                            
 sub-domain 0 ipv6                                                              
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator P2 sid 2001:DB8:14::1                                        
  encapsulation-type ipv6 bsl 256 max-si 0                                      
#
return</pre>
<p>PE1 configuration file</p>
<pre class="screen">#                                                                               
sysname PE1                                                                 
# 
multicast ipv6 mvpn ipv6-underlay 2001:DB8:115::1                                    
# 
ip vpn-instance VPNA                                                            
 ipv6-family                                                                    
  route-distinguisher 100:1                                                     
  vpn frr                                                                       
  apply-label per-instance                                                      
  vpn-target 111:1 export-extcommunity evpn                                        
  vpn-target 111:1 import-extcommunity evpn    
  multicast ipv6 routing-enable                                                      
  mvpn                                                                          
   vpn-target 111:1 export-extcommunity
   vpn-target 111:1 import-extcommunity
   ipv6 underlay enable
   c-multicast signaling bgp                                                    
   c-multicast frr                                                              
   c-multicast frr flow-detection-based 2111
   multicast wtr 100                                       
# 
acl ipv6 number 2111                                                                 
 rule 5 permit                                                                  
# 
segment-routing ipv6                                                                                               
 locator PE1 ipv6-prefix 2001:DB8:15:: 64 static 32                           
#                                                                               
isis 1                                                                          
 is-level level-2                                                               
 cost-style wide                                                                
 network-entity 10.0000.0000.0005.00                                            
 bier enable                                                                    
 #                                                                              
 ipv6 enable topology ipv6                                                      
 segment-routing ipv6 locator PE1 auto-sid-disable                            
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                          
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:5::2/112                                                  
 isis ipv6 enable 1 
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                       
 undo shutdown
 ip binding vpn-instance VPNA 
 ipv6 enable                                         
 ipv6 address 2001:DB8:7::1/112                                           
 pim ipv6 sm 
# 
interface GigabitEthernet<span>0/1/2</span>                                                       
 undo shutdown
 ip binding vpn-instance VPNA
 ipv6 enable  
 ipv6 address 2001:DB8:6::2/112                                           
 pim ipv6 sm 
#
interface LoopBack1                                                             
 ipv6 enable                                                                    
 ipv6 address 2001:DB8:115::1/128                                               
 isis ipv6 enable 1                                                             
# 
bgp 100                                                                         
 router-id 1.1.1.5                                                              
 peer 2001:DB8:111::1 as-number 100                                             
 peer 2001:DB8:111::1 connect-interface LoopBack1                               
 peer 2001:DB8:112::1 as-number 100                                             
 peer 2001:DB8:112::1 connect-interface LoopBack1                               
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization                                                          
 # 
 ipv6-family mvpn                                                               
  policy vpn-target                                                             
  peer 2001:DB8:111::1 enable                                                  
  peer 2001:DB8:112::1 enable                                                  
 #                                                                              
 ipv6-family vpnv6                                                              
  policy vpn-target                                                             
  peer 2001:DB8:111::1 enable                                                   
  peer 2001:DB8:111::1 prefix-sid                                               
  peer 2001:DB8:112::1 enable                                                   
  peer 2001:DB8:112::1 prefix-sid                                               
 #                                                                              
 ipv6-family vpn-instance VPNA                                                  
  import-route direct
  advertise l2vpn evpn                                                           
  segment-routing ipv6 locator PE1 evpn                                           
  segment-routing ipv6 best-effort evpn                             
  peer 2001:DB8:7::2 as-number 65411
 #
 l2vpn-family evpn
 policy vpn-target
 peer 2001:DB8:111::1 enable
 peer 2001:DB8:111::1 advertise encap-type srv6
 peer 2001:DB8:112::1 enable
 peer 2001:DB8:112::1 advertise encap-type srv6 
# 
bier                                                                            
 sub-domain 0 ipv6                                                              
  bfr-id 1                                                                      
  bfr-prefix interface LoopBack1                                                
  protocol isis                                                                 
  end-bier locator PE1 sid 2001:DB8:15::1                                     
  encapsulation-type ipv6 bsl 256 max-si 0                                      
# 
return </pre>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0023.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0050.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0051.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>