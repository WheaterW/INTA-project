
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Backup Device to Forward Multicast Data Flows Through a Backup Link">
<meta name="abstract" content="This section provides an example for configuring a backup device to forward multicast data flows through a backup link on a VPLS network. With this configuration, the backup device can forward multicast data flows immediately after the master device or primary link fails, improving service transmission reliability and minimizing service loss.">
<meta name="description" content="This section provides an example for configuring a backup device to forward multicast data flows through a backup link on a VPLS network. With this configuration, the backup device can forward multicast data flows immediately after the master device or primary link fails, improving service transmission reliability and minimizing service loss.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_063.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0069.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,l2multicastvrp,c00549182,w00556928,w00437000,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368000">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring a Backup Device to Forward Multicast Data Flows Through a Backup Link</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368000"></a><a name="EN-US_TASK_0172368000"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Backup Device to Forward Multicast Data Flows Through a Backup Link</h1>
<div class="taskbody"><p>This section provides an example for configuring a backup device to forward multicast data flows through a backup link on a VPLS network. With this configuration, the backup device can forward multicast data flows immediately after the master device or primary link fails, improving service transmission reliability and minimizing service loss.</p>
<div class="context"><a name="EN-US_TASK_0172368000__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Reliable data, voice, and video transmission is important in Internet services. Backup devices and links are generally deployed to prevent service transmission interruptions.</p>
<div class="p">As shown in <a href="#EN-US_TASK_0172368000__fig_dc_vrp_l2mc_cfg_006501">Figure 1</a>, access and aggregation rings are deployed on the MAN. End-to-end LDP LSPs are deployed between PEs. A VPLS network is established using the UPE, SPEs, and NPEs to carry multicast services, such as IPTV, on the MAN. The UPE is dual-homed to SPE1 and SPE2 over the VPLS network. SPE1 is the master SPE, and SPE2 is the backup SPE; therefore, the PW primary/backup information is as follows:<ul><li><p>Primary PW: PW between SPE1 and the UPE. This PW forwards multicast protocol and data packets when it is active.</p>
</li><li><p>Backup PW: PW between SPE2 and the UPE. Multicast protocol and data packets are blocked on the backup PW, disabling SPE2 from learning multicast forwarding entries.</p>
</li></ul>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>On this example network, the UPE, SPE1, and SPE2 are Layer 2 devices on which the function to allow a backup device to forward multicast data flows through a backup link needs to be configured.</p>
</div></div>
<p>Without this function, multicast services will be interrupted for a long time when the primary link or master device fails. This is because the backup device does not create multicast forwarding entries when the master device works properly.</p>
<p>To enable multicast traffic to be rapidly switched to the backup link or device, configure rapid multicast traffic forwarding on the UPE, SPE1, and SPE2 so that SPE2 can also learn Layer 2 multicast forwarding entries. Once the backup PW becomes the new primary PW, multicast data traffic can be forwarded immediately, ensuring normal service transmission after the upgrade.</p>
<div class="fignone" id="EN-US_TASK_0172368000__fig_dc_vrp_l2mc_cfg_006501"><a name="EN-US_TASK_0172368000__fig_dc_vrp_l2mc_cfg_006501"></a><a name="fig_dc_vrp_l2mc_cfg_006501"></a><span class="figcap"><b>Figure 1 </b>Configuring VPLS PW redundancy to carry multicast services</span><br><span><img class="vsd" src="images/fig_dc_vrp_l2mc_cfg_006501.png"></span></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 4 in this example represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Mapping between interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="33.33%" id="mcps1.4.1.9.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="36%" id="mcps1.4.1.9.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="30.669999999999998%" id="mcps1.4.1.9.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33%" headers="mcps1.4.1.9.2.4.1.1 "><p>UPE</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.9.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.10.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.20.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="33.33%" headers="mcps1.4.1.9.2.4.1.1 "><p>SPE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.10.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.30.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="33.33%" headers="mcps1.4.1.9.2.4.1.1 "><p>SPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.20.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.50.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33%" headers="mcps1.4.1.9.2.4.1.1 "><p>NPE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.9.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.30.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.60.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33%" headers="mcps1.4.1.9.2.4.1.1 "><p>NPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.9.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.50.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>192.168.60.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.9.2.4.1.3 "><p>5.5.5.5/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368000__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Assign an IP address to each interface.</li><li>Configure routing protocols to implement network-layer interconnection between PEs. In this example, OSPF is used.</li><li><p>Configure MPLS and public network tunnels to carry PWs.</p>
<p>In this example, LDP LSPs are used as tunnels between PEs.</p>
<ul><li>Enable MPLS and MPLS LDP globally on each PE.</li><li>Enable MPLS on interfaces of each PE.</li><li>Enable MPLS LDP on the ingress and egress interfaces of each LDP LSP.</li></ul>
</li><li><p>Configure PWs as follows:</p>
<ul><li>Enable MPLS L2VPN on each PE.</li><li>Create a VSI on each PE.</li><li>Specify the VSI peer on each PE. Configure two spoke PWs between the UPE and SPEs. Configure four hub PWs between the SPEs and NPEs.</li></ul>
</li><li><p>Add the PWs between the UPE and SPEs to a PW protection group for the two PWs to work in backup mode as follows:</p>
<ul><li>Configure a PW protection group on the UPE.</li><li>Configure the master/slave PW redundancy mode.</li><li>Add the PWs to the PW protection group and specify the priorities of the PWs.</li><li>Set the revertive switching delay to 60s.</li></ul>
</li><li><p>Enable IGMP snooping both globally and for a specified VSI.</p>
</li><li><div class="p">Configure the backup device to rapidly forward multicast traffic based on the learned Layer 2 multicast forwarding entries after a master/backup device or link switchover.<ul><li><p>Configure the master and backup SPEs to send to the UPE IGMP Query messages through the PWs.</p>
</li><li><p>Configure the master and backup SPEs to receive from the UPE IGMP Report/Leave messages through the PWs.</p>
</li></ul>
</div>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368000__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address, OSPF process ID (1), and OSPF area ID (0) of each interface</p>
</li><li><p>LSR ID of each node and the names and numbers of the interfaces on which LDP sessions are to be set up</p>
</li><li><p>VSI name (vsi1), member discovery mode (static), VSI signaling protocol (LDP), VSI ID (1), VSI peer IP address, AC interface types, and AC interface numbers</p>
</li><li><p>VPLS PW redundancy group name (vsi1), protection mode (master), switchback mode (delayed switchback), switchback delay (60s), and PW priorities (1 and 2)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368000__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface on the backbone network.</span></li><li><span>Configure routing protocols to implement network-layer interconnection among devices.</span><p><p>Configure OSPF on the UPE, SPEs, and NPEs to advertise the network segments and host routes of LSR IDs.</p>
<p># Configure the UPE.</p>
<pre class="screen">&lt;UPE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1-area-0.0.0.0]<strong> network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1-area-0.0.0.0]<strong> network 192.168.10.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1-area-0.0.0.0]<strong> network 192.168.20.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> commit</strong></pre>
<p># Configure the SPEs. The following example uses SPE1. The configuration on SPE2 is similar.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> network 192.168.10.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> network 192.168.30.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
<p># Configure the NPEs. The following example uses NPE1. The configuration on NPE2 is similar.</p>
<pre class="screen">&lt;NPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1-area-0.0.0.0]<strong> network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1-area-0.0.0.0]<strong> network 192.168.30.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1-area-0.0.0.0]<strong> network 192.168.60.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
</p></li><li><span>Configure basic MPLS functions and set up local MPLS LDP sessions.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>mpls ldp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> commit</strong></pre>
<p># Configure the SPEs. The following example uses SPE1. The configuration on SPE2 is similar.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>mpls ldp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure the NPEs. The following example uses NPE1. The configuration on NPE2 is similar.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>mpls ldp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>interface gigabitethernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/3</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/3</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>commit</strong></pre>
</p></li><li><span>Configure PWs.</span><p><p># Create a VSI on the UPE and specify SPE1 and SPE2 as the VSI peers.</p>
<pre class="screen">&lt;UPE&gt; <strong>system-view</strong></pre>
<p># Enable MPLS L2VPN.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-l2vpn] <strong>quit</strong></pre>
<p># Create a VSI on the UPE and configure the LDP signaling type and VSI ID.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<p># Specify VSI peers so that two PWs can be established between the UPE and SPE1, and between the UPE and SPE2.</p>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You do not need to specify the <strong><span>secondary</span></strong> parameter for the backup PW, because the PW protection group determines the primary/backup status of PWs based on PW priorities.</p>
</div></div>
<p># Create a VSI on each SPE and specify the UPE and NPEs as VSI peers. The following example uses SPE1. The configuration on SPE2 is similar.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Create a VSI on each NPE and specify the SPEs as VSI peers. The following example uses NPE1. The configuration on NPE2 is similar.</p>
<pre class="screen">&lt;NPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>commit</strong></pre>
</p></li><li><span>Add the PWs between the UPE and SPEs to a PW protection group.</span><p><p># Configure a PW protection group on the UPE and configure the PW redundancy mode as master/slave. Add the PWs to the PW protection group and specify the priorities of the PWs. Set the revertive switching delay to 60s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>protect-group vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>protect-mode pw-redundancy master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 2.2.2.2 preference 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 3.3.3.3 preference 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>reroute delay 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Before adding PWs to a PW protection group, ensure that the PW protection group already exists and its PW redundancy mode is specified. The revertive switching policy can be configured for only PW protection groups with the master/slave PW redundancy mode.</p>
</div></div>
</p></li><li><span>Enable IGMP snooping in the system view and VSI view on the UPE and SPEs.</span><p><p># Configure IGMP snooping on the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-VSI-vsi1]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-VSI-vsi1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> commit</strong></pre>
<p># Configure IGMP snooping on the SPEs. The following example uses SPE1. The configuration of SPE2 is similar to that of SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-VSI-vsi1]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-VSI-vsi1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
</p></li><li><span>Enable the UPE and SPEs to forward multicast data flows through the backup link.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE]<strong> vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>l2-multicast backup-query forward source-mac-replace</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>l2-multicast backup-report forward source-mac-replace</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE]<strong> commit</strong></pre>
<p># Configure the SPEs. The following example uses SPE1. The configuration on SPE2 is similar.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1]<strong> vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>l2-multicast backup-query forward source-mac-replace</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>l2-multicast backup-report forward source-mac-replace</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><ul><li><p>Run the <strong>display vsi name protect-group</strong> command on the UPE to check PW redundancy protection group information. The command output shows that the forwarding state is <strong>Active</strong> for the primary PW and <strong>Inactive</strong> for the backup PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] display vsi name vsi1 protect-group vsi1

Protect-group: vsi1
-------------------------------------------------------------------------------
PeerIp:VcId                Pref   Active
-------------------------------------------------------------------------------
2.2.2.2:1                  1      <strong>Active</strong>
3.3.3.3:1                  2      <strong>Inactive</strong></pre>
</li><li><p>Run the <strong>display vsi name vsi1 verbose</strong> command on the UPE to check information about the VSI and corresponding PWs. The command output shows that <strong>VSI State</strong> is <strong>up</strong>, <strong>PW State</strong> is <strong>up</strong> for the primary PW, and <strong>PW State</strong> is <strong>backup</strong> for the backup PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display vsi name vsi1 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : vsi1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : ldp
    Member Discovery Style : static
    Bridge-domain Mode     : disable
<span>    PW MAC Learning Style  : unqualify</span>
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 1 hours, 2 minutes, 50 seconds
    VSI State              : <strong>up</strong>

    VSI ID                 : 1
   *Peer Router ID         : 2.2.2.2
    primary or secondary   : primary
    Protect group          : vsi1
    Priority               : 1
    Active state           : active
    ignore-standby-state   : no
    VC Label               : 1024
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800005
    Broadcast Tunnel ID    : 0x800005
    Broad BackupTunnel ID  : 0x0
    CKey                   : 2
    NKey                   : 1
    Stp Enable             : 0
    PwIndex                : 0
    Control Word           : disable
   *Peer Router ID         : 3.3.3.3
    primary or secondary   : primary
    Protect group          : vsi1
    Priority               : 2
    Active state           : inactive
    ignore-standby-state   : no
    VC Label               : 1025
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800008
    Broadcast Tunnel ID    : 0x800008
    Broad BackupTunnel ID  : 0x0
    CKey                   : 4
    NKey                   : 3
    Stp Enable             : 0
    PwIndex                : 0
    Control Word           : disable
    Interface Name         : GigabitEthernet<span>0/1/0</span>.10
    State                  : up
    Access Port            : false
    Last Up Time           : 2011/12/16 15:14:40
    Total Up Time          : 0 days, 0 hours, 26 minutes, 16 seconds

  **PW Information:

   *Peer Ip Address        : 2.2.2.2
    PW State               : <strong>up</strong>
    Local VC Label         : 1024
    Remote VC Label        : 1024
    Remote Control Word    : disable
    PW Type                : label
    Tunnel ID              : 0x800005
    Broadcast Tunnel ID    : 0x800005
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x2
    Nkey                   : 0x1
    Main PW Token          : 0x800005
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/1</span>
    Backup OutInterface    :
    Stp Enable             : 0
    PW Last Up Time        : 2011/12/16 15:14:40
    PW Total Up Time       : 0 days, 0 hours, 26 minutes, 16 seconds
   *Peer Ip Address        : 3.3.3.3
    PW State               : <strong>backup</strong>
    Local VC Label         : 1025
    Remote VC Label        : 1024
    Remote Control Word    : disable
    PW Type                : label
    Tunnel ID              : 0x800008
    Broadcast Tunnel ID    : 0x800008
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x4
    Nkey                   : 0x3
    Main PW Token          : 0x800008
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/2</span>
    Backup OutInterface    :
    Stp Enable             : 0
    PW Last Up Time        : 2011/12/16 15:14:40
    PW Total Up Time       : 0 days, 0 hours, 26 minutes, 17 seconds </pre>
</li><li><p>If the primary PW between the UPE and SPE1 fails, service traffic will be switched to the backup PW between the UPE and SPE2 for transmission.</p>
<p>Run the <strong>display vpls forwarding-info vsi</strong> command on the UPE. The command output shows that <strong>PW State</strong> is <strong>up</strong> for the backup PW and <strong>backup</strong> for the primary PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display vpls forwarding-info vsi vsi1</strong></pre>
<pre class="screen">Total Number   : 2,        2  up,  0  down

Vsi-Name                        PeerIP          VcOrSiteId  PwState
vsi1                            2.2.2.2         1           <strong>BACKUP</strong>
vsi1                            3.3.3.3         1           <strong>UP</strong>    </pre>
</li><li><p>If the primary PW between the UPE and SPE1 recovers, service traffic will be switched back to the primary PW after the specified switchback delay expires.</p>
<p>Run the <a href="cmdqueryname=display+vpls+forwarding-info+vsi"><b><span class="cmdname">display vpls forwarding-info vsi</span></b></a> command on the UPE. The command output shows that primary PW is in UP state and the backup PW is in BACKUP state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display vpls forwarding-info vsi vsi1</strong></pre>
<pre class="screen">Total Number   : 2,        2  up,  0  down

Vsi-Name                        PeerIP          VcOrSiteId  PwState
vsi1                            3.3.3.3         1           <strong>BACKUP</strong>
vsi1                            2.2.2.2         1           <strong>UP</strong>    </pre>
</li></ul>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172368000__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#
sysname UPE
#
igmp-snooping enable
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
  protect-group vsi1
   protect-mode pw-redundancy master
   reroute delay 60
   peer 2.2.2.2 preference 1
   peer 3.3.3.3 preference 2
 igmp-snooping enable
 l2-multicast backup-query forward source-mac-replace
 l2-multicast backup-report forward source-mac-replace
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.10.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.20.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#
return</pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#
sysname SPE1
#
igmp-snooping enable
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe
  peer 4.4.4.4
  peer 5.5.5.5
 igmp-snooping enable
 l2-multicast backup-query forward source-mac-replace
 l2-multicast backup-report forward source-mac-replace
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.10.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.30.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.30.0 0.0.0.255
#
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#
sysname SPE2
#
igmp-snooping enable
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe
  peer 4.4.4.4
  peer 5.5.5.5
 igmp-snooping enable
 l2-multicast backup-query forward source-mac-replace
 l2-multicast backup-report forward source-mac-replace
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.20.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.50.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.20.0 0.0.0.255
  network 192.168.50.0 0.0.0.255
#
return
</pre>
</li><li><p>NPE1 configuration file</p>
<pre class="screen">#
sysname NPE1
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.30.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 192.168.60.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.30.0 0.0.0.255
  network 192.168.60.0 0.0.0.255
#
return </pre>
</li><li><p>NPE2 configuration file</p>
<pre class="screen">#
sysname NPE2
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls l2vpn
#
vsi vsi1
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.50.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 192.168.60.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 192.168.50.0 0.0.0.255
  network 192.168.60.0 0.0.0.255
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">Configuration Examples for Layer 2 Multicast
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_063.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0069.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>