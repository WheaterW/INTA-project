
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MVPN Extranet in the Local Route Leaking Scenario Where the Multicast Source Belongs to the Public Network Instance">
<meta name="abstract" content="This section provides an example for configuring MVPN Extranet in the local route leaking scenario where the multicast source belongs to the public network instance.">
<meta name="description" content="This section provides an example for configuring MVPN Extranet in the local route leaking scenario where the multicast source belongs to the public network instance.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2133.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2263.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001225512712">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring MVPN Extranet in the Local Route Leaking Scenario Where the Multicast Source Belongs to the Public Network Instance</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001225512712"></a><a name="EN-US_TASK_0000001225512712"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MVPN Extranet in the Local Route Leaking Scenario Where the Multicast Source Belongs to the Public Network Instance</h1>
<div class="taskbody"><p>This section provides an example for configuring MVPN Extranet in the local route leaking scenario where the multicast source belongs to the public network instance.</p>
<div class="context"><a name="EN-US_TASK_0000001225512712__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>MD MVPN supports only intra-VPN multicast service distribution. In real-world application, however, a service provider may need to provide multicast services to users in a different VPN than its own VPN. This requires inter-VPN multicast distribution.</p>
<p>In the local route leaking scenario shown in <a href="#EN-US_TASK_0000001225512712__fig_dc_vrp_multicast_cfg_226401">Figure 1</a>, the multicast source belongs to the public network instance and the receiver belongs to VPN RED. The receiver requires multicast data from the source in the public network instance. To meet this requirement, deploy MVPN extranet.</p>
<div class="fignone" id="EN-US_TASK_0000001225512712__fig_dc_vrp_multicast_cfg_226401"><a name="EN-US_TASK_0000001225512712__fig_dc_vrp_multicast_cfg_226401"></a><a name="fig_dc_vrp_multicast_cfg_226401"></a><span class="figcap"><b>Figure 1 </b>Configuring multicast VPN extranet in the scenario where the multicast source is on the public network</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE<span>0/1/0</span> and GE<span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001225832744.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001225512712__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a unicast routing protocol on the public network and enable the multicast function, ensuring normal multicast routing on the public network.</p>
</li><li><p>Configure a VPN instance named VPN RED on PE2, enable the IPv4 address family and set a Share-Group address for VPN RED, and bind the Share-Group address to an MTunnel interface. Bind the interface connecting PE2 to the corresponding CE to the VPN instance.</p>
</li><li><p>Configure a unicast routing protocol and enable the multicast function for the VPN instance to ensure that multicast routes of the VPN instance are reachable.</p>
</li><li><p>Configure a unicast routing protocol between a PE and a CE to ensure that the PE and the CE are routable.</p>
</li><li><p>On PE, bind the VPN instance to an MTunnel interface.</p>
</li><li><p>Configure a Rendezvous Point (RP) to serve the multicast groups running the multicast VPN extranet service.</p>
</li><li><p>Configure a VPN instance static route to the multicast source and another VPN instance static route to the public network RP.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p">This example does not involve the following situations:<ul><li>Multicast VPN is not supported on an interface board.</li><li>The current device is an ingress PE, and the VPN inbound interface is a logical interface.</li><li>The current device is an egress PE, and the public network inbound interface is a logical interface.</li></ul>
If any of the preceding situations exists in the actual networking, you need to enable IP multicast VPN to allow multicast traffic to be properly forwarded. For configuration details, see <a href="../ne/dc_ne_mcast_cfg_2001.html">(Optional) Enabling IP Multicast VPN</a>.</div>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001225512712__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>RD and RT of VPN RED: 300:1</p>
</li><li><p>Share-group address of VPN RED: 238.0.0.0</p>
</li><li><p>Multicast group address used by the VPN extranet: 228.0.0.1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001225512712__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure OSPF and multicast on the public network to ensure that the multicast routes on the network are reachable.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-Gigabitethernet<span>0/1/0</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-Gigabitethernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a VPN instance named VPN RED on PE2, enable the IPv4 address family and set a Share-Group address for VPN RED, and bind the Share-Group address to an MTunnel interface. Then, bind the interface that connects PE2 to the CE to the VPN instance.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>vpn-target 200:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>multicast-domain share-group 238.0.0.0 binding mtunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong>ip binding vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong>ip address 10.1.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a unicast routing protocol and enable the multicast function for VPN RED to ensure that multicast routes of the VPN instance are reachable.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 2 vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Gigabitethernet<span>0/1/0</span>] <strong>ip address 10.1.3.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Gigabitethernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Gigabitethernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.4.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 10.1.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</p></li><li><span>Configure an IP address for the MTunnel interface.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface MTunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-MTunnel1]<strong> ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-MTunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure an RP to serve the multicast VPN extranet.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Source VPN instances and receiver VPN instances support only static RPs. In addition, static RPs can be deployed only in source VPN instances.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> pim vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-RED] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-RED] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</p></li><li><span>Configure a VPN instance static route to the multicast source and another VPN instance static route to the public network RP.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ip route-static vpn-instance RED 192.168.3.2 24 192.168.2.1 public</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> ip route-static vpn-instance RED 1.1.1.1 32 192.168.2.1 public</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> ip route-static 192.168.3.2 32 gigabitethernet <span>0/1/0</span> 10.1.3.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> ip route-static 1.1.1.1 255.255.255.255 gigabitethernet <span>0/1/0</span> 10.1.3.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>By checking the configuration result, you can view that Receiver in VPN RED can receive multicast data from Source in the public network.</p>
<p>Run the <strong>display pim routing-table</strong> command on PE2 to check information about the PIM routing table. The following command output shows that the upstream interface of the RPF route selected by the PIM entry with 228.0.0.1 as the group address belongs to the public network instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance RED routing-table extranet source-vpn-instance vpn-instance public</strong></pre>
<pre class="screen"> VPN-Instance: RED
 Total 1 (*, G) entry; 2 (S, G) entries
 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 1.1.1.1 
     Protocol: pim-sm, Flag: WC 
     UpTime: 1d:00h
     Upstream interface: <strong>MCAST_Extranet(public net)</strong>
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: Gigabitethernet<span>0/1/0</span>
             Protocol: pim-sm, UpTime: 1d:00h, Expires: 00:03:12
 
 (192.168.3.2, 228.0.0.1)
     RP: 1.1.1.1 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 00:23:00
     Upstream interface: <strong>MCAST_Extranet(public net)</strong>
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: Gigabitethernet<span>0/1/0</span>
             Protocol: pim-sm, UpTime: 00:23:03, Expires: -</pre>
<p>The following command output shows that the multicast extranet receiver of the public network instance belongs to VPN RED.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim routing-table extranet receive-vpn-instance vpn-instance RED</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 2 (*, G) entries; 3 (S, G) entries
 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 1.1.1.1 
     Protocol: pim-sm, Flag: WC EXTRANET 
     UpTime: 1d:00h
     Upstream interface: Gigabitethernet<span>0/1/1</span>
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information: none

     <strong>Extranet receiver(s): 1</strong>
        <strong>1: RED</strong>
 
 (192.168.3.2, 228.0.0.1)
     RP: 1.1.1.1 
     Protocol: pim-sm, Flag: SPT EXTRANET 
     UpTime: 00:28:19
     Upstream interface: Gigabitethernet<span>0/1/1</span>
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information: none

     <strong>Extranet receiver(s): 1</strong>
        <strong>1: RED</strong></pre>
<p>Run the <strong>display multicast routing-table</strong> command on PE2 to check information about the multicast routing table. The following command output shows that the upstream interface of the RPF route selected by the multicast route entry with 228.0.0.1 as the group address belongs to the public network instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display multicast vpn-instance RED routing-table extranet source-vpn-instance vpn-instance public</strong></pre>
<pre class="screen">Multicast routing table of VPN instance: RED
 Total 0 (*, G) entry; 1 (S, G) entry, 1 matched
 
 00001: (192.168.3.2, 228.0.0.1)
       Uptime: 00:21:13     
       Upstream Interface: <strong>MCAST_Extranet(public net)</strong>
       List of 1 downstream interface
           1: Gigabitethernet<span>0/1/0</span></pre>
<p>Run the <strong>display multicast rpf-info</strong> command on PE2 to check information about the RPF route with 192.168.3.2 as the multicast source address. The following command output shows that the upstream interface of the RPF route selected by the multicast route entry with 228.0.0.1 as the group address belongs to the public network instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display multicast vpn-instance RED rpf-info 192.168.3.2 228.0.0.1</strong></pre>
<pre class="screen"> VPN-Instance: RED
 RPF information about source 192.168.3.2 and group 228.0.0.1
     RPF interface: <strong>MCAST_Extranet</strong>
     <strong>RPF Source VPN-Instance: public net</strong>
     Referenced route/mask: 192.168.3.0/24
     Referenced route type: unicast
     Route selection rule: preference-preferred
     Load splitting rule: disable</pre>
<p>After the preceding configurations, Receiver can receive multicast data from Source. Run the <strong>display pim routing-table</strong> command on CE1 to check information about the PIM routing table. The following command output shows that multicast data has reached CE1 and has been forwarded to the receiver.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 1.1.1.1 
     Protocol: pim-sm, Flag: WC 
     UpTime: 1d:04h     
     Upstream interface: Gigabitethernet<span>0/1/0</span>, Refresh time: 1d:04h
         Upstream neighbor: 10.1.3.1
         RPF prime neighbor: 10.1.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: Gigabitethernet<span>0/1/1</span>
             Protocol: static, UpTime: 1d:04h, Expires: - 

 (192.168.3.2, 228.0.0.1)
     RP: 1.1.1.1 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 00:00:19     
     Upstream interface: Gigabitethernet<span>0/1/0</span>, Refresh time: 00:00:19
         Upstream neighbor: 10.1.3.1
         RPF prime neighbor: 10.1.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: Gigabitethernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:00:19, Expires: - </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001225512712__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
multicast routing-enable
#
interface gigabitethernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 pim sm
#
interface gigabitethernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 192.168.3.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 pim sm
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
#
pim 
 static-rp 1.1.1.1
#
return </pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
multicast routing-enable
#
interface gigabitethernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 pim sm
#
interface gigabitethernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 pim sm
#
ospf 1
 area 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
pim
 static-rp 1.1.1.1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast routing-enable
#
ip vpn-instance RED
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 200:1 export-extcommunity
  vpn-target 200:1 import-extcommunity
multicast routing-enable
  multicast-domain share-group 238.0.0.0 binding mtunnel 1
#
interface gigabitethernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
#
interface gigabitethernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip binding vpn-instance RED
 ip address 10.1.3.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 pim sm
#
interface MTunnel1
 ip binding vpn-instance RED
 ip address 3.3.3.3 255.255.255.0
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
ospf 2 vpn-instance RED
 import-route direct
 import-route static
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
#
pim
 static-rp 1.1.1.1
#
pim vpn-instance RED
 static-rp 1.1.1.1
#
 ip route-static vpn-instance RED 1.1.1.1 255.255.255.255 192.168.2.1 public
 ip route-static vpn-instance RED 192.168.3.0 255.255.255.0 192.168.2.1 public
#
return
</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast routing-enable
#
interface gigabitethernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 pim sm
#
interface gigabitethernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 pim sm
 igmp enable    
 igmp static-group 228.0.0.1
 #
ospf 2
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 10.1.4.0 0.0.0.255
#
pim
 static-rp 1.1.1.1
#
 ip route-static 1.1.1.1 255.255.255.255 Gigabitethernet<span>0/1/0</span> 10.1.3.1
 ip route-static 192.168.3.2 255.255.255.255 Gigabitethernet<span>0/1/0</span> 10.1.3.1
#
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2133.html">Configuration Examples for an IPv4 Multicast VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2263.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>