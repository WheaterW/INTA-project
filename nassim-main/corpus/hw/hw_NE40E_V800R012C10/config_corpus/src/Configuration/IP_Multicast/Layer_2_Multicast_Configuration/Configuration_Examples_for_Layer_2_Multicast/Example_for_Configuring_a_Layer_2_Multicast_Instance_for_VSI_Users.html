
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Layer 2 Multicast Instance for VSI Users">
<meta name="abstract" content="This section provides an example for configuring a Layer 2 multicast instance based on the VSI in a typical VPLS network.">
<meta name="description" content="This section provides an example for configuring a Layer 2 multicast instance based on the VSI in a typical VPLS network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0069.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_mld_snooping_l2l3vpn_packet_encapsulation.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,l2multicastvrp,c00549182,w00556928,w00437000,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368006">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Layer 2 Multicast Instance for VSI Users</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368006"></a><a name="EN-US_TASK_0172368006"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Layer 2 Multicast Instance for VSI Users</h1>
<div class="taskbody"><p>This section provides an example for configuring a Layer 2 multicast instance based on the VSI in a typical VPLS network.</p>
<div class="context"><a name="EN-US_TASK_0172368006__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In traditional multicast on-demand mode, if users in different VPLS domains order multicast data from the same multicast source through a device, the device has to send a copy of multicast data for each user. This wastes bandwidth resources and burdens the upstream device. On the network shown in <a href="#EN-US_TASK_0172368006__fig_dc_vrp_l2mc_cfg_007001">Figure 1</a>, PE1 and PE2 connect to users. PE1 and PE2 are connected over a VPLS network. If users in different VSIs require the same multicast data flow, PE2 needs to send the same multicast data flow to each VSI on PE1.</p>
<p>To save bandwidth resources on PE1 and PE2, configure a Layer 2 multicast instance. After a Layer 2 multicast instance is configured, PE2 sends only one copy of multicast data to PE1, and PE1 replicates the multicast data to the VPLS domains to which users belong. In addition, different multicast services can have their own channels specified so that different users can join the channels.</p>
<div class="fignone" id="EN-US_TASK_0172368006__fig_dc_vrp_l2mc_cfg_007001"><a name="EN-US_TASK_0172368006__fig_dc_vrp_l2mc_cfg_007001"></a><a name="fig_dc_vrp_l2mc_cfg_007001"></a><span class="figcap"><b>Figure 1 </b>Configuring a Layer 2 multicast instance for VSI users</span><br><span><img class="vsd" src="images/fig_dc_vrp_l2mc_cfg_007001.png"></span></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1, interface 2, interface 1.1, interface 1.2, and interface 1.3 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/1/0</span>.1, GE<span>0/1/0</span>.2, and GE<span>0/1/0</span>.3, respectively.</p>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368006__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign IP addresses for interfaces and configure basic MPLS functions to ensure the VPLS network connectivity.</p>
</li><li><p>Configure VSIs and enable basic IGMP snooping functions.</p>
</li><li><p>Configure static Layer 2 multicast groups for VSIs.</p>
</li><li><p>Create a Layer 2 multicast instance.</p>
</li><li><p>Specify a channel for the Layer 2 multicast instance.</p>
</li><li><p>Configure the multicast instance and user instances for the Layer 2 multicast instance.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368006__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface IP addresses (including the loopback interface addresses) and IS-IS process ID</p>
</li><li><p>Multicast channel addresses and static multicast group addresses</p>
</li><li><p>Name of the VSI to be configured as the multicast instance, and names of the VSIs to be configured as user instances</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368006__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses and IS-IS for GE<span>0/2/0</span> on PE1, GE<span>0/2/0</span> on PE2, and P.</span><p><p># Configure IP addresses and IS-IS on PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> ip address 192.168.0.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> network-entity 49.0010.0100.1001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> isis enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> isis enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1]<strong> quit</strong></pre>
</p><p><p># Configure IP addresses and IS-IS on PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1]<strong> ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> ip address 192.168.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1]<strong> is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1]<strong> network-entity 49.0020.0200.2002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> isis enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1]<strong> isis enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-LoopBack1]<strong> quit</strong></pre>
</p><p><p># Configure IP addresses and IS-IS on the P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1]<strong> ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> ip address 192.168.0.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> ip address 192.168.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1]<strong> is-level level-1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1]<strong> network-entity 49.0030.0300.3003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1]<strong> isis enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> isis enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> isis enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure basic MPLS functions and LDP on PE1, PE2, and the P.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Specify the remote peer and its IP address on PEs at both ends of a remote LDP session.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls ldp remote-peer PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-PE2]<strong> remote-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-PE2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp-remote-PE2]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong>mpls ldp remote-peer PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-PE1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-PE1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp-remote-PE1] <strong>quit</strong></pre>
</p></li><li><span>Verify the MPLS configuration.</span><p><p>After completing the configurations, run the <a href="cmdqueryname=display+mpls+ldp+session"><b><span class="cmdname">display mpls ldp session</span></b></a> command on PE1 and PE2. A remote LDP session has been established successfully between PE1 and PE2 if the command output shows the session status as <strong>Operational</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[PE1]<strong> display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 A '*' before a session means the session is being deleted.
 ------------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 ------------------------------------------------------------------------------
 3.3.3.3:0          <strong>Operational</strong> DU   Passive  0001:00:04  5780/5780
 2.2.2.2:0          <strong>Operational</strong> DU   Passive  0001:03:17  6552/6552
 ------------------------------------------------------------------------------
 TOTAL: 2 session(s) Found.</pre>
<p>Run the <a href="cmdqueryname=display+mpls+ldp+remote-peer"><b><span class="cmdname">display mpls ldp remote-peer</span></b></a> command on PE1 and PE2 to check remote peer information.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[PE1]<strong> display mpls ldp remote-peer</strong></pre>
<pre class="screen">                          LDP Remote Entity Information
 ------------------------------------------------------------------------------
 Remote Peer Name  : peb
 Description       : ----
 Remote Peer IP    : <strong>2.2.2.2</strong>            LDP ID        : 1.1.1.1:0
 Transport Address : <strong>1.1.1.1</strong>            Entity Status : Active

 Configured Keepalive Hold Timer : 45 Sec
 Configured Keepalive Send Timer : ---
 Configured Hello Hold Timer     : 45 Sec
 Negotiated Hello Hold Timer     : 45 Sec
 Configured Hello Send Timer     : ---
 Configured Delay Timer          : 10 Sec
 Hello Packet sent/received      : 6562/6561
 Label Advertisement Mode        : Downstream Unsolicited
 Auto-config                     : ----
 Manual-config                   : effective
 Session-Protect effect          : NO
 Session-Protect Duration        : Duration
 Session-Protect Remain          : ----
 ------------------------------------------------------------------------------
 TOTAL: 1 Peer(s) Found.</pre>
</p></li><li><span>Enable MPLS L2VPN and configure VSIs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi mtv3 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-mtv3]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-mtv3-ldp]<strong> vsi-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-mtv3-ldp]<strong> peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-mtv3-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-mtv3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi utv2 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv2]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv2-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv2-ldp]<strong> peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv2-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi utv1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv1]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv1-ldp]<strong> vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv1-ldp]<strong> peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-utv1-ldp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-utv1-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-utv1]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vsi mtv3 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-mtv3]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-mtv3-ldp]<strong> vsi-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-mtv3-ldp]<strong> peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-mtv3-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-mtv3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vsi utv2 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv2]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv2-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv2-ldp]<strong> peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv2-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vsi utv1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv1]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv1-ldp]<strong> vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv1-ldp]<strong> peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-utv1-ldp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vsi-utv1-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vsi-utv1]<strong> quit</strong></pre>
</p></li><li><span>Enable IGMP snooping on PE1.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
</p></li><li><span>On PE1 and PE2, bind sub-interfaces to VSIs. On PE1, configure Layer 2 static multicast groups for the sub-interface bound to the VSI named utv1 and for that bound to the VSI named utv2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vlan 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vlan3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span>.3</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.3]<strong> vlan-type dot1q 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.3]<strong> l2 binding vsi mtv3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vlan 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vlan11]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> l2 binding vsi utv1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> l2-multicast static-group group-address 226.0.0.1 vsi utv1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vlan 22</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vlan22]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.2]<strong> vlan-type dot1q 22</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2]<strong> l2 binding vsi utv2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2]<strong> l2-multicast static-group group-address 226.0.0.1 vsi utv2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>.2]<strong> quit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vlan 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vlan3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span>.3</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>.3]<strong> vlan-type dot1q 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.3]<strong> l2 binding vsi mtv3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vlan 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vlan11]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> vlan-type dot1q 11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> l2 binding vsi utv1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vlan 22</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vlan22]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span>.2</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>.2]<strong> vlan-type dot1q 22</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.2]<strong> l2 binding vsi utv2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>.2]<strong> quit</strong></pre>
</p></li><li><span>After completing the configurations, run the <a href="cmdqueryname=display+vsi"><b><span class="cmdname">display vsi</span></b></a> command to check VSI status.</span><p><p>The following example uses the command output on PE1. The command output shows that all the VSIs are Up.</p>
<pre class="screen">[PE1]<strong> display vsi</strong></pre>
<pre class="screen">Total VSI number is 3, 3 is up, 0 is down, 3 is LDP mode, 0 is BGP mode

Vsi                             Mem    PW   Mac       Encap     Mtu   Vsi
Name                            Disc   Type Learn     Type      Value State
--------------------------------------------------------------------------
mtv3                            static ldp  unqualify vlan      1500  <strong>up</strong>
utv2                            static ldp  unqualify vlan      1500  <strong>up</strong>
utv1                            static ldp  unqualify vlan      1500  <strong>up</strong></pre>
</p></li><li><span>On PEs, enable IGMP snooping for the VSI named <strong>mtv3</strong>.</span><p><p># On PE1, enable IGMP snooping.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vsi mtv3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-VSI-mtv3]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-VSI-mtv3]<strong> quit</strong></pre>
<p># On PE2, enable IGMP snooping.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vsi mtv3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-VSI-mtv3]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-VSI-mtv3]<strong> quit</strong></pre>
</p></li><li><span>Create a Layer 2 multicast instance and enter the instance view.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> l2-multicast instance 1</strong></pre>
</p></li><li><span>Specify a multicast channel for the Layer 2 multicast instance.</span><p><pre class="screen">[<span class="keyword">*</span>PE1-l2-minst1]<strong> import-channel 226.0.0.0 24</strong></pre>
</p></li><li><span>Configure a VSI as the multicast instance for the Layer 2 multicast instance.</span><p><pre class="screen">[<span class="keyword">*</span>PE1-l2-minst1]<strong> multicast-instance vsi mtv3</strong></pre>
</p></li><li><span>Configure VSIs as user instances for the Layer 2 multicast instance.</span><p><pre class="screen">[<span class="keyword">*</span>PE1-l2-minst1]<strong> user-instance vsi utv1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2-minst1]<strong> user-instance vsi utv2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2-minst1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-l2-minst1]<strong> quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After completing the configurations, run the <a href="cmdqueryname=display+l2-multicast+instance"><b><span class="cmdname">display l2-multicast instance</span></b></a> command on PE1 to check information about the multicast instance, user instances, and channel of the Layer 2 multicast instance.</p>
<pre class="screen">[PE1] <strong>display l2-multicast instance</strong></pre>
<pre class="screen"><strong>L2-multicast instance ID: 1</strong>
Multicast-instance: VSI mtv3
Multicast channels: 
 226.0.0.0/24
User-instance count: 2
User-instance List: 
VSI List:
 VSI utv1
 VSI utv2
</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172368006__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
vlan batch 3 11 22
#
igmp-snooping enable
#
mpls lsr-id 1.1.1.1
 mpls
#
mpls l2vpn
#
vsi mtv3 static
 pwsignal ldp
  vsi-id 3
  peer 2.2.2.2
 igmp-snooping enable
#
vsi utv2 static
 pwsignal ldp
  vsi-id 2
  peer 2.2.2.2
#
vsi utv1 static
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
#
mpls ldp
#
 mpls ldp remote-peer pe2
 remote-ip 2.2.2.2
isis 1
 is-level level-1
 network-entity 49.0010.0100.1001.00
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 11
 l2 binding vsi utv1
 l2-multicast static-group group-address 226.0.0.1 vsi utv1
#
interface GigabitEthernet<span>0/1/0</span>.2
 vlan-type dot1q 22
 l2 binding vsi utv2
 l2-multicast static-group group-address 226.0.0.1 vsi utv2
#
interface GigabitEthernet<span>0/1/0</span>.3
 vlan-type dot1q 3
 l2 binding vsi mtv3
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.0.1 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
l2-multicast instance 1
 multicast-instance vsi mtv3
 import-channel 226.0.0.0 255.255.255.0
 user-instance vsi utv2
 user-instance vsi utv1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
vlan batch 3 11 22
#
igmp-snooping enable
#
mpls lsr-id 2.2.2.2
 mpls
#
mpls l2vpn
#
vsi mtv3 static
 pwsignal ldp
  vsi-id 3
  peer 1.1.1.1
 igmp-snooping enable
#
vsi utv2 static
 pwsignal ldp
  vsi-id 2
  peer 1.1.1.1
#
vsi utv1 static
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1
#
mpls ldp
#
mpls ldp remote-peer pe1
 remote-ip 1.1.1.1
#
isis 1
 is-level level-1
 network-entity 49.0020.0200.2002.00
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 11
 l2 binding vsi utv1
#
interface GigabitEthernet<span>0/1/0</span>.2
 vlan-type dot1q 22
 l2 binding vsi utv2
#
interface GigabitEthernet<span>0/1/0</span>.3
 vlan-type dot1q 3
 l2 binding vsi mtv3
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 3.3.3.3
 mpls
#
mpls ldp
#
isis 1
 is-level level-1
 network-entity 49.0030.0300.3003.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.0.2 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">Configuration Examples for Layer 2 Multicast
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0069.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_mld_snooping_l2l3vpn_packet_encapsulation.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>