
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Policy for Receiving MBGP Routes">
<meta name="abstract" content="MBGP filters received routes by using a policy. Only the routes that match the policy can be added to a routing table.">
<meta name="description" content="MBGP filters received routes by using a policy. Only the routes that match the policy can be added to a routing table.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1019.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1021.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="MBGP">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172367055">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Policy for Receiving MBGP Routes</title>
</head>
<body><a name="EN-US_TASK_0172367055"></a><a name="EN-US_TASK_0172367055"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Policy for Receiving MBGP Routes</h1>
<div class="taskbody"><p>MBGP filters received routes by using a policy. Only the routes that match the policy can be added to a routing table.</p>
<div class="context"><a name="EN-US_TASK_0172367055__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>MBGP can apply a routing policy to all received routes or only routes received from a specific peer or peer group.</p>
<p>MBGP provides peer-specific route control to limit the number of routes received from a peer or peer group. If a device is under malicious attacks or some network configurations are incorrect, the device will receive a large number of routes from its MBGP peers, consuming resources. Therefore, you need to limit resources consumed by MBGP devices based on network planning and device capacities.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172367055__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure MBGP to filter all received routes.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family+multicast"><b><span class="cmdname">ipv4-family multicast</span></b></a> command to enter the BGP-IPv4 multicast address family view, or run the <strong><a href="cmdqueryname=ipv4-multicast+vpn-instance"><b><span class="cmdname">ipv4-multicast vpn-instance</span></b></a> </strong><em><i><span class="varname">vpn-instance-name</span></i></em> command to enter the BGP-multicast VPN instance IPv4 address family view.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=filter-policy"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> | <strong><span>ip-prefix</span></strong> <i><span class="varname">ip-prefix-name</span></i> } <a href="cmdqueryname=import"><b><span class="cmdname">import</span></b></a></span><p><p>A policy is configured to filter the routes received from all MBGP peers.</p>
</p><p><p>Routes exchanged between the device and any of its MBGP peers can thus be controlled.</p>
</p><p><ul><li><i><span class="varname">basic-acl-number or acl-name acl-name: specifies an ACL.</span></i></li><li><i><span class="varname">ip-prefix-name</span></i>: specifies an IP prefix list.</li><li><strong><span>import</span></strong>: filters routes received from any MBGP peers. Only the routes that pass the filtering are permitted.</li></ul>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure MBGP to filter routes received from a specific peer or peer group.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family+multicast"><b><span class="cmdname">ipv4-family multicast</span></b></a> command to enter the BGP-IPv4 multicast address family view, or run the <strong><a href="cmdqueryname=ipv4-multicast+vpn-instance"><b><span class="cmdname">ipv4-multicast vpn-instance</span></b></a> </strong><em><i><span class="varname">vpn-instance-name</span></i></em> command to enter the BGP-multicast VPN instance IPv4 address family view.</span></li><li class="substepexpand"><span>Run the following commands as needed to configure MBGP to use different filters to filter routes received from peers:</span><p><ul><li><p>To use an ACL for route filtering, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peer-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=filter-policy"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">basic-acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>import</span></strong> command.</p>
</li><li><p>To use the AS_Path filter for route filtering, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peer-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=as-path-filter"><b><span class="cmdname">as-path-filter</span></b></a> { <i><span class="varname">as-path-filter-number</span></i> | <i><span class="varname">as-path-filter-name</span></i> } <strong><span>import</span></strong> command.</p>
</li><li><p>To use a prefix list for route filtering, run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">peer-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=ip-prefix"><b><span class="cmdname">ip-prefix</span></b></a> <i><span class="varname">ip-prefix-name</span></i> <strong><span>import</span></strong> command.</p>
</li></ul>
<p>A peer group and its members can use different inbound policies when receiving routes. This means that each member in a peer group can select its own policy to filter received routes.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Limit the number of routes received from peers.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family+multicast"><b><span class="cmdname">ipv4-family multicast</span></b></a> command to enter the BGP-IPv4 multicast address family view, or run the <strong><a href="cmdqueryname=ipv4-multicast+vpn-instance"><b><span class="cmdname">ipv4-multicast vpn-instance</span></b></a> </strong><em><i><span class="varname">vpn-instance-name</span></i></em> command to enter the BGP-multicast VPN instance IPv4 address family view.</span></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">peer-address</span></i> } <a href="cmdqueryname=route-limit"><b><span class="cmdname">route-limit</span></b></a> <i><span class="varname">maximum-limit</span></i> [ <i><span class="varname">percentage</span></i> ] [ <strong><span>alert-only</span></strong> | <strong><span>idle-forever</span></strong> | <strong><span>idle-timeout</span></strong> <i><span class="varname">minutes</span></i> ]</span></span><p><p>The number of routes that can be received from a peer or peer group is set.</p>
<p>The command provides peer-specific control. You can set specific parameters as needed to control the MBGP device's behaviors after the number of the routes received from a peer exceeds the limit.</p>
<ul><li><p>If <strong><span>alert-only</span></strong> is set, the device does not end the peer relationship but does not receive any subsequent routes after the number of received routes exceeds the limit. In addition, the device generates an alarm and a log.</p>
</li><li><p>If <strong><span>idle-forever</span></strong> is set, the device ends the peer relationship, and does not attempt to establish a connection. In addition, the device generates an alarm and a log. If you run the <a href="cmdqueryname=display+bgp+multicast+peer"><b><span class="cmdname">display bgp multicast peer</span></b></a> [ <strong><span>verbose</span></strong> ] command, you will see that the peer relationship is in the Idle state. To restore the MBGP connection, run the <a href="cmdqueryname=reset+bgp"><b><span class="cmdname">reset bgp</span></b></a> command.</p>
</li><li><p>If <strong><span>idle-timeout</span></strong> is set, the device ends the peer relationship, and attempts to re-establish the connection after the corresponding timer expires. In addition, the device generates an alarm and a log. If you run the <a href="cmdqueryname=display+bgp+multicast+peer"><b><span class="cmdname">display bgp multicast peer</span></b></a> [ <strong><span>verbose</span></strong> ] command, you will see that the peer relationship is in the Idle state. To restore the MBGP connection before the timer expires, run the <a href="cmdqueryname=reset+bgp"><b><span class="cmdname">reset bgp</span></b></a> command.</p>
</li><li><p>If none of the preceding parameters are set, the device ends the peer relationship, and attempts to establish a connection after 30 seconds. In addition, the device generates an alarm and a log.</p>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the number of routes received by a <span class="keyword">Router</span> exceeds the upper threshold and the <a href="cmdqueryname=peer+route-limit"><b><span class="cmdname">peer route-limit</span></b></a> command is used for the first time, the <span class="keyword">Router</span> and its peer re-establish the peer relationship, regardless of whether <strong><span>alert-only</span></strong> is specified.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1018.html">Configuring MBGP Routing Policies
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1019.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_1021.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>