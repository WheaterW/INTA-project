
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NG MVPN Extranet in the Local Route Leaking Scenario Where the Source and Receiver VPN Instances Reside on the Same PE">
<meta name="abstract" content="This section provides an example for configuring NG MVPN extranet in the local route leaking scenario.">
<meta name="description" content="This section provides an example for configuring NG MVPN extranet in the local route leaking scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0122.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0125.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001270153557">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring NG MVPN Extranet in the Local Route Leaking Scenario Where the Source and Receiver VPN Instances Reside on the Same PE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001270153557"></a><a name="EN-US_TASK_0000001270153557"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NG MVPN Extranet in the Local Route Leaking Scenario Where the Source and Receiver VPN Instances Reside on the Same PE</h1>
<div class="taskbody"><p>This section provides an example for configuring NG MVPN extranet in the local route leaking scenario.</p>
<div class="context"><a name="EN-US_TASK_0000001270153557__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In NG MVPN applications, a service provider in a VPN may need to provide multicast services for users in other VPNs. Therefore, multicast services need to be distributed across VPNs.</p>
<p>In the local route leaking scenario of single-AS NG MVPN shown in <a href="#EN-US_TASK_0000001270153557__fig_dc_vrp_cfg_ngmvpn_012301">Figure 1</a>, the receiver in VPN RED requires multicast data from the source in VPN BLUE. To meet this requirement, deploy NG MVPN extranet.</p>
<div class="fignone" id="EN-US_TASK_0000001270153557__fig_dc_vrp_cfg_ngmvpn_012301"><a name="EN-US_TASK_0000001270153557__fig_dc_vrp_cfg_ngmvpn_012301"></a><a name="fig_dc_vrp_cfg_ngmvpn_012301"></a><span class="figcap"><b>Figure 1 </b>Configuring NG MVPN extranet in the local route leaking scenario where the source and receiver VPN instances reside on the same PE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001225833724.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270153557__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic single-AS NG MVPN functions.</p>
</li><li><p>Configure a rendezvous point (RP) to serve the NG MVPN extranet.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270153557__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>RD of VPN BLUE: 100:1; VPN target of VPN BLUE: 100:1</p>
</li><li><p>RD of VPN RED: 200:1; VPN targets of VPN RED: 200:1 and 100:1</p>
</li><li><p>Multicast group address used by the NG MVPN extranet: 228.0.0.1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001270153557__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic single-AS NG MVPN functions.</span><ol type="a"><li class="substepexpand"><span>Configure basic MPLS functions and MPLS LDP and set up LDP LSPs on the public network.</span><p><p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure unicast OSPF and multicast on the public network to ensure that the multicast routes on the network are reachable.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>] <strong>ip address 192.168.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>On PE2, configure a VPN instance, enable the IPv4 address family for the VPN instance, and bind the interface that connects PE2 to the corresponding CE to the VPN instance.</span><p><p># On PE2, create VPN BLUE, enable multicast globally and the IPv4 address family for VPN BLUE, and bind PE2's GE <span>0/1/0</span> connected to CE1 to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>vpn-target 100:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4-mvpn-ipmsi] <strong>mldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># On PE2, create VPN RED, enable multicast globally and the IPv4 address family for VPN RED, and bind PE2's GE <span>0/1/2</span> connected to CE2 to VPN RED. Import routes from VPN BLUE into VPN RED.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>vpn-target 200:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4-mvpn] <strong>multicast extranet select-rpf vpn-instance BLUE group 228.0.0.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>ip binding vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>ip address 10.1.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a unicast routing protocol and enable the multicast function for VPN BLUE and VPN RED to ensure that multicast routes of the VPN instances are reachable.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoppBack1] <strong>ip address 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoppBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoppBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>ospf 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-3] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-3-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-3-area-0.0.0.0] <strong>network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-3-area-0.0.0.0] <strong>network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-3-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>ip address 10.1.3.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.4.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>network 10.1.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish MP-IBGP peer relationships between PEs, and configure a unicast routing protocol between PEs and corresponding CEs to ensure routing between the PEs and CEs.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-BLUE] <strong>import-route ospf 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-BLUE] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-BLUE]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-RED] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-RED] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-RED]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4]<strong> peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf 2 vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf 3 vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-3] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-3] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-3-area-0.0.0.0] <strong>network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-3-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure an RP to serve the NG MVPN extranet.</span><p><ul><li><p># In the VPN BLUE and VPN RED views on CE1, CE2, and PE2, configure CE1's loopback 1 as a static RP to serve the NG MVPN extranet.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Source and receiver VPN instances support only static RPs. The routes to a static RP and source must be in the same VPN instance.</p>
</div></div>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> pim vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-BLUE] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-BLUE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> pim vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-RED] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-RED] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Verify the configuration.</span><p><p>By checking the configuration, you can view that the receiver in VPN RED can receive multicast data from the source in VPN BLUE.</p>
<p>Run the <strong>display pim routing-table</strong> command on PE2 to check information about the PIM routing table. The following command output shows that the upstream interface of the RPF route selected by the PIM entry with 228.0.0.1 as the group address belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance RED routing-table extranet source-vpn-instance vpn-instance BLUE</strong></pre>
<pre class="screen"> VPN-Instance: RED
 Total 1 (*, G) entry; 1 (S, G) entry
 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: WC 
     UpTime: 00:03:05
     Upstream interface: <strong>MCAST_Extranet(BLUE)</strong>, Refresh time: 00:03:05
         Upstream neighbor: 10.1.2.1
         RPF prime neighbor: 10.1.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/2</span>
             Protocol: pim-sm, UpTime: 00:03:05, Expires: 00:03:26
 
 (10.1.1.2, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 00:00:02
     Upstream interface: <strong>MCAST_Extranet(BLUE)</strong>, Refresh time: 00:00:02
         Upstream neighbor: 10.1.2.1
         RPF prime neighbor: 10.1.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/2</span>
             Protocol: pim-sm, UpTime: 00:00:06, Expires: -</pre>
<p>The following command output shows that the multicast extranet receiver of VPN BLUE belongs to VPN RED.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance BLUE routing-table extranet receive-vpn-instance vpn-instance RED</strong></pre>
<pre class="screen"> VPN-Instance: BLUE
 Total 1 (*, G) entry; 1 (S, G) entry
 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: WC EXTRANET 
     UpTime: 00:06:16
     Upstream interface: GigabitEthernet<span>0/1/0</span>, Refresh time: 00:06:16
         Upstream neighbor: 10.1.2.1
         RPF prime neighbor: 10.1.2.1
     Downstream interface(s) information: none

     <strong>Extranet receiver(s): 1</strong>
        <strong>1: RED</strong>
 
 (10.1.1.2, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 00:03:13
     Upstream interface: GigabitEthernet<span>0/1/0</span>, Refresh time: 00:03:13
         Upstream neighbor: 10.1.2.1
         RPF prime neighbor: 10.1.2.1
     Downstream interface(s) information: none

     <strong>Extranet receiver(s): 1</strong>
        <strong>1: RED</strong></pre>
<p>Run the <strong>display multicast routing-table</strong> command on PE2 to check information about the multicast routing table. The following command output shows that the upstream interface of the RPF route selected by the multicast route entry with 228.0.0.1 as the group address belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display multicast vpn-instance RED routing-table extranet source-vpn-instance vpn-instance BLUE</strong></pre>
<pre class="screen">Multicast routing table of VPN instance: RED
 Total 0 (*, G) entry; 1 (S, G) entry, 1 matched
 
 00001: (10.1.1.2, 228.0.0.1)
       Uptime: 05:39:09     
       Upstream Interface: <strong>MCAST_Extranet(BLUE)</strong>
       List of 1 downstream interface
           1: GigabitEthernet<span>0/3/0</span></pre>
<p>Run the <strong>display multicast rpf-info</strong> command on PE2 to check information about the RPF route with 10.1.1.2 as the multicast source address. The following command output shows that the upstream interface of the RPF route selected by the multicast route entry with 228.0.0.1 as the group address belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display multicast vpn-instance RED rpf-info 10.1.1.2 228.0.0.1</strong></pre>
<pre class="screen"> VPN-Instance: RED
 RPF information about source 10.1.1.2 and group 228.0.0.1
     RPF interface: <strong>MCAST_Extranet</strong>
     <strong>RPF Source VPN-Instance: BLUE</strong>
     Referenced route/mask: 10.1.1.0/24
     Referenced route type: unicast
     Route selection rule: preference-preferred
     Load splitting rule: disable</pre>
<p>After the preceding configurations are complete, the receiver can receive multicast data from the source. Run the <strong>display pim routing-table</strong> command on CE2 to check information about the PIM routing table. The following command output shows that multicast data has reached CE2 and has been forwarded to the receiver.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: WC 
     UpTime: 00:00:09     
     Upstream interface: GigabitEthernet<span>0/1/2</span>, Refresh time: 00:00:09
         Upstream neighbor: 10.1.3.1
         RPF prime neighbor: 10.1.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: static, UpTime: 00:00:09, Expires: - 

 (10.1.1.2, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 00:04:06     
     Upstream interface: GigabitEthernet<span>0/1/2</span>, Refresh time: 00:04:06
         Upstream neighbor: 10.1.3.1
         RPF prime neighbor: 10.1.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:00:09, Expires: - </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001270153557__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast routing-enable
#
ip vpn-instance BLUE
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   ipmsi-tunnel
    mldp
#
ip vpn-instance RED
 ipv4-family
  route-distinguisher 200:1
  vpn-target 200:1 export-extcommunity
  vpn-target 200:1 import-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   multicast extranet select-rpf vpn-instance BLUE group 228.0.0.1 24
#
mpls lsr-id 3.3.3.3
#
mpls 
#
mpls ldp
 mldp p2mp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance BLUE
 ip address 10.1.2.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip binding vpn-instance RED
 ip address 10.1.3.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 pim sm
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance BLUE
  import-route direct
  import-route ospf 3
 #
 ipv4-family vpn-instance RED
  import-route direct
  import-route ospf 2
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
ospf 2 vpn-instance RED
 import-route bgp
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
#
ospf 3 vpn-instance BLUE
 import-route bgp
 area 0.0.0.0
  network 10.1.2.0 0.0.0.255
#
pim
#
pim vpn-instance BLUE
 static-rp 4.4.4.4
#
pim vpn-instance RED
 static-rp 4.4.4.4
#
return </pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 pim sm
#
ospf 3
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
  network 4.4.4.4 0.0.0.0
#
pim
 static-rp 4.4.4.4
#
return </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 pim sm
 igmp enable
 igmp static-group 228.0.0.1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 pim sm
#
ospf 2
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 10.1.4.0 0.0.0.255
#
pim
 static-rp 4.4.4.4
#
return 
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">Configuration Examples for NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0122.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0125.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>