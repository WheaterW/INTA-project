
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Layer 2 Multicast SSM Mapping">
<meta name="abstract" content="This section provides an example for configuring Layer 2 multicast SSM mapping.">
<meta name="description" content="This section provides an example for configuring Layer 2 multicast SSM mapping.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0036.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0038.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,l2multicastvrp,c00549182,w00556928,w00437000,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172367975">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Layer 2 Multicast SSM Mapping</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172367975"></a><a name="EN-US_TASK_0172367975"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Layer 2 Multicast SSM Mapping</h1>
<div class="taskbody"><p>This section provides an example for configuring Layer 2 multicast SSM mapping.</p>
<div class="context"><a name="EN-US_TASK_0172367975__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172367975__fig_dc_vrp_l2mc_cfg_003701">Figure 1</a>, GE<span>0/1/0</span> on PE1 is connected to PE2 and belongs to VLAN 10. GE <span>0/1/0</span> on PE2 is a static router port.</p>
<p>IGMPv3 is running on PE1 while IGMPv2 is running on PE2.</p>
<p>Then, SSM mapping needs to be configured on PE1 so that PE1 can map the multicast group addresses of the received packets with no source addresses to specific sources. In addition, the querier function needs to be enabled for VLAN 10 on PE1 so that PE1 can send Query messages periodically to PE2.</p>
<div class="fignone" id="EN-US_TASK_0172367975__fig_dc_vrp_l2mc_cfg_003701"><a name="EN-US_TASK_0172367975__fig_dc_vrp_l2mc_cfg_003701"></a><a name="fig_dc_vrp_l2mc_cfg_003701"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of Layer 2 multicast SSM mapping</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2mc_cfg_003701.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367975__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create VLANs and enable basic IGMP snooping functions.</p>
</li><li><p>Configure the version numbers of IGMP snooping running on PE1 and PE2.</p>
</li><li><p>Enable the querier function for VLAN 10 on PE1.</p>
</li><li><p>Configure GE <span>0/1/0</span> on PE2 as a static router port.</p>
</li><li><p>Configure an IGMP snooping SSM policy.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367975__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VLAN ID: 10</p>
</li><li><p>IGMP snooping version number: 3 on PE1 and 2 on PE2</p>
</li><li><p>Static multicast group address: 224.1.1.1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172367975__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create VLANs.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>vlan 10</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>port gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vlan10] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>vlan 10</strong>
[<span class="keyword">*</span>PE2-vlan10] <strong>port gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE2-vlan10] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vlan10] <strong>quit</strong></pre>
</p></li><li><span>Enable global IGMP snooping and IGMP snooping in a VLAN.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>igmp-snooping enable</strong>
[<span class="keyword">*</span>PE1] <strong>vlan 10</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>igmp-snooping enable</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>igmp-snooping enable</strong>
[<span class="keyword">*</span>PE2] <strong>vlan 10</strong>
[<span class="keyword">*</span>PE2-vlan10] <strong>igmp-snooping enable</strong>
[<span class="keyword">*</span>PE2-vlan10] <strong>igmp-snooping report-suppress</strong>
[<span class="keyword">*</span>PE2-vlan10] <strong>commit</strong></pre>
</p></li><li><span>Configure the version numbers of IGMP snooping running on PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vlan10] <strong>igmp-snooping version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vlan10] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2-vlan10] <strong>igmp-snooping version 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vlan10] <strong>commit</strong></pre>
</p></li><li><span>Enable the querier function for VLAN 10 on PE1 so that PE1 can send General Query messages to PE2.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>igmp-snooping send-query enable</strong>
[<span class="keyword">*</span>PE1] <strong>vlan 10</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>igmp-snooping querier enable</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vlan10] <strong>quit</strong></pre>
</p></li><li><span>Configure GE <span>0/1/0</span> on PE2 as a static router port and statically add GE <span>0/1/1</span> on PE2 to the multicast group with group address being 224.1.1.1.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong>
<span>[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>igmp-snooping static-router-port vlan 10 </strong></span>
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>portswitch</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>port trunk allow-pass vlan 10</strong>
<span>[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>l2-multicast static-group group-address 224.1.1.1 vlan 10</strong></span>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</p></li><li><span>Configure an IGMP snooping SSM policy.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>acl number 2008</strong>
[<span class="keyword">*</span>PE1-acl-basic-2008] <strong>rule 5 permit source 224.1.1.1 0</strong>
[<span class="keyword">*</span>PE1-acl-basic-2008] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>vlan 10</strong> 
<span>[<span class="keyword">*</span>PE1-vlan10] <strong>igmp-snooping ssm-policy 2008</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>igmp-snooping ssm-mapping enable</strong> 
[<span class="keyword">*</span>PE1-vlan10] <strong>igmp-snooping ssm-mapping 224.1.1.1 24 10.1.1.2</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>igmp-snooping ssm-mapping 224.1.1.1 24 10.1.1.3</strong>
[<span class="keyword">*</span>PE1-vlan10] <strong>igmp-snooping ssm-mapping 224.1.1.1 24 10.1.1.4</strong></span>
[<span class="keyword">*</span>PE1-vlan10] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display igmp-snooping vlan configuration</strong> command on PE1 to view VLAN configurations.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display igmp-snooping vlan configuration</strong>
 IGMP Snooping Configuration for VLAN 10
     igmp-snooping enable
     igmp-snooping version 3
     igmp-snooping querier enable
     igmp-snooping ssm-mapping enable
     igmp-snooping ssm-policy 2008
     igmp-snooping ssm-mapping 224.1.1.1 255.255.255.0 10.1.1.2
     igmp-snooping ssm-mapping 224.1.1.1 255.255.255.0 10.1.1.3
     igmp-snooping ssm-mapping 224.1.1.1 255.255.255.0 10.1.1.4</pre>
<p># After PE1 receives a Report message, run the <strong>display igmp-snooping port-info</strong> command to check port information. In the command output, <strong>Source</strong> indicates a multicast source IP address, and <strong>Group</strong> indicates a multicast group IP address.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display igmp-snooping port-info</strong>
 -----------------------------------------------------------------------------------
  Flag: S:Static     D:Dynamic     M:Ssm-mapping
        A:Active     P:Protocol    F:Fast-channel                                
                    (Source, Group)  Port                                      Flag
 -------------------------------------------------------------------------------
 VLAN 10, 3 Entry(s)
               (10.1.1.2, 224.1.1.1)                                        P--
                                      GigabitEthernet<span>0/1/0</span>                  --M
                                                        1 port(s) include
               (10.1.1.3, 224.1.1.1)                                        P--
                                      GigabitEthernet<span>0/1/0</span>                  --M
                                                        1 port(s) include
               (10.1.1.4, 224.1.1.1)                                        P--
                                      GigabitEthernet<span>0/1/0</span>                  --M
                                                        1 port(s) include
 -------------------------------------------------------------------------------</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172367975__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
vlan batch 10
#
<span>igmp-snooping enable</span>
<span>igmp-snooping send-query enable</span>
#
vlan 10
<span> igmp-snooping enable</span>
<span> igmp-snooping querier enable</span>
<span> igmp-snooping ssm-mapping enable</span>
<span> igmp-snooping version 3</span>
<span> igmp-snooping ssm-policy 2008</span>
<span> igmp-snooping ssm-mapping 224.1.1.1 255.255.255.0 10.1.1.2</span>
<span> igmp-snooping ssm-mapping 224.1.1.1 255.255.255.0 10.1.1.3</span>
<span> igmp-snooping ssm-mapping 224.1.1.1 255.255.255.0 10.1.1.4</span>
#
acl number 2008
 rule 5 permit source 224.1.1.1 0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 portswitch
 port default vlan 10
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
vlan batch 10
#
<span>igmp-snooping enable</span>
#
vlan 10
<span> igmp-snooping enable</span>
<span> igmp-snooping report-suppress</span>
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 portswitch
 port default vlan 10
 <span>igmp-snooping static-router-port vlan 10</span>
#   
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 portswitch
 port trunk allow-pass vlan 10
 <span>l2-multicast static-group group-address 224.1.1.1 vlan 10</span>
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">Configuration Examples for Layer 2 Multicast
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0036.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0038.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>