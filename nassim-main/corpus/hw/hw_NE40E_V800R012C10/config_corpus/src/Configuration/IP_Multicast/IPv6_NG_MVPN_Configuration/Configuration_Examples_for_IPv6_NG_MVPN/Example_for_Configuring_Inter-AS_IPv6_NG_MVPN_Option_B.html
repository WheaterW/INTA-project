
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS IPv6 NG MVPN Option B">
<meta name="abstract" content="In this example, communication between VPNs spans multiple ASs on the backbone network, and ASBRs advertise labeled VPN-IPv4 routes through MP-EBGP.">
<meta name="description" content="In this example, communication between VPNs spans multiple ASs on the backbone network, and ASBRs advertise labeled VPN-IPv4 routes through MP-EBGP.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0212.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0213.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0274.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172367587">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Inter-AS IPv6 NG MVPN Option B</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172367587"></a><a name="EN-US_TASK_0172367587"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS IPv6 NG MVPN Option B</h1>
<div class="taskbody"><p>In this example, communication between VPNs spans multiple ASs on the backbone network, and ASBRs advertise labeled VPN-IPv4 routes through MP-EBGP.</p>
<div class="context"><a name="EN-US_TASK_0172367587__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172367587__fig_dc_vrp_cfg_ngmvpn_027301">Figure 1</a>, CE1 and CE2 belong to different VPNs. Communication between the VPNs spans two ASs: AS100 and AS200. VPN instances do not need to be created on each ASBR. Instead, each ASBR only needs to receive VPNv6 routes and transmit the routes to the peer ASBR. The MP-IBGP peer relationship needs to be established between each pair of PE and ASBR, and the MP-EBGP peer relationship needs to be established between the ASBRs.</p>
<div class="fignone" id="EN-US_TASK_0172367587__fig_dc_vrp_cfg_ngmvpn_027301"><a name="EN-US_TASK_0172367587__fig_dc_vrp_cfg_ngmvpn_027301"></a><a name="fig_dc_vrp_cfg_ngmvpn_027301"></a><span class="figcap"><b>Figure 1 </b>Networking for configuring inter-AS IPv6 NG MVPN Option B</span><br><span><img class="vsd" src="images/fig_dc_vrp_cfg_ngmvpn_027301.png"></span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 4 in this example represent GE <span>0/1/1</span>, GE <span>0/1/2</span>, GE <span>0/1/3</span>, and GE <span>0/1/4</span>, respectively.</p>
</div></div>
</div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="13.24867513248675%" id="mcps1.4.1.4.1.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="37.08629137086292%" id="mcps1.4.1.4.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="49.66503349665034%" id="mcps1.4.1.4.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>CE1</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:DB8:5::6/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:DB8:6::6/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>PE1</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:DB8:6::3/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.0.2.3/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR1</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.0.7.5/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.0.2.5/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR2</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>LoopBack0</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.0.7.7/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.0.16.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>PE2</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>1.1.1.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.0.16.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:DB8:14::4/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>CE2</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:DB8:3::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GigabitEthernet<span>0/1/4</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>2001:DB8:14::1/64</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367587__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When configuring inter-AS IPv6 NG MVPN Option B, note the following:</p>
<ul><li><p>The MP-EBGP peer relationship needs to be established between ASBRs in different ASs. The MP-IBGP peer relationship needs to be established between the PE and ASBR in the same AS.</p>
</li><li><p>ASBRs do not filter received VPNv6 routes based on VPN targets.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367587__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Run an IGP in each AS to implement communication between nodes in the same AS. Establish an MPLS LDP LSP between the ASBR and PE in the same AS.</p>
</li><li><p>Configure the MP-EBGP peer relationship between ASBRs in different ASs. Configure the MP-IBGP peer relationship between the PE and ASBR in the same AS.</p>
</li><li><p>Configure a VPN instance on each PE and bind the interface that connects a PE to a CE to the VPN instance on that PE.</p>
</li><li><p>Enable MPLS on the ASBR interfaces connected to each other. Establish an MP-EBGP peer relationship between ASBRs and configure ASBRs not to filter VPNv6 routes based on VPN targets.</p>
</li><li><p>Configure a P2MP LSP to carry multicast traffic.</p>
</li><li><p>Configure PIM.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367587__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and ASBRs (1.1.1.1, 1.1.1.2, 1.1.1.3, and 1.1.1.4)</p>
</li><li><p>Name (ngv6), RD (100:1 and 200:1), and export and import VPN targets (1:1) of the VPN instance on each PE</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172367587__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IGP on the MPLS backbone networks of AS100 and AS200, so that nodes on each MPLS backbone network can communicate with each other.</span><p><p>This example uses OSPF. For configuration details, see <a href="#EN-US_TASK_0172367587__example_dc_vrp_cfg_ngmvpn_027301">Configuration Files</a> in this example.</p>
</p></li><li><span>Configure IS-IS for communication between PEs and CEs. For configuration details, see <a href="#EN-US_TASK_0172367587__example_dc_vrp_cfg_ngmvpn_027301">Configuration Files</a> in this example.</span></li><li><span>Configure basic MPLS functions and MPLS LDP on the MPLS backbone networks of AS100 and AS200 to establish LDP LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/4</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/4</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/4</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<p>The procedure for configuring PE2 is similar to the procedure for configuring PE1. For configuration details, see Configuration Files in this example.</p>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls lsr-id 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface GigabitEthernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/4</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/4</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/4</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<p>The procedure for configuring ASBR2 is similar to the procedure for configuring ASBR1. For configuration details, see Configuration Files in this example.</p>
<p>After the configurations are complete, LDP peer relationships are set up between the PE and ASBR in each AS and between ASBRs. Run the <strong>display mpls ldp session</strong> command on each <span class="keyword">Router</span>. The command output shows that <strong>Session State</strong> is <strong>Operational</strong>. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt;<strong> display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.</pre>
<pre class="screen"> -------------------------------------------------------------------------</pre>
<pre class="screen"> PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv</pre>
<pre class="screen"> ------------------------------------------------------------------------</pre>
<pre class="screen"> 1.1.1.2          <strong>Operational</strong> DU   Passive  0000:00:01  5/5</pre>
<pre class="screen"> -------------------------------------------------------------------------</pre>
<pre class="screen"> TOTAL: 1 session(s) Found.</pre>
</p></li><li><span>Configure an automatic mLDP P2MP LSP on PEs and ASBRs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>mldp recursive-fec</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>quit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>mldp recursive-fec</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<p>The procedure for configuring ASBR2 is similar to the procedure for configuring ASBR1. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Configure the MP-IBGP peer relationship between the PE and ASBR in the same AS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 1.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 1.1.1.2 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 1.1.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 1.1.1.1 connect-interface loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The procedure for configuring AS200 is similar to the procedure for configuring AS100. For configuration details, see Configuration Files in this example.</p>
<p>After the configuration is complete, run the <strong>display bgp vpnv4 all peer</strong> command on the PE or ASBR. The command output shows that the MP-IBGP peer relationship between the PE and ASBR in the same AS or between ASBRs is in the <strong>Established</strong> state. The command output on PE1 is used as an example.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv6 all peer</strong>

 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1         Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv

  1.1.1.2        4         100    18970    19008     0 91:51:24   <strong>Established</strong>    0
</pre>
</p></li><li><span>Create VPN instances on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>ip binding vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>ip address 2001:db8:6::3 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/4</span>] <strong>ip binding vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/4</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/4</span>] <strong>ip address 2001:db8:14::4 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/4</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
</p></li><li><span>Enable MPLS on the interfaces interconnecting ASBRs, establish the MP-EBGP relationship between ASBRs, and configure the ASBRs not to filter received VPNv6 routes based on VPN targets.</span><p><p># Enable MPLS on GigabitEthernet<span>0/1/2</span> connecting ASBR1 to ASBR2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface GigabitEthernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>ip address 10.0.7.5 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Configure ASBR2: Enable MPLS on GigabitEthernet<span>0/2/0</span> connecting to ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2] <strong>interface GigabitEthernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-GigabitEthernet<span>0/1/3</span>] <strong>ip address 10.0.7.7 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/3</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/3</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p># Configure ASBR1: Establish the MP-EBGP peer relationship with ASBR2 and configure ASBR1 not to filter received VPNv6 routes based on VPN targets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>peer 10.0.7.7 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6] <strong>peer 10.0.7.7 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p># Configure ASBR2: Establish the MP-EBGP peer relationship with ASBR1 and configure ASBR2 not to filter received VPNv6 routes based on VPN targets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-bgp] <strong>peer 10.0.7.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv6] <strong>peer 10.0.7.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv6] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <strong>display bgp mvpn vpnv6 all peer</strong> command. The command output shows that the MP-EBGP peer relationship between ASBRs is in the <strong>Established</strong> state. The command output on ASBR1 is used as an example.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>display bgp mvpn vpnv6 all peer</strong>

 BGP local router ID : 1.1.1.2
 Local AS number : 100
 Total number of peers : 2         Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv

  1.1.1.1        4         100    17533    17554     0 127:24:5 Established    1
10.0.7.7        4         200    12343    34554     0 127:24:5 Established    1</pre>
</p></li><li><span>Configure BGP MVPN peers.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 1.1.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv6-family vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpn-ngv6] <strong>import-route isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpn-ngv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpn-ngv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-mvpnv6] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpnv6] <strong>peer 1.1.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-mvpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p>The configuration on PE2 is similar to the configuration on PE1. For configuration details, see Configuration Files in this example.</p>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 10.0.7.7 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-mvpnv6] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-mvpnv6] <strong>peer 10.0.7.7 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-mvpnv6] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-mvpnv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-mvpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The procedure for configuring ASBR2 is similar to the procedure for configuring ASBR1. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Configure an mLDP LSP on PEs to carry multicast traffic.</span><p><p># Configure PE1 as the sender PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast ipv6 mvpn 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>auto-discovery inter-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>mldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ngv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ngv6] <strong>quit</strong></pre>
<p># Configure PE2 as the receiver PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast ipv6 mvpn 1.1.1.4</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>auto-discovery inter-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ngv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ngv6] <strong>quit</strong></pre>
</p></li><li><span>Configure PIM.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim-ipv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-pim6] <strong>static-rp 2001:db8:6::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-pim6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface GigabitEthernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>pim-ipv6</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-pim6] <strong>static-rp 2001:db8:6::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-pim6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>mld enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>mld static-group FF3E::1 source 2001:DB8:5::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface GigabitEthernet <span>0/1/4</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/4</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/4</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/4</span>] <strong>quit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pim-ipv6 vpn-instance ngv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim6-ngv6] <strong>static-rp 2001:db8:6::3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim6-ngv6] <strong>source-lifetime 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim6-ngv6] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-pim6-ngv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet <span>0/1/3</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/3</span>] <strong>quit</strong></pre>
<p>The configuration on PE2 is similar to the configuration on PE1. For configuration details, see Configuration Files in this example.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, CE1 and CE2 can successfully ping each other.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ipv6 2001:db8:14::1</strong></pre>
<pre class="screen">  PING 2001:DB8:14::1: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=1 ttl=252 time=120 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=2 ttl=252 time=73 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=3 ttl=252 time=111 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=4 ttl=252 time=86 ms</pre>
<pre class="screen">    Reply from 2001:DB8:14::1: bytes=56 Sequence=5 ttl=252 time=110 ms</pre>
<pre class="screen">  --- 2001:DB8:14::1 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 73/100/120 ms </pre>
<p>Run the <a href="cmdqueryname=display+pim+ipv6+routing-table"><b><span class="cmdname">display pim ipv6 routing-table</span></b></a> command on a PE to check the PIM routing table.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt;<strong> display pim ipv6 vpn-instance ngv6 routing-table</strong></pre>
<pre class="screen"> VPN-Instance: ngv6
 Total 1 (S, G) entry

 (2001:DB8:5::2, FF3E::1)
     Protocol: pim-ssm, Flag:
     UpTime: 00:24:09
     Upstream interface: through-BGP, Refresh time: 00:24:09
         Upstream neighbor: ::FFFF:1.1.1.2
         RPF prime neighbor: ::FFFF:1.1.1.2
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/3</span>
             Protocol: pim-ssm, UpTime: 00:24:09, Expires: 00:02:35
</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172367587__example_dc_vrp_cfg_ngmvpn_027301"><a name="EN-US_TASK_0172367587__example_dc_vrp_cfg_ngmvpn_027301"></a><a name="example_dc_vrp_cfg_ngmvpn_027301"></a><a name="EN-US_TASK_0172367587__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast ipv6 routing-enable
#
isis 1
 is-level level-2
 ipv6 enable topology ipv6
 network-entity 10.0000.0000.0004.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:5::6 64
 isis ipv6 enable 1
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:6::6 64
 isis ipv6 enable 1
 pim ipv6 sm
#
pim-ipv6
 static-rp 2001:DB8:6::3
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
 sysname PE1
#
multicast ipv6 mvpn 1.1.1.1
#
ip vpn-instance ngv6
 ipv6-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
  multicast ipv6 routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   auto-discovery inter-as
   ipmsi-tunnel
    mldp
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
 mldp p2mp
#
isis 1 vpn-instance ngv6
 is-level level-2
 network-entity 10.0000.0000.0006.00
 ipv6 enable topology ipv6
 ipv6 import-route bgp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip binding vpn-instance ngv6
 ipv6 enable
 ipv6 address 2001:DB8:6::3 64
 isis ipv6 enable 1
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 10.0.2.3 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 1.1.1.2 as-number 100
 peer 1.1.1.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.2 enable
 #
 ipv6-family mvpn
  policy vpn-target
  peer 1.1.1.2 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.2 enable
 #
 ipv6-family vpn-instance ngv6
  import-route isis 1
#
ospf 1
 area 0.0.0.0
  network 10.0.2.0 0.0.0.255
  network 1.1.1.1 0.0.0.0
#
pim-ipv6 vpn-instance ngv6
 static-rp 2001:DB8:6::3
 source-lifetime 60
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
 sysname ASBR1
#
mpls lsr-id 1.1.1.2
#
mpls
#
mpls ldp
 mldp p2mp
 mldp recursive-fec
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.0.7.5 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 10.0.2.5 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.2 255.255.255.255
#
bgp 100
 peer 10.0.7.7 as-number 200
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 #
 ipv4-family unicast
 undo synchronization
  peer 10.0.7.7 enable
  peer 1.1.1.1 enable
 #
 ipv6-family mvpn
  undo policy vpn-target
  peer 10.0.7.7 enable
  peer 1.1.1.1 enable
 #
 ipv6-family vpnv6
  undo policy vpn-target
  peer 10.0.7.7 enable
  peer 1.1.1.1 enable
#
ospf 1
 area 0.0.0.0
  network 10.0.2.0 0.0.0.255
  network 1.1.1.2 0.0.0.0
#
ip route-static 1.1.1.3 255.255.255.255 10.0.7.7
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
 sysname ASBR2
#
mpls lsr-id 1.1.1.3
#
mpls
#
mpls ldp
 mldp p2mp
 mldp recursive-fec
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.0.7.7 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip address 10.0.16.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.3 255.255.255.255
#
bgp 200
 peer 10.0.7.5 as-number 100
 peer 1.1.1.4 as-number 200
 peer 1.1.1.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 10.0.7.5 enable
  peer 1.1.1.4 enable
 #
 ipv6-family mvpn
undo policy vpn-target
  peer 10.0.7.5 enable
  peer 1.1.1.4 enable
 #
 ipv6-family vpnv6
  undo policy vpn-target
  peer 10.0.7.5 enable
  peer 1.1.1.4 enable
#
ospf 1
 area 0.0.0.0
  network 10.0.16.0 0.0.0.255
  network 1.1.1.3 0.0.0.0
#
ip route-static 1.1.1.2 255.255.255.255 10.0.7.5
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast ipv6 mvpn 1.1.1.4
#
ip vpn-instance ngv6
 #
 ipv6-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
  multicast ipv6 routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
   auto-discovery inter-as
   ipmsi-tunnel
#
mpls lsr-id 1.1.1.4
#
mpls
#
mpls ldp
 mldp p2mp
 mldp recursive-fec
#
isis 1 vpn-instance ngv6
 is-level level-2
 network-entity 10.0000.0000.0007.00
 ipv6 enable topology ipv6
 ipv6 import-route bgp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 10.0.16.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ip binding vpn-instance ngv6
 ipv6 enable
 ipv6 address 2001:DB8:14::4 64
 isis ipv6 enable 1
 pim ipv6 sm
#
interface LoopBack0
 ip address 1.1.1.4 255.255.255.255
#
bgp 200
 peer 1.1.1.3 as-number 200
 peer 1.1.1.3 connect-interface LoopBack0
#
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.3 enable
#
 ipv6-family mvpn
  policy vpn-target
  peer 1.1.1.3 enable
#
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.3 enable
#
 ipv6-family vpn-instance ngv6
  import-route isis 1
#
ospf 1
 area 0.0.0.0
  network 10.0.16.0 0.0.0.255
  network 1.1.1.4 0.0.0.0
#
pim-ipv6 vpn-instance ngv6
 static-rp 2001:DB8:6::3
 source-lifetime 60
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
multicast ipv6 routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:3::1 64
 isis ipv6 enable 1
 pim ipv6 sm
 mld enable
 mld static-group FF3E::1 source 2001:DB8:5::2
#
interface GigabitEthernet<span>0/1/4</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:14::1 64
 isis ipv6 enable 1
 pim ipv6 sm
#
isis 1
 is-level level-2
 ipv6 enable topology ipv6
 network-entity 10.0000.0000.0004.00
#
pim-ipv6
 static-rp 2001:DB8:6::3
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0212.html">Configuration Examples for IPv6 NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0213.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0274.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>