
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MVPN Extranet in the Remote Route Leaking Scenario Where a Source VPN Instance Is Configured on a Receiver PE">
<meta name="abstract" content="This section provides an example for configuring MVPN extranet in the remote route leaking scenario where a source VPN instance needs to be configured on a receiver PE.">
<meta name="description" content="This section provides an example for configuring MVPN extranet in the remote route leaking scenario where a source VPN instance needs to be configured on a receiver PE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2133.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2275.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2263.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_Rosen">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001225512684">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring MVPN Extranet in the Remote Route Leaking Scenario Where a Source VPN Instance Is Configured on a Receiver PE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001225512684"></a><a name="EN-US_TASK_0000001225512684"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MVPN Extranet in the Remote Route Leaking Scenario Where a Source VPN Instance Is Configured on a Receiver PE</h1>
<div class="taskbody"><p>This section provides an example for configuring MVPN extranet in the remote route leaking scenario where a source VPN instance needs to be configured on a receiver PE.</p>
<div class="context"><a name="EN-US_TASK_0000001225512684__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>MD MVPN supports only intra-VPN multicast service distribution. In real-world application, however, a service provider may need to provide multicast services to users in a different VPN than its own VPN. This requires inter-VPN multicast distribution. </p>
<p>In the remote route leaking scenario of single-AS MD MVPN shown in <a href="#EN-US_TASK_0000001225512684__fig_dc_vrp_multicast_cfg_226101">Figure 1</a>, the receiver in VPN RED requires multicast data from the source in VPN BLUE. To meet this requirement, deploy MVPN extranet by configuring the source VPN on the receiver PE. In addition, configure a multicast route selection policy for VPN RED on receiver PE2 and specify in the policy that the upstream interface of the RPF route belongs to VPN BLUE.</p>
<div class="fignone" id="EN-US_TASK_0000001225512684__fig_dc_vrp_multicast_cfg_226101"><a name="EN-US_TASK_0000001225512684__fig_dc_vrp_multicast_cfg_226101"></a><a name="fig_dc_vrp_multicast_cfg_226101"></a><span class="figcap"><b>Figure 1 </b>Configuring MVPN extranet in the remote route leaking scenario where a source VPN instance needs to be configured on a receiver PE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE <span>0/1/0</span> and GE <span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001225832720.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001225512684__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic single-AS MD MVPN functions.</p>
</li><li><p>Configure the VPN instance (VPN BLUE) enabled with the IPv4 address family on PE2 and bind the VPN instance to an MTunnel interface.</p>
</li><li><p>Configure Rendezvous Points (RPs) to serve the public network.</p>
</li><li><p>Configure RPs to serve the multicast groups running the multicast VPN extranet service.</p>
</li><li><p>Configure a multicast route selection policy for VPN RED on PE2 and specify VPN BLUE as the upstream interface of the RPF route.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p">This example does not involve the following situations:<ul><li>Multicast VPN is not supported on an interface board.</li><li>The current device is an ingress PE, and the VPN inbound interface is a logical interface.</li><li>The current device is an egress PE, and the public network inbound interface is a logical interface.</li></ul>
If any of the preceding situations exists in the actual networking, you need to enable IP multicast VPN to allow multicast traffic to be properly forwarded. For configuration details, see <a href="../ne/dc_ne_mcast_cfg_2001.html">(Optional) Enabling IP Multicast VPN</a>.</div>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001225512684__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>RD and RT of VPN BLUE: 100:1</p>
</li><li><p>RD and RT of VPN RED: 200:1</p>
</li><li><p>Share-group address of VPN BLUE: 239.0.0.0</p>
</li><li><p>Share-group address of VPN RED: 238.0.0.0</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001225512684__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure basic single-AS MD MVPN functions.</span><ol type="a"><li class="substepexpand"><span>Configure basic MPLS functions and MPLS LDP and set up LDP LSPs on the public network.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname P</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a unicast routing protocol and the multicast function on the public network to ensure that multicast routes on the public network are reachable.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure VPN BLUE and VPN RED on PEs, set share-group addresses for VPN BLUE and VPN RED, and bind the share-group addresses to MTunnel interfaces. Then, bind the interface that connects each PE to the corresponding CE to a VPN instance.</span><p><p># Create a VPN instance named BLUE on PE1. For VPN BLUE, configure the IPv4 address family, globally enable the multicast function, configure a Share-Group address, and bind the Share-Group address to MTunnel 0. In addition, bind GE <span>0/1/1</span> that connects PE1 to CE1 to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-BLUE] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>vpn-target 100:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>multicast-domain share-group 239.0.0.0 binding mtunnel 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-BLUE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Create a VPN instance named RED on PE2. For VPN RED, configure the IPv4 address family, globally enable the multicast function, configure a Share-Group address, and bind the Share-Group address to MTunnel 1. In addition, bind GE <span>0/1/0</span> that connects PE2 to CE2 to VPN RED. Import the routes from VPN BLUE into VPN RED.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>vpn-target 200:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>multicast-domain share-group 238.0.0.0 binding mtunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure IP addresses for MTunnel interfaces.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface MTunnel 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-MTunnel0]<strong> ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-MTunnel0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface MTunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-MTunnel1]<strong> ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-MTunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a unicast routing protocol and enable the multicast function for VPN BLUE and VPN RED to ensure that multicast routes of the VPN instances are reachable.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.3.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.1.4.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>network 10.1.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish MP-IBGP peer relationships between PEs, and configure a unicast routing protocol between PEs and corresponding CEs to ensure routing between them.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-BLUE] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-BLUE] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-BLUE]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4]<strong> peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ospf 2 vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2-area-0.0.0.0] <strong>network 10.1.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-BLUE] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-BLUE] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-BLUE]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-RED] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-RED] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-RED]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4]<strong> peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf 2 vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-3] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure VPN BLUE on PE2 and bind VPN BLUE to MTunnel 0.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>vpn-target 100:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>multicast-domain share-group 239.0.0.0 binding mtunnel 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-BLUE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface MTunnel 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-MTunnel0]<strong> ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-MTunnel0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a C-RP for the public network.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim] <strong>c-bsr Loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim] <strong>c-rp Loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
</p></li><li><span>Configure a VPN RP to serve multicast VPN extranet multicast groups.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Source VPN instances and receiver VPN instances support only static RPs. In addition, the routes to static RPs and the routes to the sources need to be in the same VPN instance.</p>
</div></div>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> pim vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-BLUE] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-BLUE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> pim vpn-instance BLUE</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-BLUE] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-BLUE] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> pim vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-RED] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-RED] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>static-rp 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a multicast route selection policy for VPN RED to specify VPN BLUE for the upstream interface of the RPF route selected by the PIM entry with the group address 228.0.0.1/24.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance RED</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>multicast extranet select-rpf vpn-instance BLUE group 228.0.0.0 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-RED] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>By checking the configuration result, you can view that the receiver in VPN RED can receive multicast data from the source in VPN BLUE.</p>
<p>Run the <strong>display pim routing-table</strong> command on PE2 to check information about the PIM routing table. The following command output shows that the upstream interface of the RPF route selected by the PIM entry with the group address 228.0.0.1 belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance RED routing-table extranet source-vpn-instance vpn-instance BLUE</strong></pre>
<pre class="screen"> VPN-Instance: RED
 Total 1 (*, G) entry; 2 (S, G) entries
 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: WC 
     UpTime: 00:47:55
     Upstream interface: <strong>MCAST_Extranet(BLUE)</strong>
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/0</span>
             Protocol: pim-sm, UpTime: 00:47:55, Expires: 00:02:34
 
 (10.1.1.2, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 06:18:43
     Upstream interface: <strong>MCAST_Extranet(BLUE)</strong>
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/0</span>
             Protocol: pim-sm, UpTime: 00:47:57, Expires: 00:02:32</pre>
<p>The following command output shows that the multicast extranet receiver of VPN BLUE belongs to VPN RED.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance BLUE routing-table extranet receive-vpn-instance vpn-instance RED</strong></pre>
<pre class="screen"> VPN-Instance: BLUE
 Total 1 (*, G) entry; 1 (S, G) entry
 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: WC EXTRANET 
     UpTime: 00:06:27
     Upstream interface: MTunnel0
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information: none

     <strong>Extranet receiver(s): 1</strong>
        <strong>1: RED</strong>
 
 (10.1.1.2, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: SPT ACT EXTRANET 
     UpTime: 00:06:06
     Upstream interface: MTunnel0
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information: none

     <strong>Extranet receiver(s): 1</strong>
        <strong>1: RED</strong></pre>
<p>Run the <strong>display multicast routing-table</strong> command on PE2 to check information about the multicast routing table. The following command output shows that the upstream interface of the RPF route selected by the multicast routing entry with the group address 228.0.0.1 belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display multicast vpn-instance RED routing-table extranet source-vpn-instance vpn-instance BLUE</strong></pre>
<pre class="screen">Multicast routing table of VPN instance: RED
 Total 0 (*, G) entry; 1 (S, G) entry, 1 matched
 
 00001: (10.1.1.2, 228.0.0.1)
       Uptime: 00:42:23     
       Upstream Interface: <strong>MCAST_Extranet(BLUE)</strong>
       List of 1 downstream interface
           1: GigabitEthernet<span>0/1/0</span></pre>
<p>Run the <strong>display multicast rpf-info</strong> command on PE2 to check information about the RPF route with 10.1.1.2 as the multicast source address. The following command output shows that the upstream interface of the RPF route selected by the multicast routing entry with the group address 228.0.0.1 belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display multicast vpn-instance RED rpf-info 10.1.1.2 228.0.0.1</strong></pre>
<pre class="screen"> VPN-Instance: RED
 RPF information about source 10.1.1.2 and group 228.0.0.1
     RPF interface: <strong>MCAST_Extranet</strong>
     <strong>RPF Source VPN-Instance: BLUE</strong>
     Referenced route/mask: 10.1.1.0/24
     Referenced route type: unicast
     Route selection rule: preference-preferred
     Load splitting rule: disable</pre>
<p>After the preceding configurations, Receiver can receive multicast data from Source. Run the <strong>display pim routing-table</strong> command on CE2 to check information about the PIM routing table. The following command output shows that multicast data has reached CE2 and has been forwarded to the receiver.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: WC 
     UpTime: 00:53:02     
     Upstream interface: GigabitEthernet<span>0/1/0</span>, Refresh time: 00:53:02
         Upstream neighbor: 10.1.3.1
         RPF prime neighbor: 10.1.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: static, UpTime: 00:53:02, Expires: - 

 (10.1.1.2, 228.0.0.1)
     RP: 4.4.4.4 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 00:08:02     
     Upstream interface: GigabitEthernet<span>0/1/0</span>, Refresh time: 00:08:02
         Upstream neighbor: 10.1.3.1
         RPF prime neighbor: 10.1.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:08:02, Expires: - </pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001225512684__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
multicast routing-enable
#
ip vpn-instance BLUE
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 239.0.0.0 binding mtunnel 0
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 pim sm
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip binding vpn-instance BLUE
 ip address 10.1.2.2 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 pim sm
#
interface MTunnel0
 ip binding vpn-instance BLUE
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance BLUE
  import-route direct
  import-route ospf 2
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
ospf 2 vpn-instance BLUE
 import-route bgp
 area 0.0.0.0
  network 10.1.2.0 0.0.0.255
#
pim
#
pim vpn-instance BLUE
 static-rp 4.4.4.4
#
return </pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
multicast routing-enable
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 pim sm
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 pim sm
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 pim sm
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
pim
 c-bsr LoopBack1
 c-rp LoopBack1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast routing-enable
#
ip vpn-instance BLUE
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 239.0.0.0 binding mtunnel 0
#
ip vpn-instance RED
 ipv4-family
  route-distinguisher 200:1
  vpn-target 200:1 export-extcommunity
  vpn-target 200:1 import-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  multicast-domain share-group 238.0.0.0 binding mtunnel 1
  multicast extranet select-rpf vpn-instance BLUE group 228.0.0.0 255.255.255.0
#
mpls lsr-id 3.3.3.3
#               
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip binding vpn-instance RED
 ip address 10.1.3.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 pim sm
#
interface MTunnel0
 ip binding vpn-instance BLUE
 ip address 3.3.3.3 255.255.255.255
#
interface MTunnel1
 ip binding vpn-instance RED
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance BLUE
  import-route direct
  import-route ospf 2
 #
 ipv4-family vpn-instance RED
  import-route direct
  import-route ospf 2
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
ospf 2 vpn-instance RED
 import-route bgp
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
#
pim
#
pim vpn-instance RED
 static-rp 4.4.4.4
#
pim vpn-instance BLUE
 static-rp 4.4.4.4
#
return
</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 pim sm
#
ospf 2
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
#
pim
 static-rp 4.4.4.4
#
return </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo portswitch
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo portswitch
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 pim sm
 igmp enable
 igmp static-group 228.0.0.1
 #
ospf 2
 area 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 10.1.4.0 0.0.0.255
#
pim
 static-rp 4.4.4.4
#
return 
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2133.html">Configuration Examples for an IPv4 Multicast VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2275.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2263.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>