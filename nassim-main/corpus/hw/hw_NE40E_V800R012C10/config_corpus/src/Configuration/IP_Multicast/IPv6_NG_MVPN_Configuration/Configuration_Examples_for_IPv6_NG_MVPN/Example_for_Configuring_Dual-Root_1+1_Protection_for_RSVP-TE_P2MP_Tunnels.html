
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dual-Root 1+1 Protection for RSVP-TE P2MP Tunnels">
<meta name="abstract" content="This section provides an example for configuring dual-root 1+1 protection for RSVP-TE P2MP tunnels.">
<meta name="description" content="This section provides an example for configuring dual-root 1+1 protection for RSVP-TE P2MP tunnels.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0212.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0274.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_00275.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv6 Multicast VPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0317769384">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Dual-Root 1+1 Protection for RSVP-TE P2MP Tunnels</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0317769384"></a><a name="EN-US_TASK_0317769384"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dual-Root 1+1 Protection for RSVP-TE P2MP Tunnels</h1>
<div class="taskbody"><p>This section provides an example for configuring dual-root 1+1 protection for RSVP-TE P2MP tunnels.</p>
<div class="context"><a name="EN-US_TASK_0317769384__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In an NG MVPN scenario, if a sender PE on a P2MP tunnel fails, the C-multicast service will be interrupted. Multicast services can rely only on unicast route convergence for recovery. However, unicast route convergence takes a long time, which is unacceptable to the multicast services that have high reliability requirements. To resolve this problem, you can configure dual-root 1+1 protection for RSVP-TE P2MP tunnels. On the network shown in <a href="#EN-US_TASK_0317769384__fig_dc_vrp_cfg_ngmvpn_001601">Figure 1</a>, a primary RSVP-TE P2MP tunnel is established with PE1 as the root node, and a backup RSVP-TE P2MP tunnel is established with PE2 as the root node. When links are working properly, multicast traffic is forwarded through both the primary and backup tunnels bidirectionally. The leaf node PE3 selects the multicast traffic received from the primary tunnel and discards the multicast traffic received from the backup tunnel. If PE1 fails, the leaf node can use BFD for P2MP TE to quickly detect the RSVP-TE P2MP tunnel fault and choose to accept the multicast traffic received from the backup tunnel. This accelerates multicast service convergence and improves reliability.</p>
<div class="fignone" id="EN-US_TASK_0317769384__fig_dc_vrp_cfg_ngmvpn_001601"><a name="EN-US_TASK_0317769384__fig_dc_vrp_cfg_ngmvpn_001601"></a><a name="fig_dc_vrp_cfg_ngmvpn_001601"></a><span class="figcap"><b>Figure 1 </b>Configuring dual-root 1+1 protection for RSVP-TE P2MP tunnels</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface 1, interface 2, and interface 3 represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0317787007.png" width="520.129335309066" height="NaN" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0317769384__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure BGP/MPLS IPv6 VPN and ensure that the unicast VPN is working properly.</p>
</li><li><p>Enable P2MP TE globally and configure a P2MP TE template on PEs so that the PEs can use RSVP-TE to establish P2MP tunnels.</p>
</li><li><p>Establish a BGP MVPN peer relationship between the PEs so that the PEs can use BGP to exchange A-D and C-multicast routes.</p>
</li><li><p>Configure PE1 and PE2 as sender PEs. Configure RSVP-TE P2MP on PE1 and PE2 so that two RSVP-TE P2MP tunnels rooted at PE1 and PE2 respectively are established, with PE3 as a leaf node.</p>
</li><li><p>Configure BFD for P2MP TE on the PEs to detect public network node or link failures.</p>
</li><li><p>Configure VPN FRR on PE3 so that PE3 can have two routes to the same multicast source. PE3 uses the route advertised by PE1 as the primary route and the route advertised by PE2 as the backup route.</p>
</li><li><p>Enable C-multicast FRR on PE3.</p>
</li><li><p>Configure PIM on the PEs' interfaces bound to a VPN instance and on the CEs' interfaces connected to PEs so that VPN multicast routing entries are generated for multicast traffic forwarding.</p>
</li><li><p>Configure MLD on the interface connecting a multicast device (CE2) to the user network segment to allow the device to manage multicast group members on the local network.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0317769384__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IS-IS process ID on the public network: 1; IS-IS level: Level-2; system IDs of PE1, PE2, and PE3: 10.0000.0000.0001.00, 10.0000.0000.0002.00, and 10.0000.0000.0003.00.</p>
</li><li><div class="p">VPN instance name on PE1, PE2, and PE3: VPNA; other data is shown in <a href="#EN-US_TASK_0317769384__table_dc_vrp_cfg_ngmvpn_001601">Table 1</a>.
<div class="tableBorder"><a name="EN-US_TASK_0317769384__table_dc_vrp_cfg_ngmvpn_001601"></a><a name="table_dc_vrp_cfg_ngmvpn_001601"></a><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" id="EN-US_TASK_0317769384__table_dc_vrp_cfg_ngmvpn_001601" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Data needed for each device</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.2.2.8.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.2.2.8.1.2" liSelected="liSelected"><p>IP Address of Loopback 1</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.2.2.8.1.3" liSelected="liSelected"><p>MPLS LSR-ID</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.2.2.8.1.4" liSelected="liSelected"><p>MVPN ID</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="6.445672191528545%" id="mcps1.4.3.3.2.1.2.2.8.1.5" liSelected="liSelected"><p>RD</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="6.445672191528545%" id="mcps1.4.3.3.2.1.2.2.8.1.6" liSelected="liSelected"><p>VPN-Target</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.2.2.8.1.7" liSelected="liSelected"><p>AS Number</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.2 "><p>1.1.1.1</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.4 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.5 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.6 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.7 "><p>AS65001</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.2 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.3 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.4 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.5 "><p>200:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.6 "><p>3:3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.7 "><p>AS100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.2 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.3 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.4 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.5 "><p>300:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.6 "><p>3:3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.7 "><p>AS100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.2 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.3 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.4 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.5 "><p>400:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.6 "><p>3:3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.7 "><p>AS100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.2 "><p>5.5.5.5</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.4 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.5 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.2.2.8.1.6 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.2.2.8.1.7 "><p>AS65002</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0317769384__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure BGP/MPLS IPv6 VPN.</span><ol type="a"><li class="substepexpand"><span>Assign an IP address to each interface of devices on the backbone network and VPN sites.</span><p><p>Assign an IP address to each interface according to <a href="#EN-US_TASK_0317769384__fig_dc_vrp_cfg_ngmvpn_001601">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0317769384__example_dc_vrp_cfg_ngmvpn_001601">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure an IGP for interworking on the BGP/MPLS IPv6 VPN backbone network.</span><p><p>IS-IS is used in this example. For configuration details, see <a href="#EN-US_TASK_0317769384__example_dc_vrp_cfg_ngmvpn_001601">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure basic MPLS functions and MPLS TE on the MPLS backbone network to establish MPLS TE tunnels.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>ip address unnumbered interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>destination 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>ip address unnumbered interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>destination 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel10] <strong>ip address unnumbered interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel10] <strong>destination 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface Tunnel11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>ip address unnumbered interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Tunnel11] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Establish an MP-IBGP peer relationship between the PEs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv6] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv6] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure a VPN instance on each PE for the access of the corresponding CE.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ipv6 address 2001:db8:2::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>ipv6 address 2001:db8:3::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>route-distinguisher 400:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address </strong><strong>2001:db8:4::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure a tunnel policy and apply it to the VPN instance.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>tunnel binding destination 4.4.4.4 te Tunnel10 down-switch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>tnl-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>tunnel binding destination 4.4.4.4 te Tunnel10 down-switch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>tnl-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>tunnel-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-p1] <strong>tunnel binding destination 2.2.2.2 te Tunnel10 down-switch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-p1] <strong>tunnel binding destination 3.3.3.3 te Tunnel11 down-switch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-tunnel-policy-p1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>tnl-policy p1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Establish BGP peer relationships between the PEs and CEs to import VPN routes.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-VPNA] <strong>peer 2001:DB8:2::2 as-number 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-VPNA] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>bgp 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 2001:DB8:2::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>peer 2001:DB8:2::1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li></ul>
<p>The configurations between PE2 and CE1, and between PE3 and CE2 are similar to the configurations between PE1 and CE1. For configuration details, see <a href="#EN-US_TASK_0317769384__example_dc_vrp_cfg_ngmvpn_001601">Configuration Files</a> in this section.</p>
<p>After the configurations are complete, run the <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance+verbose"><b><span class="cmdname">display ipv6 routing-table vpn-instance verbose</span></b></a> command on PE3. The command output shows a backup unicast route to the multicast source.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display ipv6 routing-table vpn-instance VPNA 2001:DB8:1::6 verbose</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : VPNA
Summary Count : 1
Destination  : 2001:DB8:1::                            PrefixLength : 64
NextHop      : ::FFFF:2.2.2.2                          Preference   : 255
Neighbour    : ::2.2.2.2                               ProcessID    : 0
Label        : 48062                                   Protocol     : IBGP
State        : Active Adv Relied                       Cost         : 20
Entry ID     : 0                                       EntryFlags   : 0x00000000
Reference Cnt: 0                                       Tag          : 0
Priority     : low                                     Age          : 74sec
IndirectID   : 0x1000120                               Instance     : 
RelayNextHop :                                         TunnelID     : 0x0000000001004c4b47
Interface    : Tunnel10                                Flags        : RD
BkNextHop    : ::FFFF:3.3.3.3                          BkInterface  : Tunnel11
BkLabel      : 48061                                   BkTunnelID   : 0x0  
BkPETunnelID : 0x0000000001004c4b43                    BkIndirectID : 0x100011A</pre>
</p></li></ol>
</li><li><span>Enable P2MP TE globally and configure a P2MP TE template.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls te p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-te-p2mp-template-t1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls te p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-te-p2mp-template-t1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p><p><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>mpls te p2mp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP MVPN peer relationship between PEs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn6] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn6] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv6-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn6] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn6] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
<p>After completing the configurations, run the <a href="cmdqueryname=display+bgp+mvpn+vpnv6+all+peer"><b><span class="cmdname">display bgp mvpn vpnv6 all peer</span></b></a> command on the PEs. The command output shows that PE3 has established a BGP MVPN peer relationship with PE1 and PE2. The following example uses the command output on PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display bgp mvpn vpnv6 all peer</strong></pre>
<pre class="screen"> BGP local router ID : 10.1.1.2
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2.2.2.2         4         100      275      290     0 03:10:56 <strong>Established</strong>    1
  3.3.3.3         4         100      286      294     0 03:44:39 <strong>Established</strong>    1
</pre>
</p></li><li><span>Configure each PE to use RSVP-TE to establish an I-PMSI tunnel.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast ipv6 mvpn 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi-mpls-te] <strong>p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi-mpls-te] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast ipv6 mvpn 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi-mpls-te] <strong>p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi-mpls-te] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>multicast ipv6 mvpn 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
<p>After the configuration is complete, run the <a href="cmdqueryname=display+mvpn+ipv6+vpn-instance+ipmsi"><b><span class="cmdname">display mvpn ipv6 vpn-instance ipmsi</span></b></a> command on the PEs to check I-PMSI tunnel information. The following example uses the command outputs on PE1 and PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mvpn ipv6 vpn-instance VPNA ipmsi</strong></pre>
<pre class="screen">MVPN local I-PMSI information for VPN-Instance: VPNA
Tunnel type: RSVP-TE P2MP LSP
<span>Tunnel state: Up </span>
P2MP ID: 0x2020202
Tunnel ID: 32769
Extended tunnel ID: 2.2.2.2
Root: 2.2.2.2 (local)
Leaf:
  1: 4.4.4.4       </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display mvpn ipv6 vpn-instance VPNA ipmsi</strong></pre>
<pre class="screen">MVPN local I-PMSI information for VPN-Instance: VPNA
Tunnel type: RSVP-TE P2MP LSP
<span>Tunnel state: Up </span>
P2MP ID: 0x3030303
Tunnel ID: 32769
Extended tunnel ID: 3.3.3.3
Root: 3.3.3.3 (local)
Leaf:
  1: 4.4.4.4    </pre>
<p>According to the preceding command outputs, two RSVP-TE P2MP tunnels have been established, with PE1 and PE2 as their root nodes and PE3 as a leaf node.</p>
</p></li><li><span>Configure BFD for P2MP TE on the PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls te p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-te-p2mp-template-t1] <strong>bfd enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-te-p2mp-template-t1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls te p2mp-template t1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-te-p2mp-template-t1] <strong>bfd enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-te-p2mp-template-t1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p><p><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bfd] <strong>mpls-passive</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure VPN FRR on PE3.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv6-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-6-VPNA] <strong>auto-frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-6-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Enable C-multicast FRR on PE3.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6-mvpn] <strong>c-multicast frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure PIM.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>multicast ipv6 routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Configure MLD.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim ipv6 sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>mld enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>mld version 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, RSVP-TE P2MP tunnels have dual-root 1+1 protection. After users of CE2 send MLD Report messages and the multicast source at 2001:DB8:1::264 sends multicast traffic, you can check multicast routing entries.</p>
<ul><li><p>When the links are working properly:</p>
<div class="p"># Display the PIM routing table on PE3. As dual-root 1+1 protection is configured for RSVP-TE P2MP tunnels, the command output shows that a backup PIM entry has been generated.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display pim ipv6 vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (2001:DB8:1::264, FF1E::3)
     RP: NULL
     Protocol: pim-sm, Flag: SPT ACT
     UpTime: 03:12:27
     Upstream interface: through-BGP, Refresh time: 03:12:27
         Upstream neighbor: ::FFFF:2.2.2.2
         RPF prime neighbor: ::FFFF:2.2.2.2
         <strong>Backup Upstream neighbor: ::FFFF:3.3.3.3</strong>
         <strong>Backup RPF prime neighbor: ::FFFF:3.3.3.3</strong>
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/0</span>
             Protocol: pim-sm, UpTime: 03:12:27, Expires: 00:03:05 </pre>
</div>
<div class="p"># Display the PIM routing table on CE1. The command output shows that a backup PIM entry has been generated.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display pim ipv6 routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (2001:DB8:1::264, FF1E::3)
     RP: NULL
     Protocol: pim-sm, Flag: SPT LOC ACT
     UpTime: 03:35:37
     Upstream interface: GigabitEthernet<span>0/1/0</span>, Refresh time: 03:35:37
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 03:28:03, Expires: 00:03:28   
        1: GigabitEthernet<span>0/1/2</span>
             Protocol: pim-sm, UpTime: 03:28:03, Expires: 00:03:28   </pre>
</div>
</li><li><p>If a link fails:</p>
<div class="p"># Run the <strong>shutdown</strong> command on GE <span>0/1/0</span> of PE1 to simulate a link failure.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
<p># Run the <a href="cmdqueryname=display+pim+ipv6+routing-table"><b><span class="cmdname">display pim ipv6 routing-table</span></b></a> command on receiver CE2 and sender CE1 to check their PIM routing tables. Run the <a href="cmdqueryname=display+pim+ipv6+vpn-instance"><b><span class="cmdname">display pim ipv6 vpn-instance</span></b></a> <strong><span>routing-table</span></strong> command on receiver PE3 and sender PE2 to check the PIM routing table of the VPN instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display pim ipv6 routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (2001:DB8:1::264, FF1E::3)
     RP: NULL
     Protocol: pim-sm, Flag: SPT SG_RCVR ACT
     UpTime: 05:39:14
     Upstream interface: GigabitEthernet<span>0/1/0</span>, Refresh time: 05:39:14
         Upstream neighbor: FE80::3AA3:8FFF:FE51:305
         RPF prime neighbor: FE80::3AA3:8FFF:FE51:305
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: mld, UpTime: 05:39:14, Expires: -  </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display pim ipv6 vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (2001:DB8:1::264, FF1E::3)
     RP: NULL
     Protocol: pim-sm, Flag: SPT ACT
     UpTime: 03:32:13
     Upstream interface: through-BGP, Refresh time: 03:32:13
         Upstream neighbor: ::FFFF:3.3.3.3
         RPF prime neighbor: ::FFFF:3.3.3.3
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/0</span>
             Protocol: pim-sm, UpTime: 03:32:13, Expires: 00:03:19   </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim ipv6 vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (2001:DB8:1::264, FF1E::3)
     RP: NULL
     Protocol: pim-sm, Flag: SPT SG_RCVR ACT
     UpTime: 03:25:51
     Upstream interface: GigabitEthernet<span>0/1/2</span>, Refresh time: 03:25:51
         Upstream neighbor: FE80::3AA3:8FFF:FE51:304
         RPF prime neighbor: FE80::3AA3:8FFF:FE51:304
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: pseudo
             Protocol: BGP, UpTime: 03:25:51, Expires: -        </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display pim ipv6 routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (2001:DB8:1::264, FF1E::3)
     RP: NULL
     Protocol: pim-sm, Flag: SPT LOC ACT
     UpTime: 03:35:37
     Upstream interface: GigabitEthernet<span>0/1/0</span>, Refresh time: 03:35:37
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/2</span>
             Protocol: pim-sm, UpTime: 03:28:03, Expires: 00:03:28   </pre>
<p>The command outputs show that traffic exists in the backup tunnel because a backup upstream device is available. Multicast traffic in the backup tunnel is forwarded to receivers immediately after BFD detects that the primary tunnel is faulty.</p>
</li></ul>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0317769384__example_dc_vrp_cfg_ngmvpn_001601"><a name="EN-US_TASK_0317769384__example_dc_vrp_cfg_ngmvpn_001601"></a><a name="example_dc_vrp_cfg_ngmvpn_001601"></a><a name="EN-US_TASK_0317769384__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1</p>
<pre class="screen">#
sysname CE1
#
multicast ipv6 routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:1::1/64
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2::2/64
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:3::2/64
 pim ipv6 sm
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 65001
 peer 2001:DB8:2::1 as-number 100
 peer 2001:DB8:3::1 as-number 100
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:DB8:2::1 enable
  peer 2001:DB8:3::1 enable
#
return</pre>
</li><li><p>PE1</p>
<pre class="screen">#
sysname PE1
#
multicast ipv6 mvpn 2.2.2.2
#
ip vpn-instance VPNA
 ipv6-family
  route-distinguisher 200:1
  apply-label per-instance
  tnl-policy p1
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast ipv6 routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   ipmsi-tunnel
    mpls te
     p2mp-template t1
#
bfd
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls te p2mp-te
 mpls rsvp-te
 mpls te cspf
#
mpls te p2mp-template t1
 bfd enable
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0001.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ipv6 enable
 ipv6 address 2001:DB8:2::1/64
 pim ipv6 sm
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.4
 mpls te reserved-for-binding
 mpls te tunnel-id 100
#
bgp 100
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv6-family unicast
  undo synchronization
  peer 4.4.4.4 enable
 #
 ipv6-family mvpn
  policy vpn-target
  peer 4.4.4.4 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 4.4.4.4 enable
 #
 ipv6-family vpn-instance VPNA
  import-route direct
  peer 2001:DB8:2::2 as-number 65001
#
tunnel-policy p1
 tunnel binding destination 4.4.4.4 te Tunnel10 down-switch 
#
return</pre>
</li><li><p>PE2</p>
<pre class="screen">#
sysname PE2
#
multicast ipv6 mvpn 3.3.3.3
#
ip vpn-instance VPNA
 ipv6-family
  route-distinguisher 300:1
  apply-label per-instance
  tnl-policy p1
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast ipv6 routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   ipmsi-tunnel
    mpls te
     p2mp-template t1
#
bfd
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
 mpls te p2mp-te
 mpls rsvp-te
 mpls te cspf
#
mpls te p2mp-template t1
 bfd enable    
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te     
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ipv6 enable
 ip binding vpn-instance VPNA
 ipv6 address 2001:DB8:3::1/64
 pim ipv6 sm
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 4.4.4.4
 mpls te reserved-for-binding
 mpls te tunnel-id 200
#
bgp 100
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv6-family unicast
  undo synchronization
  peer 4.4.4.4 enable
 #
 ipv6-family mvpn
  policy vpn-target
  peer 4.4.4.4 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 4.4.4.4 enable
 #
 ipv6-family vpn-instance VPNA
  import-route direct
  peer 2001:DB8:3::2 as-number 65001
#
tunnel-policy p1
 tunnel binding destination 4.4.4.4 te Tunnel10 down-switch
#
return</pre>
</li><li><p>PE3</p>
<pre class="screen">#
sysname PE3
#
multicast ipv6 mvpn 4.4.4.4
#
ip vpn-instance VPNA
 ipv6-family
  route-distinguisher 400:1
  apply-label per-instance
  tnl-policy p1
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast ipv6 routing-enable
  mvpn
   c-multicast signaling bgp
   c-multicast frr
#
bfd
 mpls-passive
#
mpls lsr-id 4.4.4.4    
#
mpls
 mpls te
 mpls te p2mp-te
 mpls rsvp-te
 mpls te cspf
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.1.3 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te      
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te   
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 isis enable 1
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 2.2.2.2
 mpls te reserved-for-binding
 mpls te tunnel-id 100
#
interface Tunnel11
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.3
 mpls te reserved-for-binding
 mpls te tunnel-id 200
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv6-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv6-family mvpn
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 ipv6-family vpn-instance VPNA
  import-route direct
  auto-frr
  peer 2001:DB8:4::2 as-number 65001
#
tunnel-policy p1
 tunnel binding destination 2.2.2.2 te Tunnel10 down-switch
 tunnel binding destination 3.3.3.3 te Tunnel11 down-switch  
#
return</pre>
</li><li><p>CE2</p>
<pre class="screen">#
sysname CE2
#
multicast ipv6 routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:4::2/64
 pim ipv6 sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:5::2/64
 pim ipv6 sm
 mld enable
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
bgp 65002
 peer 2001:DB8:4::1 as-number 100
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:DB8:4::1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0212.html">Configuration Examples for IPv6 NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0274.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_00275.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>