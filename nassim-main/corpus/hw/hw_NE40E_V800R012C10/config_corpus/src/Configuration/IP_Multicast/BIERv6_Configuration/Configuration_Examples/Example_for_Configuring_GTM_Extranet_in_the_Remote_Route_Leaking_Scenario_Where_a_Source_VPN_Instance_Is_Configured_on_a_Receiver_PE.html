
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring GTM Extranet in the Remote Route Leaking Scenario Where a Source VPN Instance Is Configured on a Receiver PE">
<meta name="abstract" content="This section provides an example for configuring GTM extranet in the remote route leaking scenario where a source VPN instance is configured on a receiver PE.">
<meta name="description" content="This section provides an example for configuring GTM extranet in the remote route leaking scenario where a source VPN instance is configured on a receiver PE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0051.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_gtm_0122.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIERv6">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001255450249">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring GTM Extranet in the Remote Route Leaking Scenario Where a Source VPN Instance Is Configured on a Receiver PE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001255450249"></a><a name="EN-US_TASK_0000001255450249"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring GTM Extranet in the Remote Route Leaking Scenario Where a Source VPN Instance Is Configured on a Receiver PE</h1>
<div class="taskbody"><p>This section provides an example for configuring GTM extranet in the remote route leaking scenario where a source VPN instance is configured on a receiver PE.</p>
<div class="context"><a name="EN-US_TASK_0000001255450249__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In a GTM application, a service provider needs to provide multicast services from a VPN for users on a public network. In this case, service traffic needs to be imported from the VPN to the public network for multicast service distribution.</p>
<p>In the remote route leaking scenario shown in <a href="#EN-US_TASK_0000001255450249__fig44631823184117">Figure 1</a>, the receiver on the public network requires multicast data from the source in VPN BLUE. To meet this requirement, configure GTM extranet. Specifically, configure receiver GTM on root node PE1 and configure PE1 to import VPN unicast routes into the public network instance so that PE1 sends multicast data to PE2 over the VPN NG tunnel connecting them. In addition, on receiver PE2, configure a multicast route selection policy, in which VPN BLUE is specified for the upstream interface of the RPF route. In this way, the receiver in the GTM instance can receive multicast data from the multicast source in VPN BLUE.</p>
<div class="fignone" id="EN-US_TASK_0000001255450249__fig44631823184117"><a name="EN-US_TASK_0000001255450249__fig44631823184117"></a><a name="fig44631823184117"></a><span class="figcap"><b>Figure 1 </b>Configuring GTM extranet in the remote route leaking scenario where a source VPN instance is configured on a receiver PE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interface 1 and interface 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001212542478.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001255450249__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic functions of single-AS NG MVPN and GTM.</p>
</li><li><p>Configure a public network instance on PE2.</p>
</li><li><p>Configure an RP to serve the GTM group.</p>
</li><li><p>Configure on PE2 a GTM multicast route selection policy, in which VPN BLUE is specified for the upstream interface of the RPF route.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001255450249__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>RD and VPN target of VPN BLUE: 100:1; VPN target of MVPN routes: 1:1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001255450249__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure NG MVPN and GTM functions.</span><ol type="a"><li class="substepexpand"><span>Configure an IPv6 address for each interface. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section. Similar details will be omitted in the rest of the document.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:DB8:1::2 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address 2001:DB8:10::1 128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a unicast routing protocol on the public network to ensure that multicast routes on the public network are reachable. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-2</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet </strong><strong><span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface Loopback 1</strong>
[<span class="keyword">*</span>PE1-Loopback1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-Loopback1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a VPN instance, and enable the IPv4 address family for the VPN instance on each PE. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>route-distinguisher 100:1</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>vpn-target 100:1 both</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE] <strong>quit</strong>
[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.1 24</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish an EBGP peer relationship between each PE and the corresponding CE. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>bgp 65410</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>router-id 11.11.11.11</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>peer 192.168.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>peer 192.168.1.2 as-number 65410</strong>
[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>commit</strong>
[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish an MP-IBGP peer relationship between PEs, and configure a unicast routing protocol between each PE and the corresponding CE to ensure that routes are reachable between them. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:20::1 as-number 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:20::1 connect-interface LoopBack 1</strong>
[<span class="keyword">*</span>PE1-bgp]<strong> ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4]<strong> peer 2001:DB8:20::1 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp]<strong> ipv4-family unicast</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:20::1 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:20::1 advertise-ext-community</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure basic SRv6 functions and SRv6 SIDs. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:db8:10::1</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator PE1 ipv6-prefix 2001:DB8:100:: 64 static 32</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>qui</strong><strong>t</strong>
[<span class="keyword">*</span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4]<strong> peer 2001:DB8:20::1 prefix-sid advertise-srv6-locator</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>segment-routing ipv6 locator PE1</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2001:DB8:20::1 prefix-sid</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-bgp-BLUE] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>PE1-bgp-BLUE] <strong>segment-routing ipv6 locator PE1</strong>
[<span class="keyword">*</span>PE1-bgp-BLUE] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing ipv6 locator PE1 auto-sid-disable</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure basic BIERv6 functions and enable IS-ISv6 for BIERv6. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bier</strong>
[<span class="keyword">*</span>PE1-bier] <strong>sub-domain 0</strong> <strong>ipv6</strong>
[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>bfr-id 1</strong>
[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>encapsulation-type ipv6 bsl 256 max-si 0</strong>
[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>bfr-prefix interface loopback1</strong>
[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>end-bier locator PE1 sid 2001:db8:100::3</strong>
[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6]<strong> protocol isis</strong>
[<span class="keyword">*</span>PE1-bier-sub-domain-0-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bier] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>bier enable</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Establish a BGP MVPN peer relationship between PEs. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family mvpn</strong>
[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 2001:DB8:20::1 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure multicast traffic forwarding over a BIERv6 I-PMSI tunnel. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast routing-enable</strong>
[<span class="keyword">*</span>PE1] <strong>multicast mvpn ipv6-underlay 2001:DB8:10::1</strong>
[<span class="keyword">*</span>PE1] <strong>ip vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>multicast routing-enable</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>mvpn</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn] <strong>vpn-target 1:1 both</strong> 
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn] <strong>sender-enable</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn] <strong>ipv6 underlay enable</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn] <strong>src-dt4 locator PE1 sid 2001:DB8:100::2</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn] <strong>rpt-spt mode</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn-ipmsi] <strong>bier</strong> <strong>sub-domain 0 bsl 256</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn-ipmsi] <strong>quit</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4-mvpn] <strong>quit</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-vpn-instance-BLUE] <strong>quit</strong>
[<span class="keyword">*</span>PE1]<strong> multicast vpn-public</strong>
[<span class="keyword">*</span>PE1-mvpn-pub] <strong>sender-enable</strong>
[<span class="keyword">*</span>PE1-mvpn-pub] <strong>ipv6 underlay enable</strong>
[<span class="keyword">*</span>PE1-mvpn-pub] <strong>src-dt4 locator PE1 sid 2001:DB8:100::1</strong>
[<span class="keyword">*</span>PE1-mvpn-pub] <strong>rpt-spt</strong> <strong>mode</strong>
[<span class="keyword">*</span>PE1-mvpn-pub] <strong>ipmsi-tunnel</strong>
[<span class="keyword">*</span>PE1-mvpn-pub-ipmsi] <strong>bier sub-domain 0 bsl 256</strong>
[<span class="keyword">*</span>PE1-mvpn-pub-ipmsi] <strong>quit</strong>
[<span class="keyword">*</span>PE1-mvpn-pub] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Enable PIM on PEs. The configuration of PE1 is used as an example. The configuration of PE2 is similar to that of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet </strong><span>0/2/0</span>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface Loopback 2</strong>
[<span class="keyword">*</span>PE1-Loopback2] <strong>ip binding vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-Loopback2] <strong>ip address 10.1.1.1 255.255.255.255</strong>
[<span class="keyword">*</span>PE1-Loopback2] <strong>pim sm</strong> 
[<span class="keyword">*</span>PE1-Loopback2] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a unicast routing protocol and enable the multicast function for VPN BLUE and the GTM instance to ensure that multicast routes of the VPN instance are reachable.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast routing-enable</strong>
[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.2 24</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.11.2 24</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>router-id 11.11.11.11</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>peer 192.168.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>CE1-bgp-af-ipv4] <strong>import-route direct</strong>
[<span class="keyword">*</span>CE1-bgp-af-ipv4] <strong>peer 192.168.1.1 enable</strong>
[<span class="keyword">*</span>CE1-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>multicast routing-enable</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.2.2 24</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.4.2 24</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>] <strong>pim sm</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>bgp 65411</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>router-id 12.12.12.12</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>peer 192.168.2.1 as-number 100</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>CE2-bgp-af-ipv4] <strong>peer 192.168.2.1 enable</strong>
[<span class="keyword">*</span>CE2-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure PE1 to import direct routes from the VPN instance to the public network instance.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip import-rib vpn-instance </strong><strong>BLUE protocol direct</strong>
[<span class="keyword">*</span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>import-rib vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Configure a VPN RP to serve the GTM extranet group.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim</strong>
[<span class="keyword">*</span>CE1-pim] <strong>static-rp 10.1.1.1</strong>
[<span class="keyword">*</span>CE1-pim] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pim vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE1-pim-BLUE] <strong>static-rp 10.1.1.1</strong>
[<span class="keyword">*</span>PE1-pim-BLUE] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pim</strong>
[<span class="keyword">*</span>PE2-pim] <strong>static-rp 10.1.1.1</strong>
[<span class="keyword">*</span>PE2-pim] <strong>quit</strong>
[<span class="keyword">*</span>PE2]<strong> pim vpn-instance BLUE</strong>
[<span class="keyword">*</span>PE2-pim-BLUE] <strong>static-rp 10.1.1.1</strong>
[<span class="keyword">*</span>PE2-pim-BLUE] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>pim</strong>
[<span class="keyword">*</span>CE2-pim] <strong>static-rp 10.1.1.1</strong>
[<span class="keyword">*</span>CE2-pim] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure for the GTM instance a multicast route selection policy, in which VPN BLUE is specified for the upstream interface of the RPF route selected for the PIM entry with the group address 228.1.1.0/24.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast vpn-public</strong>
[<span class="keyword">*</span>PE2-mvpn-pub] <strong>multicast extranet select-rpf vpn-instance BLUE group 228.1.1.0 24</strong>
[<span class="keyword">*</span>PE2-mvpn-pub] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Verifying the Configuration</span><p><p>By checking the configuration result, you can verify that the receiver in the GTM instance receives multicast data from the multicast source in VPN BLUE.</p>
<p>Run the <strong>display pim routing-table</strong> command on PE2 to check information about its PIM routing table. The following command output shows PIM routing entries of VPN BLUE whose receivers belong to the public network instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance BLUE routing-table extranet receive-vpn-instance all</strong></pre>
<pre class="screen"> VPN-Instance: BLUE 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 10.1.1.1 
     Protocol: pim-sm, Flag: WC EXTRANWET 
     UpTime: 00:47:55
     Upstream interface: <strong>through-BGP</strong>, Refresh time: 00:47:55
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams:none

     Extranet receiver(s): 1
        1: _public_
     
 
 (192.168.11.0, 228.0.0.1)
     RP: 10.1.1.1 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 06:18:43
     Upstream interface: <strong>through-BGP</strong>, Refresh time: 06:18:43
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: none

     Extranet receiver(s): 1
        1: _public_</pre>
<p>Run the <a href="cmdqueryname=display+pim+routing-table"><b><span class="cmdname">display pim routing-table</span></b></a> command on PE2 to check information about its PIM routing table. The following command output shows that the upstream interface of the RPF route selected by the PIM entry with 228.0.0.1 as the group address belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim routing-table 228.0.0.1 extranet source-vpn-instance vpn-instance BLUE</strong>
 VPN-Instance: public net 
 Total matched 1 (*, G) entry; 1 (S, G) entry

 (*, 228.0.0.1)
     RP: 10.1.1.1 
     Protocol: pim-sm, Flag: WC EXTRANWET 
     UpTime: 00:47:55
     Upstream interface: <strong>MCAST_Extranet(BLUE)</strong>, Refresh time: 00:47:55
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/2/0</span>
             Protocol: pim-sm, UpTime: 00:47:55, Expires: 00:02:34
     
 (192.168.11.0, 228.0.0.1)
     RP: 10.1.1.1 
     Protocol: pim-sm, Flag: SPT ACT 
     UpTime: 06:18:43
     Upstream interface: <strong>MCAST_Extranet(BLUE)</strong>, Refresh time: 06:18:43
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/2/0</span>
             Protocol: pim-sm, UpTime: 00:47:57, Expires: 00:02:32</pre>
<p>Run the <strong>display multicast routing-table</strong> command on PE2 to check information about its multicast routing table. The following command output shows that the upstream interface of the RPF route selected by the multicast route entry with 228.0.0.1 as the group address belongs to VPN BLUE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display multicast routing-table extranet source-vpn-instance vpn-instance BLUE</strong></pre>
<pre class="screen">Multicast routing table of VPN instance: _public_
 Total 0 (*, G) entry; 1 (S, G) entry, 1 matched
 
 00001: (192.168.11.0, 228.0.0.1)
       Uptime: 00:42:23     
       Upstream Interface: <strong>MCAST_Extranet(BLUE)</strong>
       List of 1 downstream interface
           1: GigabitEthernet<span>0/2/0</span></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001255450249__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
multicast routing-enable
#
multicast mvpn ipv6-underlay 2001:DB8:10::1
#
multicast vpn-public
 ipv6 underlay enable
 sender-enable
 src-dt4 locator PE1 sid 2001:DB8:100::1
 rpt-spt mode
 ipmsi-tunnel
  bier sub-domain 0 bsl 256
#
ip vpn-instance BLUE
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  mvpn
   vpn-target 1:1 export-extcommunity
   vpn-target 1:1 import-extcommunity
   ipv6 underlay enable
   sender-enable
   src-dt4 locator PE1 sid 2001:DB8:100::2
   rpt-spt mode
   ipmsi-tunnel
    bier sub-domain 0 bsl 256
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:10::1
 locator PE1 ipv6-prefix 2001:DB8:100:: 64 static 32
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0001.00
 bier enable
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator PE1 auto-sid-disable
 #
#
ip import-rib vpn-instance BLUE protocol direct
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:1::2/96
 isis ipv6 enable 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance BLUE
 ipv6 enable
 ip address 192.168.1.1 255.255.255.0
 pim sm
#
interface LoopBack1
  ipv6 enable
  ipv6 address 2001:DB8:10::1/128
  isis ipv6 enable 1
#
interface LoopBack2
 ip binding vpn-instance BLUE
 ip address 10.1.1.1 255.255.255.255
 pim sm
#
bgp 100
 router-id 1.1.1.1
 peer 192.168.1.2 as-number 65410
 peer 2001:DB8:20::1 as-number 100
 peer 2001:DB8:20::1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  import-rib vpn-instance BLUE
  segment-routing ipv6 locator PE1
  segment-routing ipv6 best-effort
  peer 192.168.1.2 enable
  peer 2001:DB8:20::1 enable
  peer 2001:DB8:20::1 advertise-ext-community
  peer 2001:DB8:20::1 prefix-sid advertise-srv6-locator
 #
 ipv4-family mvpn
  policy vpn-target
  peer 2001:DB8:20::1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:20::1 enable
  peer 2001:DB8:20::1 prefix-sid
 #
 ipv4-family vpn-instance BLUE
  import-route direct
  segment-routing ipv6 locator PE1
  segment-routing ipv6 best-effort
  peer 192.168.1.2 as-number 65410
#
pim vpn-instance BLUE
 static-rp 10.1.1.1
#
bier
 sub-domain 0 ipv6       
  bfr-id 1
  bfr-prefix interface LoopBack1       
  protocol isis     
  end-bier locator PE1 sid 2001:DB8:100::3  
  encapsulation-type ipv6 bsl 256 max-si 0
#  
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast routing-enable
#
multicast mvpn ipv6-underlay 2001:DB8:20::1
#
multicast vpn-public
 ipv6 underlay enable
 c-multicast signaling bgp
 rpt-spt mode
 multicast extranet select-rpf vpn-instance BLUE group 228.1.1.0 255.255.255.0
#
ip vpn-instance BLUE
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:1 export-extcommunity
  vpn-target 100:1 import-extcommunity
  multicast routing-enable
  mvpn
   vpn-target 1:1 export-extcommunity
   vpn-target 1:1 import-extcommunity
   ipv6 underlay enable
   c-multicast signaling bgp
   rpt-spt mode
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:20::1
 locator PE2 ipv6-prefix 2001:DB8:200:: 64 static 32
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0002.00
 bier enable
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator PE2 auto-sid-disable
 #
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:2::2/96
 isis ipv6 enable 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 pim sm
#
interface LoopBack1
  ipv6 enable
  ipv6 address 2001:DB8:20::1/128
  isis ipv6 enable 
#
bgp 100
 router-id 1.1.1.2
 peer 192.168.2.2 as-number 65411
 peer 2001:DB8:10::1 as-number 100
 peer 2001:DB8:10::1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  segment-routing ipv6 locator PE1
  segment-routing ipv6 best-effort
  peer 192.168.2.2 enable
  peer 2001:DB8:10::1 enable
  peer 2001:DB8:10::1 advertise-ext-community
  peer 2001:DB8:10::1 prefix-sid advertise-srv6-locator
 #
 ipv4-family mvpn
  policy vpn-target
  peer 2001:DB8:10::1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2001:DB8:10::1 enable
  peer 2001:DB8:10::1 prefix-sid
 #
 ipv4-family vpn-instance BLUE
  segment-routing ipv6 locator PE2
  segment-routing ipv6 best-effort
#
pim
 static-rp 10.1.1.1
#
pim vpn-instance BLUE
 static-rp 10.1.1.1
#
bier
 sub-domain 0 ipv6       
  bfr-id 2
  bfr-prefix interface LoopBack1       
  protocol isis     
  end-bier locator PE2 sid 2001:DB8:200::3  
  encapsulation-type ipv6 bsl 256 max-si 0
#  
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.11.2 255.255.255.0
 pim sm
#
bgp 65410
 router-id 11.11.11.11
 peer 192.168.1.1 as-number 100 
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 192.168.1.1 enable
#
pim
 static-rp 10.1.1.1
#
return </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.4.2 255.255.255.0
 pim sm
 igmp enable
 igmp version 3
#
bgp 65411
 router-id 12.12.12.12
 peer 192.168.2.1 as-number 100 
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.2.1 enable
#
pim
 static-rp 10.1.1.1
#
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0023.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bierv6_cfg_0051.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_gtm_0122.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>