
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an Inter-AS Seamless MPLS NG MVPN Option B">
<meta name="abstract" content="This example describes how to configure inter-AS seamless MPLS NG MVPN in Option B mode to implement E2E service connectivity, when the devices are in different ASs.">
<meta name="description" content="This example describes how to configure inter-AS seamless MPLS NG MVPN in Option B mode to implement E2E service connectivity, when the devices are in different ASs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0145.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0076.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="IPv4 Multicast VPN_NG MVPN">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001270313585">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an Inter-AS Seamless MPLS NG MVPN Option B</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001270313585"></a><a name="EN-US_TASK_0000001270313585"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an Inter-AS Seamless MPLS NG MVPN Option B</h1>
<div class="taskbody"><p>This example describes how to configure inter-AS seamless MPLS NG MVPN in Option B mode to implement E2E service connectivity, when the devices are in different ASs.</p>
<div class="context"><a name="EN-US_TASK_0000001270313585__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001270313585__fig_dc_vrp_cfg_ngmvpn_007501">Figure 1</a>, the PEs, ABR and ASBRs are in different ASs. To implement interworking between PEs and provide VPN services, you can deploy inter-AS seamless MPLS NG MVPN.</p>
<div class="fignone" id="EN-US_TASK_0000001270313585__fig_dc_vrp_cfg_ngmvpn_007501"><a name="EN-US_TASK_0000001270313585__fig_dc_vrp_cfg_ngmvpn_007501"></a><a name="fig_dc_vrp_cfg_ngmvpn_007501"></a><span class="figcap"><b>Figure 1 </b>Configuring inter-AS seamless MPLS NG MVPN</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE <span>0/1/0</span> and GE <span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001225513796.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270313585__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP protocols at each network to implement network connectivity at each network.</p>
</li><li><p>Configure basic MPLS functions and MPLS LDP on each device to establish MPLS LSPs at each layer.</p>
</li><li><p>Establish IBGP peer relationships at each AS and enable devices to exchange labeled routes.</p>
</li><li><p>Configure an EBGP peer relationship between ASBRs and enable these devices to exchange labeled routes across ASs.</p>
</li><li><p>Configure the ABR as an RR to reflect routes so that PEs can obtain the route destined for each other's loopback interface.</p>
</li><li><p>Configure a routing policy to control label distribution for a BGP LSP to be established on each device. The egress of the BGP LSP to be established needs to assign an MPLS label to the route advertised to an upstream node. If a transit node receives a labeled IPv4 route from downstream, the downstream node must re-assign an MPLS label to the transit node.</p>
</li><li><p>Configure BGP peers.</p>
</li><li><p>Configure multicast traffic transmission over P2MP tunnels.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001270313585__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the devices (1.1.1.1, 2.2.2.2, 3.3.3.3, 4.4.4.4, and 5.5.5.5)</p>
</li><li><p>Route policy configured on each device (policy1)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001270313585__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address for each interface.</span><p><p>Assign an IP address and its mask to every physical interface; configure a loopback interface address as an LSR ID on every device shown in <a href="#EN-US_TASK_0000001270313585__fig_dc_vrp_cfg_ngmvpn_007501">Figure 1</a>; configure OSPF and IS-IS to advertise the route to the network segment of each interface and a host route to each loopback interface address (LSR ID). For configuration details, see <a href="#EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205">Configuration Files</a> in this section.</p>
</p></li><li><span>Enable MPLS and MPLS LDP globally on each device to set up LDP LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the ABR.</p>
<pre class="screen">&lt;ABR&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ABR]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>commit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1]<strong> mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Configure ASBR2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2]<strong> mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure the automatic mLDP P2MP tunnel function.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>mldp recursive-fec</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205">Configuration Files</a> in this section.</p>
<p># Configure the ABR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ABR] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ABR-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-mpls-ldp] <strong>mldp recursive-fec</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ABR-mpls-ldp] <strong>quit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>mldp recursive-fec</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For configuration details, see <a href="#EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205">Configuration Files</a> in this section.</p>
</p></li><li><span>Establish IBGP peer relationships in each AS, establish an EBGP peer relationship between ASBR1 and ASBR2, and enable devices to exchange labeled routes.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2.2.2.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>network 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the ABR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ABR] <strong>bgp 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>peer 1.1.1.1 as-number 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>peer 3.3.3.3 as-number 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 1.1.1.1 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 3.3.3.3 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-mvpn] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-mvpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-mvpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>commit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 2.2.2.2 as-number 1.0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>peer 10.1.3.2 as-number 65535.65535</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>network 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>peer 2.2.2.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-mvpn] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-mvpn] <strong>peer 10.1.3.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-mvpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 10.1.3.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Configure ASBR2.</p>
<pre class="screen">&lt;ASBR2&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2] <strong>bgp 65535.65535</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>peer 5.5.5.5 as-number 65535.65535</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>peer 10.1.3.1 as-number 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>peer 5.5.5.5 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-ipv4] <strong>peer 10.1.3.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-ipv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-mvpn] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-mvpn] <strong>peer 10.1.3.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-mvpn] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv4] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv4] <strong>peer 10.1.3.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv4] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 65535.65535</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 as-number 65535.65535</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>undo synchronization</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure the ABR as an RR to reflect routes so that PE1 and PE2 can obtain the route destined for each other's loopback interface.</span><p><p># Configure the ABR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ABR] <strong>bgp 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 1.1.1.1 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 3.3.3.3 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 3.3.3.3 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-mvpn] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-mvpn] <strong>peer 3.3.3.3 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>peer 1.1.1.1 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>peer 3.3.3.3 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>peer 3.3.3.3 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>commit</strong></pre>
</p></li><li><span>Configure a route-policy on each device to establish BGP LSPs.</span><p><p># Create a route-policy on PE1 and apply the route-policy to the routes to be advertised to a specified peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>peer 2.2.2.2 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205">Configuration Files</a> in this section.</p>
<p># Create a route-policy on the ABR and apply the route-policy to the routes to be advertised to specified peers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ABR] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-route-policy] <strong>if-match mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-route-policy]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>bgp 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 1.1.1.1 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>peer 3.3.3.3 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ABR] <strong>commit</strong></pre>
<p>The configuration of ASBR1 is similar to the configuration of ABR. For configuration details, see <a href="#EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205">Configuration Files</a> in this section.</p>
</p></li><li><span>Create a VPN instance and configure unicast peers.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance ng</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4] <strong>route-distinguisher 1.2.3.4:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance ng</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 1.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance ng</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpn-ng] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpn-ng] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure PEs to use P2MP tunnels to carry multicast traffic.</span><p><p># Configure PE1 as a sender PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast mvpn 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance ng</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ng] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ng-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4-mvpn] <strong>auto-discovery inter-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4-mvpn-ipmsi] <strong>mldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-ng] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-ng] <strong>quit</strong></pre>
<p># Configure PE2 as a receiver PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast mvpn 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance ng</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ng] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ng-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ng-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ng-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ng-af-ipv4-mvpn] <strong>auto-discovery inter-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ng-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ng-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-ng] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-ng] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, run the <strong>display ip routing-table</strong> command on PE1 or PE2 to display the routes to each other's loopback address.</p>
<p>The following example uses the command output on PE1:</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 10       Routes : 10
Destination/Mask    Proto   Pre  Cost        Flags NextHop        Interface
      1.1.1.1/32  Direct  0    0             D  127.0.0.1         LoopBack1
       2.2.2.2/32  OSPF    10   1             D  10.1.1.2         GigabitEthernet<span>0/1/1</span>
       5.5.5.5/32  IBGP    255  0             RD 2.2.2.2          GigabitEthernet<span>0/1/1</span>
       10.1.1.0/24  Direct  0    0             D  10.1.1.1        GigabitEthernet<span>0/1/1</span>
       10.1.1.1/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/1</span>
     10.1.1.255/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/1</span>
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0</pre>
<p>Run the <strong>display mpls lsp</strong> command on PE1 or PE2 to display the LSP information.</p>
<p>The following example uses the command output on PE1:</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls lsp</strong></pre>
<pre class="screen">Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP 
Flag after LDP FRR: (L) - Logic FRR LSP
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.1/32         3/NULL          -/-
2.2.2.2/32         NULL/3          -/GigabitEthernet<span>0/1/1</span>
2.2.2.2/32         32828/3         -/GigabitEthernet<span>0/1/1</span>
-------------------------------------------------------------------------------
                 LSP Information: BGP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.1/32         32830/NULL      -/-
5.5.5.5/32         NULL/32835      -/-</pre>
<p>Run the <strong>ping lsp</strong> command on PE1 or PE2 to check the connectivity of BGP LSP.</p>
<p>The following example uses the command output on PE1:</p>
<pre class="screen">&lt;PE1&gt; <strong>ping lsp bgp 5.5.5.5 32</strong></pre>
<pre class="screen">  LSP PING FEC: IPV4 PREFIX 5.5.5.5/32/ : 100  data bytes, press CTRL_C to break
    Reply from 5.5.5.5: bytes=100 Sequence=1 time=94 ms
    Reply from 5.5.5.5: bytes=100 Sequence=2 time=4 ms
    Reply from 5.5.5.5: bytes=100 Sequence=3 time=4 ms
    Reply from 5.5.5.5: bytes=100 Sequence=4 time=4 ms
    Reply from 5.5.5.5: bytes=100 Sequence=5 time=4 ms

  --- FEC: BGP LABLED IPV4 PREFIX 5.5.5.5/32 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 4/22/94 ms</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205"><a name="EN-US_TASK_0000001270313585__section_dc_vrp_seamless_mpls_cfg_003205"></a><a name="section_dc_vrp_seamless_mpls_cfg_003205"></a><a name="EN-US_TASK_0000001270313585__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1 
#
multicast mvpn 1.1.1.1 
#
ip vpn-instance ng 
 ipv4-family 
 route-distinguisher 1.2.3.4:1
 apply-label per-instance 
 vpn-target 1:1 export-extcommunity 
 vpn-target 1:1 import-extcommunity 
 multicast routing-enable 
 mvpn 
  sender-enable 
  c-multicast signaling bgp 
  auto-discovery inter-as 
  ipmsi-tunnel 
   mldp 
#
mpls lsr-id 1.1.1.1 
#
mpls 
#
mpls ldp 
 mldp p2mp
# 
 mldp recursive-fec 
 ipv4-family 
#
route-policy policy1 permit node 1 
 apply mpls-label 
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown 
 ip binding vpn-instance ng 
 ip address 192.168.1.1 255.255.255.0  
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown 
 ip address 10.1.1.1 255.255.255.0 
 mpls 
 mpls ldp 
#
interface Virtual-Template0 
 ppp authentication-mode auto 
#
interface LoopBack0 
 ip address 1.1.1.1 255.255.255.255 
# 
interface NULL0 
#
bgp 1.0 
 peer 2.2.2.2 as-number 1.0 
 peer 2.2.2.2 connect-interface LoopBack0 
 #
 ipv4-family unicast 
  undo synchronization 
  network 1.1.1.1 255.255.255.255 
  peer 2.2.2.2 enable 
  peer 2.2.2.2 route-policy policy1 export 
  peer 2.2.2.2 label-route-capability 
 #
 ipv4-family mvpn 
  policy vpn-target 
  peer 2.2.2.2 enable 
 #
 ipv4-family vpnv4 
  policy vpn-target 
  peer 2.2.2.2 enable 
 #
 ipv4-family vpn-instance ng 
  import-route direct 
#
ospf 1 
 area 0.0.0.0 
 network 10.1.1.0 0.0.0.255 
 network 1.1.1.1 0.0.0.0 
#
return</pre>
</li><li><p>ABR configuration file</p>
<pre class="screen"># 
sysname ABR 
# 
mpls lsr-id 2.2.2.2 
# 
mpls 
# 
mpls ldp 
 mldp p2mp 
# 
 mldp recursive-fec 
 ipv4-family 
# 
isis 1 
 is-level level-2 
 cost-style wide 
 network-entity 10.0000.0000.000c.00 
# 
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown 
 ip address 10.1.1.2 255.255.255.0 
 mpls 
 mpls ldp 
# 
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown 
 ip address 10.1.2.1 255.255.255.0 
 isis enable 1 
 mpls 
 mpls ldp 
# 
interface Virtual-Template0 
 ppp authentication-mode auto 
# 
interface LoopBack0 
 ip address 2.2.2.2 255.255.255.255 
 isis enable 1 
# 
interface NULL0 
#
route-policy policy1 permit node 1 
 if-match mpls-label
 apply mpls-label 
# 
bgp 1.0 
 peer 1.1.1.1 as-number 1.0 
 peer 1.1.1.1 connect-interface LoopBack0 
 peer 3.3.3.3 as-number 1.0 
 peer 3.3.3.3 connect-interface LoopBack0 
 # 
 ipv4-family unicast 
  undo synchronization 
  peer 1.1.1.1 enable 
  peer 1.1.1.1 route-policy policy1 export 
  peer 1.1.1.1 reflect-client 
  peer 1.1.1.1 next-hop-local 
  peer 1.1.1.1 label-route-capability 
  peer 3.3.3.3 enable 
  peer 3.3.3.3 route-policy policy1 export 
  peer 3.3.3.3 reflect-client 
  peer 3.3.3.3 next-hop-local 
  peer 3.3.3.3 label-route-capability 
 # 
 ipv4-family mvpn 
  undo policy vpn-target 
  peer 1.1.1.1 enable 
  peer 1.1.1.1 reflect-client 
  peer 3.3.3.3 enable 
  peer 3.3.3.3 reflect-client 
 # 
 ipv4-family vpnv4 
  undo policy vpn-target 
  peer 1.1.1.1 enable 
  peer 1.1.1.1 reflect-client 
  peer 1.1.1.1 next-hop-local 
  peer 3.3.3.3 enable 
  peer 3.3.3.3 reflect-client 
  peer 3.3.3.3 next-hop-local 
# 
ospf 1 
 area 0.0.0.0 
 network 10.1.1.0 0.0.0.255 
 network 2.2.2.2 0.0.0.0 
# 
return </pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen"># 
sysname ASBR1 
# 
mpls lsr-id 3.3.3.3 
# 
mpls 
# 
mpls ldp 
 mldp p2mp 
 mldp recursive-fec 
 ipv4-family 
# 
isis 1 
 is-level level-2 
 cost-style wide 
 network-entity 10.0000.0000.000a.00 
#
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown 
 ip address 10.1.2.2 255.255.255.0 
 isis enable 1 
 mpls 
 mpls ldp 
# 
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown 
 ip address 10.1.3.1 255.255.255.0 
 mpls 
 mpls ldp 
# 
interface Virtual-Template0
 ppp authentication-mode auto
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
interface NULL0
#
route-policy policy1 permit node 1
 apply mpls-label
# 
bgp 1.0
 peer 10.1.3.2 as-number 65535.65535
 peer 2.2.2.2 as-number 1.0
 peer 2.2.2.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  network 3.3.3.3 255.255.255.255
  peer 10.1.3.2 enable
  peer 2.2.2.2 enable
  peer 2.2.2.2 route-policy policy1 export
  peer 2.2.2.2 label-route-capability
 #
 ipv4-family mvpn
  undo policy vpn-target
  peer 10.1.3.2 enable
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.1.3.2 enable
  peer 2.2.2.2 enable
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2 
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls ldp
 mldp p2mp
#
 mldp recursive-fec
#
 ipv4-family
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.000b.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface Virtual-Template0
 ppp authentication-mode auto
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
 isis enable 1
#
interface NULL0
#
bgp 65535.65535 
 peer 10.1.3.1 as-number 1.0
 peer 5.5.5.5 as-number 65535.65535
 peer 5.5.5.5 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 10.1.3.1 enable
  peer 5.5.5.5 enable
 #
 ipv4-family mvpn
  undo policy vpn-target
  peer 10.1.3.1 enable
  peer 5.5.5.5 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.1.3.1 enable
  peer 5.5.5.5 enable
# 
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast mvpn 5.5.5.5
#
ip vpn-instance ng
 ipv4-family
 route-distinguisher 2.3:1
 apply-label per-instance
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
 multicast routing-enable
 mvpn
  sender-enable
  c-multicast signaling bgp
  auto-discovery inter-as
  ipmsi-tunnel
   mldp
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls ldp
 mldp p2mp
#
 mldp recursive-fec
 #
 ipv4-family
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.000d.00
#  
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance ng
 ip address 192.168.2.1 255.255.255.0
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
 isis enable 1
#
bgp 65535.65535
 peer 4.4.4.4 as-number 65535.65535
 peer 4.4.4.4 connect-interface LoopBack0
 # 
 ipv4-family unicast
  undo synchronization
  peer 4.4.4.4 enable
 # 
 ipv4-family mvpn
  policy vpn-target
  peer 4.4.4.4 enable
 # 
 ipv4-family vpnv4
  policy vpn-target
  peer 4.4.4.4 enable
 # 
 ipv4-family vpn-instance ng
  import-route direct
#  
return </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0012.html">Configuration Examples for NG MVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0145.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ngmvpn_0076.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>