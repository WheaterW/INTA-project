
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IPv4 PIM IPsec">
<meta name="abstract" content="On a PIM-SM network, you can configure IPv4 PIM IPsec on the interfaces setting up PIM neighbor relationships to protect the devices against forged IPv4 PIM protocol packets.">
<meta name="description" content="On a PIM-SM network, you can configure IPv4 PIM IPsec on the interfaces setting up PIM neighbor relationships to protect the devices against forged IPv4 PIM protocol packets.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_0036.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2295.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2279.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="PIM">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172366945">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring IPv4 PIM IPsec</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172366945"></a><a name="EN-US_TASK_0172366945"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IPv4 PIM IPsec</h1>
<div class="taskbody"><p>On a PIM-SM network, you can configure IPv4 PIM IPsec on the interfaces setting up PIM neighbor relationships to protect the devices against forged IPv4 PIM protocol packets.</p>
<div class="context"><a name="EN-US_TASK_0172366945__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172366945__fig_dc_vrp_multicast_cfg_224901">Figure 1</a>, the multicast service is deployed. <span class="keyword">Device</span> A and <span class="keyword">Device</span> B set a PIM neighbor relationship and exchange IPv4 PIM protocol packets to maintain their neighbor relationship and multicast routing entries. If forged IPv4 PIM protocol packets exist, <span class="keyword">Device</span> A and <span class="keyword">Device</span> B may not forward multicast data properly. To prevent attacks, configure IPv4 PIM IPsec on the interfaces of <span class="keyword">Device</span> A and <span class="keyword">Device</span> B to authenticate the IPv4 PIM protocol packets transmitted between them. In this manner, malicious attacks are prevented, and users can receive multicast data from multicast sources.</p>
<p><span class="keyword">Device</span> B exchanges IGMP protocol packets with its connected users to maintain their member relationships. To protect <span class="keyword">Device</span> B against forged IGMP protocols packets, configure IGMP IPsec on interfaces that connect <span class="keyword">Device</span> B to users.</p>
<div class="fignone" id="EN-US_TASK_0172366945__fig_dc_vrp_multicast_cfg_224901"><a name="EN-US_TASK_0172366945__fig_dc_vrp_multicast_cfg_224901"></a><a name="fig_dc_vrp_multicast_cfg_224901"></a><span class="figcap"><b>Figure 1 </b>Configuring IPv4 PIM IPsec</span><br><span><img class="vsd" src="images/fig_dc_vrp_multicast_cfg_224901.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="31.819999999999997%" id="mcps1.4.1.5.1.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="37.61%" id="mcps1.4.1.5.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="30.570000000000004%" id="mcps1.4.1.5.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="31.819999999999997%" headers="mcps1.4.1.5.1.4.1.1 "><p><span class="keyword">Device</span> A</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.61%" headers="mcps1.4.1.5.1.4.1.2 "><p>Interface1: GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="30.570000000000004%" headers="mcps1.4.1.5.1.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.1.4.1.2 "><p>Interface2: GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.1.4.1.3 "><p>192.168.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.1.4.1.2 "><p>Loopback0</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.1.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="31.819999999999997%" headers="mcps1.4.1.5.1.4.1.1 "><p><span class="keyword">Device</span> B</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.61%" headers="mcps1.4.1.5.1.4.1.2 "><p>Interface1: GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="30.570000000000004%" headers="mcps1.4.1.5.1.4.1.3 "><p>192.168.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.1.4.1.2 "><p>Interface2: GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.1.4.1.3 "><p>192.168.3.1/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366945__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each <span class="keyword">Router</span> interface and configure IS-IS to implement IP interworking.</p>
</li><li><p>Enable multicast routing on each <span class="keyword">Router</span> and PIM-SM on each <span class="keyword">Router</span> interface.</p>
</li><li><p>Enable IGMP on interfaces connecting <span class="keyword">Router</span>s to hosts.</p>
</li><li><p>Configure C-BSRs and C-RPs to implement dynamic RP selection.</p>
</li><li><p>Configure basic IPsec functions.</p>
</li><li><p>Configure global IPv4 PIM IPsec to authenticate unicast IPv4 PIM protocol packets.</p>
</li><li><p>Configure IPv4 PIM IPsec on interfaces to authenticate multicast IPv4 PIM protocol packets.</p>
</li><li><p>Configure IGMP IPsec on interfaces to authenticate IGMP protocol packets.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172366945__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Multicast source address: 192.168.1.2</p>
</li><li><p>Multicast group address: 225.1.1.1</p>
</li><li><p>Security association (SA) name: sa1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172366945__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each <span class="keyword">Router</span> interface and configure IS-IS to implement IP interworking.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.2.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>ip address 1.1.1.1 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.2.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.3.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Enable multicast routing on each <span class="keyword">Router</span> and PIM-SM on each <span class="keyword">Router</span> interface. Enable IGMP on interfaces connecting <span class="keyword">Router</span>s to hosts.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>igmp static-group 225.1.1.1 source 192.168.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Configure dynamic RP selection.</span><p><p># Specify loopback 0 on <span class="keyword">Device</span> A as a C-BSR and a C-RP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>c-bsr Loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>c-rp Loopback 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
</p></li><li><span>Configure basic IPsec functions.</span><p><ul><li><p>Configure the IPsec transmission mode.</p>
<p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ipsec proposal aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-aaa] <strong>transform ah</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-aaa] <strong>encapsulation-mode transport</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-proposal-aaa] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipsec proposal aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-aaa] <strong>encapsulation-mode transport</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-aaa] <strong>transform ah</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-proposal-aaa] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</li><li><p>Configure IPsec SAs.</p>
<p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>ipsec sa sa1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-sa-sa1] <strong>proposal aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-sa-sa1] <strong>sa spi inbound ah 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-sa-sa1] <strong>sa spi outbound ah 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-sa-sa1] <strong>sa string-key inbound ah YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-sa-sa1] <strong>sa string-key outbound ah YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-ipsec-sa-sa1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>ipsec sa sa1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-sa-sa1] <strong>proposal aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-sa-sa1] <strong>sa spi inbound ah 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-sa-sa1] <strong>sa spi outbound ah 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-sa-sa1] <strong>sa string-key inbound ah YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-sa-sa1] <strong>sa string-key outbound ah YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-ipsec-sa-sa1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Configure global IPv4 PIM IPsec to authenticate unicast IPv4 PIM protocol packets.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>ipsec unicast-message sa sa1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-pim] <strong>ipsec unicast-message sa sa1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-pim] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Configure IPv4 PIM IPsec on interfaces.</span><p><p># Configure <span class="keyword">Device</span> A.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>pim ipsec sa sa1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A] <strong>commit</strong></pre>
<p># Configure <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>pim ipsec sa sa1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Configure IGMP IPsec on interfaces.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>igmp ipsec sa sa1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Configure the multicast source 192.168.1.2 to send data to the multicast group 225.1.1.1. Configure a receiver to send an IGMP Report message to join the multicast group. Ensure that the receiver receives data from the multicast source. Run the <strong>display pim interface verbose</strong> command. The command outputs show detailed configurations of IPv4 PIM IPsec on interfaces between <span class="keyword">Router</span>s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A] <strong>display pim interface gigabitethernet <span>0/1/1</span> verbose</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Interface: GigabitEthernet<span>0/1/1</span>, 192.168.2.1
     PIM version: 2
     PIM mode: Sparse
     PIM state: up
     PIM DR: 192.168.2.1 (local)
     PIM DR Priority (configured): 1
     PIM neighbor count: 0
     PIM hello interval: 30 s
     PIM LAN delay (negotiated): 500 ms
     PIM LAN delay (configured): 500 ms
     PIM hello override interval (negotiated): 2500 ms
     PIM hello override interval (configured): 2500 ms
     PIM Silent: disabled
     PIM neighbor tracking (negotiated): disabled
     PIM neighbor tracking (configured): disabled
     PIM generation ID: 0x2C24084
     PIM require-GenID: disabled
     PIM hello hold interval: 105 s
     PIM assert hold interval: 180 s
     PIM triggered hello delay: 5 s
     PIM J/P interval: 60 s
     PIM J/P hold interval: 210 s
     PIM BSR domain border: disabled
     PIM BFD: disabled
     PIM dr-switch-delay timer: not configured
     Number of routers on link not using DR priority: 0
     Number of routers on link not using LAN delay: 0
     Number of routers on link not using neighbor tracking: 1
     ACL of PIM neighbor policy: -
     ACL of PIM ASM join policy: -
     ACL of PIM SSM join policy: -
     ACL of PIM join policy: -
     <strong>PIM ipsec: enabled(sa-name: sa1)</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display pim interface gigabitethernet <span>0/1/0</span> verbose</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Interface: GigabitEthernet<span>0/1/0</span>, 192.168.2.2
     PIM version: 2
     PIM mode: Sparse
     PIM state: up
     PIM DR: 192.168.2.2 (local)
     PIM DR Priority (configured): 1
     PIM neighbor count: 0
     PIM hello interval: 30 s
     PIM LAN delay (negotiated): 500 ms
     PIM LAN delay (configured): 500 ms
     PIM hello override interval (negotiated): 2500 ms
     PIM hello override interval (configured): 2500 ms
     PIM Silent: disabled
     PIM neighbor tracking (negotiated): disabled
     PIM neighbor tracking (configured): disabled
     PIM generation ID: 0x30F1A3DD
     PIM require-GenID: disabled
     PIM hello hold interval: 105 s
     PIM assert hold interval: 180 s
     PIM triggered hello delay: 5 s
     PIM J/P interval: 60 s
     PIM J/P hold interval: 210 s
     PIM BSR domain border: disabled
     PIM BFD: disabled
     PIM dr-switch-delay timer: not configured
     Number of routers on link not using DR priority: 0
     Number of routers on link not using LAN delay: 0
     Number of routers on link not using neighbor tracking: 1
     ACL of PIM neighbor policy: -
     ACL of PIM ASM join policy: -
     ACL of PIM SSM join policy: -
     ACL of PIM join policy: -
     <strong>PIM ipsec: enabled(sa-name: sa1)</strong></pre>
<p># Run the <strong>display igmp interface verbose</strong> command. The command outputs show detailed configurations of IGMP IPsec on interfaces connected to users.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display igmp interface gigabitethernet <span>0/1/1</span> verbose</strong></pre>
<pre class="screen">Interface information of VPN-Instance: public net
 Gigabitethernet<span>0/1/1</span>(192.168.3.1):
   IGMP is enabled
   Current IGMP version is 2
   IGMP state: up
   IGMP group policy: none
   IGMP limit: -
   Value of <span>q</span>uery interval for IGMP (negotiated): -
   Value of <span>q</span>uery interval for IGMP (configured): 60 s
   Value of <span>o</span>ther querier timeout for IGMP: 0 s
   Value of <span>m</span>aximum query response time for IGMP: 10 s
   Value of <span>l</span>ast member query time: 2 s
   <span>Value of l</span>ast member query interval: 1 s
   Value of <span>s</span>tartup query interval: 15 s
   <span>s</span>tartup query count: 2
   General query timer expiry (hours:minutes:seconds): 00:00:58
   Querier for IGMP: 192.168.3.1 (this router)
   IGMP activity: 0 joins, 0 leaves
   Robustness (negotiated): -
   Robustness (configured): 2
   Require-router-alert: disabled
   Send-router-alert: enabled
   Ip-source-policy: disabled
   Query Ip-source-policy: disabled
   Prompt-leave: disabled
   SSM-Mapping: disabled
   Startup-query-timer-expiry: off
   Other-querier-present-timer-expiry: off
   <strong>IGMP ipsec: enabled(sa-name: sa1)</strong></pre>
<p>The preceding command outputs show the following information: IPv4 PIM IPsec is configured on the downstream interface GE <span>0/1/1</span> of <span class="keyword">Device</span> A and the upstream interface GE <span>0/1/0</span> of <span class="keyword">Device</span> B.<span> IGMP IPsec is configured on the downstream interface GE <span>0/1/1</span> of <span class="keyword">Device</span> B, and the SA name is <strong>sa1</strong>.</span></p>
<p># Run the <strong>display pim routing-table</strong> command to check the IPv4 PIM routing table. The command output shows that multicast routing entries exist on <span class="keyword">Device</span> B.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (192.168.1.2, 225.1.1.1)
     RP: 1.1.1.1
     Protocol: pim-sm, Flag: SPT NIIF SG_RCVR
     UpTime: 00:31:41
     Upstream interface: Gigabitethernet<span>0/1/0</span>, Refresh time: 00:31:41
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: Gigabitethernet<span>0/1/1</span>
             Protocol: static, UpTime: 00:31:41, Expires: -     </pre>
<p>The preceding command output shows that multicast data is received by the receiver.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172366945__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
ipsec proposal aaa
 encapsulation-mode transport
 transform ah
#
ipsec sa sa1
 proposal aaa
 sa spi inbound ah 300
 sa string-key inbound ah cipher @%@%QV3G&lt;F;#&gt;(tQfj-P_31%&amp;R.v@%@%
 sa spi outbound ah 300
 sa string-key outbound ah cipher @%@%StJa=GZQXOj#,G.F9n^,&amp;R/S@%@%
#
multicast routing-enable
#
isis 1
 network-entity 10.0000.0000.0001.00  
#
interface Gigabitethernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 pim sm
 isis enable 1
#
interface Gigabitethernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 pim sm
 pim ipsec sa sa1
 isis enable 1  
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
 pim sm
 isis enable 1 
#
pim
 c-bsr LoopBack0
 c-rp LoopBack0
 <span>ipsec unicast-message sa sa1</span>
#
return</pre>
</li><li><p><span class="keyword">Device</span> B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
ipsec proposal aaa
 encapsulation-mode transport
 transform ah  
#
ipsec sa sa1
 proposal aaa
 sa spi inbound ah 300
 sa string-key inbound ah cipher @%@%gbFH@o`[IC!-*3DM![X$&amp;R&amp;.@%@%
 sa spi outbound ah 300
 sa string-key outbound ah cipher @%@%M\a(7*eg-J8r|+'9`_<font style="font-size:8pt" Face="Courier New" >~</font>A&amp;R-C@%@%   
#
multicast routing-enable
#
isis 1
 network-entity 10.0000.0000.0002.00     
#
interface Gigabitethernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.3.1 255.255.255.0
 pim sm
 igmp enable
<span> igmp ipsec sa sa1</span>
 igmp static-group 225.1.1.1 source 192.168.1.2
 isis enable 1
#
interface Gigabitethernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
 pim ipsec sa sa1
 isis enable 1
#
pim
 <span>ipsec unicast-message sa sa1</span>
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_0036.html">Configuration Examples for PIM
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2295.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2279.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>