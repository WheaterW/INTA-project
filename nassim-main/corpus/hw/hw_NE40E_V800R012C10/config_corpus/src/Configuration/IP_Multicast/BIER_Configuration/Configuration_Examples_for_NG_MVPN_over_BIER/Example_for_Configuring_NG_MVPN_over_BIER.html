
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NG MVPN over BIER">
<meta name="abstract" content="This section provides an example for configuring NG MVPN over BIER.">
<meta name="description" content="This section provides an example for configuring NG MVPN over BIER.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bier_cfg_example.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bier_cfg_12.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00606909,w00447999">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BIER">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BIER">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIER">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="BIER">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0178516032">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring NG MVPN over BIER</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0178516032"></a><a name="EN-US_TASK_0178516032"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NG MVPN over BIER</h1>
<div class="taskbody"><p>This section provides an example for configuring NG MVPN over BIER.</p>
<div class="context"><a name="EN-US_TASK_0178516032__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>An NG MVPN is deployed on the service provider's backbone network to solve multicast service issues related to traffic congestion, transmission reliability, and data security. On the network shown in <a href="#EN-US_TASK_0178516032__fig35284409229">Figure 1</a>, MPLS LDP LSPs have been established to carry BGP/MPLS IP VPN services. The service provider wants to provide MVPN services for users based on the existing network. To meet this requirement, configure NG MVPN over BIER.</p>
<div class="fignone" id="EN-US_TASK_0178516032__fig35284409229"><a name="EN-US_TASK_0178516032__fig35284409229"></a><a name="fig35284409229"></a><span class="figcap"><b>Figure 1 </b>NG MVPN over BIER networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0270989598.png" width="478.8" height="462.86793000000006" title="Click to enlarge"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0178516032__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure BGP/MPLS IP VPN to ensure that unicast VPN services are properly transmitted. In this example, MPLS LDP is configured on the public network.</p>
</li><li><p>Configure BIER on Root, Leaf 1, Leaf 2, and P, and enable BIER in IS-IS.</p>
</li><li><p>Enable all PEs to establish BGP MVPN peer relationships and configure BGP to transmit A-D and C-multicast routes.</p>
</li><li>Configure Root, Leaf 1, and Leaf 2 to transmit multicast traffic over BIER tunnels.</li><li><p>Configure PIM on the PE interfaces bound to VPN instances on Root, Leaf 1, and Leaf 2 and on CEs' interfaces connected to PEs to allow a VPN multicast routing table to be established to guide multicast traffic forwarding.</p>
</li><li>Configure the address pool range and criteria for switching between I-PMSI and S-PMSI tunnels on Root.</li><li><p>Configure IGMP on the interfaces connecting a multicast device to a user network segment to allow the device to manage multicast group members on the network segment.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0178516032__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>IP addresses of interfaces (shown in <a href="#EN-US_TASK_0178516032__fig35284409229">Figure 1</a>)</li></ul>
<ul><li><p>IS-IS process ID (1) on the public network in a Level-2 area</p>
</li><li><p>VPN instance name (VPNA) on Root, Leaf 1, and Leaf 2</p>
</li><li>BFR-IDs of Root, Leaf 1, and Leaf 2 (1, 4, and 5, respectively), sub-domain 0, BSL 256, and Max-SI 2</li><li>Root, Leaf 1, and Leaf 2 as PEs</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0178516032__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure BGP/MPLS IP VPN.</span><ol type="a"><li class="substepexpand"><span>Configure the VPN backbone network and the IP address of each interface in each VPN site.</span><p><p>Configure an IP address for each interface. For configuration details, see Configuration Files in this section.</p>
</p></li><li class="substepexpand"><span>Configure an IGP to interconnect devices on the BGP/MPLS IP VPN backbone network.</span><p><p>This example uses IS-IS as the IGP. For configuration details, see Configuration Files in this section.</p>
</p></li><li class="substepexpand"><span>Configure basic MPLS functions and enable MPLS LDP on the backbone network.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
</li><li><p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>mpls lsr-id 2.2.2.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>interface </strong><strong>gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-Gigabitethernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-Gigabitethernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-Gigabitethernet<span>0/1/1</span>] <strong>quit</strong></pre>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>mpls lsr-id 4.4.4.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
</li><li># Configure Leaf 2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>mpls lsr-id 5.5.5.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Establish an MP-IBGP peer relationship between Root and Leaf 1 and between Root and Leaf 2.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>peer 5.5.5.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>peer 5.5.5.1 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>peer 4.4.4.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>peer 4.4.4.1 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-af-vpnv4] <strong>peer 5.5.5.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-af-vpnv4] <strong>peer 4.4.4.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure a VPN instance on the PEs.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 400:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure PEs to import direct routes.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-VPNA] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-VPNA] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 2.</p>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-VPNA] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
</li></ul>
</p></li></ol>
</li><li><span>Configure BIER and enable BIER in IS-IS on the PEs and P.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>interface Loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-LoopBack0] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-LoopBack0] <strong>isis enable 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>Root-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bier] <strong>sub-domain 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bier-sub-domain-0] <strong>bfr-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bier-sub-domain-0] <strong>bfr-prefix interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bier-sub-domain-0]<strong> protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bier-sub-domain-0] <strong>encapsulation-type mpls bsl 256 max-si 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bier-sub-domain-0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-isis-1] <strong>quit</strong></pre>
</li><li><p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>interface Loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack0] <strong>ip address 2.2.2.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack0] <strong>isis enable 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>P-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier] <strong>sub-domain 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0] <strong>bfr-prefix interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0] <strong>protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0] <strong>encapsulation-type mpls bsl 256 max-si 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier-sub-domain-0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1]<strong> cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1]<strong> bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-isis-1]<strong> quit</strong></pre>
</li><li><div class="p"># Configure Leaf 1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>interface Loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-LoopBack0] <strong>ip address 4.4.4.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-LoopBack0] <strong>isis enable 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bier] <strong>sub-domain 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bier-sub-domain-0] <strong>bfr-id 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bier-sub-domain-0] <strong>bfr-prefix interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bier-sub-domain-0] <strong>protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bier-sub-domain-0] <strong>encapsulation-type mpls bsl 256 max-si 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bier-sub-domain-0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-isis-1] <strong>quit</strong></pre>
</div>
</li><li><div class="p"># Configure Leaf 2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>interface Loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-LoopBack0] <strong>ip address 5.5.5.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-LoopBack0] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-LoopBack0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bier] <strong>sub-domain 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bier-sub-domain-0] <strong>bfr-id 5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bier-sub-domain-0] <strong>bfr-prefix interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bier-sub-domain-0] <strong>protocol isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bier-sub-domain-0] <strong>encapsulation-type mpls bsl 256 max-si 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bier-sub-domain-0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bier] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-isis-1] <strong>cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-isis-1] <strong>bier enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-isis-1] <strong>quit</strong></pre>
</div>
</li></ul>
</p></li><li><span>Establish a BGP MVPN peer relationship between Root and Leaf 1 and between Root and Leaf 2.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-af-mvpn] <strong>peer 5.5.5.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-af-mvpn] <strong>peer 4.4.4.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root-bgp] <strong>quit</strong></pre>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-mvpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1-bgp] <strong>quit</strong></pre>
</li><li><p># Configure Leaf 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-mvpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-bgp] <strong>quit</strong></pre>
</li></ul>
<p>After completing the configurations, run the <a href="cmdqueryname=display+bgp+mvpn+all+peer"><b><span class="cmdname">display bgp mvpn all peer</span></b></a> command. The command output shows that Root has established a BGP MVPN peer relationship with Leaf 1 and Leaf 2. The following example uses the command output on Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>display bgp mvpn all peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  4.4.4.1         4         100       43       42     0 00:29:28 <strong>Established</strong>        2
  5.5.5.1         4         100       32       35     0 00:21:59 <strong>Established</strong>        1  </pre>
</p></li><li><span>Set the PMSI tunnel type to BIER.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>multicast mvpn 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>bier</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn] <strong>spmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>group 224.0.0.0 255.255.255.0 source 192.168.1.2 255.255.255.0 bier limit 1</strong><strong>6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>multicast mvpn 4.4.4.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>multicast mvpn 5.5.5.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
</li></ul>
<p>After completing the configurations, run the <a href="cmdqueryname=display+mvpn+vpn-instance+ipmsi"><b><span class="cmdname">display mvpn vpn-instance ipmsi</span></b></a> command on the PEs to check I-PMSI tunnel establishment. The following example uses the command output on Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>display mvpn vpn-instance VPNA ipmsi</strong></pre>
<pre class="screen">MVPN local I-PMSI information for VPN-Instance:VPNA
Tunnel type: BIER 
Tunnel state: Up 
MPLS label: 256
Sub-domain ID: 0
BFR-ID: 1
BFR prefix: 1.1.1.1
Bit string ID: 1 
Root: 1.1.1.1 (local) 
Leaf:
   1: 4.4.4.1 (BFR-ID: 4, BFR prefix: 4.4.4.1)
   2: 5.5.5.1 (BFR-ID: 5, BFR prefix: 5.5.5.1)</pre>
<p>The command output shows that a BIER P2MP tunnel has been established, with Root as the root node and Leaf 1 and Leaf 2 as leaf nodes. </p>
</p></li><li><span>Configure PIM.</span><p><ul><li><p># Configure Root.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/1</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1] <strong>commit</strong></pre>
</li><li><p># Configure Leaf 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/1</span>] <strong>igmp </strong><strong>enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2] <strong>commit</strong></pre>
</li></ul>
</p></li><li><span>Configure a static RP.</span><p><ul><li><div class="p"># Configure Root.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-LoopBack1] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-LoopBack1]<strong>ip address 1.1.1.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-pim-VPNA] <strong>static-rp 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Root-pim-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root-pim-VPNA] <strong>quit</strong></pre>
</div>
</li><li><p># Configure Leaf 1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-pim-VPNA] <strong>static-rp 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf1-pim-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1-pim-VPNA] <strong>quit</strong></pre>
</li><li><p># Configure Leaf 2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-pim-VPNA] <strong>static-rp 1.1.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Leaf2-pim-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2-pim-VPNA] <strong>quit</strong></pre>
</li></ul>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, NG MVPN over BIER has been configured. If Receiver 1 or Receiver 2 has access users, CE1 can use the BGP/MPLS IP VPN to forward multicast data to the users.</p>
<p>Run the <a href="cmdqueryname=display+pim+vpn-instance"><b><span class="cmdname">display pim vpn-instance</span></b></a> <strong><span>routing-table</span></strong> command on Leaf 1, Leaf 2, and Root to check the PIM routing tables of the VPN instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf1] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (192.168.1.2, 225.1.1.1)
     RP:1.1.1.2
     Protocol: pim-sm, Flag: SPT ACT
     UpTime: 00:48:18
     Upstream interface: through-BGP, Refresh time: 00:48:18
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:48:18, Expires: 00:03:12     </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Leaf2] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (192.168.1.2, 225.1.1.1)
     RP:1.1.1.2
     Protocol: pim-sm, Flag: SPT ACT
     UpTime: 00:02:06
     Upstream interface: through-BGP, Refresh time: 00:02:06
         Upstream neighbor: 1.1.1.1
         RPF prime neighbor: 1.1.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:02:06, Expires: 00:03:26 </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Root] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entries

 (192.168.1.2, 225.1.1.1)
     RP:1.1.1.2
     Protocol: pim-sm, Flag: SPT SG_RCVR ACT
     UpTime: 00:46:58
     Upstream interface: GigabitEthernet<span>0/1/1</span>, Refresh time: 00:46:58
         Upstream neighbor: 192.168.1.1
         RPF prime neighbor: 192.168.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: pseudo
             Protocol: BGP, UpTime: 00:46:58, Expires: -</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0178516032__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><div class="p">Root configuration file<pre class="screen">#
sysname Root
#
multicast mvpn 1.1.1.1
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 4:4 export-extcommunity
  vpn-target 3:3 import-extcommunity
  vpn-target 4:4 import-extcommunity
  multicast routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   ipmsi-tunnel
    bier   
   spmsi-tunnel
    group 224.0.0.0 255.255.255.0 source 192.168.1.0 255.255.255.0 bier limit 16
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
 #
 ipv4-family
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0001.00
 bier enable
#
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown
 ip address 192.168.0.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.1.1 255.255.255.0
 pim sm
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
interface LoopBack1
 ip binding vpn-instance VPNA
 ip address 1.1.1.2 255.255.255.255
#
bgp 100
 peer 4.4.4.1 as-number 100
 peer 4.4.4.1 connect-interface LoopBack0
 peer 5.5.5.1 as-number 100
 peer 5.5.5.1 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 4.4.4.1 enable
  peer 5.5.5.1 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 4.4.4.1 enable
  peer 5.5.5.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 4.4.4.1 enable
  peer 5.5.5.1 enable
 #
 ipv4-family vpn-instance VPNA
  import-route direct
#
pim vpn-instance VPNA
 static-rp 1.1.1.2
#
bier
 sub-domain 0
  bfr-id 1
  bfr-prefix interface LoopBack0
  protocol isis
  encapsulation-type mpls bsl 256 max-si 2
#
return</pre>
</div>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.1
#
mpls
#
mpls ldp
 #
 ipv4-family
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0004.00
 traffic-eng level-2
 bier enable
#
interface GigabitEthernet<span>0/1/0</span> 
 undo shutdown
 ip address 192.168.0.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.45.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.1 255.255.255.255
 isis enable 1
#
bier
 sub-domain 0
  bfr-prefix interface LoopBack0
  protocol isis
  encapsulation-type mpls bsl 256 max-si 2
#
return</pre>
</li><li><p>Leaf 1 configuration file</p>
<pre class="screen">#
sysname Leaf1
#
multicast mvpn 4.4.4.1
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 300:1
  apply-label per-instance
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
#
mpls lsr-id 4.4.4.1
#
mpls
#
mpls ldp
 #
 ipv4-family
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0002.00
 traffic-eng level-2
 bier enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.45.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp       
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.2.1 255.255.255.0
 pim sm
 igmp enable
#
interface LoopBack0
 ip address 4.4.4.1 255.255.255.255
 isis enable 1
# 
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance VPNA
  import-route direct
 #
pim vpn-instance VPNA
 static-rp 1.1.1.2
#
bier
 sub-domain 0
  bfr-id 4
  bfr-prefix interface LoopBack0
  protocol isis
  encapsulation-type mpls bsl 256 max-si 2
#
return</pre>
</li><li><p>Leaf 2 configuration file</p>
<pre class="screen">#
sysname Leaf2
#
multicast routing-enable
#
multicast mvpn 5.5.5.1
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 400:1
  apply-label per-instance
  vpn-target 4:4 export-extcommunity
  vpn-target 4:4 import-extcommunity
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
#
mpls lsr-id 5.5.5.1
#
mpls
#
mpls ldp
 #
 ipv4-family
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0000.0000.0003.00
 traffic-eng level-2
 bier enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.45.3 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.3.1 255.255.255.0
 pim sm
 igmp enable
#
interface LoopBack0
 ip address 5.5.5.1 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance VPNA
  import-route direct
 #
pim vpn-instance VPNA
 static-rp 1.1.1.2
#
lldp enable
#
bier
 sub-domain 0
  bfr-id 5
  bfr-prefix interface LoopBack0
  protocol isis
  encapsulation-type mpls bsl 256 max-si 2
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bier_cfg_example.html">Configuration Examples for NG MVPN over BIER
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_bier_cfg_12.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>