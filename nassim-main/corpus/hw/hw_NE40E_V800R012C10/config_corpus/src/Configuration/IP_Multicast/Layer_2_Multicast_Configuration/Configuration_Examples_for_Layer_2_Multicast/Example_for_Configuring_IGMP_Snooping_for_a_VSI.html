
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring IGMP Snooping for a VSI">
<meta name="abstract" content="This section provides an example for configuring IGMP snooping for a VSI in typical VPLS networking.">
<meta name="description" content="This section provides an example for configuring IGMP snooping for a VSI in typical VPLS networking.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0034.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0036.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="z00603461,w00800033,l2multicastvrp,c00549182,w00556928,w00437000,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="featurename" content="Layer 2 Multicast">
<meta name="featuretype" content="IP Multicast">
<meta name="OWNER" content="w00447999">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00447999">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172367969">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring IGMP Snooping for a VSI</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172367969"></a><a name="EN-US_TASK_0172367969"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring IGMP Snooping for a VSI</h1>
<div class="taskbody"><p>This section provides an example for configuring IGMP snooping for a VSI in typical VPLS networking.</p>
<div class="context"><a name="EN-US_TASK_0172367969__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the VPLS network shown in <a href="#EN-US_TASK_0172367969__fig_dc_vrp_l2mc_cfg_003501">Figure 1</a>, PE1 serves as the superstratum provider edge (SPE), and PE2 and PE3 serve as underlayer PEs (UPEs). If IGMP snooping is not configured in the VSI on PE1, multicast data flows are broadcast in the VSI, which consumes a lot of network resources.</p>
<p>After IGMP snooping is configured, multicast data flows are only sent to the access devices that have multicast receivers, reducing network resource consumption.</p>
<p>On a network with a stable topology, configure GE <span>0/1/0</span> on PE1 as a static router port and the PW on PE2 as a static router port in the VSI. In this manner, receivers can steadily receive multicast data. </p>
<p>The aging time of router ports can be set based on the network stability condition so that multicast entries are updated upon network changes. The aging time of multicast entries is set to 100s in a VSI.</p>
<p>IGMP snooping proxy must be enabled in VSIs to relieve the packet processing pressure on Layer 3 devices.</p>
<div class="fignone" id="EN-US_TASK_0172367969__fig_dc_vrp_l2mc_cfg_003501"><a name="EN-US_TASK_0172367969__fig_dc_vrp_l2mc_cfg_003501"></a><a name="fig_dc_vrp_l2mc_cfg_003501"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of configuring IGMP snooping over VPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2mc_cfg_003501.png" width="NaN" height="NaN"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP Address List</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.8.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.8.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.8.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="3" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.1 "><p>PE1</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.3 "><p>10.1.1.1/30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>GE<span>0/3/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>10.1.2.1/30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.1 "><p>PE2</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.3 "><p>10.1.1.2/30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.1 "><p>PE3</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.3 "><p>10.1.2.2/30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.8.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.3 "><p>10.1.3.1/30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.3 "><p>10.1.4.1/30</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.1 "><p>CE3</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.8.2.4.1.3 "><p>10.1.5.1/30</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367969__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure basic VPLS functions.</p>
</li><li><p>Enable IGMP snooping both globally and in a specified VSI.</p>
</li><li><p>Set the timer for deleting multicast forwarding entries in the VSI.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172367969__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>ID of the VSI and VSI name</p>
</li><li><p>Timer for deleting multicast forwarding entries</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172367969__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable Open Shortest Path First (OSPF) to advertise the host routes of the network segment of each <span class="keyword">Router</span> interface and label switching router (LSR) ID. For configuration details, see the <em>OSPF Configuration</em>.</span></li><li><span>Configure basic MPLS functions and the Label Distribution Protocol (LDP).</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">&lt;PE3&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> mpls </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN and configure a VSI.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi v123 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123-ldp]<strong> vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123-ldp]<strong> peer 2.2.2.2 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123-ldp]<strong> peer 3.3.3.3 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123-ldp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-v123-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-v123]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> vsi v123 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123-ldp]<strong> vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123-ldp]<strong> peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123-ldp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vsi-v123-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vsi-v123]<strong> quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> vsi v123 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-v123]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-v123-ldp]<strong> vsi-id 123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-v123-ldp]<strong> peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-v123-ldp]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-vsi-v123-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-vsi-v123]<strong> quit</strong></pre>
</p></li><li><span>Bind the VSI on the PE devices to interfaces.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vlan10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> port link-type access</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Vlanif10]<strong> l2 binding vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Vlanif10]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Vlanif10]<strong> quit</strong></pre>
<p>The configurations of PE2 and PE3 are similar to those of PE1 and are not mentioned here.</p>
</p></li><li><span>Enable IGMP snooping globally and for the VSI on PE1, PE2, and PE3.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> igmp-snooping enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> igmp-snooping version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-v123]<strong> quit</strong></pre>
<p>The configurations of PE2 and PE3 are similar to those of PE1 and are not mentioned here.</p>
</p></li><li><span>Configure GE <span>0/1/0</span> on PE1 as a static router port in VLAN 10 and the PW on PE2 as a static router port.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> igmp-snooping static-router-port vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123]<strong> igmp-snooping static-router-port remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-v123]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vsi-v123]<strong> quit</strong></pre>
</p></li><li><span>Set the timer for deleting multicast forwarding entries in the VSI to 100s.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vsi v123</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> l2-multicast source-lifetime 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> igmp-snooping proxy</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-v123]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vsi-v123]<strong> quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display igmp-snooping router-port vsi</strong> command on PE1 to check whether the static router port is successfully configured.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display igmp-snooping router-port vsi v123</strong></pre>
<pre class="screen">Port Name                       UpTime        Expires       Flags
 ---------------------------------------------------------------------
 VSI v123, 1 router-port(s)
 GE<span>0/1/0</span>(VID:10)                 00:21:05      --           <strong> STATIC</strong> </pre>
<p>If the command output contains <strong>STATIC</strong>, GE<span>0/1/0</span> has been configured as a static router port in the VSI.</p>
<p>Run the <strong>display igmp-snooping router-port vsi</strong> command on PE2 to check whether the static router port is successfully configured.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display igmp-snooping router-port vsi v123</strong></pre>
<pre class="screen"> Port Name                       UpTime        Expires       Flags</pre>
<pre class="screen"> ---------------------------------------------------------------------</pre>
<pre class="screen"> VSI v123, 1 router-port(s)</pre>
<pre class="screen"> PW(1.1.1.1/123)                 00:05:16      --            <strong>STATIC</strong>  </pre>
<p>If the command output contains <strong>STATIC</strong>, PW (1.1.1.1/123) has been configured as a static router port.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172367969__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE1</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 10</pre>
<pre class="screen">#</pre>
<pre class="screen">igmp-snooping enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 1.1.1.1</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls l2vpn</pre>
<pre class="screen">#</pre>
<pre class="screen">vsi v123 static</pre>
<pre class="screen"> pwsignal ldp</pre>
<pre class="screen">  vsi-id 123</pre>
<pre class="screen">  peer 2.2.2.2 upe</pre>
<pre class="screen">  peer 3.3.3.3 upe</pre>
<pre class="screen"> igmp-snooping enable</pre>
<pre class="screen"> igmp-snooping proxy</pre>
<pre class="screen"> igmp-snooping version 3</pre>
<pre class="screen"> l2-multicast source-lifetime 100</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Vlanif10</pre>
<pre class="screen"> l2 binding vsi v123</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 10</pre>
<pre class="screen"> igmp-snooping static-router-port vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.1 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 1.1.1.1 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.3</pre>
<pre class="screen">  network 10.1.2.0 0.0.0.3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE2</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 10</pre>
<pre class="screen">#</pre>
<pre class="screen">igmp-snooping enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 2.2.2.2</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls l2vpn</pre>
<pre class="screen">#</pre>
<pre class="screen">vsi v123 static</pre>
<pre class="screen"> pwsignal ldp</pre>
<pre class="screen">  vsi-id 123</pre>
<pre class="screen">  peer 1.1.1.1</pre>
<pre class="screen"> igmp-snooping enable</pre>
<pre class="screen"> igmp-snooping version 3</pre>
<pre class="screen"> igmp-snooping static-router-port remote-peer 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Vlanif10</pre>
<pre class="screen"> l2 binding vsi v123</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 2.2.2.2 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname PE3</pre>
<pre class="screen">#</pre>
<pre class="screen">vlan batch 10</pre>
<pre class="screen">#</pre>
<pre class="screen">igmp-snooping enable</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 3.3.3.3</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls l2vpn</pre>
<pre class="screen">#</pre>
<pre class="screen">vsi v123 static</pre>
<pre class="screen"> pwsignal ldp</pre>
<pre class="screen">  vsi-id 123</pre>
<pre class="screen">  peer 1.1.1.1</pre>
<pre class="screen"> igmp-snooping enable</pre>
<pre class="screen"> igmp-snooping version 3</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Vlanif10</pre>
<pre class="screen"> l2 binding vsi v123</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> portswitch</pre>
<pre class="screen"> port link-type access</pre>
<pre class="screen"> port default vlan 10</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.2.2 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 3.3.3.3 0.0.0.0</pre>
<pre class="screen">  network 10.1.2.0 0.0.0.3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname CE1</pre>
<pre class="screen">#</pre>
<pre class="screen">multicast routing-enable</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet <span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.3.1 255.255.255.252</pre>
<pre class="screen"> pim sm</pre>
<pre class="screen"> igmp enable</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen">area 0.0.0.0</pre>
<pre class="screen">network 10.1.1.0 0.0.0.3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0033.html">Configuration Examples for Layer 2 Multicast
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0034.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2mc_cfg_0036.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>