
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Transit LSPs Through an IP Prefix List">
<meta name="abstract" content="This section provides an example for configuring transit LSPs. The configuration procedure involves establishing local LDP sessions and configuring an IP prefix list to filter routes on each transit LSR.">
<meta name="description" content="This section provides an example for configuring transit LSPs. The configuration procedure involves establishing local LDP sessions and configuring an IP prefix list to filter routes on each transit LSR.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0041.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_2048.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ldp-p2pvrp,w00800033,z00545680,w00556928,w00606909,z00809835,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368566">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Transit LSPs Through an IP Prefix List</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368566"></a><a name="EN-US_TASK_0172368566"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Transit LSPs Through an IP Prefix List</h1>
<div class="taskbody"><p>This section provides an example for configuring transit LSPs. The configuration procedure involves establishing local LDP sessions and configuring an IP prefix list to filter routes on each transit LSR.</p>
<div class="context"><a name="EN-US_TASK_0172368566__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>After MPLS LDP is enabled on each interface, LDP LSPs can be automatically established, including a great number of unnecessary transit LSPs, which wastes resources. On the network shown in <a href="#EN-US_TASK_0172368566__fig_dc_vrp_ldp-p2p_cfg_004201">Figure 1</a>, after a policy for triggering the establishment of transit LSPs is configured, LSRB only uses the routes to 4.4.4.4/32 to establish a transit LSP.</p>
<div class="fignone" id="EN-US_TASK_0172368566__fig_dc_vrp_ldp-p2p_cfg_004201"><a name="EN-US_TASK_0172368566__fig_dc_vrp_ldp-p2p_cfg_004201"></a><a name="fig_dc_vrp_ldp-p2p_cfg_004201"></a><span class="figcap"><b>Figure 1 </b>Configuring a policy for triggering transit LSP establishment</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0279157581.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368566__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>During the configuration, note the following:</p>
<p>By default, LDP establishes transit LSPs for all routes, without filtering them.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368566__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each interface and configure OSPF to advertise the route to the network segment to which each interface is connected and the host route to each LSR ID.</p>
</li><li><p>Configure an IP prefix list to limit the routes for which transit LSPs can be established.</p>
</li><li><p>Enable MPLS and MPLS LDP globally on each LSR and configure a policy of triggering LSP establishment.</p>
</li><li><p>Configure LSRB (transit node) to use the IP prefix list to limit the routes for which transit LSPs can be established.</p>
</li><li><p>Enable MPLS and MPLS LDP on each interface.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368566__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of each interface on each node (as shown in <a href="#EN-US_TASK_0172368566__fig_dc_vrp_ldp-p2p_cfg_004201">Figure 1</a>), OSPF process ID, and area ID</p>
</li><li><p>Policy for triggering LSP establishment</p>
</li><li><p>IP prefix list name and the routes to be filtered on the transit node</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368566__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface and configure OSPF to advertise the route to the network segment to which each interface is connected and the host route to each LSR ID.</span><p><p># Assign an IP address to each interface (as shown in <a href="#EN-US_TASK_0172368566__fig_dc_vrp_ldp-p2p_cfg_004201">Figure 1</a>), including the loopback interfaces. Configure OSPF to advertise the route to the network segment to which each interface is connected and the host route to each LSR ID.</p>
</p></li><li><span>Configure an IP prefix list on the transit node LSRB.</span><p><p># Configure an IP prefix list on LSRB to allow LSRB to establish a transit LSP only for the route 4.4.4.4/32 to LSRD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong>ip ip-prefix FilterOnTransit permit 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong>commit</strong></pre>
</p></li><li><span>Configure basic MPLS and MPLS LDP functions on each node and interface, and configure a policy for triggering LSP establishment.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Configure LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls-ldp] <strong>propagate mapping for ip-prefix FilterOnTransit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p>The configurations of LSRC and LSRD are similar to the configuration of LSRA.</p>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <a href="cmdqueryname=display+mpls+ldp+lsp"><b><span class="cmdname">display mpls ldp lsp</span></b></a> command to check LSP information.</p>
<p># Display LDP LSPs established on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 1.1.1.1/32         3/NULL         2.2.2.2         127.0.0.1        LoopBack1
 2.2.2.2/32         NULL/3         -               192.168.1.2      GE<span>0/1/0</span>
 2.2.2.2/32         1025/3         2.2.2.2         192.168.1.2      GE<span>0/1/0</span>
 4.4.4.4/32         NULL/1025      -               192.168.1.2      GE<span>0/1/0</span>
 4.4.4.4/32         1026/1026      4.4.4.4         192.168.1.2      GE<span>0/1/0</span>
 192.168.1.0/24     3/NULL         2.2.2.2         192.168.1.1      GE<span>0/1/0</span>
*192.168.1.0/24     Liberal/26                     DS/2.2.2.2
 192.168.2.0/24     NULL/3         -               192.168.1.2      GE<span>0/1/0</span>
 192.168.2.0/24     1027/3         3.3.3.3         192.168.1.2      GE<span>0/1/0</span>
--------------------------------------------------------------------------
 TOTAL: 8 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 Frr LSP(s) Found.
<span> An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</span>
</pre>
<p>The command output on each node shows that the LDP LSP with LSRB as the transit node is established only for the route 4.4.4.4/32 and that other LDP LSPs not with LSRB as the transit node are established.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172368566__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRA</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #
 ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 1.1.1.1 0.0.0.0</pre>
<pre class="screen">  network 192.168.1.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRB</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 2.2.2.2</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp
 #
 ipv4-family
  propagate mapping for ip-prefix FilterOnTransit</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.2.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 2.2.2.2 0.0.0.0</pre>
<pre class="screen">  network 192.168.1.0 0.0.0.255</pre>
<pre class="screen">  network 192.168.2.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ip ip-prefix FilterOnTransit index 10 permit 4.4.4.4 32</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRC</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 3.3.3.3</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #
 ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.2.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.3.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 3.3.3.3 0.0.0.0</pre>
<pre class="screen">  network 192.168.2.0 0.0.0.255</pre>
<pre class="screen">  network 192.168.3.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRD configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRD</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 4.4.4.4</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #
 ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 192.168.3.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 4.4.4.4 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 4.4.4.4 0.0.0.0</pre>
<pre class="screen">  network 192.168.3.0 0.0.0.255</pre>
<pre class="screen">#</pre>
<pre class="screen">Return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">Configuration Examples for MPLS LDP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0041.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_2048.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>