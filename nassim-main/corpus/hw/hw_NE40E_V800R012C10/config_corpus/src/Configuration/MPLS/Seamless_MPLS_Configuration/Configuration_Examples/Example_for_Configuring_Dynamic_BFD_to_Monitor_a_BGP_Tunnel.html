
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dynamic BFD to Monitor a BGP Tunnel">
<meta name="abstract" content="This section provides an example for configuring dynamic BFD to monitor a BGP tunnel. The configuration involves configuring a BGP tunnel and configuring dynamic BFD for BGP tunnel.">
<meta name="description" content="This section provides an example for configuring dynamic BFD to monitor a BGP tunnel. The configuration involves configuring a BGP tunnel and configuring dynamic BFD for BGP tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0030.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0033.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,z00545680,w00556928,seamlessvrp,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="Seamless MPLS">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368697">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Dynamic BFD to Monitor a BGP Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368697"></a><a name="EN-US_TASK_0172368697"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dynamic BFD to Monitor a BGP Tunnel</h1>
<div class="taskbody"><p>This section provides an example for configuring dynamic BFD to monitor a BGP tunnel. The configuration involves configuring a BGP tunnel and configuring dynamic BFD for BGP tunnel.</p>
<div class="context"><a name="EN-US_TASK_0172368697__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Seamless MPLS integrates the access, aggregation, and core layers on the same MPLS network to transmit VPN services. Seamless MPLS establishes an E2E BGP tunnel to provide E2E access services. To rapidly detect faults in BGP tunnels, BFD for BGP tunnel needs to be configured.</p>
<p>In <a href="#EN-US_TASK_0172368697__fig_dc_vrp_seamless_mpls_cfg_004201">Figure 1</a>, the access and aggregation layers belong to one AS, and the core layer belongs to another AS. The base station needs to communicate with an MME or SGW over a VPN. To meet this requirement, inter-AS seamless MPLS can be configured to form a BGP tunnel between the CSG and MASG. To monitor the connectivity of the BGP tunnel, BFD for BGP tunnel needs to be configured.</p>
<div class="fignone" id="EN-US_TASK_0172368697__fig_dc_vrp_seamless_mpls_cfg_004201"><a name="EN-US_TASK_0172368697__fig_dc_vrp_seamless_mpls_cfg_004201"></a><a name="fig_dc_vrp_seamless_mpls_cfg_004201"></a><span class="figcap"><b>Figure 1 </b>Inter-AS seamless MPLS networking</span><br><span><img class="vsd" src="images/fig_dc_vrp_seamless_mpls_cfg_004201.png" width="NaN" height="NaN"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface parameters</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.5.2.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.5.2.4.1.2" liSelected="liSelected"><p>Interface Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.4.1.5.2.4.1.3" liSelected="liSelected"><p>IP Address and Mask</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.1 "><p>CSG</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.1 "><p>AGG</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.2.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.1 "><p>AGG ASBR</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.3.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.1 "><p>Core ASBR</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.3.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>10.4.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.1 "><p>MASG</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.4.1.5.2.4.1.3 "><p>10.4.1.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368697__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure inter-AS seamless MPLS.</p>
</li><li><p>Configure BFD for BGP tunnel.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368697__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>OSPF process ID (1) at the access layer, IS-IS process ID (1) at the aggregation layer, and OSPF process ID (2) at the core layer</p>
</li><li><p>IS-IS area number (10.0001) and IS-IS system IDs (which are obtained based on loopback addresses)</p>
</li><li><p>MPLS LSR IDs: 1.1.1.1 for the CSG, 2.2.2.2 for the AGG, 3.3.3.3 for the AGG ASBR, 4.4.4.4 for the core ASBR, and 5.5.5.5 for the MASG</p>
</li><li><p>Name of a routing policy (policy1)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368697__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p>Assign an IP address and mask to each interface, including each loopback interface, according to <a href="#EN-US_TASK_0172368697__fig_dc_vrp_seamless_mpls_cfg_004201">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0172368697__section_dc_vrp_seamless_mpls_cfg_004205">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an IGP.</span><p><p>Configure OSPF with process ID 1 at the access layer, IS-IS with process ID 1 at the aggregation layer, and OSPF with process ID 2 at the core layer. Configure IGP protocols to advertise the route to each network segment to which each interface is connected and to advertise the host route to each loopback address which is used as an LSR ID. For configuration details, see <a href="#EN-US_TASK_0172368697__section_dc_vrp_seamless_mpls_cfg_004205">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure basic MPLS and MPLS LDP functions.</span><p><p>Enable MPLS and MPLS LDP globally on each device and on interfaces in each AS. For configuration details, see <a href="#EN-US_TASK_0172368697__section_dc_vrp_seamless_mpls_cfg_004205">Configuration Files</a> in this section.</p>
</p></li><li><span>Establish IBGP peer relationships at each layer and enable devices to exchange labeled routes.</span><p><p># Configure the CSG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>network 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># Configure the AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>commit</strong></pre>
<p># Configure the AGG ASBR.</p>
<pre class="screen">&lt;AGG ASBR&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG ASBR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 2.2.2.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>commit</strong></pre>
<p># Configure the core ASBR.</p>
<pre class="screen">&lt;Core ASBR&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Core ASBR] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 5.5.5.5 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 5.5.5.5 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 5.5.5.5 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>commit</strong></pre>
<p># Configure the MASG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MASG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>peer 4.4.4.4 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>network 5.5.5.5 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG] <strong>commit</strong></pre>
</p></li><li><span>Establish an EBGP peer relationship for each AGG ASBR-and-core ASBR pair and enable these devices to exchange labeled routes.</span><p><p># Configure the AGG ASBR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG ASBR] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG ASBR-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 10.3.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>peer 10.3.1.2 label-route-capability check-tunnel-reachable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG ASBR] <strong>commit</strong></pre>
<p># Configure the core ASBR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Core ASBR] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>Core ASBR-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 10.3.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>peer 10.3.1.1 label-route-capability check-tunnel-reachable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>Core ASBR] <strong>commit</strong></pre>
</p></li><li><span>Configure each AGG as an RR to help the CSG and MASG obtain the route destined for each other's loopback interface.</span><p><p># Configure the AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG-bgp] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 next-hop-local</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>commit</strong></pre>
</p></li><li><span>Configure a routing policy on each device to establish a BGP tunnel.</span><p><p># Configure a routing policy for advertising routes matching Route-Policy conditions to the CSG's BGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>peer 2.2.2.2 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p>Repeat this step for the MASG. For configuration details, see <a href="#EN-US_TASK_0172368697__section_dc_vrp_seamless_mpls_cfg_004205">Configuration Files</a> in this section.</p>
<p># Configure a routing policy for advertising routes matching Route-Policy conditions to the AGG's BGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>AGG] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-route-policy] <strong>if-match mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-route-policy]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 1.1.1.1 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>peer 3.3.3.3 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>AGG] <strong>commit</strong></pre>
<p>Repeat this step for the AGG ASBR and core ASBR. For configuration details, see <a href="#EN-US_TASK_0172368697__section_dc_vrp_seamless_mpls_cfg_004205">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure BFD for BGP tunnel.</span><p><p># On the CSG, enable the MPLS capability to dynamically establish BGP BFD sessions based on host addresses.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls] <strong>mpls bgp bfd enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls] <strong>mpls bgp bfd-trigger-tunnel host</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CSG] <strong>commit</strong></pre>
<p># On the MASG, enable the MPLS capability of passively creating a BFD session.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MASG] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bfd] <strong>mpls-passive</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MASG] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the preceding configurations, run the <strong>display mpls bfd session protocol bgp</strong> command on the CSG to view information about the BFD session that monitors a BGP tunnel.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CSG] <strong>display mpls bfd session protocol bgp</strong></pre>
<pre class="screen">-------------------------------------------------------------------------------
                        BFD Information: BGP  TUNNEL
-------------------------------------------------------------------------------
FEC             DISC  OUT-IF           NEXTHOP         TUNNEL         STATE
-------------------------------------------------------------------------------
5.5.5.5         16385 -                -.-.-.-         -              Up</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368697__section_dc_vrp_seamless_mpls_cfg_004205"><a name="EN-US_TASK_0172368697__section_dc_vrp_seamless_mpls_cfg_004205"></a><a name="section_dc_vrp_seamless_mpls_cfg_004205"></a><a name="EN-US_TASK_0172368697__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CSG configuration file</p>
<pre class="screen">#
sysname CSG
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls bgp bfd enable
 mpls bgp bfd-trigger-Tunnel host
# 
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  network 1.1.1.1 255.255.255.255
  peer 2.2.2.2 enable
  peer 2.2.2.2 route-policy policy1 export
  peer 2.2.2.2 label-route-capability
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 apply mpls-label
#
return</pre>
</li><li><p>AGG configuration file</p>
<pre class="screen">#
sysname AGG
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0001.0020.0200.2002.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 1.1.1.1 enable
  peer 1.1.1.1 route-policy policy1 export
  peer 1.1.1.1 reflect-client
  peer 1.1.1.1 next-hop-local
  peer 1.1.1.1 label-route-capability
  peer 3.3.3.3 enable
  peer 3.3.3.3 route-policy policy1 export
  peer 3.3.3.3 reflect-client
  peer 3.3.3.3 next-hop-local
  peer 3.3.3.3 label-route-capability
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>AGG ASBR configuration file</p>
<pre class="screen">#
sysname AGG ASBR
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0001.0030.0300.3003.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 10.3.1.2 as-number 200
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
  peer 2.2.2.2 route-policy policy1 export
  peer 2.2.2.2 label-route-capability
  peer 10.3.1.2 enable
  peer 10.3.1.2 route-policy policy1 export
  peer 10.3.1.2 label-route-capability check-tunnel-reachable
#
route-policy policy1 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>Core ASBR configuration file</p>
<pre class="screen">#
sysname Core ASBR
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 mpls
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
bgp 200
 peer 5.5.5.5 as-number 200
 peer 5.5.5.5 connect-interface LoopBack0
 peer 10.3.1.1 as-number 100
 #
 ipv4-family unicast
  peer 5.5.5.5 enable
  peer 5.5.5.5 route-policy policy1 export
  peer 5.5.5.5 label-route-capability
  peer 10.3.1.1 enable
  peer 10.3.1.1 route-policy policy1 export
  peer 10.3.1.1 label-route-capability check-tunnel-reachable
#
ospf 2
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.4.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>MASG configuration file</p>
<pre class="screen">#
sysname MASG
#
bfd
 mpls-passive
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
#
bgp 100
 peer 4.4.4.4 as-number 200
 peer 4.4.4.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  network 5.5.5.5 255.255.255.255
  peer 4.4.4.4 enable
  peer 4.4.4.4 route-policy policy1 export
  peer 4.4.4.4 label-route-capability
#
ospf 2
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 10.4.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 apply mpls-label
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0030.html">Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_seamless_mpls_cfg_0033.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>