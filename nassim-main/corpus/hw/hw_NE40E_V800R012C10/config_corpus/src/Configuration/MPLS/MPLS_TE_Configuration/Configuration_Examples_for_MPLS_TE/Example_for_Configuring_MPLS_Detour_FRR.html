
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MPLS Detour FRR">
<meta name="abstract" content="This section provides an example for configuring MPLS detour FRR on an RSVP-TE tunnel.">
<meta name="description" content="This section provides an example for configuring MPLS detour FRR on an RSVP-TE tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0106.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0109.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,te-p2pvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368345">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring MPLS Detour FRR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368345"></a><a name="EN-US_TASK_0172368345"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MPLS Detour FRR</h1>
<div class="taskbody"><p>This section provides an example for configuring MPLS detour FRR on an RSVP-TE tunnel.</p>
<div class="context"><a name="EN-US_TASK_0172368345__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Traffic engineering (TE) fast reroute (FRR) provides local link and node protection for MPLS TE tunnels. If a link or node fails, traffic is rapidly switched to a backup path, which minimizes traffic loss. TE FRR is working in facility or one-to-one backup mode. TE FRR in one-to-one backup mode is also called MPLS detour FRR. MPLS detour FRR automatically creates a detour LSP on each eligible node along primary CR-LSP to protect downstream links or nodes. This mode is easy to configure, eliminates manual network planning, and provides flexibility on a complex network.</p>
<p><a href="#EN-US_TASK_0172368345__fig_dc_vrp_te-p2p_cfg_021301">Figure 1</a> shows a primary RSVP-TE tunnel along the path LSRA -&gt; LSRC -&gt; LSRE. To improve tunnel reliability, MPLS detour FRR must be configured.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For information about how to configure TE FRR in facility backup mode, see <a href="dc_vrp_te-p2p_cfg_0105.html">Example for Configuring MPLS TE Manual FRR</a> and <a href="dc_vrp_te-p2p_cfg_0106.html">Example for Configuring MPLS TE Auto FRR</a>.</p>
</div></div>
<div class="fignone" id="EN-US_TASK_0172368345__fig_dc_vrp_te-p2p_cfg_021301"><a name="EN-US_TASK_0172368345__fig_dc_vrp_te-p2p_cfg_021301"></a><a name="fig_dc_vrp_te-p2p_cfg_021301"></a><span class="figcap"><b>Figure 1 </b>MPLS detour FRR networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/1</span>, GE <span>0/1/2</span>, and GE <span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_te-p2p_cfg_021301.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368345__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><ul><li><p>The facility backup and one-to-one backup modes are mutually exclusive on the same TE tunnel interface. If both modes are configured, the latest configured mode overrides the previous one.</p>
</li><li><p>The shared explicit (SE) style must be used for the MPLS detour FRR-enabled tunnel.</p>
</li><li><p>CSPF must be enabled on each node along both the primary and backup RSVP-TE tunnels.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368345__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an RSVP-TE tunnel.</p>
</li><li><p>Enable MPLS detour FRR on an RSVP-TE tunnel interface.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368345__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP addresses of interfaces</p>
</li><li><p>IGP protocol (IS-IS), process ID (1), system ID (converted using loopback1 address), and IS-IS level (level-2)</p>
</li><li><p>LSR ID (loopback interface address) of every MPLS node</p>
</li><li><p>Tunnel interface name (Tunnel1), tunnel IP address (loopback interface IP address), tunnel ID (100), and destination IP address (5.5.5.5)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368345__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address and a mask to each interface.</span><p><p>Assign an IP address to each interface and create a loopback interface on each node. For configuration details, see <a href="#EN-US_TASK_0172368345__section_dc_vrp_te-p2p_cfg_021305">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure IS-IS to advertise the route to each network segment to which each interface is connected and to advertise the host route to each loopback address that is used as an LSR ID.</span><p><p>Configure IS-IS on each node to implement network layer connectivity. For configuration details, see <a href="#EN-US_TASK_0172368345__section_dc_vrp_te-p2p_cfg_021305">Configuration Files</a> in this section.</p>
</p></li><li><span>Enable MPLS, MPLS TE, MPLS RSVP-TE, and CSPF globally on each node.</span><p><p># Configure LSRA.</p>
<pre class="screen">&lt;LSRA&gt; <strong>system-view </strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>quit</strong></pre>
<p>Repeat this step for LSRB, LSRC, LSRD, LSRE, and LSRF. For configuration details, see <a href="#EN-US_TASK_0172368345__section_dc_vrp_te-p2p_cfg_021305">Configuration Files</a> in this section.</p>
</p></li><li><span>Enable IGP TE on each node.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-isis-1]<strong> cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1]<strong> traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-isis-1]<strong> quit</strong></pre>
<p>Repeat this step for LSRB, LSRC, LSRD, LSRE, and LSRF. For configuration details, see <a href="#EN-US_TASK_0172368345__section_dc_vrp_te-p2p_cfg_021305">Configuration Files</a> in this section.</p>
</p></li><li><span>Enable RSVP-TE on interfaces of each node.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/1</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/1</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-GigabitEthernet<span>0/1/2</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/2</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/2</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p>Repeat this step for LSRB, LSRC, LSRD, LSRE, and LSRF. For configuration details, see <a href="#EN-US_TASK_0172368345__section_dc_vrp_te-p2p_cfg_021305">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an RSVP-TE tunnel interface on LSRA (ingress).</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> destination 5.5.5.5</strong></pre>
</p></li><li><span>Enable MPLS detour FRR on an RSVP-TE tunnel interface.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> mpls te detour</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-Tunnel1]<strong> quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><div class="p">After completing the configurations, run the <a href="cmdqueryname=display+mpls+te+tunnel"><b><span class="cmdname">display mpls te tunnel</span></b></a> command on LSRA to view detour LSP information.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> display mpls te tunnel</strong></pre>
<pre class="screen">* means the LSP is detour LSP
-------------------------------------------------------------------------------
Ingress LsrId   Destination     LSPID In/OutLabel     R Tunnel-name
-------------------------------------------------------------------------------
1.1.1.1         5.5.5.5         25    -/32832         I Tunnel1
1.1.1.1         5.5.5.5         25   *-/32831         I Tunnel1
-------------------------------------------------------------------------------
R: Role, I: Ingress, T: Transit, E: Egress</pre>
</div>
<div class="p">Run the <a href="cmdqueryname=display+mpls+te+tunnel+path"><b><span class="cmdname">display mpls te tunnel path</span></b></a> command on LSRA to view the primary CR-LSP and detour LSP information. The command output shows that a detour LSP has been established to provide node protection on LSRA, and another detour LSP has been established to provide link protection on LSRC.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> display mpls te tunnel path</strong></pre>
<pre class="screen"> Tunnel Interface Name : Tunnel1
 Lsp ID : 1.1.1.1 :100 :25
 Hop Information
  Hop 0   10.1.1.1 <strong>Local-Protection available | node</strong>
  Hop 1   10.1.1.2 Label 32832
  Hop 2   3.3.3.3 Label 32832
  Hop 3   10.1.3.1 <strong>Local-Protection available</strong>
  Hop 4   10.1.3.2 Label 3
  Hop 5   5.5.5.5 Label 3
  
 Tunnel Interface Name : Tunnel1
 Lsp ID : 1.1.1.1 :100 :25
 <strong>Detour Lsp  PLR ID :10.1.2.1 </strong>
 Hop Information
  Hop 0   10.1.2.1
  Hop 1   10.1.2.2 Label 32831
  Hop 2   2.2.2.2 Label 32831
  Hop 3   10.1.6.1
  Hop 4   10.1.6.2 Label 32832
  Hop 5   4.4.4.4 Label 32832
  Hop 6   10.1.7.1
  Hop 7   10.1.7.2 Label 32831
  Hop 8   6.6.6.6 Label 32831
  Hop 9   10.1.5.2
  Hop 10  10.1.5.1 Label 3
  Hop 11  5.5.5.5 Label 3</pre>
</div>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368345__section_dc_vrp_te-p2p_cfg_021305"><a name="EN-US_TASK_0172368345__section_dc_vrp_te-p2p_cfg_021305"></a><a name="section_dc_vrp_te-p2p_cfg_021305"></a><a name="EN-US_TASK_0172368345__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#
sysname LSRA
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#               
isis 1          
 is-level level-2
 cost-style wide
 network-entity 10.0001.0010.0100.1001.00
 traffic-eng level-2
#               
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown  
 ip address 10.1.1.1 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#                            
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ip address 10.1.2.1 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#               
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1  
#               
interface Tunnel1
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 5.5.5.5
 mpls te record-route label
 mpls te detour 
 mpls te tunnel-id 100
#                            
return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#
sysname LSRB
#
mpls lsr-id 2.2.2.2
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf       
#               
isis 1          
 is-level level-2
 cost-style wide
 network-entity 10.0001.0020.0200.2002.00
 traffic-eng level-2         
#               
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown  
 ip address 10.1.2.2 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te              
#               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ip address 10.1.6.1 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te              
#               
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1  
#                   
return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#
sysname LSRC
#
mpls lsr-id 3.3.3.3
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf      
#               
isis 1          
 is-level level-2
 cost-style wide
 network-entity 10.0001.0030.0300.3003.00
 traffic-eng level-2
#               
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown  
 ip address 10.1.1.2 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ip address 10.1.4.1 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#               
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown  
 ip address 10.1.3.1 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#               
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1  
#               
return          </pre>
</li><li><p>LSRD configuration file</p>
<pre class="screen">#
sysname LSRD
#
mpls lsr-id 4.4.4.4
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#               
isis 1          
 is-level level-2
 cost-style wide
 network-entity 10.0001.0040.0400.4004.00
 traffic-eng level-2         
#               
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown  
 ip address 10.1.6.2 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown  
 ip address 10.1.4.2 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#                            
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown  
 ip address 10.1.7.1 255.255.255.0
 isis enable 1  
 mpls           
 mpls te
 mpls rsvp-te   
#               
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 isis enable 1  
#               
return          </pre>
</li><li><p>LSRE configuration file</p>
<pre class="screen">#
sysname LSRE
#
mpls lsr-id 5.5.5.5
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0001.0050.0500.5005.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.5.1 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>LSRF configuration file</p>
<pre class="screen">#
sysname LSRF
#
mpls lsr-id 6.6.6.6
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
isis 1
 is-level level-2
 cost-style wide
 network-entity 10.0001.0060.0600.6006.00
 traffic-eng level-2
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.5.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.7.2 255.255.255.0
 isis enable 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 6.6.6.6 255.255.255.255
 isis enable 1
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">Configuration Examples for MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0106.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0109.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>