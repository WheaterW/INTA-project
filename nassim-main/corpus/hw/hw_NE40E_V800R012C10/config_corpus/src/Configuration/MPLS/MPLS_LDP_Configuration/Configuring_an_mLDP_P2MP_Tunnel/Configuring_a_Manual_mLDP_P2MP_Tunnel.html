
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Manual mLDP P2MP Tunnel">
<meta name="abstract" content="A manual mLDP P2MP tunnel can be manually triggered and transmit multicast services, excluding multicast VPN services.">
<meta name="description" content="A manual mLDP P2MP tunnel can be manually triggered and transmit multicast services, excluding multicast VPN services.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0060.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0062.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ldp-p2pvrp,w00800033,z00545680,w00556928,w00606909,z00809835,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368535">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Manual mLDP P2MP Tunnel</title>
</head>
<body><a name="EN-US_TASK_0172368535"></a><a name="EN-US_TASK_0172368535"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Manual mLDP P2MP Tunnel</h1>
<div class="taskbody"><p>A manual mLDP P2MP tunnel can be manually triggered and transmit multicast services, excluding multicast VPN services.</p>
<div class="context"><a name="EN-US_TASK_0172368535__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Manually configure the root and leaf nodes to trigger the establishment of a manual mLDP P2MP tunnel.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172368535__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li id="EN-US_TASK_0172368535__step_01"><span id="EN-US_TASK_0172368535__cmd1339867217214047">Enable mLDP P2MP globally.</span><ol id="EN-US_TASK_0172368535__substeps429169241214047"><li class="substepexpand" id="EN-US_TASK_0172368535__substep1503714125214047"><span id="EN-US_TASK_0172368535__cmd1335740979214047">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1953882560214047">system-view</span></b></a></span><p><p id="EN-US_TASK_0172368535__p146068319273">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368535__substep1947610509214047"><span id="EN-US_TASK_0172368535__cmd1544077189214047">Run <a href="cmdqueryname=mpls+ldp"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname350850855214047">mpls ldp</span></b></a></span><p><p id="EN-US_TASK_0172368535__p7274145313262">The MPLS-LDP view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368535__substep1999747460214047"><span id="EN-US_TASK_0172368535__cmd1636484670214047">Run <a href="cmdqueryname=mldp+p2mp"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1765230099214047">mldp p2mp</span></b></a></span><p><p id="EN-US_TASK_0172368535__p23421142192617">mLDP P2MP is enabled globally.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368535__substep1678459143214047"><span id="EN-US_TASK_0172368535__cmd517629409214047">(Optional) Run <a href="cmdqueryname=mldp+make-before-break"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1154732772214047">mldp make-before-break</span></b></a></span><p><p id="EN-US_TASK_0172368535__p19263113112619">The mLDP make-before-break (MBB) capability is enabled.</p>
</p><p><p id="EN-US_TASK_0172368535__p191189848214047">If the optimal route between a non-root node and a root node on an mLDP P2MP network changes, the non-root node re-selects an upstream node and by default tears down the current P2MP LSP. As a result, traffic is dropped before a new P2MP LSP is established. To prevent traffic loss, the mLDP MBB capability can be enabled. If the optimal route to the root node changes, the node does not delete the original P2MP LSP until a new P2MP LSP is established. This minimizes traffic loss.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368535__substep301104151214047"><span id="EN-US_TASK_0172368535__cmd1185993525214047">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname65749370214047">commit</span></b></a></span><p><p id="EN-US_TASK_0172368535__p4295182072612">The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368535__step_02"><span id="EN-US_TASK_0172368535__cmd1885478289214047">(Optional) Disable mLDP P2MP on an interface.</span><p><p id="EN-US_TASK_0172368535__p2123108507214047">To flexibly control the path of a P2MP LSP, you can disable mLDP P2MP on a specified interface.</p>
<p id="EN-US_TASK_0172368535__p2144734831214047">Disabling mLDP P2MP on an interface helps you plan a network. For example, if links balance traffic on a network, to enable P2MP traffic to travel along a specific link, disable mLDP P2MP on the interfaces connected to other links.</p>
</p><ol id="EN-US_TASK_0172368535__substeps1428372214047"><li class="substepexpand" id="EN-US_TASK_0172368535__substep1918831680214047"><span id="EN-US_TASK_0172368535__cmd1042118761214047">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1727515077214047">system-view</span></b></a></span><p><p id="EN-US_TASK_0172368535__p3969156192514">The system view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368535__substep2074034667214047"><span id="EN-US_TASK_0172368535__cmd346090165214047">Run <a href="cmdqueryname=interface"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1722718787214047">interface</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368535__varname4621165915264">interface-type</span></i> <i><span class="varname" id="EN-US_TASK_0172368535__varname1862125942620">interface-number</span></i></span><p><p id="EN-US_TASK_0172368535__p77917882610">The interface view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368535__substep1960007866214047"><span id="EN-US_TASK_0172368535__cmd1600542529214047">Run <a href="cmdqueryname=mpls+mldp+p2mp+disable"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname201282593214047">mpls mldp p2mp disable</span></b></a></span><p><p id="EN-US_TASK_0172368535__p157696429323">mLDP P2MP is disabled on the interface.</p>
</p><p><p id="EN-US_TASK_0172368535__p726583078214047">Disabling mLDP P2MP on an interface affects the establishment of P2MP LSPs, but does not cause the reestablishment of other P2P LDP sessions.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172368535__substep1241343996214047"><span id="EN-US_TASK_0172368535__cmd464910167214047">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname112635598214047">commit</span></b></a></span><p><p id="EN-US_TASK_0172368535__p6277161013313">The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure each leaf node to trigger mLDP P2MP LSP establishment.</span><p><p>After mLDP P2MP is enabled on all nodes, configure each leaf node to trigger mLDP P2MP LSP establishment.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mpls+ldp"><b><span class="cmdname">mpls ldp</span></b></a></span><p><p>The MPLS-LDP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mldp+p2mp-lsp+name+root-ip+lsp-id"><b><span class="cmdname">mldp p2mp-lsp</span></b></a> <strong><span>name</span></strong> <i><span class="varname">p2mp-lsp-name</span></i> <strong><span>root-ip</span></strong> <i><span class="varname">root-ip-address</span></i> <strong><span>lsp-id</span></strong> <i><span class="varname">lsp-id</span></i></span><p><p>The leaf node is configured to trigger the establishment of an mLDP P2MP LSP from the specified root node to the current leaf node.</p>
</p><p><p><i><span class="varname">p2mp-lsp-name</span></i> specifies the name of the P2MP LSP, <i><span class="varname">root-ip-address</span></i> specifies the IP address of the root node, and <i><span class="varname">lsp-id</span></i> specifies the ID of the P2MP LSP. The <i><span class="varname">root-ip-address</span></i> and <i><span class="varname">lsp-id</span></i> parameters together uniquely identify an mLDP P2MP LSP.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure an mLDP P2MP tunnel interface.</span><p><p>Before multicast traffic can be steered into an mLDP P2MP LSP, the mLDP P2MP LSP must be bound to an mLDP P2MP tunnel interface so that the tunnel interface can be statically added to an Internet Group Management Protocol (IGMP) multicast group.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mldp-p2mp-tunnel"><b><span class="cmdname">mldp-p2mp-tunnel</span></b></a> <i><span class="varname">tunnel-name</span></i></span><p><p>An mLDP P2MP tunnel interface is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=root-ip+lsp-id"><b><span class="cmdname">root-ip</span></b></a> <i><span class="varname">root-ip-address</span></i> <strong><span>lsp-id</span></strong> <i><span class="varname">lsp-id</span></i></span><p><p>An mLDP P2MP LSP is bound to the tunnel interface.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li id="EN-US_TASK_0172368535__step1358102152117"><span id="EN-US_TASK_0172368535__cmd20358021182116">(Optional) Configure a tunnel establishment policy that allows mLDP to select an upstream node based on peer IDs.</span><p><p id="EN-US_TASK_0172368535__p122801562134">By default, a leaf or transit node selects the next hop on the optimal route to the root node as its upstream node during P2MP tunnel establishment. If routes work in load balancing mode, more than one such upstream node exists, and a leaf or transit node randomly selects an upstream node among the candidates. If you want a leaf or transit node to select a specific upstream node, configure a tunnel establishment policy that allows mLDP to select an upstream node based on peer IDs â an upstream node with the largest or smallest peer ID.</p>
<p id="EN-US_TASK_0172368535__p981018123395">Both NG MVPN over mLDP P2MP and VPLS over mLDP P2MP have the dual-root 1+1 protection mechanism. If the routes to the primary and backup roots work in load balancing mode and share some links, an upstream node may be selected by mLDP for both the primary and backup mLDP tunnels. In this case, if the shared link where the selected upstream node resides becomes faulty, dual-root 1+1 protection fails to take effect. To prevent such a protection failure in the scenario with co-routed primary and backup mLDP tunnels, run the <a href="cmdqueryname=mldp+upstream-lsr-select+highest"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname18267859114716">mldp upstream-lsr-select highest</span></b></a> command for one tunnel and the <a href="cmdqueryname=mldp+upstream-lsr-select+lowest"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname192460816483">mldp upstream-lsr-select lowest</span></b></a> command for the other tunnel.</p>
<ol id="EN-US_TASK_0172368535__ol7438818185318"><li id="EN-US_TASK_0172368535__li19801169204914">Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname19889563231">system-view</span></b></a><p id="EN-US_TASK_0172368535__p1035967122315">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172368535__li1643861811538">Run <a href="cmdqueryname=ip+ip-prefix+permit+deny"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname16609323234">ip ip-prefix</span></b></a><strong id="EN-US_TASK_0172368535__b9609225232"> </strong><i><span class="varname" id="EN-US_TASK_0172368535__varname11609112102312">ip-prefix-name</span></i><em id="EN-US_TASK_0172368535__i1860922132317"> </em>{ <strong><span id="EN-US_TASK_0172368535__cmdparmname2609122162311">permit</span></strong> | <strong><span id="EN-US_TASK_0172368535__cmdparmname1160952182314">deny</span></strong> } <i><span class="varname" id="EN-US_TASK_0172368535__varname060912162314">ip-address</span></i><p id="EN-US_TASK_0172368535__p52610302310">A policy for selecting tunnels to specified root nodes is configured.</p>
</li><li id="EN-US_TASK_0172368535__li069112651814">Run <a href="cmdqueryname=mpls"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1595795822212">mpls</span></b></a><p id="EN-US_TASK_0172368535__p64561759172213">MPLS is enabled, and the MPLS view is displayed.</p>
</li><li id="EN-US_TASK_0172368535__li2448791478">Run <a href="cmdqueryname=mpls+ldp"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname52631155192219">mpls ldp</span></b></a><p id="EN-US_TASK_0172368535__p1788855202213">The MPLS-LDP view is displayed.</p>
</li><li id="EN-US_TASK_0172368535__li09932045124813">Run <a href="cmdqueryname=mldp+p2mp"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname16807151192210">mldp p2mp</span></b></a><p id="EN-US_TASK_0172368535__p14776165211225">mLDP P2MP is enabled globally.</p>
</li><li id="EN-US_TASK_0172368535__li610711566525">Configure a tunnel establishment policy that allows mLDP to select an upstream node based on peer IDs.<div class="note" id="EN-US_TASK_0172368535__note6253151417416"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172368535__p1325317147411">If both the <a href="cmdqueryname=mldp+upstream-lsr-select+highest"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname62501836154115">mldp upstream-lsr-select highest</span></b></a> and <a href="cmdqueryname=mldp+upstream-lsr-select+lowest"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1639284134110">mldp upstream-lsr-select lowest</span></b></a> commands are run and the same mLDP root node is specified in them, only the <a href="cmdqueryname=mldp+upstream-lsr-select+highest"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1090054612412">mldp upstream-lsr-select highest</span></b></a> command configuration takes effect.</p>
</div></div>
<ul id="EN-US_TASK_0172368535__ul1172615619596"><li id="EN-US_TASK_0172368535__li772695625919">Run the <a href="cmdqueryname=mldp+upstream-lsr-select+lowest+ip-prefix"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1849294017014">mldp upstream-lsr-select lowest ip-prefix</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368535__varname153591254600">ip-prefix-name</span></i> command to configure a tunnel establishment policy that allows mLDP to select an upstream node with the smallest peer ID.</li><li id="EN-US_TASK_0172368535__li1881063418">Run the <a href="cmdqueryname=mldp+upstream-lsr-select+highest+ip-prefix"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname10881461544">mldp upstream-lsr-select highest ip-prefix</span></b></a> <i><span class="varname" id="EN-US_TASK_0172368535__varname0881961142">ip-prefix-name</span></i> command to configure a tunnel establishment policy that allows mLDP to select an upstream node with the largest peer ID.</li></ul>
</li><li id="EN-US_TASK_0172368535__li239115512610">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname33710427224">commit</span></b></a><p id="EN-US_TASK_0172368535__p13951143182213">The configuration is committed.</p>
</li></ol>
</p></li><li id="EN-US_TASK_0172368535__step1924119405168"><span id="EN-US_TASK_0172368535__cmd17241134031618">(Optional) Disabling mLDP from Using the Default Route to Establish Tunnels</span><p><p id="EN-US_TASK_0172368535__p1149591116194">In a scenario where mLDP P2MP uses intra-AS routes or inter-AS BGP routes to tunnel root nodes to establish mLDP tunnels, you can configure mLDP not to use the default route 0.0.0.0/0 to establish an mLDP tunnel if such a tunnel is not expected.</p>
<ol id="EN-US_TASK_0172368535__ol59431492113"><li id="EN-US_TASK_0172368535__li0597528112114"><p id="EN-US_TASK_0172368535__p89295614452"><a name="EN-US_TASK_0172368535__li0597528112114"></a><a name="li0597528112114"></a>Run <a href="cmdqueryname=system-view"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname79212564451">system-view</span></b></a></p>
<p id="EN-US_TASK_0172368535__p11351957174518">The system view is displayed.</p>
</li><li id="EN-US_TASK_0172368535__li55986282217"><p id="EN-US_TASK_0172368535__p101417010462"><a name="EN-US_TASK_0172368535__li55986282217"></a><a name="li55986282217"></a>Run <a href="cmdqueryname=mpls"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname2141705464">mpls</span></b></a></p>
<p id="EN-US_TASK_0172368535__p65921802461">MPLS is enabled, and the MPLS view is displayed.</p>
</li><li id="EN-US_TASK_0172368535__li063753611213"><p id="EN-US_TASK_0172368535__p1428420734617"><a name="EN-US_TASK_0172368535__li063753611213"></a><a name="li063753611213"></a>Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname11284117174611">quit</span></b></a></p>
<p id="EN-US_TASK_0172368535__p118072712469">Return to the system view.</p>
</li><li id="EN-US_TASK_0172368535__li14383623112213"><p id="EN-US_TASK_0172368535__p44081711154616"><a name="EN-US_TASK_0172368535__li14383623112213"></a><a name="li14383623112213"></a>Run <a href="cmdqueryname=mpls+ldp"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname14081611154618">mpls ldp</span></b></a></p>
<p id="EN-US_TASK_0172368535__p17903111114469">The MPLS-LDP view is displayed.</p>
</li><li id="EN-US_TASK_0172368535__li216653411221"><p id="EN-US_TASK_0172368535__p1591314154613"><a name="EN-US_TASK_0172368535__li216653411221"></a><a name="li216653411221"></a>Run <a href="cmdqueryname=mldp+p2mp"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname059914114616">mldp p2mp</span></b></a></p>
<p id="EN-US_TASK_0172368535__p11548151410467">mLDP P2MP is enabled globally.</p>
</li><li id="EN-US_TASK_0172368535__li15276203613225"><p id="EN-US_TASK_0172368535__p1024771815463"><a name="EN-US_TASK_0172368535__li15276203613225"></a><a name="li15276203613225"></a>Run <strong id="EN-US_TASK_0172368535__b12247141824612"><a href="cmdqueryname=mldp+default-route-match+ignore"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname152478183468">mldp default-route-match ignore</span></b></a></strong></p>
<p id="EN-US_TASK_0172368535__p08079184468">mLDP is disabled from using the default route to establish tunnels.</p>
</li><li id="EN-US_TASK_0172368535__li1533252817245"><p id="EN-US_TASK_0172368535__p1570532114615"><a name="EN-US_TASK_0172368535__li1533252817245"></a><a name="li1533252817245"></a>Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172368535__cmdname1470552117469">commit</span></b></a></p>
<p id="EN-US_TASK_0172368535__p520619227467">The configuration is committed.</p>
</li></ol>
</p></li></ul></div>
<div class="postreq"><a name="EN-US_TASK_0172368535__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Follow-up Procedure</h4>
<div class="p"><p>Statically add the tunnel interface to an IGMP multicast group to allow multicast traffic to be steered into the mLDP tunnel.</p>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0060.html">Configuring an mLDP P2MP Tunnel
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0062.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>