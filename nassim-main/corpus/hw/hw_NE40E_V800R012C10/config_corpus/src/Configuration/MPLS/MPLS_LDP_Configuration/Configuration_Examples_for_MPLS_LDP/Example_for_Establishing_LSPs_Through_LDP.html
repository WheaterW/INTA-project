
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Establishing LSPs Through LDP">
<meta name="abstract" content="This section provides an example for establishing LSPs using LDP. The configuration procedure involves establishing a local LDP session and modifying the policy for triggering the establishment of an LSP on each LSR.">
<meta name="description" content="This section provides an example for establishing LSPs using LDP. The configuration procedure involves establishing a local LDP session and modifying the policy for triggering the establishment of an LSP on each LSR.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0040.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0042.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ldp-p2pvrp,w00800033,z00545680,w00556928,w00606909,z00809835,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368565">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Establishing LSPs Through LDP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368565"></a><a name="EN-US_TASK_0172368565"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Establishing LSPs Through LDP</h1>
<div class="taskbody"><p>This section provides an example for establishing LSPs using LDP. The configuration procedure involves establishing a local LDP session and modifying the policy for triggering the establishment of an LSP on each LSR.</p>
<div class="context"><a name="EN-US_TASK_0172368565__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172368565__fig_dc_vrp_ldp-p2p_cfg_004101">Figure 1</a>, LSRA, LSRB, and LSRC all function as core devices or edge devices on a backbone network. On this network, after local LDP sessions are set up between LSRA and LSRB, and between LSRB and LSRC, each pair of LSRs can distribute labels to each other and establish LDP LSPs. MPLS services can be transmitted along the LSPs.</p>
<div class="fignone" id="EN-US_TASK_0172368565__fig_dc_vrp_ldp-p2p_cfg_004101"><a name="EN-US_TASK_0172368565__fig_dc_vrp_ldp-p2p_cfg_004101"></a><a name="fig_dc_vrp_ldp-p2p_cfg_004101"></a><span class="figcap"><b>Figure 1 </b>Configuring a policy for triggering LDP LSP establishment</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0278892277.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368565__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>During the configuration, note the following:</p>
<ul><li><p>Each LSR must have route entries that exactly match FECs for the LSPs to be established.</p>
</li><li><p>By default, the triggering policy is <strong>host</strong>, allowing a device to use host IP routes with 32-bit addresses to trigger LDP LSP establishment.</p>
</li><li>If the triggering policy is <strong>all</strong>, all IGP routes are used to trigger LDP LSP establishment. The device does not use public network BGP routes to trigger LDP LSP establishment.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368565__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure local LDP sessions.</p>
</li><li><p>Change the policy for triggering LDP LSP establishment on each LSR.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368565__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of each interface on each LSR (as shown in <a href="#EN-US_TASK_0172368565__fig_dc_vrp_ldp-p2p_cfg_004101">Figure 1</a>), OSPF process ID, and area ID</p>
</li><li><p>Policy for triggering LDP LSP establishment</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368565__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an LDP LSP.</span><p><p>After you complete the task described in <a href="dc_vrp_ldp-p2p_cfg_0039.html">Example for Configuring Local LDP Sessions</a>, each LSR uses the default LDP LSP triggering policy. That is, each LSR uses host IP routes with 32-bit addresses to trigger LDP LSP establishment.</p>
<p># Run the <a href="cmdqueryname=display+mpls+ldp+lsp"><b><span class="cmdname">display mpls ldp lsp</span></b></a> command on each LSR. The command output shows the LSR has successfully established LDP LSPs for all host routes.</p>
<p>The following example uses the command output on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 1.1.1.9/32         3/NULL         2.2.2.9         127.0.0.1        LoopBack1
*1.1.1.9/32         Liberal/3                      DS/2.2.2.9
 2.2.2.9/32         NULL/3         -               10.1.1.2         GE<span>0/1/0</span>
 2.2.2.9/32         1024/3         2.2.2.9         10.1.1.2         GE<span>0/1/0</span>
 3.3.3.9/32         NULL/1025      -               10.1.1.2         GE<span>0/1/0</span>
 3.3.3.9/32         1025/1025      3.3.3.9         10.1.1.2         GE<span>0/1/0</span>     
 ------------------------------------------------------------------------------
 TOTAL: 5 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 Frr LSP(s) Found.
<span> An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</span></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The default triggering policy is recommended, as this allows a device to use host IP routes with 32-bit addresses to trigger LDP LSP establishment. You can also perform the following steps to change the policy for triggering LDP LSP establishment as required.</p>
</div></div>
</p></li><li><span>Change the policy for triggering the establishment of LDP LSPs.</span><p><p>Change the policy for triggering LDP LSP establishment to <strong>all</strong> on each LSR so that the LSR uses all<span> static routes and</span> IGP routes in the routing table to trigger LDP LSP establishment.</p>
<p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>lsp-trigger all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>quit</strong></pre>
<p># Configure LSRB.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-mpls] <strong>lsp-trigger all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-mpls] <strong>quit</strong></pre>
<p># Configure LSRC.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls] <strong>lsp-trigger all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRC-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRC-mpls] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After completing the configuration, run the <a href="cmdqueryname=display+mpls+ldp+lsp"><b><span class="cmdname">display mpls ldp lsp</span></b></a> command on each node to check information about LDP LSPs. The following example uses the command output on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel   UpstreamPeer    NextHop     OutInterface
 -------------------------------------------------------------------------------
 1.1.1.9/32         3/NULL        2.2.2.9         127.0.0.1   LoopBack1    
*1.1.1.9/32         Liberal/3                     DS/2.2.2.9
 2.2.2.9/32         NULL/3        -               10.1.1.2    GE<span>0/1/0</span>    
 2.2.2.9/32         1024/3        2.2.2.9         10.1.1.2    GE<span>0/1/0</span>    
 3.3.3.9/32         NULL/1025     -               10.1.1.2    GE<span>0/1/0</span>    
 3.3.3.9/32         1025/1025     2.2.2.9         10.1.1.2    GE<span>0/1/0</span>    
 10.1.1.0/30        3/NULL        2.2.2.9         10.1.1.1    GE<span>0/1/0</span>    
*10.1.1.0/30        Liberal/3                     DS/2.2.2.9
 10.2.1.0/30        NULL/3        -               10.1.1.2    GE<span>0/1/0</span>    
 10.2.1.0/30        1026/3        2.2.2.9         10.1.1.2    GE<span>0/1/0</span>    
 -------------------------------------------------------------------------------
 TOTAL: 8 Normal LSP(s) Found.
 TOTAL: 2 Liberal LSP(s) Found.
 TOTAL: 0 Frr LSP(s) Found.
<span> An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</span></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172368565__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRA</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.9</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">  lsp-trigger all</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #
 ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.1 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 1.1.1.9 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#</pre>
<pre class="screen"> sysname LSRB</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 2.2.2.9</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls</pre>
<pre class="screen">  lsp-trigger all</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #
 ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.1.1.2 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.1.1 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 2.2.2.9 0.0.0.0</pre>
<pre class="screen">  network 10.1.1.0 0.0.0.3</pre>
<pre class="screen">  network 10.2.1.0 0.0.0.3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRC</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 3.3.3.9</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen">  lsp-trigger all</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls ldp</pre>
<pre class="screen"> #
 ipv4-family</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.2.1.2 255.255.255.252</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls ldp</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.9 255.255.255.255</pre>
<pre class="screen">#</pre>
<pre class="screen">ospf 1</pre>
<pre class="screen"> area 0.0.0.0</pre>
<pre class="screen">  network 3.3.3.9 0.0.0.0</pre>
<pre class="screen">  network 10.2.1.0 0.0.0.3</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">Configuration Examples for MPLS LDP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0040.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0042.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>