
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dynamic BFD for LDP Tunnel">
<meta name="abstract" content="This section provides an example for configuring dynamic BFD to monitor an LDP tunnel. The configuration involves configuring LDP FRR and configuring dynamic BFD for LDP tunnel.">
<meta name="description" content="This section provides an example for configuring dynamic BFD to monitor an LDP tunnel. The configuration involves configuring LDP FRR and configuring dynamic BFD for LDP tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_2045.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0054.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="ldp-p2pvrp,w00800033,z00545680,w00556928,w00606909,z00809835,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS LDP">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="z00809835">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="b00896120">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368587">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Dynamic BFD for LDP Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368587"></a><a name="EN-US_TASK_0172368587"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dynamic BFD for LDP Tunnel</h1>
<div class="taskbody"><p>This section provides an example for configuring dynamic BFD to monitor an LDP tunnel. The configuration involves configuring LDP FRR and configuring dynamic BFD for LDP tunnel.</p>
<div class="context"><a name="EN-US_TASK_0172368587__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>When LDP LSPs transmit application traffic, for example, VPN, to improve network reliability, LDP FRR and an LDP upper-layer protection mechanism, such as VPN FRR or VPN equal-cost multipath (ECMP), are used. BFD for LDP LSP only detects primary LSP faults and switches traffic to an FRR LSP. If the primary and FRR LSPs fail simultaneously, the BFD mechanism does not take effect. In this situation, LDP can instruct its upper-layer application to perform a protection switchover only after LDP detects the FRR LSP failure. As a result, a great number of packets are dropped.</p>
<p>To prevent packet loss occurring when BFD for LDP LSP cannot detect faults of the primary and backup LSPs, configure dynamic BFD for LDP tunnel to create a dynamic BFD session that monitors the primary LSP and FRR LSP. In this way, when both the primary LSP and FRR LSP are faulty, BFD can quickly detect and trigger the upper-layer application of the LDP to perform protection switching and reduce traffic loss.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172368587__fig_dc_vrp_ldp-p2p_cfg_007701">Figure 1</a>, an LDP LSP originates from LSRA and is destined for LSRD. LDP Auto FRR is configured to protect LSP traffic. LSRA establishes the primary LSP over the path LSRA -&gt; LSRC -&gt; LSRD and the FRR LSP over the path LSRA -&gt; LSRB -&gt; LSRC -&gt; LSRD. Dynamic BFD for LDP tunnel can be configured to dynamically create a BFD session to monitor both the primary and FRR LSPs.</p>
<div class="fignone" id="EN-US_TASK_0172368587__fig_dc_vrp_ldp-p2p_cfg_007701"><a name="EN-US_TASK_0172368587__fig_dc_vrp_ldp-p2p_cfg_007701"></a><a name="fig_dc_vrp_ldp-p2p_cfg_007701"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of dynamic BFD for LDP tunnel</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0279177394.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368587__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish an LDP LSP between LSRA and LSRD.</p>
</li><li><p>Configure LDP Auto FRR.</p>
</li><li><p>Configure a dynamic BFD session to monitor an LDP tunnel.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368587__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address of each interface on each node: values shown in <a href="#EN-US_TASK_0172368587__fig_dc_vrp_ldp-p2p_cfg_007701">Figure 1</a>.</p>
</li><li><p>LSR ID of each node: loopback addresses shown in <a href="#EN-US_TASK_0172368587__fig_dc_vrp_ldp-p2p_cfg_007701">Figure 1</a></p>
</li><li><p>IS-IS process number (1), IS-IS level (level-2), and network entity name of each node:</p>
<ul><li>LSRA: 10.0000.0000.0001.00</li><li>LSRC: 10.0000.0000.0002.00</li><li>LSRB: 10.0000.0000.0003.00</li><li>LSRD: 10.0000.0000.0004.00</li></ul>
</li><li><p>Name of a FEC list used to establish the BFD session: list1</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368587__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface. For configuration details, see <a href="#EN-US_TASK_0172368587__example_01">Configuration Files</a> in this section.</span></li><li><span>Configure basic IS-IS functions. For configuration details, see <a href="#EN-US_TASK_0172368587__example_01">Configuration Files</a> in this section.</span></li><li><span>Configure LDP LSPs.</span><p><p># Configure LSRA.</p>
<pre class="screen">&lt;LSRA&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> interface GigabitEthernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/1</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Repeat this step for LSRB, LSRC, and LSRD. For configuration details, see <a href="#EN-US_TASK_0172368587__example_01">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure LDP Auto FRR.</span><p><p># Enable IS-IS Auto FRR on LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1] <strong>frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1-frr] <strong>loop-free-alternate level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1-frr] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-isis-1] <strong>quit</strong></pre>
<p>After IS-IS Auto FRR is enabled, LDP Auto FRR automatically takes effect. Then, run the <strong>display mpls lsp</strong> command on LSRA to view information about the primary and FRR LSPs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>display mpls lsp</strong></pre>
<pre class="screen">Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP 
Flag after LDP FRR: (L) - Logic FRR LSP
-------------------------------------------------------------------------------
                 LSP Information: LDP LSP
-------------------------------------------------------------------------------
FEC                In/Out Label    In/Out IF                      Vrf Name
1.1.1.9/32         3/NULL          -/-                            
2.2.2.9/32         NULL/3          -/GE<span>0/1/1</span>                      
2.2.2.9/32         32833/3         -/GE<span>0/1/1</span>                      
   **LDP FRR**     NULL/32835      -/GE<span>0/1/0</span>                      
   **LDP FRR**     32833/32835     -/GE<span>0/1/0</span>                      
3.3.3.9/32         NULL/3          -/GE<span>0/1/1</span>                      
3.3.3.9/32         32837/3         -/GE<span>0/1/1</span>                      
   **LDP FRR**     NULL/32837      -/GE<span>0/1/0</span>                      
   **LDP FRR**     32837/32837     -/GE<span>0/1/0</span>                      
4.4.4.9/32         NULL/32832      -/GE<span>0/1/1</span>                      
4.4.4.9/32         32836/32832     -/GE<span>0/1/1</span>                      
   **LDP FRR**     NULL/32836      -/GE<span>0/1/0</span>                      
   **LDP FRR**     32836/32836     -/GE<span>0/1/0</span>                      
10.1.3.0/24        32834/3         -/GE<span>0/1/0</span>                      
10.1.3.0/24        32834/3         -/GE<span>0/1/1</span>                      
10.1.4.0/24        32835/3         -/GE<span>0/1/1</span>                      </pre>
</p></li><li><span>Enable BFD globally.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-bfd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-bfd] <strong>quit</strong></pre>
<p># Configure LSRD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-bfd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD-bfd] <strong>quit</strong></pre>
</p></li><li><span>Enable the function to dynamically create BFD sessions in the MPLS scenario.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>mpls bfd enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>quit</strong></pre>
<p># Configure LSRD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD-bfd] <strong>mpls-passive</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRD-bfd] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRD-bfd] <strong>quit</strong></pre>
</p></li><li><span>Configure a policy for triggering dynamic BFD for LDP tunnel.</span><p><p># On LSRA, create a FEC list and add a node with IP address 4.4.4.9 to the list so that the FEC list is used to establish a BFD session only to monitor the LDP tunnel from LSRA to LSRD.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>fec-list list1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-fec-list-list1] <strong>fec-node 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-fec-list-list1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-fec-list-list1] <strong>quit</strong></pre>
<p># Specify the FEC list on LSRA so that LSRA uses it to establish a BFD session.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>mpls bfd-trigger-tunnel fec-list list1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-mpls] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display mpls bfd session protocol ldp bfd-type ldp-tunnel verbose</strong> command on LSRA. The command output shows that a dynamic BFD session is <strong>Up</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>display mpls bfd session protocol ldp bfd-type ldp-tunnel verbose</strong></pre>
<pre class="screen">--------------------------------------------------------------------------------
                        BFD Information: LDP  Tunnel                           
--------------------------------------------------------------------------------
  No                     : 1
  LspIndex               : 0
  Protocol               : LDP
  Fec                    : 4.4.4.9
  Bfd-Discriminator      : 16389
  ActTx                  : 10
  ActRx                  : 10
  ActMulti               : 3
  Bfd-State              : <strong>Up</strong>
  Time                   : 800 sec
</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368587__example_01"><a name="EN-US_TASK_0172368587__example_01"></a><a name="example_01"></a><a name="EN-US_TASK_0172368587__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#
sysname LSRA
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
 mpls bfd enable
 mpls bfd-trigger-tunnel fec-list list1
#
fec-list list1
 fec-node 4.4.4.9
#
mpls ldp
 #
 ipv4-family
#
isis 1
 is-level level-2
 network-entity 10.0000.0000.0001.00
 frr
  loop-free-alternate level-1
  loop-free-alternate level-2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.9 255.255.255.255
 isis enable 1  
#
return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#
sysname LSRB
#
mpls lsr-id 2.2.2.9
#
mpls
 lsp-trigger all
#
mpls ldp
 #              
 ipv4-family
#
isis 1          
 is-level level-2
 network-entity 10.0000.0000.0002.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 isis enable 1
 mpls           
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.9 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#
sysname LSRC
#
mpls lsr-id 3.3.3.9
#
mpls
 lsp-trigger all
#
mpls ldp
 #              
 ipv4-family
#
isis 1          
 is-level level-2
 network-entity 10.0000.0000.0003.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 3.3.3.9 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>LSRD configuration file</p>
<pre class="screen">#
sysname LSRD
#
bfd
 mpls-passive
#
mpls lsr-id 4.4.4.9
#
mpls
 lsp-trigger all
#
mpls ldp
 #              
 ipv4-family
#
isis 1          
 is-level level-2
 network-entity 10.0000.0000.0004.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.4.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 4.4.4.9 255.255.255.255
 isis enable 1
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0038.html">Configuration Examples for MPLS LDP
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_2045.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ldp-p2p_cfg_0054.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>