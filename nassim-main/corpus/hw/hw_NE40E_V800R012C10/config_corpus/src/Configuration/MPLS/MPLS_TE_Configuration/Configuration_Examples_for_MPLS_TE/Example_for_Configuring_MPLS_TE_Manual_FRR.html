
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring MPLS TE Manual FRR">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0103.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0106.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,te-p2pvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="featurename" content="MPLS TE">
<meta name="featuretype" content="MPLS">
<meta name="OWNER" content="l00468467">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="w00845984">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172368339">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring MPLS TE Manual FRR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172368339"></a><a name="EN-US_TASK_0172368339"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring MPLS TE Manual FRR</h1>
<div class="taskbody"><div class="context"><a name="EN-US_TASK_0172368339__1.3.1"></a><a name="1.3.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172368339__fig_dc_vrp_te-p2p_cfg_010501">Figure 1</a>, a primary LSP is along the path LSRA -&gt; LSRB -&gt; LSRC -&gt; LSRD. FRR is enabled on LSRB to protect traffic on the link between LSRB and LSRC.</p>
<p>A bypass CR-LSP is established over the path LSRB -&gt; LSRE -&gt; LSRC. LSRB is a PLR, and LSRC is an MP.</p>
<p>Explicit paths are used to establish the primary and bypass CR-LSPs. RSVP-TE is used as a signaling protocol.</p>
<div class="fignone" id="EN-US_TASK_0172368339__fig_dc_vrp_te-p2p_cfg_010501"><a name="EN-US_TASK_0172368339__fig_dc_vrp_te-p2p_cfg_010501"></a><a name="fig_dc_vrp_te-p2p_cfg_010501"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for MPLS TE manual FRR</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_te-p2p_cfg_010501.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368339__1.3.2"></a><a name="1.3.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>None.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368339__1.3.3"></a><a name="1.3.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a primary CR-LSP and enable TE FRR on the tunnel interface of the primary CR-LSP.</p>
</li><li><p>Configure a bypass CR-LSP on the PLR (ingress) and specify the interface of the protected link.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172368339__1.3.4"></a><a name="1.3.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IS-IS area ID, originating system ID, and IS-IS level of each node</p>
</li><li><p>Explicit paths for the primary and bypass CR-LSPs</p>
</li><li><p>Tunnel interface number, source and destination IP addresses, ID, and RSVP-TE signaling protocol for each of the primary and bypass CR-LSPs</p>
</li><li><p>Protected bandwidth and type and number of the interface on the protected link</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172368339__1.3.5"></a><a name="1.3.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface.</span><p><p>Assign an IP address and its mask to every physical interface and configure a loopback interface address as an LSR ID on every node shown in <a href="#EN-US_TASK_0172368339__fig_dc_vrp_te-p2p_cfg_010501">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0172368339__section_dc_vrp_te-p2p_cfg_010505">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an IGP.</span><p><p>Configure IS-IS on all nodes to advertise host routes. For configuration details, see <a href="#EN-US_TASK_0172368339__section_dc_vrp_te-p2p_cfg_010505">Configuration Files</a> in this section.</p>
<p>After completing the configurations, run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command on every node. All nodes have learned routes from each other.</p>
</p></li><li><span>Configure basic MPLS functions and enable MPLS TE, CSPF, RSVP-TE, and IS-IS TE.</span><p><p># Configure LSRA.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>] <strong>mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA]<strong> isis</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1]<strong> cost-style wide</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1]<strong> traffic-eng level-2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-isis-1]<strong> commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of LSRB, LSRC, LSRD and LSRE are similar to the configuration of LSRA. For configuration details, see <a href="#EN-US_TASK_0172368339__section_dc_vrp_te-p2p_cfg_010505">Configuration Files</a> in this section. CSPF needs to be enabled only on LSRA and LSRB, which are ingress nodes of the primary and bypass CR-LSPs, respectively.</p>
</div></div>
</p></li><li><span>Configure an MPLS TE tunnel on LSRA.</span><p><p># Configure an explicit path for the primary CR-LSP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA]<strong> explicit-path pri-path</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-explicit-path-pri-path] <strong>next hop 10.21.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-explicit-path-pri-path] <strong>next hop 10.31.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-explicit-path-pri-path] <strong>next hop 10.41.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-explicit-path-pri-path] <strong>next hop 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-explicit-path-pri-path] <strong>quit</strong></pre>
<p># Configure the MPLS TE tunnel for the primary CR-LSP.</p>
<pre class="screen">[<span class="keyword">*</span>LSRA] <strong>interface tunnel 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> destination 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1]<strong> mpls te tunnel-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1] <strong>mpls te path explicit-path pri-path</strong></pre>
<p># Enable FRR.</p>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1] <strong>mpls te fast-reroute</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRA-Tunnel1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA-Tunnel1]<strong> quit</strong></pre>
<p>After completing the configuration, run the <a href="cmdqueryname=display+interface+tunnel"><b><span class="cmdname">display interface tunnel</span></b></a> command on LSRA. <strong>Tunnel1</strong> is <strong>Up</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>display interface tunnel</strong></pre>
<pre class="screen">Tunnel1 current state : UP (ifindex: 20)
Line protocol current state : UP 
Last line protocol up time : 2011-05-31 06:30:58
Description:
Route Port,The Maximum Transmit Unit is 1500<span>, Current BW: 50Mbps </span>
Internet Address is unnumbered, using address of LoopBack1(1.1.1.1/32)
Encapsulation is TUNNEL, loopback not set
Tunnel destination 4.4.4.4
Tunnel up/down statistics 1
Tunnel protocol/transport MPLS/MPLS, ILM is available,
primary tunnel id is 0x321, secondary tunnel id is 0x0
Current system time: 2011-05-31 07:32:31
    300 seconds output rate 0 bits/sec, 0 packets/sec
    0 seconds output rate 0 bits/sec, 0 packets/sec
    126 packets output,  34204 bytes
    0 output error
    18 output drop
    Last 300 seconds input utility rate:  0.00%
    Last 300 seconds output utility rate: 0.00%</pre>
<p># Run the <a href="cmdqueryname=display+mpls+te+tunnel-interface"><b><span class="cmdname">display mpls te tunnel-interface</span></b></a> command on LSRA. Detailed information about the TE tunnel interface is displayed.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>display mpls te tunnel-interface</strong></pre>
<pre class="screen">    Tunnel Name       : Tunnel1
    Signalled Tunnel Name: -
    Tunnel State Desc : CR-LSP is Up
    Tunnel Attributes   :     
    Active LSP          : Primary LSP                                       
    Traffic Switch      : - 
    Session ID          : 1
    Ingress LSR ID      : 1.1.1.1               Egress LSR ID: 4.4.4.4
    Admin State         : UP                    Oper State   : UP
    Signaling Protocol  : RSVP
    FTid                : 1
    Tie-Breaking Policy : None                  Metric Type  : None
    Bfd Cap             : None                  
    Reopt               : Disabled              Reopt Freq   : -              
<span>    Inter-area Reopt    : Disabled </span>
    Auto BW             : Disabled              Threshold    : 0 percent
    Current Collected BW: 0 kbps                Auto BW Freq : 0
    Min BW              : 0 kbps                Max BW       : 0 kbps
    Offload             : Disabled              Offload Freq : - 
    Low Value           : -                     High Value   : - 
    Readjust Value      : - 
    Offload Explicit Path Name: 
    Tunnel Group        : -                                              
    Interfaces Protected: -
    Excluded IP Address : -
    Referred LSP Count  : 0  
    Primary Tunnel      : -                     Pri Tunn Sum : -              
    Backup Tunnel       : -                                                    
    Group Status        : Up                    Oam Status   : -             
    IPTN InLabel        : -                     Tunnel BFD Status : -                               
    BackUp LSP Type     : Hot-Standby           BestEffort   : Enabled
    Secondary HopLimit  : -
    BestEffort HopLimit  : -
    Secondary Explicit Path Name: -
    Secondary Affinity Prop/Mask: 0x0/0x0
    BestEffort Affinity Prop/Mask: 0x0/0x0  
    IsConfigLspConstraint: -
    Hot-Standby Revertive Mode:  Revertive
    Hot-Standby Overlap-path:  Disabled
    Hot-Standby Switch State:  CLEAR
    Bit Error Detection:  Disabled
    Bit Error Detection Switch Threshold:  -
    Bit Error Detection Resume Threshold:  -
    Ip-Prefix Name    : -
    P2p-Template Name : -
    PCE Delegate      : No                    LSP Control Status : Local control
    Path Verification : -
    Entropy Label     : None 
    Auto BW Remain Time : 200 s               Reopt Remain Time  : 100 s
<span>    Metric Inherit IGP : None</span>
<span>    Binding Sid       : -                     Reverse Binding Sid : - </span>
    Self-Ping         : Disable               Self-Ping Duration : 1800 sec
    FRR Attr Source   : -                     Is FRR degrade down : No

    Primary LSP ID      : 1.1.1.1:19
    LSP State           : UP                    LSP Type     : Primary
    Setup Priority      : 7                     Hold Priority: 7
    IncludeAll          : 0x0
    IncludeAny          : 0x0
    ExcludeAny          : 0x0
    Affinity Prop/Mask  : 0x0/0x0               Resv Style   :  SE
    Configured Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 10000           CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Actual Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 10000           CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Explicit Path Name  : pri-path                         Hop Limit: -
    Record Route        : Disabled              Record Label : Disabled
    Route Pinning       : Disabled
    FRR Flag            : Disabled
    IdleTime Remain     : -
    BFD Status          : -
    Soft Preemption     : Enabled 
    Reroute Flag        : Disabled
    Pce Flag            : Normal<span>
    Path Setup Type     : EXPLICIT</span>
    Create Modify LSP Reason: -
    Self-Ping Status    : -

    Backup LSP ID       : 1.1.1.1:46945
    IsBestEffortPath    : No
    LSP State           : UP                    LSP Type     : Hot-Standby
    Setup Priority      : 7                     Hold Priority: 7
    IncludeAll          : 0x0
    IncludeAny          : 0x0
    ExcludeAny          : 0x0
    Affinity Prop/Mask  : 0x0/0x0               Resv Style   :  SE
    Configured Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Actual Bandwidth Information:
    CT0 Bandwidth(Kbit/sec): 0               CT1 Bandwidth(Kbit/sec): 0
    CT2 Bandwidth(Kbit/sec): 0               CT3 Bandwidth(Kbit/sec): 0
    CT4 Bandwidth(Kbit/sec): 0               CT5 Bandwidth(Kbit/sec): 0
    CT6 Bandwidth(Kbit/sec): 0               CT7 Bandwidth(Kbit/sec): 0
    Explicit Path Name  : -                                Hop Limit: -
    Record Route        : Enabled               Record Label : Disabled
    Route Pinning       : Disabled
    FRR Flag            : Disabled
    IdleTime Remain     : -
    BFD Status          : -
    Soft Preemption     : Enabled
    Reroute Flag        : Enabled
    Pce Flag            : Normal
    Path Setup Type     : CSPF
    Create Modify LSP Reason: -
    Self-Ping Status    : -</pre>
</p></li><li><span>Configure a bypass CR-LSP on LSRB that functions as the PLR.</span><p><p># Configure an explicit path for the bypass CR-LSP.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> explicit-path by-path</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-explicit-path-by-path] <strong>next hop 10.32.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-explicit-path-by-path] <strong>next hop 10.33.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-explicit-path-by-path] <strong>next hop 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-explicit-path-by-path] <strong>quit</strong></pre>
<p># Configure the bypass CR-LSP.</p>
<pre class="screen">[<span class="keyword">*</span>LSRB] <strong>interface tunnel 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3]<strong> destination 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3] <strong>mpls te tunnel-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3] <strong>mpls te path explicit-path by-path</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3] <strong>mpls te bypass-tunnel</strong></pre>
<p># Bind the bypass CR-LSP to the interface of the protected link.</p>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3] <strong>mpls te protected-interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-Tunnel3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-Tunnel3] <strong>quit</strong></pre>
<p>After completing the configuration, run the <a href="cmdqueryname=display+interface+tunnel"><b><span class="cmdname">display interface tunnel</span></b></a> command on LSRB. The tunnel named <strong>Tunnel3</strong> is <strong>Up</strong>.</p>
<p>Run the <a href="cmdqueryname=display+mpls+te+tunnel+name+Tunnel1+verbose"><b><span class="cmdname">display mpls te tunnel name Tunnel1 verbose</span></b></a> command on LSRB. The bypass tunnel is bound to the outbound interface GE <span>0/2/0</span> and is not in use.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB] <strong>display mpls te tunnel name Tunnel1 verbose</strong></pre>
<pre class="screen">    No                      :  1
    Tunnel-Name             :  Tunnel1
    Tunnel Interface Name   :  Tunnel1
    TunnelIndex             :  - 
    Session ID              :  1           LSP ID            :  95
    Lsr Role                :  Transit
    Ingress LSR ID          :  1.1.1.1
    Egress LSR ID           :  4.4.4.4
    In-Interface            :  GE<span>0/1/0</span>
    Out-Interface           :  GE<span>0/2/0</span>
    Sign-Protocol           :  RSVP TE     Resv Style        :  SE
    IncludeAnyAff           :  0x0         ExcludeAnyAff     :  0x0
    IncludeAllAff           :  0x0  
    ER-Hop Table Index      :  -           AR-Hop Table Index:  -
    C-Hop Table Index       :  -
    PrevTunnelIndexInSession:  -           NextTunnelIndexInSession:  -
    PSB Handle              :  -
    Created Time            :  2012/02/01 04:53:22
    --------------------------------
              DS-TE Information
    --------------------------------
    Bandwidth Reserved Flag :  Reserved
    CT0 Bandwidth(Kbit/sec) :  10000       CT1 Bandwidth(Kbit/sec):  0
    CT2 Bandwidth(Kbit/sec) :  0           CT3 Bandwidth(Kbit/sec):  0
    CT4 Bandwidth(Kbit/sec) :  0           CT5 Bandwidth(Kbit/sec):  0
    CT6 Bandwidth(Kbit/sec) :  0           CT7 Bandwidth(Kbit/sec):  0
    Setup-Priority          :  7           Hold-Priority          :  7
    --------------------------------
                FRR Information
    --------------------------------
    Primary LSP Info
    Bypass In Use           :  <strong>Not Used</strong>
    Bypass Tunnel Id        :  1
    <strong>BypassTunnel          :  Tunnel Index[Tunnel3]</strong>, InnerLabel[16]
    Bypass Lsp ID           :  8           <strong>FrrNextHop        :  10.33.1.1</strong>
    ReferAutoBypassHandle   :  -
    FrrPrevTunnelTableIndex :  -           FrrNextTunnelTableIndex:  -
    Bypass Attribute
    Setup Priority          :  7           Hold Priority     :  7
    HopLimit                :  32          Bandwidth         :  0
    IncludeAnyGroup         :  0           ExcludeAnyGroup   :  0
    IncludeAllGroup         :  0
    Bypass Unbound Bandwidth Info(Kbit/sec)
    CT0 Unbound Bandwidth   :  -         CT1 Unbound Bandwidth:  -
    CT2 Unbound Bandwidth   :  -         CT3 Unbound Bandwidth:  -
    CT4 Unbound Bandwidth   :  -         CT5 Unbound Bandwidth:  -
    CT6 Unbound Bandwidth   :  -         CT7 Unbound Bandwidth:  -
    --------------------------------
               BFD Information
    --------------------------------
    NextSessionTunnelIndex  :  -           PrevSessionTunnelIndex:  -
    NextLspId               :  -           PrevLspId         :  - </pre>
</p></li><li><span>Verify the configuration.</span><p><p># Shut down the outbound interface of the protected link on the PLR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<p>Run the <a href="cmdqueryname=display+interface+tunnel+1"><b><span class="cmdname">display interface tunnel 1</span></b></a> command on LSRA. The tunnel interface of the primary CR-LSP is still <strong>Up</strong>.</p>
<p>Run the <a href="cmdqueryname=tracert+lsp+te+tunnel1"><b><span class="cmdname">tracert lsp te tunnel1</span></b></a> command on LSRA. The path through which the primary CR-LSP passes is displayed.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRA] <strong>tracert lsp te tunnel1</strong></pre>
<pre class="screen">  LSP Trace Route FEC: TE TUNNEL IPV4 SESSION QUERY Tunnel1 , press CTRL_C to break.
TTL    Replier            Time    Type      Downstream
0                                 Ingress   10.21.1.2/[25 ]
1      10.21.1.2          3       Transit   10.32.1.2/[16 16 ]
2      10.32.1.2          4       Transit   10.33.1.2/[3 ]
3      10.33.1.2          4       Transit   10.41.1.2/[3 ]
4      4.4.4.4            3       Egress  </pre>
<p>The preceding command output shows that traffic has switched to the bypass CR-LSP.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the <a href="cmdqueryname=display+mpls+te+tunnel-interface"><b><span class="cmdname">display mpls te tunnel-interface</span></b></a> command is run immediately after FRR switching has been performed, two CR-LSPs are both Up. This is because FRR uses the make-before-break mechanism to establish a bypass CR-LSP. The original CR-LSP will be deleted after a new CR-LSP has been established.</p>
</div></div>
<p>Run the <a href="cmdqueryname=display+mpls+te+tunnel+name+Tunnel1+verbose"><b><span class="cmdname">display mpls te tunnel name Tunnel1 verbose</span></b></a> command on LSRB. The bypass CR-LSP is being used.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB] <strong>display mpls te tunnel name Tunnel1 verbose</strong></pre>
<pre class="screen">    No                      :  1
    Tunnel-Name             :  Tunnel1
    Tunnel Interface Name   :  Tunnel1
    TunnelIndex             :  - 
    Session ID              :  1           LSP ID            :  95
    Lsr Role                :  Transit
    Ingress LSR ID          :  1.1.1.1
    Egress LSR ID           :  4.4.4.4
    In-Interface            :  GE<span>0/1/0</span>
    Out-Interface           :  GE<span>0/2/0</span>
    Sign-Protocol           :  RSVP TE     Resv Style        :  SE
    IncludeAnyAff           :  0x0         ExcludeAnyAff     :  0x0
    IncludeAllAff           :  0x0  
    ER-Hop Table Index      :  -           AR-Hop Table Index:  -
    C-Hop Table Index       :  -
    PrevTunnelIndexInSession:  -           NextTunnelIndexInSession:  -
    PSB Handle              :  -
    Created Time            :  2012/02/01 04:53:22
    --------------------------------
              DS-TE Information
    --------------------------------
    Bandwidth Reserved Flag :  Reserved
    CT0 Bandwidth(Kbit/sec) :  10000       CT1 Bandwidth(Kbit/sec):  0
    CT2 Bandwidth(Kbit/sec) :  0           CT3 Bandwidth(Kbit/sec):  0
    CT4 Bandwidth(Kbit/sec) :  0           CT5 Bandwidth(Kbit/sec):  0
    CT6 Bandwidth(Kbit/sec) :  0           CT7 Bandwidth(Kbit/sec):  0
    Setup-Priority          :  7           Hold-Priority          :  7
    --------------------------------
                FRR Information
    --------------------------------
    Primary LSP Info
    Bypass In Use           :  <strong>In Use</strong>
    Bypass Tunnel Id        :  1
    BypassTunnel            :  Tunnel Index[Tunnel3], InnerLabel[16]
    Bypass Lsp ID           :  8           FrrNextHop        :  3.3.3.3
    ReferAutoBypassHandle   :  -
    FrrPrevTunnelTableIndex :  -           FrrNextTunnelTableIndex:  -
    Bypass Attribute
    Setup Priority          :  7           Hold Priority     :  7
    HopLimit                :  32          Bandwidth         :  0
    IncludeAnyGroup         :  0           ExcludeAnyGroup   :  0
    IncludeAllGroup         :  0
    Bypass Unbound Bandwidth Info(Kbit/sec)
    CT0 Unbound Bandwidth   :  -         CT1 Unbound Bandwidth:  -
    CT2 Unbound Bandwidth   :  -         CT3 Unbound Bandwidth:  -
    CT4 Unbound Bandwidth   :  -         CT5 Unbound Bandwidth:  -
    CT6 Unbound Bandwidth   :  -         CT7 Unbound Bandwidth:  -
    --------------------------------
               BFD Information
    --------------------------------
    NextSessionTunnelIndex  :  -           PrevSessionTunnelIndex:  -
    NextLspId               :  -           PrevLspId         :  - </pre>
<p># Start the outbound interface of the protected link on the PLR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>LSRB-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<p>Run the <a href="cmdqueryname=display+interface+tunnel1"><b><span class="cmdname">display interface tunnel1</span></b></a> command on LSRA. The tunnel interface of the primary CR-LSP is <strong>UP</strong>.</p>
<p>After specified period of time elapses, run the <a href="cmdqueryname=display+mpls+te+tunnel+name+tunnel1+verbose"><b><span class="cmdname">display mpls te tunnel name tunnel1 verbose</span></b></a> command on LSRB. Tunnel1's <strong>Bypass In Use</strong> status is <strong>Not Used</strong>, indicating that traffic has switched back to GE <span>0/2/0</span>.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172368339__section_dc_vrp_te-p2p_cfg_010505"><a name="EN-US_TASK_0172368339__section_dc_vrp_te-p2p_cfg_010505"></a><a name="section_dc_vrp_te-p2p_cfg_010505"></a><a name="EN-US_TASK_0172368339__1.3.6"></a><a name="1.3.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>LSRA configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRA</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 1.1.1.1</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls te cspf</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">explicit-path pri-path</pre>
<pre class="screen"> next hop 10.21.1.2</pre>
<pre class="screen"> next hop 10.31.1.2</pre>
<pre class="screen"> next hop 10.41.1.2</pre>
<pre class="screen"> next hop 4.4.4.4</pre>
<pre class="screen">#</pre>
<pre class="screen">isis 1</pre>
<pre class="screen"> is-level level-2</pre>
<pre class="screen"> cost-style wide</pre>
<pre class="screen"> traffic-eng level-2</pre>
<pre class="screen"> network-entity 00.0005.0000.0000.0001.00</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.21.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 1.1.1.1 255.255.255.255</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Tunnel1</pre>
<pre class="screen"> ip address unnumbered interface LoopBack1</pre>
<pre class="screen"> tunnel-protocol mpls te</pre>
<pre class="screen"> destination 4.4.4.4</pre>
<pre class="screen"> mpls te tunnel-id 1</pre>
<pre class="screen"> mpls te record-route label</pre>
<pre class="screen"> mpls te path explicit-path pri-path</pre>
<pre class="screen"> mpls te fast-reroute</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRB configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRB</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 2.2.2.2</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls te cspf</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">explicit-path by-path</pre>
<pre class="screen"> next hop 10.32.1.2</pre>
<pre class="screen"> next hop 10.33.1.2</pre>
<pre class="screen"> next hop 3.3.3.3</pre>
<pre class="screen">#</pre>
<pre class="screen">isis 1</pre>
<pre class="screen"> is-level level-2</pre>
<pre class="screen"> cost-style wide</pre>
<pre class="screen"> traffic-eng level-2</pre>
<pre class="screen"> network-entity 00.0005.0000.0000.0002.00</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.21.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.31.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.32.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 2.2.2.2 255.255.255.255</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">interface Tunnel3</pre>
<pre class="screen"> ip address unnumbered interface LoopBack1</pre>
<pre class="screen"> tunnel-protocol mpls te</pre>
<pre class="screen"> destination 3.3.3.3</pre>
<pre class="screen"> mpls te tunnel-id 2</pre>
<pre class="screen"> mpls te record-route</pre>
<pre class="screen"> mpls te path explicit-path by-path</pre>
<pre class="screen"> mpls te bypass-tunnel</pre>
<pre class="screen"> mpls te protected-interface GigabitEthernet <span>0/2/0</span></pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRC configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRC</pre>
<pre class="screen">#</pre>
<pre class="screen"> mpls lsr-id 3.3.3.3</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">isis 1</pre>
<pre class="screen"> is-level level-2</pre>
<pre class="screen"> cost-style wide</pre>
<pre class="screen"> traffic-eng level-2</pre>
<pre class="screen"> network-entity 00.0005.0000.0000.0003.00</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.41.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.31.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/3/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.33.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 3.3.3.3 255.255.255.255</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRD configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRD</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 4.4.4.4</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">isis 1</pre>
<pre class="screen"> is-level level-2</pre>
<pre class="screen"> cost-style wide</pre>
<pre class="screen"> traffic-eng level-2</pre>
<pre class="screen"> network-entity 00.0005.0000.0000.0004.00</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.41.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 4.4.4.4 255.255.255.255</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li><li><p>LSRE configuration file</p>
<pre class="screen">#</pre>
<pre class="screen">sysname LSRE</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls lsr-id 5.5.5.5</pre>
<pre class="screen">#</pre>
<pre class="screen">mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">isis 1</pre>
<pre class="screen"> is-level level-2</pre>
<pre class="screen"> cost-style wide</pre>
<pre class="screen"> traffic-eng level-2</pre>
<pre class="screen"> network-entity 00.0005.0000.0000.0005.00</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.32.1.2 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface GigabitEthernet<span>0/2/0</span></pre>
<pre class="screen"> undo shutdown</pre>
<pre class="screen"> ip address 10.33.1.1 255.255.255.0</pre>
<pre class="screen"> mpls</pre>
<pre class="screen"> mpls te</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen"> mpls rsvp-te</pre>
<pre class="screen">#</pre>
<pre class="screen">interface LoopBack1</pre>
<pre class="screen"> ip address 5.5.5.5 255.255.255.255</pre>
<pre class="screen"> isis enable 1</pre>
<pre class="screen">#</pre>
<pre class="screen">return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0093.html">Configuration Examples for MPLS TE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0103.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_te-p2p_cfg_0106.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>