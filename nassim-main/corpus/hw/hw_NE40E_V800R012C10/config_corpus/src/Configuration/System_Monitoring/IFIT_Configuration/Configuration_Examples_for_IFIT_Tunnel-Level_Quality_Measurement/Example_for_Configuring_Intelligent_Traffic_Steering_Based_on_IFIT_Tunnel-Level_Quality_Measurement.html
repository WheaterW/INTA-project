
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Intelligent Traffic Steering Based on IFIT Tunnel-Level Quality Measurement">
<meta name="abstract" content="This section describes how to configure IFIT to implement tunnel-level quality measurement in an EVPN L3VPNv4 over SRv6 TE flow group scenario.">
<meta name="description" content="This section describes how to configure IFIT to implement tunnel-level quality measurement in an EVPN L3VPNv4 over SRv6 TE flow group scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="c00511010">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00511010">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001223107307">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Intelligent Traffic Steering Based on IFIT Tunnel-Level Quality Measurement</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001223107307"></a><a name="EN-US_TASK_0000001223107307"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Intelligent Traffic Steering Based on IFIT Tunnel-Level Quality Measurement</h1>
<div class="taskbody"><p>This section describes how to configure IFIT to implement tunnel-level quality measurement in an EVPN L3VPNv4 over SRv6 TE flow group scenario.</p>
<div class="context"><a name="EN-US_TASK_0000001223107307__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001223107307__fig184238288365">Figure 1</a>, a bidirectional SRv6 TE flow group is deployed between PE1 and PE2 to carry EVPN L3VPNv4 services. The paths PE1-P1-PE2 and PE1-P2-PE2 are two candidate paths for service flow forwarding. After the packet loss and delay indicators of each path are measured using IFIT, TE-Class-based traffic diversion can be used to implement intelligent traffic steering.</p>
<div class="fignone" id="EN-US_TASK_0000001223107307__fig184238288365"><a name="EN-US_TASK_0000001223107307__fig184238288365"></a><a name="fig184238288365"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring IFIT tunnel-level measurement in an EVPN L3VPNv4 over SRv6 TE flow group</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001223108085.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001223107307__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable IPv6 forwarding and configure an IPv6 address for each interface on PE1, P1, P2, and PE2.</p>
</li><li><p>Enable IS-IS, configure an IS-IS level, and specify a network entity title (NET) on PE1, P1, P2, and PE2.</p>
</li><li><p>Configure a VPN instance in the IPv4 address family on PE1 and PE2.</p>
</li><li><p>Establish an EBGP peer relationship between each PE and its connected CE.</p>
</li><li><p>Establish a BGP EVPN peer relationship between PEs.</p>
</li><li>Configure SRv6 SIDs and enable IS-IS SRv6 on PE1, P1, P2, and PE2. In addition, configure PE1 and PE2 to advertise VPN routes carrying SIDs.</li><li><p>Deploy an SRv6 TE Policy between PE1 and PE2.</p>
</li><li>Configure a TE-Class value on PE1 and PE2.</li><li>Configure SPR on PE1 and PE2.</li><li>Configure PE1 and PE2 to use TE-Class to divert traffic to the SRv6 TE Policy.</li><li>Configure a tunnel policy on PE1 and PE2 to preferentially use the SRv6 TE flow group for VPN traffic import.</li><li>Configure IFIT measurement for the SRv6 TE Policy on PE1 and PE2.</li><li>Configure an IFIT instance on PE1 and PE2.</li><li>Configure PE1 and PE2 to use telemetry (YANG model sampling) to report measurement data.</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Before performing IFIT measurement, ensure the following:</p>
<ul><li>A clock synchronization protocol has been configured to implement clock synchronization between devices. In this scenario, NTP is generally used because interworking with other types of devices may be required. For details, see <em>NTP Configuration</em>.</li><li>The devices have been connected to the NMS.</li></ul>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001223107307__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IPv6 address of each interface on PE1, P1, P2, and PE2</p>
</li><li><p>IS-IS process ID of each device (PE1, P1, P2, and PE2)</p>
</li><li><p>IS-IS level of each device (PE1, P1, P2, and PE2)</p>
</li><li><p>VPN instance names, RDs, and RTs on PE1 and PE2</p>
</li><li>NMS's IPv4 address (192.168.1.1) and port number (10001), and reachable routes between the NMS and devices</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001223107307__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable IPv6 forwarding and configure an IPv6 address for each interface. The configurations of P1, P2, and PE2 are similar to the configuration of PE1. For configuration details, see Configuration Files in this section.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:DB8:11::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/3/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ipv6 address 2001:DB8:13::1 96</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface LoopBack 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>ipv6 address 2001:DB8:1::1 128</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure IS-IS.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>network-entity 10.0000.0000.0001.00</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/3/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack1] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure P1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>isis 1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>network-entity 10.0000.0000.0002.00</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>interface loopback1</strong>
[<span class="keyword">*</span>P1-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P1-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-LoopBack1] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>isis 1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>network-entity 10.0000.0000.0003.00</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/3/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface loopback1</strong>
[<span class="keyword">*</span>PE2-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>PE2-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-LoopBack1] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure P2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>isis 1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>is-level level-1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>cost-style wide</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>network-entity 10.0000.0000.0004.00</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>ipv6 enable topology ipv6</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>interface GigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>interface loopback1</strong>
[<span class="keyword">*</span>P2-LoopBack1] <strong>isis ipv6 enable 1</strong>
[<span class="keyword">*</span>P2-LoopBack1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-LoopBack1] <strong>quit</strong></pre>
</div>
</p><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+isis+peer"><b><span class="cmdname">display isis peer</span></b></a> command to check whether IS-IS has been configured successfully.</p>
</p></li><li><span>Configure a VPN instance on each PE and enable the IPv4 address family for the instance.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong> <strong>evpn</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
</p><p><div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong> <strong>evpn</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</div>
</p><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+ip+vpn-instance"><b><span class="cmdname">display ip vpn-instance</span></b></a> command to check the VPN instance configuration.</p>
</p></li><li><span>Establish an EBGP peer relationship between each PE and its connected CE.</span><p><div class="p"># Configure CE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 11.11.11.11 32</strong>
[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>router-id</strong> <strong>11.11.11.11</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>import-route direct</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</div>
</p><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>router-id 1.1.1.1</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.2 as-number 65410</strong>
[<span class="keyword">*</span>PE1-bgp-vpna] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-bgp-vpna] <strong>advertise l2vpn evpn</strong>
[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure CE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface loopback 1</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>ip address 22.22.22.22 32</strong>
[<span class="keyword">*</span>CE2-LoopBack1] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>bgp 65420</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>router-id</strong> <strong>22.22.22.22</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.2.1.1 as-number 100</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>import-route direct</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</div>
</p><p><div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>router-id 2.2.2.2</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 10.2.1.2 as-number 65420</strong>
[<span class="keyword">*</span>PE2-bgp-vpna] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE2-bgp-vpna] <strong>advertise l2vpn evpn</strong>
[<span class="keyword">*</span>PE2-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
</div>
</p><p><p>After the configuration is complete, run the <a href="cmdqueryname=display+bgp+vpnv4+vpn-instance+peer"><b><span class="cmdname">display bgp vpnv4 vpn-instance peer</span></b></a> command to check the EBGP peer relationship established between PE1 and CE1.</p>
</p></li><li><span>Establish a BGP EVPN peer relationship between PEs.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2001:DB8:3::3 connect-interface loopback 1</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:1::1 as-number 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>peer 2001:DB8:1::1 connect-interface loopback 1</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 enable</strong>
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
</div>
<p>After completing the configuration, run the <a href="cmdqueryname=display+bgp+evpn+peer"><b><span class="cmdname">display bgp evpn peer</span></b></a> command to check the BGP EVPN peer relationship established between PEs.</p>
</p></li><li><span>Configure SRv6 SIDs, and configure the PEs to advertise VPN routes carrying SIDs.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:1::1</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>locator as1 ipv6-prefix <span>2001:DB8:100::</span> 64 static 32</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>opcode ::100 end</strong><span> <strong>psp</strong></span>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>opcode ::200 end<span> no-flavor</span></strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 </strong><strong>advertise encap-type srv6</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>PE1-bgp-vpna] <strong>segment-routing ipv6</strong><strong> </strong><strong>traffic-engineer</strong><strong> best-effort</strong> <strong>evpn</strong>
[<span class="keyword">*</span>PE1-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong> <strong>evpn</strong>
[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>segment-routing ipv6 locator as1 auto-sid-disable</strong>
[<span class="keyword">*</span>PE1-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-1] <strong>quit</strong></pre>
</div>
<div class="p"># Configure P1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:2::2</strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>locator as1 ipv6-prefix <span>2001:DB8:200::</span> 64 static 32</strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6-locator] <strong>opcode ::100 end</strong><span> <strong>psp</strong></span>
[<span class="keyword">*</span>P1-segment-routing-ipv6-locator] <strong>opcode ::200 end<span> no-flavor</span></strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>P1-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>P1] <strong>isis 1</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>segment-routing ipv6 locator as1 auto-sid-disable</strong>
[<span class="keyword">*</span>P1-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-isis-1] <strong>quit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>locator as1 ipv6-prefix <span>2001:DB8:300::</span> 64 static 32</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>opcode ::100 end</strong><span> <strong>psp</strong></span>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>opcode ::200 end<span> no-flavor</span></strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 </strong><strong>advertise encap-type srv6</strong>
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong>
[<span class="keyword">*</span>PE2-bgp-vpna] <strong>segment-routing ipv6</strong><strong> </strong><strong>traffic-engineer</strong><strong> best-effort</strong> <strong>evpn</strong>
[<span class="keyword">*</span>PE2-bgp-vpna] <strong>segment-routing ipv6 locator as1</strong> <strong>evpn</strong>
[<span class="keyword">*</span>PE2-bgp-vpna] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-vpna] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>isis 1</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>segment-routing ipv6 locator as1 auto-sid-disable</strong>
[<span class="keyword">*</span>PE2-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-isis-1] <strong>quit</strong></pre>
</div>
<div class="p"># Configure P2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:4::4</strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>locator as1 ipv6-prefix <span>2001:DB8:400::</span> 64 static 32</strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6-locator] <strong>opcode ::100 end</strong><span> <strong>psp</strong></span>
[<span class="keyword">*</span>P2-segment-routing-ipv6-locator] <strong>opcode ::200 end<span> no-flavor</span></strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>P2-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>P2] <strong>isis 1</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>segment-routing ipv6 locator as1 auto-sid-disable</strong>
[<span class="keyword">*</span>P2-isis-1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2-isis-1] <strong>quit</strong></pre>
</div>
<p>After completing the configuration, run the <a href="cmdqueryname=display+segment-routing+ipv6+locator"><b><span class="cmdname">display segment-routing ipv6 locator</span></b></a> command to check SRv6 locator information.</p>
</p></li><li><span>Configure an SRv6 TE Policy.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong> 
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>segment-list list1</strong> 
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list1] <strong>index 5 sid ipv6 2001:DB8:200::100</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 2001:DB8:300::100</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>segment-list list2</strong> 
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list2] <strong>index 5 sid ipv6 2001:DB8:400::100</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list2] <strong>index 10 sid ipv6 2001:DB8:300::100</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-segment-list-list2] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>srv6-te-policy locator as1</strong> 
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:3::3 color 10</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1] <strong>binding-sid 2001:DB8:100::900</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong> <strong>binding-sid</strong> <strong>2001:DB8:100::800</strong> <strong>reverse-binding-sid</strong> <strong>2001:DB8:300::800</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>srv6-te policy policy2 endpoint 2001:DB8:3::3 color 20</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy2] <strong>binding-sid 2001:DB8:100::901</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy2] <strong>candidate-path preference 100</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy2-path] <strong>segment-list list2</strong> <strong>binding-sid</strong> <strong>2001:DB8:100::801</strong> <strong>reverse-binding-sid</strong> <strong>2001:DB8:300::801</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy2-path] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-policy-policy2-path] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-policy-policy2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong> 
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>segment-list list1</strong> 
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list1] <strong>index 5 sid ipv6 2001:DB8:200::100</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list1] <strong>index 10 sid ipv6 2001:DB8:100::100</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list1] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>segment-list list2</strong> 
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list2] <strong>index 5 sid ipv6 2001:DB8:400::100</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list2] <strong>index 10 sid ipv6 2001:DB8:100::100</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-segment-list-list2] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>srv6-te-policy locator as1</strong> 
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:1::1 color 10</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1] <strong>binding-sid 2001:DB8:300::900</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1] <strong>candidate-path preference 100</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1-path] <strong>segment-list list1</strong> <strong>binding-sid</strong> <strong>2001:DB8:300::800</strong> <strong>reverse-binding-sid</strong> <strong>2001:DB8:100::800</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1-path] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>srv6-te policy policy2 endpoint 2001:DB8:1::1 color 20</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy2] <strong>binding-sid 2001:DB8:300::901</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy2] <strong>candidate-path preference 100</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy2-path] <strong>segment-list list2</strong> <strong>binding-sid</strong> <strong>2001:DB8:300::801</strong> <strong>reverse-binding-sid</strong> <strong>2001:DB8:100::801</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy2-path] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-policy-policy2-path] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-policy-policy2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
<p>After completing the configuration, run the <a href="cmdqueryname=display+srv6-te+policy"><b><span class="cmdname">display srv6-te policy</span></b></a> command to check SRv6 TE Policy information.</p>
</p></li><li><span>Configure a TE-Class value.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>acl number 3333</strong>
[<span class="keyword">*</span>PE1-acl-advance-3333] <strong>rule 5 permit ip source 11.11.11.11 0 destination 22.22.22.22 0</strong>
[<span class="keyword">*</span>PE1-acl-advance-3333] <strong>rule 10 permit ip source 22.22.22.22 0 destination 11.11.11.11 0</strong>
[<span class="keyword">*</span>PE1-acl-advance-3333] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-acl-advance-3333] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic classifier c1</strong>
[<span class="keyword">*</span>PE1-classifier-c1] <strong>if-match acl 3333</strong>
[<span class="keyword">*</span>PE1-classifier-c1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-classifier-c1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic behavior b1</strong>
[<span class="keyword">*</span>PE1-behavior-b1] <strong>remark te-class 1</strong>
[<span class="keyword">*</span>PE1-behavior-b1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-behavior-b1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>traffic policy p1</strong>
[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong>
[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>share-mode</strong>
[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>statistics enable</strong>
[<span class="keyword">*</span>PE1-trafficpolicy-p1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>traffic-policy p1 inbound</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>acl number 3333</strong>
[<span class="keyword">*</span>PE2-acl-advance-3333] <strong>rule 5 permit ip source 22.22.22.22 0 destination 11.11.11.11 0</strong>
[<span class="keyword">*</span>PE2-acl-advance-3333] <strong>rule 10 permit ip source 11.11.11.11 0 destination 22.22.22.22 0</strong>
[<span class="keyword">*</span>PE2-acl-advance-3333] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-acl-advance-3333] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>traffic classifier c1</strong>
[<span class="keyword">*</span>PE2-classifier-c1] <strong>if-match acl 3333</strong>
[<span class="keyword">*</span>PE2-classifier-c1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-classifier-c1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>traffic behavior b1</strong>
[<span class="keyword">*</span>PE2-behavior-b1] <strong>remark te-class 1</strong>
[<span class="keyword">*</span>PE2-behavior-b1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-behavior-b1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>traffic policy p1</strong>
[<span class="keyword">*</span>PE2-trafficpolicy-p1] <strong>classifier c1 behavior b1</strong>
[<span class="keyword">*</span>PE2-trafficpolicy-p1] <strong>share-mode</strong>
[<span class="keyword">*</span>PE2-trafficpolicy-p1] <strong>statistics enable</strong>
[<span class="keyword">*</span>PE2-trafficpolicy-p1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>traffic-policy p1 inbound</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
</div>
</p></li><li><span>Configure SPR.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>smart-policy-route</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr] <strong>spr-policy spr1</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>delay threshold 1000</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>loss threshold 300</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>jitter threshold 1000</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>cmi threshold 5000</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>srv6-te-policy color 10 priority 1</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>srv6-te-policy color 20 priority 2</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-spr-policy-spr1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-spr] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>smart-policy-route</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr] <strong>spr-policy spr1</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>delay threshold 1000</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>loss threshold 300</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>jitter threshold 1000</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>cmi threshold 5000</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>srv6-te-policy color 10 priority 1</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>srv6-te-policy color 20 priority 2</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-spr-policy-spr1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-spr] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
</p></li><li><span>Configure TE-Class-based traffic steering into an SRv6 TE Policy.</span><p><p>In TE-Class-based traffic steering, the headend recurses traffic based on the next hop of the corresponding route in compliance with the configured tunnel policy. If traffic recursion to an SRv6 TE flow group is configured, the headend matches the traffic with an SRv6 mapping policy that has the same color value as the route. If such an SRv6 mapping policy exists, the headend dynamically generates an SRv6 TE flow group that contains multiple SRv6 TE Policies with the same endpoint but different color values.</p>
<div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>mapping-policy p1 color 101</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-mapping-policy-p1] <strong>match-type te-class</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-mapping-policy-p1-te-class] <strong>index 10 te-class 1 match spr-policy spr1</strong><strong> </strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-mapping-policy-p1-te-class] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-mapping-policy-p1-te-class] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-mapping-policy-p1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>mapping-policy p1 color 101</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-mapping-policy-p1] <strong>match-type te-class</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-mapping-policy-p1-te-class] <strong>index 10 te-class 1 match spr-policy spr1</strong><strong> </strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-mapping-policy-p1-te-class] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-mapping-policy-p1-te-class] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-mapping-policy-p1] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
</p></li><li><span>Configure a tunnel policy and import VPN traffic.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>route-policy p1 permit node 10</strong>
[<span class="keyword">*</span>PE1-route-policy] <strong>apply extcommunity color 0:101</strong>
[<span class="keyword">*</span>PE1-route-policy] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 route-policy p1 import</strong> 
[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>tunnel-policy p1</strong>
[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-flow-group load-balance-number 1</strong>
[<span class="keyword">*</span>PE1-tunnel-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1</strong><strong> evpn</strong>
[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>route-policy p1 permit node 10</strong>
[<span class="keyword">*</span>PE2-route-policy] <strong>apply extcommunity color 0:101</strong>
[<span class="keyword">*</span>PE2-route-policy] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong>
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 2001:DB8:1::1 route-policy p1 import</strong> 
[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>tunnel-policy p1</strong>
[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>tunnel select-seq ipv6 srv6-te-flow-group load-balance-number 1</strong>
[<span class="keyword">*</span>PE2-tunnel-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>ip vpn-instance vpna</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>tnl-policy p1</strong><strong> evpn</strong>
[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
</div>
<p>After completing the configuration, run the <a href="cmdqueryname=display+srv6-te+flow-group"><b><span class="cmdname">display srv6-te flow-group</span></b></a> command to check the SRv6 TE flow group status. You can also run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance"><b><span class="cmdname">display ip routing-table vpn-instance</span></b></a> command to check the IPv4 routing table of a VPN instance and check whether VPN routes are successfully recursed to the SRv6 TE Policy.</p>
</p></li><li><span>Configure IFIT measurement for the SRv6 TE Policy.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:3::3 color 10</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1] <strong>ifit loss-measure enable</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1] <strong>ifit delay-measure enable</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6] <strong>srv6-te policy policy2 endpoint 2001:DB8:3::3 color 20</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy2] <strong>ifit loss-measure enable</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy2] <strong>ifit delay-measure enable</strong>
[<span class="keyword">*</span>PE1-segment-routing-ipv6-policy-policy2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6-policy-policy2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
</p><p><div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>srv6-te policy policy1 endpoint 2001:DB8:1::1 color 10</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1] <strong>ifit loss-measure enable</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1] <strong>ifit delay-measure enable</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy1] <strong>quit</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6] <strong>srv6-te policy policy2 endpoint 2001:DB8:1::1 color 20</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy2] <strong>ifit loss-measure enable</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy2] <strong>ifit delay-measure enable</strong>
[<span class="keyword">*</span>PE2-segment-routing-ipv6-policy-policy2] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6-policy-policy2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-segment-routing-ipv6] <strong>quit</strong></pre>
</div>
</p></li><li><span>Configure an IFIT instance.</span><p><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ifit</strong>
[<span class="keyword">*</span>PE1-ifit]<strong> node-id 10</strong>
[<span class="keyword">*</span>PE1-ifit]<strong> work-mode mcp</strong>
[<span class="keyword">*</span>PE1-ifit-work-mode-mcp]<strong> </strong><strong>service-type srv6-segment-list</strong>
[<span class="keyword">*</span>PE1-ifit-work-mode-mcp]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit-work-mode-mcp]<strong> </strong><strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ifit]<strong> </strong><strong>quit</strong></pre>
</div>
<div class="p"># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ifit</strong>
[<span class="keyword">*</span>PE2-ifit]<strong> node-id 20</strong>
[<span class="keyword">*</span>PE2-ifit]<strong> work-mode dcp</strong>
[<span class="keyword">*</span>PE2-ifit-work-mode-dcp]<strong> </strong><strong>service-type srv6-segment-list</strong>
[<span class="keyword">*</span>PE2-ifit-work-mode-dcp]<strong> </strong><strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ifit-work-mode-dcp]<strong> </strong><strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ifit]<strong> </strong><strong>quit</strong></pre>
</div>
</p></li><li><span>Configure the device to send statistics to the NMS through telemetry. The following example uses the configuration on PE1. The configuration of PE2 is similar to the configuration of PE1.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> </strong><strong>telemetry</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry] <strong>destination-group ifit</strong>
[<span class="keyword">*</span>PE1-telemetry-destination-group-ifit] <strong>ipv4-address 192.168.1.1 port 10001 protocol grpc</strong>
[<span class="keyword">*</span>PE1-telemetry-destination-group-ifit] <strong>quit</strong>
[<span class="keyword">*</span>PE1-telemetry] <strong>sensor-group ifit</strong>
[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit] <strong>sensor-path huawei-ifit:ifit/</strong><strong>huawei-ifit-statistics</strong><strong>:flow-sr-policy-statistics/flow-sr-policy-statistic</strong>
[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit-path] <strong>quit</strong>
[<span class="keyword">*</span>PE1-telemetry-sensor-group-ifit] <strong>quit</strong>
[<span class="keyword">*</span>PE1-telemetry] <strong>subscription ifit</strong>
[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>sensor-group ifit</strong> <strong>sample-interval 0</strong>
[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>destination-group ifit</strong>
[<span class="keyword">*</span>PE1-telemetry-subscription-ifit] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You are advised to configure devices to send data using a secure TLS encryption mode. For details, see <em>Telemetry Configuration</em>.</p>
</div></div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001223107307__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Verifying the Configuration</h4><div class="p"># Check unidirectional packet loss statistics of an IFIT flow.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ifit statistic-type one-way-loss flow-id 1572866</strong>
Latest one-way loss statistics:
-------------------------------------------------------------------------------------------------------------------------------
  Period                 Local-Loss             Local-Loss-Ratio      Remote-Loss            Remote-Loss-Ratio     Error-Info
-------------------------------------------------------------------------------------------------------------------------------
  818051526              0                      0                     0                      0                     OK            
  818051525              0                      0                     0                      0                     OK            
  818051524              0                      0                     0                      0                     OK            
  818051523              0                      0                     0                      0                     OK            
  818051522              0                      0                     0                      0                     OK            
  818051521              0                      0                     0                      0                     OK            
  818051520              0                      0                     0                      0                     OK            
  818051519              0                      0                     0                      0                     OK            
  818051518              0                      0                     0                      0                     OK            
  818051517              0                      0                     0                      0                     OK            
  818051516              0                      0                     0                      0                     OK            
  818051515              0                      0                     0                      0                     OK            
  818051514              0                      0                     0                      0                     OK            
  818051513              0                      0                     0                      0                     OK            
  818051512              0                      0                     0                      0                     OK            
  818051511              0                      0                     0                      0                     OK            
  818051510              0                      0                     0                      0                     OK            
  818051509              0                      0                     0                      0                     OK            
  818051508              0                      0                     0                      0                     OK            
  818051507              0                      0                     0                      0                     OK            
  818051506              0                      0                     0                      0                     OK            
  818051505              0                      0                     0                      0                     OK            
  818051504              0                      0                     0                      0                     OK            
  818051503              0                      0                     0                      0                     OK            
  818051502              0                      0                     0                      0                     OK            
  818051501              0                      0                     0                      0                     OK            
  818051500              0                      0                     0                      0                     OK            
  818051499              0                      0                     0                      0                     OK            
  818051498              0                      0                     0                      0                     OK            
  818051497              0                      0                     0                      0                     OK            
-------------------------------------------------------------------------------------------------------------------------------
Info: The actual loss ratio is the value displayed in the Loss-Ratio column divided by 10^6.</pre>
</div>
<div class="p"># Check one-way delay information of an IFIT flow.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ifit statistic-type one-way-delay flow-id 1572866</strong>
Latest one-way delay statistics(nsec):
-----------------------------------------------------------------------------------------------------------------------------
  Period                 Local-Delay       Local-Delay-Jitter       Remote-Delay       Remote-Delay-Jitter       Error-Info
-----------------------------------------------------------------------------------------------------------------------------
  818051332              0                 0		                0                  0                         OK          
  818051331              0                 0		                0                  0                         OK          
  818051330              0                 0		                0                  0                         OK          
  818051329              0                 0		                0                  0                         OK          
  818051328              0                 0		                0                  0                         OK          
  818051327              0                 0		                0                  0                         OK          
  818051326              0                 0		                0                  0                         OK          
  818051325              0                 0		                0                  0                         OK          
  818051324              0                 0		                0                  0                         OK          
  818051323              0                 0		                0                  0                         OK          
  818051322              0                 0		                0                  0                         OK          
  818051321              0                 0		                0                  0                         OK          
  818051320              0                 0		                0                  0                         OK          
  818051319              0                 0		                0                  0                         OK          
  818051318              0                 0		                0                  0                         OK          
  818051317              0                 0		                0                  0                         OK          
  818051316              0                 0		                0                  0                         OK          
  818051315              0                 0		                0                  0                         OK          
  818051314              0                 0		                0                  0                         OK          
  818051313              0                 0		                0                  0                         OK          
  818051312              0                 0		                0                  0                         OK          
  818051311              0                 0		                0                  0                         OK          
  818051310              0                 0		                0                  0                         OK          
  818051309              0                 0		                0                  0                         OK          
  818051308              0                 0		                0                  0                         OK          
  818051307              0                 0		                0                  0                         OK          
  818051306              0                 0		                0                  0                         OK          
  818051305              0                 0		                0                  0                         OK          
  818051304              0                 0		                0                  0                         OK          
  818051303              0                 0		                0                  0                         OK          
-----------------------------------------------------------------------------------------------------------------------------</pre>
</div>
<div class="p"># Check two-way delay information of an IFIT flow.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ifit statistic-type two-way-delay flow-id 1572866</strong>
Latest two-way delay statistics(nsec):
--------------------------------------------------------------------------------------------
  Period                 Delay(Avg)                 Jitter(Avg)                 Error-Info
--------------------------------------------------------------------------------------------
  818051332              1000000                    0                           OK          
  818051331              1000000                    0                           OK          
  818051330              1000000                    0                           OK          
  818051329              1000000                    0                           OK          
  818051328              1000000                    0                           OK          
  818051327              1000000                    0                           OK          
  818051326              1000000                    0                           OK          
  818051325              1000000                    0                           OK          
  818051324              1000000                    0                           OK          
  818051323              1000000                    0                           OK          
  818051322              1000000                    0                           OK          
  818051321              1000000                    0                           OK          
  818051320              1000000                    0                           OK          
  818051319              1000000                    0                           OK          
  818051318              1000000                    0                           OK          
  818051317              1000000                    0                           OK          
  818051316              1000000                    0                           OK          
  818051315              1000000                    0                           OK          
  818051314              1000000                    0                           OK          
  818051313              1000000                    0                           OK          
  818051312              1000000                    0                           OK          
  818051311              1000000                    0                           OK          
  818051310              1000000                    0                           OK          
  818051309              1000000                    0                           OK          
  818051308              1000000                    0                           OK          
  818051307              1000000                    0                           OK          
  818051306              1000000                    0                           OK          
  818051305              1000000                    0                           OK          
  818051304              1000000                    0                           OK          
  818051303              1000000                    0                           OK          
--------------------------------------------------------------------------------------------</pre>
</div>
<div class="p"># Check SRv6 TE Policy measurement instance information.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ifit srv6-segment-list</strong>
-------------------------------------------------------------------------
Flow Classification                     : srv6-segment-list
Instance Id                             : 2
Flow Id                                 : 1572866
Flow Type                               : unidirectional
Loss Measure                            : enable
Delay Measure                           : enable
Measure Mode                            : e2e
Interval                                : 30(s)
Color                                   : 10
Segment List Id                         : 1
Binding SID                             : 2001:DB8:100::800
Reverse Binding SID                     : 2001:DB8:300::800 
EndPoint                                : 2001:DB8:3::3
-------------------------------------------------------------------------
Flow Classification                     : srv6-segment-list
Instance Id                             : 3
Flow Id                                 : 1572867
Flow Type                               : unidirectional
Loss Measure                            : enable
Delay Measure                           : enable
Measure Mode                            : e2e
Interval                                : 30(s)
Color                                   : 20
Segment List Id                         : 2
Binding SID                             : 2001:DB8:100::801
Reverse Binding SID                     : 2001:DB8:300::801
EndPoint                                : 2001:DB8:3::3</pre>
</div>
</div>
<div class="postreq"><a name="EN-US_TASK_0000001223107307__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Scripts</h4><ul><li>PE1<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  tnl-policy p1 evpn
  apply-label per-instance
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 import-extcommunity evpn
#
acl number 3333
 rule 5 permit ip source 11.11.11.11 0 destination 22.22.22.22 0
 rule 10 permit ip source 22.22.22.22 0 destination 11.11.11.11 0
#
traffic classifier c1
 if-match acl 3333
#
traffic behavior b1
 remark te-class 1
#        
traffic policy p1
 share-mode
 statistics enable
 classifier c1 behavior b1 precedence 1
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:1::1                                              
 locator as1 ipv6-prefix 2001:DB8:100:: 64 static 32                                     
  opcode ::100 end psp      
  opcode ::200 end no-flavor
 srv6-te-policy locator as1 
 segment-list list1        
  index 5 sid ipv6 2001:DB8:200::100  
  index 10 sid ipv6 2001:DB8:300::100 
 segment-list list2        
  index 5 sid ipv6 2001:DB8:400::100  
  index 10 sid ipv6 2001:DB8:300::100 
 srv6-te policy policy1 endpoint 2001:DB8:3::3 color 10                                  
  binding-sid 2001:DB8:100::900  
  ifit loss-measure enable
  ifit delay-measure enable
  candidate-path preference 100     
   segment-list list1 binding-sid 2001:DB8:100::800 reverse-binding-sid 2001:DB8:300::800        
 srv6-te policy policy2 endpoint 2001:DB8:3::3 color 20                                  
  binding-sid 2001:DB8:100::901 
  ifit loss-measure enable
  ifit delay-measure enable
  candidate-path preference 100 
   segment-list list2 binding-sid 2001:DB8:100::801 reverse-binding-sid 2001:DB8:300::801       
 smart-policy-route
  spr-policy spr1
   delay threshold 1000
   jitter threshold 1000
   loss threshold 300
   cmi threshold 5000
   srv6-te-policy color 10 priority 1
   srv6-te-policy color 20 priority 2
 mapping-policy p1 color 101     
  match-type te-class 
   index 10 te-class 1 match spr-policy spr1
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0001.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1 auto-sid-disable
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:11::1/96
 isis ipv6 enable 1
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.1 255.255.255.0
 traffic-policy p1 inbound
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:13::1/96
 isis ipv6 enable 1
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:1::1/128
 isis ipv6 enable 1
#               
bgp 100         
 router-id 1.1.1.1
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator as1 evpn
  segment-routing ipv6 traffic-engineer best-effort evpn
  peer 10.1.1.2 as-number 65410
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 route-policy p1 import
  peer 2001:DB8:3::3 advertise encap-type srv6 
#
ifit
 node-id 10
 work-mode mcp
  service-type srv6-segment-list
#               
route-policy p1 permit node 10
 apply extcommunity color 0:101
#               
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-flow-group load-balance-number 1
#
telemetry
 #
 sensor-group ifit
  sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-sr-policy-statistics/flow-sr-policy-statistic
 #
 destination-group ifit
  ipv4-address 192.168.1.1 port 10001 protocol grpc
 #
 subscription ifit
  sensor-group ifit sample-interval 0
  destination-group ifit
#               
return</pre>
</li><li>P1<pre class="screen">#
sysname P1        
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:2::2
 locator as1 ipv6-prefix 2001:DB8:200:: 64 static 32
  opcode ::100 end psp
  opcode ::200 end no-flavor
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1 auto-sid-disable
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:11::2/96
 isis ipv6 enable 1 
# 
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:12::1/96
 isis ipv6 enable 1  
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:2::2/128
 isis ipv6 enable 1
#               
return</pre>
</li><li>PE2<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  tnl-policy p1 evpn
  apply-label per-instance
  vpn-target 111:1 export-extcommunity evpn
  vpn-target 111:1 import-extcommunity evpn
#
acl number 3333
 rule 5 permit ip source 22.22.22.22 0 destination 11.11.11.11 0
 rule 10 permit ip source 11.11.11.11 0 destination 22.22.22.22 0
#
traffic classifier c1
 if-match acl 3333
#
traffic behavior b1
 remark te-class 1
#        
traffic policy p1
 share-mode
 statistics enable
 classifier c1 behavior b1 precedence 1
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3                                              
 locator as1 ipv6-prefix 2001:DB8:300:: 64 static 32                                     
  opcode ::100 end psp      
  opcode ::200 end no-flavor
 srv6-te-policy locator as1 
 segment-list list1        
  index 5 sid ipv6 2001:DB8:200::100  
  index 10 sid ipv6 2001:DB8:100::100 
 segment-list list2        
  index 5 sid ipv6 2001:DB8:400::100  
  index 10 sid ipv6 2001:DB8:100::100 
 srv6-te policy policy1 endpoint 2001:DB8:1::1 color 10                                  
  binding-sid 2001:DB8:300::900  
  ifit loss-measure enable
  ifit delay-measure enable
  candidate-path preference 100     
   segment-list list1 binding-sid 2001:DB8:300::800 reverse-binding-sid 2001:DB8:100::800       
 srv6-te policy policy2 endpoint 2001:DB8:1::1 color 20                                  
  binding-sid 2001:DB8:300::901 
  ifit loss-measure enable
  ifit delay-measure enable
  candidate-path preference 100 
   segment-list list2 binding-sid 2001:DB8:300::801 reverse-binding-sid 2001:DB8:100::801       
 smart-policy-route
  spr-policy spr1
   delay threshold 1000
   jitter threshold 1000
   loss threshold 300
   cmi threshold 5000
   srv6-te-policy color 10 priority 1
   srv6-te-policy color 20 priority 2
 mapping-policy p1 color 101     
  match-type te-class 
   index 10 te-class 1 match spr-policy spr1
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1 auto-sid-disable             
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:12::2/96
 isis ipv6 enable 1
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.2.1.1 255.255.255.0
 traffic-policy p1 inbound
#               
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:14::2/96
 isis ipv6 enable 1
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:3::3/128
 isis ipv6 enable 1
#               
bgp 100         
 router-id 2.2.2.2
 peer 2001:DB8:1::1 as-number 100
 peer 2001:DB8:1::1 connect-interface LoopBack1
 #              
 ipv4-family unicast
  undo synchronization
 #              
 ipv4-family vpn-instance vpna
  import-route direct
  advertise l2vpn evpn
  segment-routing ipv6 locator as1 evpn
  segment-routing ipv6 traffic-engineer best-effort evpn
  peer 10.2.1.2 as-number 65420
 #              
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:1::1 enable
  peer 2001:DB8:1::1 route-policy p1 import
  peer 2001:DB8:1::1 advertise encap-type srv6 
#
ifit
 node-id 20
 work-mode dcp
  service-type srv6-segment-list
#               
route-policy p1 permit node 10
 apply extcommunity color 0:101
#               
tunnel-policy p1
 tunnel select-seq ipv6 srv6-te-flow-group load-balance-number 1
#
telemetry
 #
 sensor-group ifit
  sensor-path huawei-ifit:ifit/huawei-ifit-statistics:flow-sr-policy-statistics/flow-sr-policy-statistic
 #
 destination-group ifit
  ipv4-address 192.168.1.1 port 10001 protocol grpc
 #
 subscription ifit
  sensor-group ifit sample-interval 0
  destination-group ifit
#               
return</pre>
</li><li>P2<pre class="screen">#
sysname P2        
#               
segment-routing ipv6
 encapsulation source-address 2001:DB8:4::4
 locator as1 ipv6-prefix 2001:DB8:400::1 64 static 32
  opcode ::100 end psp
  opcode ::200 end no-flavor
#               
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator as1 auto-sid-disable
 #
#               
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:13::2/96
 isis ipv6 enable 1 
# 
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ipv6 enable    
 ipv6 address 2001:DB8:14::1/96
 isis ipv6 enable 1  
#               
interface LoopBack1
 ipv6 enable    
 ipv6 address 2001:DB8:4::4/128
 isis ipv6 enable 1
#               
return </pre>
</li><li>CE1<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#               
interface LoopBack1
 ip address 11.11.11.11 255.255.255.255
#               
bgp 65410
 router-id 11.11.11.11 
 peer 10.1.1.1 as-number 100
 #              
 ipv4-family unicast
  undo synchronization
  import-route direct 
  peer 10.1.1.1 enable
#               
return </pre>
</li><li>CE2<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
interface LoopBack1
 ip address 22.22.22.22 255.255.255.255
#
bgp 65420
 router-id 22.22.22.22
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.2.1.1 enable
#
return</pre>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0012.html">Configuration Examples for IFIT Tunnel-Level Quality Measurement
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
</div>
</div>
</body>
</html>