
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Performance Measurement based on Dynamic IFIT Flows">
<meta name="abstract" content="IFIT measurement based on dynamic flows can be triggered by packets with the IFIT header or by automatic flow learning.">
<meta name="description" content="IFIT measurement based on dynamic flows can be triggered by packets with the IFIT header or by automatic flow learning.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0006.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0021_02.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="IFIT">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00511010">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0288594311">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Performance Measurement based on Dynamic IFIT Flows</title>
</head>
<body><a name="EN-US_TASK_0288594311"></a><a name="EN-US_TASK_0288594311"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Performance Measurement based on Dynamic IFIT Flows</h1>
<div class="taskbody"><p>IFIT measurement based on dynamic flows can be triggered by packets with the IFIT header or by automatic flow learning.</p>
<div class="context"><a name="EN-US_TASK_0288594311__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Context</h4><p>IFIT supports automatic learning of dynamic flows on the ingress by using the mask or exact match of the source or destination address. In addition, IFIT can flexibly monitor service quality in real time by configuring a learning whitelist. The generation of dynamic flows on transit and egress nodes is triggered by packets with the IFIT header.</p>
<h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring performance measurement based on dynamic IFIT flows, complete the following tasks:</p>
<ul><li>Configure a dynamic routing protocol or static routes so that devices are reachable at the network layer.</li><li>Configure the network time protocol  or G.8275.1 to implement clock synchronization for all devices that have clocks on the network.</li></ul>
<h4 class="sectiontitle">Procedure</h4><div class="p">In a non-inter-AS Option A scenario, perform the following steps to configure performance measurement based on dynamic IFIT flows:<ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ifit"><b><span class="cmdname">ifit</span></b></a></p>
<p>IFIT is enabled globally, and its view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=node-id"><b><span class="cmdname">node-id</span></b></a> <i><span class="varname">node-id</span></i></p>
<p>A node ID is configured.</p>
<p>Only steps 1 to 3 need to be performed on the transit node and egress to implement dynamic flow-based measurement.</p>
</li><li><p>Run <a href="cmdqueryname=encapsulation+nexthop"><b><span class="cmdname">encapsulation nexthop</span></b></a> <i><span class="varname">ip-address</span></i></p>
<p>The device is enabled to encapsulate the IFIT header into packets destined for a specified next hop IP address.</p>
<p>This step is required only on an MPLS network.</p>
</li><li>Perform the following steps to configure IFIT automatic flow learning on the ingress to implement flexible performance measurement based on dynamic IFIT flows:<ol type="a"><li>(Optional) Run the <a href="cmdqueryname=whitelist-group"><b><span class="cmdname">whitelist-group</span></b></a> <i><span class="varname">whitelist-group-name</span></i> command to configure an IFIT whitelist group and enter its view.</li><li>(Optional) Run either of the following commands to configure a whitelist rule:<ul><li>In an IPv4 scenario, run the <a href="cmdqueryname=rule"><b><span class="cmdname">rule</span></b></a> <i><span class="varname">rule-name</span></i> <strong><span>ipv4</span></strong> { <strong><span>source</span></strong> { <i><span class="varname">src-ip-address</span></i> [ <i><span class="varname">src-mask-length</span></i> | <strong><span>any</span></strong> <i><span class="varname">src-mask-length</span></i> ] } | <strong><span>destination</span></strong> { <i><span class="varname">dest-ip-address</span></i> [ <i><span class="varname">dest-mask-length</span></i> ] | <strong><span>any</span></strong> <i><span class="varname">dest-mask-length</span></i> } | <strong><span>protocol</span></strong> { { <strong><span>tcp</span></strong> | <strong><span>udp</span></strong> | <strong><span>sctp</span></strong> | <i><span class="varname">protocol-number4</span></i> | <i><span class="varname">protocol-number5</span></i> | <i><span class="varname">protocol-number6</span></i> } [ <strong><span>source-port</span></strong> <i><span class="varname">src-port-number</span></i> ] [ <strong><span>destination-port</span></strong> <i><span class="varname">dest-port-number</span></i> ] | { <i><span class="varname">protocol-number</span></i> | <i><span class="varname">protocol-number3</span></i> | <i><span class="varname">protocol-number7</span></i> | <i><span class="varname">protocol-number8</span></i> } } } <sup>*</sup> command.</li><li>In an IPv6 scenario, run the <a href="cmdqueryname=rule"><b><span class="cmdname">rule</span></b></a> <i><span class="varname">rule-name</span></i> <strong><span>ipv6</span></strong> { <strong><span>source-ipv6</span></strong> { <i><span class="varname">src-ipv6-address</span></i> [ <i><span class="varname">src6-mask-length</span></i> | <strong><span>any</span></strong> <i><span class="varname">src6-mask-length</span></i> ] } | <strong><span>destination-ipv6</span></strong> { <i><span class="varname">dest-ipv6-address</span></i> [ <i><span class="varname">dest6-mask-length</span></i> ] | <strong><span>any</span></strong> <i><span class="varname">dest6-mask-length</span></i> } | <strong><span>protocol</span></strong> { { <strong><span>tcp</span></strong> | <strong><span>udp</span></strong> | <strong><span>sctp</span></strong> | <i><span class="varname">protocol-number4</span></i> | <i><span class="varname">protocol-number5</span></i> | <i><span class="varname">protocol-number6</span></i> } [ <strong><span>source-port</span></strong> <i><span class="varname">src-port-number</span></i> ] [ <strong><span>destination-port</span></strong> <i><span class="varname">dest-port-number</span></i> ] | { <i><span class="varname">protocol-number</span></i> | <i><span class="varname">protocol-number3</span></i> | <i><span class="varname">protocol-number7</span></i> | <i><span class="varname">protocol-number8</span></i> } } } <sup>*</sup> command.</li></ul>
</li><li>Run the <a href="cmdqueryname=flow-learning+vpn-instance"><b><span class="cmdname">flow-learning vpn-instance</span></b></a> <i><span class="varname">vpn-name</span></i> command to configure an IFIT VPN instance and enter its view.</li><li>(Optional) Run the <a href="cmdqueryname=learning-mode"><b><span class="cmdname">learning-mode</span></b></a> { <strong><span>sip-mask-dip-exact</span></strong> | <strong><span>sip-mask-dip-mask</span></strong> | <strong><span>sip-exact-dip-exact</span></strong> | <strong><span>sip-exact-dip-mask</span></strong> } command to configure an IFIT flow learning mode.</li><li>Run the <a href="cmdqueryname=flow-learning"><b><span class="cmdname">flow-learning</span></b></a> { <strong><span>bidirectional</span></strong> | <strong><span>unidirectional</span></strong> } command to configure an IFIT flow learning direction.</li><li>Run the <a href="cmdqueryname=measure-mode"><b><span class="cmdname">measure-mode</span></b></a> { <strong><span>e2e</span></strong> | <strong><span>trace</span></strong> } command to set the IFIT flow learning measurement mode to end-to-end or hop-by-hop.<p>By default, end-to-end measurement is used.</p>
</li><li>(Optional) Run the <a href="cmdqueryname=interval"><b><span class="cmdname">interval</span></b></a> <i><span class="varname">interval-value</span></i> command to configure a measurement interval for IFIT flow learning.</li><li>Run the <a href="cmdqueryname=flow-learning+interface"><b><span class="cmdname">flow-learning interface</span></b></a> { <strong><span>all</span></strong> | { <i><span class="varname">ifType</span></i> <i><span class="varname">ifNum</span></i> | <i><span class="varname">ifName</span></i> } } [ <strong><span>whitelist-group</span></strong> <i><span class="varname">whitelist-group-name</span></i> ] command to bind the learned IFIT flows to a specified interface.</li><li>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the IFIT view.</li></ol>
</li><li>Run the following commands to modify the learned dynamic IFIT flows as required:<ul><li>In IPv4 scenarios:<ul><li>To set dynamic flow parameters, run the <a href="cmdqueryname=dynamic+flow"><b><span class="cmdname">dynamic flow</span></b></a><strong> </strong><strong><span>source</span></strong><strong> </strong>{ <i><span class="varname">src-ip-address</span></i> [ <i><span class="varname">src-mask-length</span></i> ] | <strong><span>srcAny</span></strong> } <strong><span>destination</span></strong> { <i><span class="varname">dest-ip-address</span></i> [ <i><span class="varname">dest-mask-length</span></i> ] | <strong><span>dstAny</span></strong> } [ <span><strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i></span> ] <strong><span>interface</span></strong> { <i><span class="varname">ifType</span></i><em> </em><i><span class="varname">ifNum</span></i> | <i><span class="varname">ifName</span></i> } [ <strong><span>dscp</span></strong><em> </em><i><span class="varname">dscp-value</span></i> ] [ <strong><span>protocol</span></strong> { { <strong><span>tcp</span></strong> | <strong><span>udp</span></strong> | <i><span class="varname">protocol-tcp</span></i> | <i><span class="varname">protocol-udp</span></i> | <strong><span>sctp</span></strong> | <i><span class="varname">protocol-sctp</span></i> } [ <strong><span>source-port</span></strong><em> </em><i><span class="varname">src-port-number</span></i> ] [ <strong><span>destination-port</span></strong><em> d</em><i><span class="varname">est-port-number</span></i> ] | { <i><span class="varname">protocol-number</span></i> | <i><span class="varname">protocol-number3</span></i> | <i><span class="varname">protocol-number4</span></i> | <i><span class="varname">protocol-number5</span></i> } } ] { <strong><span>measure-mode</span></strong> { <strong><span>e2e</span></strong> | <strong><span>trace</span></strong> } | <strong><span>delay-measure</span></strong> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> } | <strong><span>interval</span></strong><em> </em><i><span class="varname">interval-value</span></i> | { <strong><span>loss-measure-enable</span></strong> | <strong><span>loss-measure-disable</span></strong> } | { <strong><span>disorder-measure-enable</span></strong> | <strong><span>disorder-measure-disable</span></strong> } | <strong><span>per-packet-delay</span></strong> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> } } <sup>*</sup> command.</li><li>To clear the learned dynamic IFIT flows, run the <a href="cmdqueryname=reset+dynamic+flow"><b><span class="cmdname">reset dynamic flow</span></b></a> <strong><span>source</span></strong><strong> </strong>{ <i><span class="varname">src-ip-address</span></i> [ <i><span class="varname">src-mask-length</span></i> ] | <strong><span>srcAny</span></strong> } <strong><span>destination</span></strong> { <i><span class="varname">dest-ip-address</span></i> [ <i><span class="varname">dest-mask-length</span></i> ] | <strong><span>dstAny</span></strong> } [ <span><strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i></span> ] <strong><span>interface</span></strong> { <i><span class="varname">ifType</span></i><em> </em><i><span class="varname">ifNum</span></i> | <i><span class="varname">ifName</span></i> } [ <strong><span>dscp</span></strong><em> </em><i><span class="varname">dscp-value</span></i> ] [ <strong><span>protocol</span></strong> { { <strong><span>tcp</span></strong> | <strong><span>udp</span></strong> | <i><span class="varname">protocol-tcp</span></i> | <i><span class="varname">protocol-udp</span></i> | <strong><span>sctp</span></strong> | <i><span class="varname">protocol-sctp</span></i> } [ <strong><span>source-port</span></strong><em> </em><i><span class="varname">src-port-number</span></i> ] [ <strong><span>destination-port</span></strong><em> d</em><i><span class="varname">est-port-number</span></i> ] | { <i><span class="varname">protocol-number</span></i> | <i><span class="varname">protocol-number3</span></i> | <i><span class="varname">protocol-number4</span></i> | <i><span class="varname">protocol-number5</span></i> } } ] command.</li></ul>
</li><li>In IPv6 scenarios:<ul><li>To set dynamic flow parameters, run the <a href="cmdqueryname=dynamic+flow"><b><span class="cmdname">dynamic flow</span></b></a> <strong><span>source-ipv6</span></strong><strong> </strong>{ <i><span class="varname">src-ipv6-address</span></i> [ <i><span class="varname">src6-mask-length</span></i> ] | <strong><span>srcAny</span></strong> } <strong><span>destination-ipv6</span></strong> { <i><span class="varname">dest-ipv6-address</span></i> [ <i><span class="varname">dest6-mask-length</span></i> ] | <strong><span>dstAny</span></strong> } [ <span><strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i></span> ] <strong><span>interface</span></strong> { <i><span class="varname">ifType</span></i><em> </em><i><span class="varname">ifNum</span></i> | <i><span class="varname">ifName</span></i> } [ <strong><span>dscp</span></strong><em> </em><i><span class="varname">dscp-value</span></i> ] [ <strong><span>protocol</span></strong> { { <strong><span>tcp</span></strong> | <strong><span>udp</span></strong> | <i><span class="varname">protocol-tcp</span></i> | <i><span class="varname">protocol-udp</span></i> | <strong><span>sctp</span></strong> | <i><span class="varname">protocol-sctp</span></i> } [ <strong><span>source-port</span></strong><em> </em><i><span class="varname">src-port-number</span></i> ] [ <strong><span>destination-port</span></strong><em> d</em><i><span class="varname">est-port-number</span></i> ] | { <i><span class="varname">protocol-number</span></i> | <i><span class="varname">protocol-number3</span></i> | <i><span class="varname">protocol-number4</span></i> | <i><span class="varname">protocol-number5</span></i> } } ] { <strong><span>measure-mode</span></strong> { <strong><span>e2e</span></strong> | <strong><span>trace</span></strong> } | <strong><span>delay-measure</span></strong> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> } | <strong><span>interval</span></strong><em> </em><i><span class="varname">interval-value</span></i> | { <strong><span>loss-measure-enable</span></strong> | <strong><span>loss-measure-disable</span></strong> } | { <strong><span>disorder-measure-enable</span></strong> | <strong><span>disorder-measure-disable</span></strong> } | <strong><span>per-packet-delay</span></strong> { <strong><span>enable</span></strong> | <strong><span>disable</span></strong> } } <sup>*</sup> command.</li><li>To clear the learned dynamic IFIT flows, run the <a href="cmdqueryname=reset+dynamic+flow"><b><span class="cmdname">reset dynamic flow</span></b></a> <strong><span>source-ipv6</span></strong><strong> </strong>{ <i><span class="varname">src-ipv6-address</span></i> [ <i><span class="varname">src6-mask-length</span></i> ] | <strong><span>srcAny</span></strong> } <strong><span>destination-ipv6</span></strong> { <i><span class="varname">dest-ipv6-address</span></i> [ <i><span class="varname">dest6-mask-length</span></i> ] | <strong><span>dstAny</span></strong> } [ <span><strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-name</span></i></span> ] <strong><span>interface</span></strong> { <i><span class="varname">ifType</span></i><em> </em><i><span class="varname">ifNum</span></i> | <i><span class="varname">ifName</span></i> } [ <strong><span>dscp</span></strong><em> </em><i><span class="varname">dscp-value</span></i> ] [ <strong><span>protocol</span></strong> { { <strong><span>tcp</span></strong> | <strong><span>udp</span></strong> | <i><span class="varname">protocol-tcp</span></i> | <i><span class="varname">protocol-udp</span></i> | <strong><span>sctp</span></strong> | <i><span class="varname">protocol-sctp</span></i> } [ <strong><span>source-port</span></strong><em> </em><i><span class="varname">src-port-number</span></i> ] [ <strong><span>destination-port</span></strong><em> d</em><i><span class="varname">est-port-number</span></i> ] | { <i><span class="varname">protocol-number</span></i> | <i><span class="varname">protocol-number3</span></i> | <i><span class="varname">protocol-number4</span></i> | <i><span class="varname">protocol-number5</span></i> } } ] command.</li></ul>
</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>If automatic flow learning is not performed, this step can also be used to modify the learned dynamic reverse flows in scenarios where IFIT measurement is performed for bidirectional flows.</li><li>Per-packet delay measurement can be enabled only after packet loss measurement is enabled and is mutually exclusive with out-of-order packet measurement.</li></ul>
</div></div>
</li><li><p>(Optional) Run <a href="cmdqueryname=flow-learning+reverse-flow-mode+eth-trunk"><b><span class="cmdname">flow-learning reverse-flow-mode eth-trunk</span></b></a></p>
<p>The learning mode of IFIT reverse flows is set to Eth-Trunk interface-based learning.</p>
</li><li>(Optional) Run <a href="cmdqueryname=dynamic-flow+age+interval-multiplier"><b><span class="cmdname">dynamic-flow age interval-multiplier</span></b></a> <i><span class="varname">multi-value</span></i><p>The aging time of dynamic IFIT flows is set.</p>
</li><li>(Optional) Run <a href="cmdqueryname=reset+dynamic"><b><span class="cmdname">reset dynamic</span></b></a> <strong><span>flow</span></strong> { <i><span class="varname">flowId</span></i> | <strong><span>all</span></strong> }<p>All learned dynamic flows or a specific one is deleted.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</div>
<div class="p">In an inter-AS Option A scenario, in addition to the preceding configurations, you also need to perform the following steps to enable IFIT mapping on the interfaces of the devices (a pair of ASBRs) that connect different ASs:<ol><li>In the system view, run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> }<p>The interface view is displayed.</p>
</li><li>Run either of the following commands based on the device location to enable IFIT mapping on the interface:<ul><li>To enable IFIT mapping in the inbound direction, run the <a href="cmdqueryname=ifit+ingress+mapping+enable"><b><span class="cmdname">ifit ingress mapping enable</span></b></a> command on the egress ASBR.</li><li>To enable IFIT mapping in the outbound direction, run the <a href="cmdqueryname=ifit+egress+mapping+enable"><b><span class="cmdname">ifit egress mapping enable</span></b></a> command on the ingress ASBR.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You are advised to configure IFIT mapping in the inbound direction and then in the outbound direction. Otherwise, traffic may be interrupted.</p>
</div></div>
</li></ul>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</div>
</div>
</div></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0006.html">Configuring IFIT Application-Level Quality Measurement
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0021_02.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_ifit_cfg_0009.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>