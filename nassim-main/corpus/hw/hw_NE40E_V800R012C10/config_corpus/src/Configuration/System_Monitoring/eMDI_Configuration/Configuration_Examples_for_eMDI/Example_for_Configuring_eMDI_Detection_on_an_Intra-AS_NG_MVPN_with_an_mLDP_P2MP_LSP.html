
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring eMDI Detection on an Intra-AS NG MVPN with an mLDP P2MP LSP">
<meta name="abstract" content="This section provides an example for configuring eMDI detection on an intra-AS NG MVPN to carry multicast traffic over an mLDP P2MP LSP.">
<meta name="description" content="This section provides an example for configuring eMDI detection on an intra-AS NG MVPN to carry multicast traffic over an mLDP P2MP LSP.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_emdi_cfg_0013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2272.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_emdi_cfg_0015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EMDI">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EMDI">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="EMDI">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="EMDI">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00799643">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00799643">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0174621687">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring eMDI Detection on an Intra-AS NG MVPN with an mLDP P2MP LSP</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0174621687"></a><a name="EN-US_TASK_0174621687"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring eMDI Detection on an Intra-AS NG MVPN with an mLDP P2MP LSP</h1>
<div class="taskbody"><p>This section provides an example for configuring eMDI detection on an intra-AS NG MVPN to carry multicast traffic over an mLDP P2MP LSP.</p>
<div class="context"><a name="EN-US_TASK_0174621687__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0174621687__fig_dc_vrp_cfg_ngmvpn_001301">Figure 1</a>, a BGP MPLS/IP VPN over an MPLS LDP LSP is deployed to carry unicast services, and an NG MVPN over an mLDP P2MP LSP is deployed to carry multicast services. In addition, eMDI is deployed on the network to monitor multicast service quality. Network maintenance personnel can check real-time detection results reported through telemetry on the monitor platform, quickly demarcating and locating faults.</p>
<div class="fignone" id="EN-US_TASK_0174621687__fig_dc_vrp_cfg_ngmvpn_001301"><a name="EN-US_TASK_0174621687__fig_dc_vrp_cfg_ngmvpn_001301"></a><a name="fig_dc_vrp_cfg_ngmvpn_001301"></a><span class="figcap"><b>Figure 1 </b>eMDI detection on an intra-AS NG MVPN</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/1/1</span>, and GE <span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0174641116.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0174621687__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a BGP MPLS/IP VPN.</p>
</li><li><p>Enable mLDP globally.</p>
</li><li><p>Configure an NG MVPN.</p>
</li><li><p>Configure eMDI detection.</p>
<ol type="a"><li>Configure eMDI to monitor a channel group.</li><li>Configure eMDI to monitor a board group.</li><li>Bind a channel group to a board group.</li></ol>
</li><li><p>Configure telemetry.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0174621687__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Public network OSPF process ID: 1; area ID: 0 OSPF multi-instance process ID: 2; area ID: 0</p>
</li><li><div class="p">VPN instance name on PE1, PE2, and PE3: VPNA
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Data needed for each device</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.1.2.8.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.1.2.8.1.2" liSelected="liSelected"><p>IP Address of Loopback 1</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.1.2.8.1.3" liSelected="liSelected"><p>MPLS LSR ID</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.1.2.8.1.4" liSelected="liSelected"><p>MVPN ID</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="6.445672191528545%" id="mcps1.4.3.3.2.1.1.2.8.1.5" liSelected="liSelected"><p>RD</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="6.445672191528545%" id="mcps1.4.3.3.2.1.1.2.8.1.6" liSelected="liSelected"><p>VPN Target</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="17.421731123388582%" id="mcps1.4.3.3.2.1.1.2.8.1.7" liSelected="liSelected"><p>AS Number</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.1 "><p>CE1 configuration file</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.2 "><p>1.1.1.1</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.4 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.5 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.6 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.7 "><p>AS65001</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.2 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.3 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.4 "><p>2.2.2.2</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.5 "><p>200:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.6 "><p>3:3 4:4</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.7 "><p>AS100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.2 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.3 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.4 "><p>3.3.3.3</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.5 "><p>300:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.6 "><p>3:3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.7 "><p>AS100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.2 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.3 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.4 "><p>4.4.4.4</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.5 "><p>400:1</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.6 "><p>4:4</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.7 "><p>AS100</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.2 "><p>5.5.5.5</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.4 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.5 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.6 "><p>-</p>
</td>
<td class="cellrowborder" valign="middle" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.7 "><p>AS65002</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.1 "><p>CE3</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.2 "><p>6.6.6.6</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.3 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.4 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.5 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="6.445672191528545%" headers="mcps1.4.3.3.2.1.1.2.8.1.6 "><p>-</p>
</td>
<td class="cellrowborder" valign="top" width="17.421731123388582%" headers="mcps1.4.3.3.2.1.1.2.8.1.7 "><p>AS65003</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</li><li>Channel group names and board group names</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0174621687__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a BGP MPLS/IP VPN.</span><ol type="a"><li class="substepexpand"><span>Assign an IP address to each interface of devices on the backbone network and VPN sites.</span><p><p>Assign an IP address to each interface according to <a href="#EN-US_TASK_0174621687__fig_dc_vrp_cfg_ngmvpn_001301">Figure 1</a>. For configuration details, see <a href="#EN-US_TASK_0174621687__example_dc_vrp_cfg_ngmvpn_001301">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure an IGP to interconnect devices on the backbone network.</span><p><p>OSPF is used in this example. For configuration details, see <a href="#EN-US_TASK_0174621687__example_dc_vrp_cfg_ngmvpn_001301">Configuration Files</a> in this section.</p>
</p></li><li class="substepexpand"><span>Configure basic MPLS functions and MPLS LDP on the backbone network to establish LDP LSPs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Establish an MP-IBGP peer relationship between PEs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 connect-interface LoopBack1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure a VPN instance on each PE so that the CEs can access the PEs.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 3:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>route-distinguisher 400:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>vpn-target 4:4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>ip address 192.168.3.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure an OSPF multi-instance on each PE to import VPN routes.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 2 vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 2 vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-VPNA] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ospf 2 vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-2] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-2-area-0.0.0.0] <strong>network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-VPNA] <strong>import-route ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</p></li><li class="substepexpand"><span>Configure OSPF on each CE.</span><p><ul><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 10.1.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>network 192.168.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>network 10.1.4.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>network 5.5.5.5 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li><p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-2-area-0.0.0.0] <strong>network 192.168.3.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-2-area-0.0.0.0] <strong>network 10.1.5.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-2-area-0.0.0.0] <strong>network 6.6.6.6 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
</li></ul>
<p>After completing the configuration, run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> command on CE2 and CE3. The command outputs show that CE2 and CE3 have routes to CE1. Run the <a href="cmdqueryname=ping"><b><span class="cmdname">ping</span></b></a> command on CE2 and CE3 to ping CE1. The command outputs show that the ping operations are successful. The following example uses the command output on CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 11       Routes : 11

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  OSPF    10   3             D  192.168.3.1     GigabitEthernet<span>0/1/0</span>
        6.6.6.6/32  Direct  0    0             D  127.0.0.1       LoopBack1
       10.1.3.0/24  OSPF    10   4             D  192.168.3.1     GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct  0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0
    192.168.1.0/24  OSPF    10   3             D  192.168.3.1     GigabitEthernet<span>0/1/0</span>
    192.168.3.0/24  Direct  0    0             D  192.168.3.2     GigabitEthernet<span>0/1/0</span>
    192.168.3.2/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
    192.168.3.3/32  Direct  0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct  0    0             D  127.0.0.1       InLoopBack0  </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>ping 1.1.1.1</strong></pre>
<pre class="screen">  PING 1.1.1.1: 56  data bytes, press CTRL_C to break
    Reply from 1.1.1.1: bytes=56 Sequence=1 ttl=253 time=118 ms
    Reply from 1.1.1.1: bytes=56 Sequence=2 ttl=253 time=3 ms
    Reply from 1.1.1.1: bytes=56 Sequence=3 ttl=253 time=4 ms
    Reply from 1.1.1.1: bytes=56 Sequence=4 ttl=253 time=3 ms
    Reply from 1.1.1.1: bytes=56 Sequence=5 ttl=253 time=3 ms

  --- 1.1.1.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 3/26/118 ms                     </pre>
</p></li></ol>
</li><li><span>Enable mLDP globally.</span><p><ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp] <strong>quit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp] <strong>quit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-mpls-ldp] <strong>quit</strong></pre>
</li></ul>
</p></li><li><span>Configure an NG MVPN.</span><p><ul><li>Establish a BGP MVPN peer relationship between the PEs.<ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-mvpn] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp-af-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp] <strong>quit</strong></pre>
<p>After the configuration is complete, run the <a href="cmdqueryname=display+bgp+mvpn+all+peer"><b><span class="cmdname">display bgp mvpn all peer</span></b></a> command on the PEs. The command output shows that PE1 has established a BGP MVPN peer relationship with PE2 and PE3. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp mvpn all peer</strong></pre>
<pre class="screen"> BGP local router ID : 10.1.2.1
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.3         4         100       43       42     0 00:29:28 <strong>Established</strong>        2
  4.4.4.4         4         100       32       35     0 00:21:59 <strong>Established</strong>        1  </pre>
</li></ul>
</li><li>Configure each PE to use mLDP to establish an S-PMSI tunnel.<ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>multicast mvpn 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>sender-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>ipmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>mldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-ipmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>spmsi-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>group 224.0.0.0 255.255.255.0 mldp limit 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn-spmsi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>multicast mvpn 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>multicast mvpn 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>ip vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>mvpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>c-multicast signaling bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>rpt-spt mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4-mvpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vpn-instance-VPNA] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p>After completing the configuration, run the <a href="cmdqueryname=display+mvpn+vpn-instance+ipmsi"><b><span class="cmdname">display mvpn vpn-instance ipmsi</span></b></a> command on the PEs to check I-PMSI tunnel information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mvpn vpn-instance VPNA ipmsi</strong></pre>
<pre class="screen">MVPN local i-PMSI information for VPN-Instance: VPNA
Tunnel type: mLDP P2MP LSP
<span>Tunnel state: Up</span>
Root-ip: 2.2.2.2
Opaque value: 0x01000400008021
Root: 2.2.2.2 (local)
Leaf:
  1: 3.3.3.3
  2: 4.4.4.4</pre>
<p>The command output shows that an mLDP P2MP LSP has been established, with PE1 as the root node and PE2 and PE3 as leaf nodes.</p>
</li></ul>
</li><li>Configure PIM.<ul><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</li><li># Configure PE3.<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li><li># Configure CE3.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>multicast routing-enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
</li></ul>
</li><li>Configure IGMP.<ul><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>igmp version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</li><li># Configure CE3.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>pim sm</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>igmp enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>igmp version 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</li></ul>
</li><li>Configure a static RP.<ul><li><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-pim] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-pim] <strong>quit</strong></pre>
</li><li><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-pim] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-pim] <strong>quit</strong></pre>
</li><li><p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>pim</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-pim] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-pim] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-pim] <strong>quit</strong></pre>
</li><li><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-VPNA] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pim-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-pim-VPNA] <strong>quit</strong></pre>
</li><li><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-VPNA] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pim-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-pim-VPNA] <strong>quit</strong></pre>
</li><li><p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>pim vpn-instance VPNA</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pim-VPNA] <strong>static-rp 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pim-VPNA] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-pim-VPNA] <strong>quit</strong></pre>
</li></ul>
</li></ul>
</p><p><p>After the configurations are complete, NG MVPN functions have been configured. If CE2 or CE3 has access users, CE1 can use the BGP MPLS/IP VPN to forward multicast data to the users. Configure users on CE2 or CE3 to send IGMPv3 Report messages and the multicast source 10.1.3.1 to send multicast data. Then, check multicast routing entries to verify whether the NG MVPN is configured successfully.</p>
<p>Run the <a href="cmdqueryname=display+pim+routing-table"><b><span class="cmdname">display pim routing-table</span></b></a> command on CE2, CE3, and CE1 to check the PIM routing table. Run the <a href="cmdqueryname=display+pim+vpn-instance"><b><span class="cmdname">display pim vpn-instance</span></b></a> <strong><span>routing-table</span></strong> command on PE2, PE3, and PE1 to check the PIM routing table of the VPN instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.1.3.1, 225.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT SG_RCVR ACT
     UpTime: 00:54:11
     Upstream interface: GigabitEthernet<span>0/1/0</span>
         Upstream neighbor: 192.168.2.1
         RPF prime neighbor: 192.168.2.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: igmp, UpTime: 00:54:11, Expires: -</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.1.3.1, 226.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT SG_RCVR ACT
     UpTime: 00:01:57
     Upstream interface: GigabitEthernet<span>0/1/0</span>
         Upstream neighbor: 192.168.3.1
         RPF prime neighbor: 192.168.3.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: igmp, UpTime: 00:01:57, Expires: - </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.1.3.1, 225.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT ACT
     UpTime: 00:48:18
     Upstream interface: through-BGP
         Upstream neighbor: 2.2.2.2
         RPF prime neighbor: 2.2.2.2
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:48:18, Expires: 00:03:12     </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 1 (S, G) entry

 (10.1.3.1, 226.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT ACT
     UpTime: 00:02:06
     Upstream interface: through-BGP
         Upstream neighbor: 2.2.2.2
         RPF prime neighbor: 2.2.2.2
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:02:06, Expires: 00:03:26 </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display pim vpn-instance VPNA routing-table</strong></pre>
<pre class="screen"> VPN-Instance: VPNA
 Total 0 (*, G) entry; 2 (S, G) entries

 (10.1.3.1, 225.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT SG_RCVR ACT
     UpTime: 00:46:58
     Upstream interface: GigabitEthernet<span>0/1/1</span>
         Upstream neighbor: 192.168.1.1
         RPF prime neighbor: 192.168.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: pseudo
             Protocol: BGP, UpTime: 00:46:58, Expires: -

 (10.1.3.1, 226.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT SG_RCVR ACT
     UpTime: 00:00:23
     Upstream interface: GigabitEthernet<span>0/1/1</span>
         Upstream neighbor: 192.168.1.1
         RPF prime neighbor: 192.168.1.1
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: pseudo
             Protocol: BGP, UpTime: 00:00:26, Expires: - </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display pim routing-table</strong></pre>
<pre class="screen"> VPN-Instance: public net
 Total 0 (*, G) entry; 2 (S, G) entries

 (10.1.3.1, 225.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT LOC ACT
     UpTime: 00:47:29
     Upstream interface: GigabitEthernet<span>0/1/0</span>
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:47:29, Expires: 00:03:03

 (10.1.3.1, 226.1.1.1)
     RP:1.1.1.1
     Protocol: pim-sm, Flag: SPT LOC ACT
     UpTime: 00:00:54
     Upstream interface: GigabitEthernet<span>0/1/0</span>
         Upstream neighbor: NULL
         RPF prime neighbor: NULL
     Downstream interface(s) information:
     Total number of downstreams: 1
        1: GigabitEthernet<span>0/1/1</span>
             Protocol: pim-sm, UpTime: 00:00:54, Expires: 00:02:36  </pre>
<p>The command outputs show that CE1 connecting to the multicast source has received PIM Join messages from CE2 and CE3 connecting to multicast receivers and that CE1 has generated PIM routing entries.</p>
</p></li><li><span>Configure eMDI detection.</span><p><div class="p">Configure eMDI detection on PE1, PE2, and PE3.<ul><li>Configure eMDI to monitor a channel group.<ul><li><div class="p"># Configure PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>emdi</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi] <strong>emdi channel-group PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi-channel-group-PE1] <strong>emdi channel 1 source 10.1.3.1 group 225.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi-channel-group-PE1] <strong>emdi channel 2 source 10.1.3.1 group 226.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi-channel-group-PE1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
</li><li># Configure PE2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>emdi</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-emdi] <strong>emdi channel-group PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-emdi-channel-group-PE2] <strong>emdi channel 1 source 10.1.3.1 group 225.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-emdi-channel-group-PE2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-emdi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li><li># Configure PE3.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>emdi</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-emdi] <strong>emdi channel-group PE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-emdi-channel-group-PE3] <strong>emdi channel 2 source 10.1.3.1 group 226.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-emdi-channel-group-PE3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-emdi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</li></ul>
</li><li>Configure eMDI to monitor a board group.<div class="p">The following uses PE1 as an example. The configurations of PE2 and PE3 are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0174621687__example_dc_vrp_cfg_ngmvpn_001301">Configuration Files</a> in this section.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>emdi</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi] <strong>emdi lpu-group PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi-lpu-group-PE1] <strong>emdi bind slot all</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi-lpu-group-PE1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
</li><li>Bind a channel group to a board group.<p>The following uses PE1 as an example. The configurations of PE2 and PE3 are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0174621687__example_dc_vrp_cfg_ngmvpn_001301">Configuration Files</a> in this section.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>emdi</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi] <strong>emdi bind channel-group PE1 lpu-group PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-emdi] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>After completing the configuration, run the <strong>display emdi statistics history channel</strong> command to check the detection result when multicast traffic passes through PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display emdi statistics history channel 1 start 3 end 5</strong></pre>
<pre class="screen">Channel Name   : 1 
Total Records  : 3         Latest Rate(pps) : 0                   Latest Detect Time : 2021-02-18 21:22:40
---------------------------------------------------------------------------------------------------------------------------------------------------------
 Record          Record        Monitor     Monitor    Received      Rate         Rate         RTP-LC       RTP-SE       RTP-LR       RTP-SER        RTP   
 Index           Time         Period(s)    Status     Packets       pps          bps                                   (1/100000)   (1/100000)    Jitter(ms)
---------------------------------------------------------------------------------------------------------------------------------------------------------
 3        2019-02-02:08-33-00     60      Normal      4393232      439323     4871215641       6700          6633         152           151           0         
 4        2019-02-02:08-32-00     60      Normal      4388533      438853     4866005390       6700          6633         152           151           0         
 5        2019-02-02:08-31-00     60      Normal      4388218      438821     4865656118       6700          6633         152           151           0         
---------------------------------------------------------------------------------------------------------------------------------------------------------</pre>
<p></p>
</li></ul>
</div>
</p></li><li><span>Configure telemetry.</span><p><p>The following uses PE1 as an example. The configurations of PE2 and PE3 are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0174621687__example_dc_vrp_cfg_ngmvpn_001301">Configuration Files</a> in this section (Only key configurations are provided here. For details, see Telemetry Configuration).</p>
<ul><li>Configure a destination collector.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>telemetry</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry] <strong>destination-group Monitor</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-destination-group-Monitor] <strong>ipv4-address 10.1.6.2 port 10001 protocol grpc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-destination-group-Monitor] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry-destination-group-Monitor] <strong>quit</strong></pre>
</li><li>Configure a sampling path.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry] <strong>sensor-group emdimonitor</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-emdimonitor] <strong>sensor-path huawei-emdi:emdi/emdi-telem-reps/emdi-telem-rep</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-emdimonitor] <strong>sensor-path huawei-emdi:emdi/emdi-telem-rtps/emdi-telem-rtp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-sensor-group-emdimonitor] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry-sensor-group-emdimonitor] <strong>quit</strong></pre>
</li><li>Create a static subscription.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-telemetry] <strong>subscription PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-PE1] <strong>sensor-group emdimonitor</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-PE1] <strong>destination-group Monitor</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-telemetry-subscription-PE1] <strong>commit</strong></pre>
</li></ul>
<p>After completing the configuration, check the eMDI detection result reported through telemetry on the monitor platform.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0174621687__example_dc_vrp_cfg_ngmvpn_001301"><a name="EN-US_TASK_0174621687__example_dc_vrp_cfg_ngmvpn_001301"></a><a name="example_dc_vrp_cfg_ngmvpn_001301"></a><a name="EN-US_TASK_0174621687__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 2
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 192.168.1.0 0.0.0.255
#
pim
 static-rp 1.1.1.1
#
return
</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
multicast mvpn 2.2.2.2
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 200:1
  vpn-target 3:3 4:4 export-extcommunity
  vpn-target 3:3 4:4 import-extcommunity
  multicast routing-enable
  mvpn
   sender-enable
   c-multicast signaling bgp
   rpt-spt mode
   ipmsi-tunnel
    mldp
   spmsi-tunnel
    group 224.0.0.0 255.255.255.0 mldp limit 1
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
 mldp p2mp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.1.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 ipv4-family vpn-instance VPNA
  import-route ospf 2
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.2.0 0.0.0.255
#
ospf 2 vpn-instance VPNA
 import-route bgp
 area 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
pim vpn-instance VPNA
 static-rp 1.1.1.1
#
emdi
 emdi channel-group PE1
  emdi channel 1 source 10.1.3.1 group 225.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz
  emdi channel 2 source 10.1.3.1 group 226.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz
 emdi lpu-group _default_
  emdi bind slot all
 emdi lpu-group PE1
  emdi bind slot all
 emdi bind channel-group PE1 lpu-group PE1
#
telemetry
 #
 sensor-group emdimonitor
  sensor-path huawei-emdi:emdi/emdi-telem-reps/emdi-telem-rep
  sensor-path huawei-emdi:emdi/emdi-telem-rtps/emdi-telem-rtp
#
 destination-group Monitor
  ipv4-address 10.1.6.2 port 10001 protocol grpc
 #
 subscription PE1
  sensor-group emdimonitor
  destination-group Monitor
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.4.1 255.255.255.0
 pim sm
 igmp enable
 igmp version 3
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
ospf 2
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 10.1.4.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
pim
 static-rp 1.1.1.1
#

return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
multicast mvpn 3.3.3.3
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 300:1
  vpn-target 3:3 export-extcommunity
  vpn-target 3:3 import-extcommunity
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
 mldp p2mp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.6.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.2.1 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance VPNA
  import-route ospf 2
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.1.6.0 0.0.0.255
#
ospf 2 vpn-instance VPNA
 import-route bgp
 area 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
pim vpn-instance VPNA
 static-rp 1.1.1.1
#
emdi
 emdi channel-group PE2
  emdi channel 1 source 10.1.3.1 group 225.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz
 emdi lpu-group _default_
  emdi bind slot all
 emdi lpu-group PE2
  emdi bind slot all
 emdi bind channel-group PE2 lpu-group PE2
#
telemetry
 #
 sensor-group emdimonitor
  sensor-path huawei-emdi:emdi/emdi-telem-reps/emdi-telem-rep
  sensor-path huawei-emdi:emdi/emdi-telem-rtps/emdi-telem-rtp
#
 destination-group Monitor
  ipv4-address 10.1.6.2 port 10001 protocol grpc
 #
 subscription PE2
  sensor-group emdimonitor
  destination-group Monitor
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
multicast routing-enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.0
 pim sm
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.5.1 255.255.255.0
 pim sm
 igmp enable
 igmp version 3
#
interface LoopBack1
 ip address 6.6.6.6 255.255.255.255
#
ospf 2
 area 0.0.0.0
  network 6.6.6.6 0.0.0.0
  network 10.1.5.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
#
pim
 static-rp 1.1.1.1
#
return </pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
multicast mvpn 4.4.4.4
#
ip vpn-instance VPNA
 ipv4-family
  route-distinguisher 400:1
  vpn-target 4:4 export-extcommunity
  vpn-target 4:4 import-extcommunity
  multicast routing-enable
  mvpn
   c-multicast signaling bgp
   rpt-spt mode
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls ldp
 mldp p2mp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance VPNA
 ip address 192.168.3.1 255.255.255.0
 pim sm
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family mvpn
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance VPNA
  import-route ospf 2
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.1.2.0 0.0.0.255
#
ospf 2 vpn-instance VPNA
 import-route bgp
 area 0.0.0.0
  network 192.168.3.0 0.0.0.255
#
pim vpn-instance VPNA
 static-rp 1.1.1.1
#
emdi
 emdi channel-group PE3
  emdi channel 1 source 10.1.3.1 group 226.1.1.1 vpn-instance VPNA pt 33 clock-rate 90kHz
 emdi lpu-group _default_
  emdi bind slot all
 emdi lpu-group PE3
  emdi bind slot all
 emdi bind channel-group PE3 lpu-group PE3
#
telemetry
 #
 sensor-group emdimonitor
  sensor-path huawei-emdi:emdi/emdi-telem-reps/emdi-telem-rep
  sensor-path huawei-emdi:emdi/emdi-telem-rtps/emdi-telem-rtp
#
 destination-group Monitor
  ipv4-address 10.1.6.2 port 10001 protocol grpc
 #
 subscription PE3
  sensor-group emdimonitor
  destination-group Monitor
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_emdi_cfg_0013.html">Configuration Examples for eMDI
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_multicast_cfg_2272.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_emdi_cfg_0015.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>