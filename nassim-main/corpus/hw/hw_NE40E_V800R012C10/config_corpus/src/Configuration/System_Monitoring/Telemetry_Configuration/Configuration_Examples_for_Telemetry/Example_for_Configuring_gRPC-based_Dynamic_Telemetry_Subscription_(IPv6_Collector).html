
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring gRPC-based Dynamic Telemetry Subscription (IPv6 Collector)">
<meta name="abstract" content="This section provides an example for configuring dynamic telemetry subscription using gRPC to send sampled data in a scenario where an IPv6 destination collector is deployed.">
<meta name="description" content="This section provides an example for configuring dynamic telemetry subscription using gRPC to send sampled data in a scenario where an IPv6 destination collector is deployed.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_telemetry_cfg_0019.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_telemetry_cfg_00183.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitor">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitor">
<meta name="featurename" content="Telemetry">
<meta name="featuretype" content="System Monitor">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00799643">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0175158822">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring gRPC-based Dynamic Telemetry Subscription (IPv6 Collector)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0175158822"></a><a name="EN-US_TASK_0175158822"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring gRPC-based Dynamic Telemetry Subscription (IPv6 Collector)</h1>
<div class="taskbody"><p>This section provides an example for configuring dynamic telemetry subscription using gRPC to send sampled data in a scenario where an IPv6 destination collector is deployed.</p>
<div class="context"><a name="EN-US_TASK_0175158822__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As the network scale increases, users need to optimize networks and rectify faults based on device information. For example, if a user wants to monitor an interface for a period of time, dynamic telemetry subscription can be configured. To stop monitoring, tear down the connection. The subscription is automatically canceled and cannot be restored. This avoids long-term loads on devices and simplifies the interaction between users and devices.</p>
<p>On the network shown in <a href="#EN-US_TASK_0175158822__fig_dc_vrp_telemetry_cfg_001801">Figure 1</a>, telemetry-capable DeviceA establishes a gRPC connection with the collector. It is required that <span>interface1</span> of DeviceA be monitored and data be sent to the collector as required.</p>
<p>DeviceA communicates with the collector using an IPv6 address.</p>
<div class="fignone" id="EN-US_TASK_0175158822__fig_dc_vrp_telemetry_cfg_001801"><a name="EN-US_TASK_0175158822__fig_dc_vrp_telemetry_cfg_001801"></a><a name="fig_dc_vrp_telemetry_cfg_001801"></a><span class="figcap"><b>Figure 1 </b>Configuring gRPC-based dynamic telemetry subscription</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 and 2 represent <span>GE</span><span>0/1/1</span> and <span>GE</span><span>0/1/2</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0175163847.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0175158822__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Create a local user, and add the user to the administrator group. Configure a service type for the user.</li><li>Configure an SSL policy.</li><li><p>Configure the gRPC IPv6 server function.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0175158822__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IPv6 address of <span>interface1</span> to be listened for: 2001:db8:4::1 (<span>interface1</span> on DeviceA and the collector must be routable.)</p>
</li><li><p>Number of the port to be listened for: 20000</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0175158822__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and a routing protocol for each interface so that all devices can communicate at the network layer. (The configuration details are not provided here.)</span></li><li><span>Create a local user, and add the user to the administrator group. Configure a service type for the user.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname DeviceA</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>local-user hhww123 password</strong></pre>
<pre class="screen">Please configure the password (8-128)
Enter Password:
Confirm Password:</pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-aaa] <strong>local-user hhww123 service-type http</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-aaa] <strong>local-user hhww123 user-group manage-ug</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure an SSL policy.</span><p><p># Configure a PKI domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>pki domain</strong> <strong>domain1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-pki-domain-domain1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-pki-domain-domain1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>pki import-certificate ca domain domain1 filename test.crt</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The CA certificate is used as an example. During the actual configuration, you need to replace <strong>ca</strong> and <strong>test.crt</strong> with the existing certificate type and name on the device. You can directly upload the certificate to the device for installation, or apply for and download the certificate for installation. For details, see "Obtaining a Certificate" in <em>PKI Configuration</em>.</p>
</div></div>
<p># Configure an SSL policy and bind it to the PKI domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>ssl policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ssl-policy-policy1] <strong>pki-domain domain1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-ssl-policy-policy1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-ssl-policy-policy1] <strong>quit</strong></pre>
</p></li><li><span>Configure the gRPC IPv6 server function.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA] <strong>interface </strong><span><strong>GigabitEthernet</strong></span><strong><span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>DeviceA-<span>GigabitEthernet</span><span>0/1/1</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-<span>GigabitEthernet</span><span>0/1/1</span>] <strong>ipv6 address 2001:db8:4::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-<span>GigabitEthernet</span><span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>ipv6 route-static 2001:db8:3:: 64 <span>GigabitEthernet</span><span>0/1/1</span> 2001:db8:4::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA] <strong>grpc</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-grpc] <strong>grpc server</strong> <strong>ipv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-grpc-server-ipv6] <strong>source-ip 2001:db8:4::1</strong></pre>
</p><p><pre class="screen">[<span class="keyword">*</span>DeviceA-grpc-server-ipv6] <strong>server-port 20000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-grpc-server-ipv6] <strong>ssl-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-grpc-server-ipv6] <strong>ssl-verify peer</strong></pre>
</p><p><pre class="screen">[<span class="keyword">*</span>DeviceA-grpc-server-ipv6] <strong>server enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>DeviceA-grpc-server-ipv6] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0175158822__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p>DeviceA configuration file</p>
<pre class="screen">#
sysname DeviceA
#
aaa
  local-user hhww123 password irreversible-cipher $1c$%L%X:Jn3hY$5^%T5I\4HG&gt;j|i<font style="font-size:8pt" Face="Courier New" >~</font>s,{.@FpH*2XGM\R;7#$"\i!L0$
  local-user hhww123 service-type http
  local-user hhww123 user-group manage-ug
#
interface <span>GigabitEthernet</span><span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:4::1/64
#
ipv6 route-static 2001:DB8:3:: 64 <span>GigabitEthernet</span><span>0/1/1</span> 2001:DB8:4::2
#
ssl policy policy1
 pki-domain domain1
#
grpc
 #
 grpc server ipv6
  source-ip 2001:DB8:4::1
  server-port 20000
  ssl-policy policy1
  ssl-verify peer
  server enable
#
pki domain domain1
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_telemetry_cfg_0019.html">Configuration Examples for Telemetry
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_telemetry_cfg_00183.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>