
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Interworking Between LDP VPLS and BGP AD VPLS in HVPLS Mode">
<meta name="abstract" content="This section provides an example for interworking between LDP VPLS and BGP AD VPLS in HVPLS mode.">
<meta name="description" content="This section provides an example for interworking between LDP VPLS and BGP AD VPLS in HVPLS mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5062.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5069.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370272">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Interworking Between LDP VPLS and BGP AD VPLS in HVPLS Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370272"></a><a name="EN-US_TASK_0172370272"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Interworking Between LDP VPLS and BGP AD VPLS in HVPLS Mode</h1>
<div class="taskbody"><p>This section provides an example for interworking between LDP VPLS and BGP AD VPLS in HVPLS mode.</p>
<div class="context"><a name="EN-US_TASK_0172370272__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370272__fig_dc_vrp_vpls_cfg_506801">Figure 1</a>, PE3, PE4, and PE5 need to be fully meshed using BGP AD VPLS connections. LDP VPLS needs to be deployed between PE1 and PE2. PE1 and PE2 support only LDP VPLS, and PE3 supports both LDP VPLS and BGP AD VPLS. It is required that CE1 and CE2 be able to communicate with each other, and PE1 and PE2 serve as UPEs to access PE3 in HVPLS mode.</p>
<div class="p">The specific PW deployment requirements are as follows:<ul><li>Establish an LDP hub PW from PE1 to PE2 and from PE1 to PE3.</li><li>Establish an LDP hub PW from PE2 to PE1 and from PE2 to PE3.</li><li>Establish an LDP spoke PW from PE3 to PE1 and from PE3 to PE2. Establish a BGP AD hub PW from PE3 to PE4 and from PE3 to PE5.</li><li>Establish a BGP AD hub PW from PE4 to PE3 and from PE4 to PE5.</li><li>Establish a BGP AD hub PW from PE5 to PE3 and from PE5 to PE4.</li></ul>
</div>
<p>Because traffic can be forwarded between spoke PWs, traffic may loop among PE1, PE2, and PE3. To prevent traffic loops, configure on PE3 traffic isolation between spoke PWs.</p>
<div class="fignone" id="EN-US_TASK_0172370272__fig_dc_vrp_vpls_cfg_506801"><a name="EN-US_TASK_0172370272__fig_dc_vrp_vpls_cfg_506801"></a><a name="fig_dc_vrp_vpls_cfg_506801"></a><span class="figcap"><b>Figure 1 </b>Interworking between LDP VPLS and BGP AD VPLS in HVPLS mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>In this example, interface1 represents GE<span>0/1/2</span>.</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_506801.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP address list</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="33.33333333333333%" id="mcps1.4.1.6.2.4.1.1" liSelected="liSelected"><p><strong>Device</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="33.33333333333333%" id="mcps1.4.1.6.2.4.1.2" liSelected="liSelected"><p><strong>Interface</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="33.33333333333333%" id="mcps1.4.1.6.2.4.1.3" liSelected="liSelected"><p><strong>IP Address</strong></p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.5.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p>PE4</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.6.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.5.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p>PE5</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.6.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>5.5.5.5/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.10.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="33.33333333333333%" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE<span>0/1/2</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.10.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370272__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure an IP address and a routing protocol for each involved interface so that PEs can communicate at the network layer. This example uses OSPF as the routing protocol.</li><li><p>Configure MPLS and public network tunnels to carry PWs. In this example, LDP LSPs are used between PEs.</p>
</li><li><p>Configure LDP VPLS among PE1, PE2, and PE3.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>When you configure LDP PWs on PE3, specify peers as UPEs for the PWs to function as spoke PWs. Then, configure traffic isolation between spoke PWs.</p>
</div></div>
</li><li><p>Configure BGP AD VPLS among PE3, PE4, and PE5.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370272__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address, OSPF process ID (1), and OSPF area ID (0) of each interface, and LSR ID of each PE</p>
</li><li><p>Virtual switch instance (VSI) name, VSI ID, VPLS ID, virtual private network (VPN) targets, and BGP AS number</p>
</li><li><p>Number and virtual local area network (VLAN) ID of each interface bound to a VSI</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370272__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and a routing protocol for each involved interface on the backbone network so that PEs can communicate at the network layer.</span><p><p>OSPF is used in this example. For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on PEs. The command output shows that the PEs have learned each other's loopback interface address.</p>
</p></li><li><span>Configure MPLS and public network tunnels.</span><p><p>This example uses LDP LSPs as public network tunnels. For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on PEs. The status of the peer relationship between PEs is <strong>Operational</strong>, indicating that the peer relationship has been established. Run the <strong>display mpls lsp</strong> command. The command output shows whether LSPs have been set up.</p>
</p></li><li><span>Configure LDP VPLS among PE1, PE2, and PE3.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">&lt;PE3&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>peer 2.2.2.2 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>isolate spoken</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Bind the AC interface to the VSI on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure BGP AD VPLS among PE3, PE4, and PE5.</span><p><ol type="a"><li><p>Enable BGP peers to exchange VPLS member information.</p>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 4.4.4.4 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 5.5.5.5 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure PE4.</p>
<pre class="screen">&lt;PE4&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 3.3.3.3 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 5.5.5.5 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 5.5.5.5 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>peer 5.5.5.5 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
<p># Configure PE5.</p>
<pre class="screen">&lt;PE5&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE5] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp] <strong>peer 3.3.3.3 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp] <strong>peer 4.4.4.4 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp-af-l2vpn-ad] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp-af-l2vpn-ad] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5] <strong>commit</strong></pre>
</li><li><p>Configure VSIs with BGP AD signaling.</p>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>vpls-id 192.168.0.0:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>On PE3, the LDP and BGP AD PWs must be configured in the same VSI.</p>
</div></div>
<p># Configure PE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>vpls-id 192.168.0.0:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
<p># Configure PE5.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE5] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-vsi-vsi1--bgpad] <strong>vpls-id 192.168.0.0:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-vsi-vsi1--bgpad] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-vsi-vsi1--bgpad] <strong>vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-vsi-vsi1--bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5] <strong>commit</strong></pre>
</li><li><p># Bind the AC interface to the VSI on PE5.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE5] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-GigabitEthernet<span>0/1/2</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE5] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>.1] <strong>ip address 192.168.10.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;CE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>.1] <strong>ip address 192.168.10.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration. Ping CE2 from CE1. The command output shows that the ping is successful.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 192.168.10.2</strong></pre>
<pre class="screen">  PING 192.168.10.2: 56  data bytes, press CTRL_C to break
    Reply from 192.168.10.2: bytes=56 Sequence=1 ttl=255 time=190 ms
    Reply from 192.168.10.2: bytes=56 Sequence=2 ttl=255 time=190 ms
    Reply from 192.168.10.2: bytes=56 Sequence=3 ttl=255 time=140 ms
    Reply from 192.168.10.2: bytes=56 Sequence=4 ttl=255 time=140 ms
    Reply from 192.168.10.2: bytes=56 Sequence=5 ttl=255 time=110 ms

  --- 192.168.10.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 110/154/190 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370272__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1
  peer 3.3.3.3
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe
  peer 2.2.2.2 upe
 bgp-ad
  vpls-id 192.168.0.0:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
 isolate spoken
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.4.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 192.168.5.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 4.4.4.4 enable
  peer 5.5.5.5 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 4.4.4.4 enable
  peer 5.5.5.5 enable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.2.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
  network 192.168.4.0 0.0.0.255
  network 192.168.5.0 0.0.0.255
#
return</pre>
</li><li><p>PE4 configuration file</p>
<pre class="screen">#
sysname PE4
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls l2vpn
#
vsi vsi1
 bgp-ad
  vpls-id 192.168.0.0:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
#
mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.6.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 192.168.5.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 5.5.5.5 as-number 100
 peer 5.5.5.5 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 3.3.3.3 enable
  peer 5.5.5.5 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 3.3.3.3 enable
  peer 5.5.5.5 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.5.0 0.0.0.255
  network 192.168.6.0 0.0.0.255
#
return</pre>
</li><li><p>PE5 configuration file</p>
<pre class="screen">#
sysname PE5
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls l2vpn
#
vsi vsi1
 bgp-ad
  vpls-id 192.168.0.0:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.4.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.6.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface LoopBack0
 ip address 5.5.5.5 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 192.168.4.0 0.0.0.255
  network 192.168.6.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 ip address 192.168.10.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 ip address 192.168.10.2 255.255.255.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5062.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5069.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>