
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an MCE">
<meta name="abstract" content="OSPF multi-instance can be configured on a CE to isolate different types of services on a LAN.">
<meta name="description" content="OSPF multi-instance can be configured on a CE to isolate different types of services on a LAN.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2060.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0310.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369543">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an MCE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369543"></a><a name="EN-US_TASK_0172369543"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an MCE</h1>
<div class="taskbody"><p>OSPF multi-instance can be configured on a CE to isolate different types of services on a LAN.</p>
<div class="context"><a name="EN-US_TASK_0172369543__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><div class="p">Branch A at site 1 and branch B at site 2 need to communicate with the HQ over the carrier backbone network. Branches A and B are responsible for different types of services and need to access service-related departments or servers in different areas of the headquarters. In this example, the services in branches A and B need to be isolated. If the traditional BGP/MPLS IP VPN technology is used, branches A and B each require a CE to be deployed at the HQ. This deployment is expensive. To resolve this issue, deploy a multi-VPN-instance CE (MCE) at the HQ to connect to the sites of different VPNs, as shown in <a href="#EN-US_TASK_0172369543__fig_dc_vrp_mpls-l3vpn-v4_cfg_012201">Figure 1</a>.<ul><li><p>CE1 in branch A and CE2 in branch B belong to vpna and vpnb, respectively.</p>
</li><li><p>The MCE connects to the sites on vpna and vpnb at the headquarters.</p>
</li><li><p>vpna and vpnb use different VPN targets.</p>
</li><li><p>The headquarters use <span class="keyword">Device</span> A and <span class="keyword">Device</span> B to communicate with branches A and B, respectively.</p>
</li></ul>
</div>
<p>This configuration ensures that users on the same VPN can communicate with each other and that users on different VPNs cannot communicate with each other.</p>
<div class="fignone" id="EN-US_TASK_0172369543__fig_dc_vrp_mpls-l3vpn-v4_cfg_012201"><a name="EN-US_TASK_0172369543__fig_dc_vrp_mpls-l3vpn-v4_cfg_012201"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_012201"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring an MCE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>interface1, interface2, interface3, and interface4 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/3/0</span>, and GE<span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_012201.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369543__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When configuring an MCE, note the following:</p>
<ul><li><p>Different VPN instances must be configured on the MCE and bound to different interfaces.</p>
</li><li><p>Routing loop detection must be disabled on the MCE so that the MCE exchanges routing information with the PEs using OSPF multi-instance.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369543__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure OSPF on PEs and enable MP-IBGP on the PEs to exchange VPN routing information.</p>
</li><li><p>Establish EBGP peer relationships between PEs and CEs to import VPN routes into the PEs' VRF tables.</p>
</li><li><p>Configure OSPF multi-instance on the MCE and PE2 to exchange VPN routing information.</p>
</li><li><p>Configure RIPv2 on the MCE, <span class="keyword">Device</span>A, and <span class="keyword">Device</span>B to exchange VPN routing information.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configuring OSPF multi-instance on the MCE and PE2 includes the following configurations:</p>
<ul><li><p>Import BGP routes to PE2's OSPF process in which OSPF multi-instance is configured on the MCE and PE2. Then advertise PE1's VPN routes to the MCE.</p>
</li><li><p>Import all routes to PE2's OSPF process in which OSPF multi-instance is configured on the MCE and PE2, in PE2's BGP-VPN instance IPv4 address family view. Then advertise MCE's VPN routes to PE1.</p>
</li></ul>
</div></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369543__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VPN instances on PE1 and PE2 (vpna and vpnb), the MCE for each service, vpna's import and export VPN targets (111:1), and vpnb's import and export VPN targets (222:2)</p>
</li><li><p>vpna's OSPF process ID (100) and vpnb's OSPF process ID (200)</p>
</li><li><p>vpna's RIP process ID (100) and vpnb's RIP process ID (200) used for importing VPN routes of sites 3 and 4 on the MCE</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369543__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable OSPF on the PEs on the backbone network to ensure that the PEs interwork with each other.</span><p><p>For configuration details, see the configuration files.</p>
<p>After the configurations are complete, the PEs can learn the address of each other's Loopback1 interface.</p>
<p>The following example uses the command output on PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 9        Routes : 9

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  OSPF   10   1             D  172.16.1.1      GigabitEthernet<span>0/1/0</span>
        2.2.2.2/32  Direct 0    0             D  127.0.0.1       LoopBack1
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
     172.16.1.0/24  Direct 0    0             D  172.16.1.2      GigabitEthernet<span>0/1/0</span>
     172.16.1.2/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   172.16.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure MPLS and MPLS LDP both globally and per interface on each node of the backbone network. Then establish LDP LSPs between PEs.</span><p><p>For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display mpls ldp session</strong> command on PEs. The command output shows that an MPLS LDP session has been established between the PEs and its status is <strong>Operational</strong>.</p>
<p>The following example uses the command output on PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
--------------------------------------------------------------------------
 PeerID             Status       LAM  SsnRole  SsnAge       KASent/Rcv
--------------------------------------------------------------------------
 1.1.1.1:0          <strong>Operational</strong> DU  Active  0001:16:01  9608/9608
--------------------------------------------------------------------------
TOTAL: 1 Session(s) Found.</pre>
</p></li><li><span>Configure VPN instances on PE1 and PE2, bind the VPN instances on PE1 to PE1's interfaces connected to CE1 and CE2, and bind the VPN instances on PE2 to PE2's interfaces connected to the MCE.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv4] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv4] <strong>vpn-target 222:2 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpnb] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpnb-af-ipv4] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpnb-af-ipv4] <strong>vpn-target 222:2 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpnb-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpnb] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.5.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong>interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>ip binding vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.5.2.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure VPN instances on the MCE and bind the VPN instances to the MCE's interfaces connected to Site3, Site4, and PE2.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname MCE</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>ip vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpnb] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpnb-af-ipv4] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpnb-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-vpn-instance-vpnb] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/3/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.4.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.5.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/2/0</span>] <strong>ip</strong> <strong>address 10.5.2.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>commit</strong></pre>
</p></li><li><span>Establish an MP-IBGP peer relationship between the PEs, and establish EBGP peer relationships between PE1 and CE1 and between PE1 and CE2.</span><p><p>For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display bgp vpnv4 all peer</strong> command on PE1. The command output shows that IBGP peer relationships have been established between PE1 and PE2 and that EBGP peer relationships have been established between PE1 and CE1 and between PE1 and CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv4 all peer</strong></pre>
<pre class="screen"> BGP local router ID : 172.16.1.1
 Local AS number : 100
 Total number of peers : 3                 Peers in established state : 3

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2.2.2.2         4         100       13       12     0 00:04:49 <strong>Established</strong>   4

  Peer of IPv4-family for vpn instance :

  VPN-Instance vpna, router ID 172.16.1.1:
  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.1.1.1        4       65410       12       13     0 00:06:00 <strong>Established</strong>   1
  VPN-Instance vpnb, router ID 172.16.1.1:
  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.2.1.1        4       65420       12       12     0 00:06:00 <strong>Established</strong>   1</pre>
</p></li><li><span>Configure OSPF multi-instance on PE2 and the MCE.</span><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 100 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-100] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-100-area-0.0.0.0] <strong>network 10.5.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-100-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-100] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-100]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ospf 200 vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-200] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-200-area-0.0.0.0] <strong>network 10.5.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-200-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-200]<strong> import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-200] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>import-route ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpnb] <strong>import-route ospf 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpnb] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-vpnb] <strong>quit</strong></pre>
<p># Configure the MCE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE]<strong> ospf 100 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-100]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-100-area-0.0.0.0]<strong> network 10.5.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-100-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>ospf 200 vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-200] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-200-area-0.0.0.0] <strong>network 10.5.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-200-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE-ospf-200-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE-ospf-200] <strong>quit</strong></pre>
</p></li><li><span>Disable routing loop detection on the MCE and import RIP routes destined for the VPN sites.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE] <strong>ospf 100 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE-ospf-100] <strong>vpn-instance-capability simple</strong>
Warning: This operation may cause a routing loop. Continue? [Y/N]:Y</pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-100] <strong>import-route rip 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE] <strong>ospf 200 vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-200] <strong>vpn-instance-capability simple</strong>
Warning: This operation may cause a routing loop. Continue? [Y/N]:Y</pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-200] <strong>import-route rip 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-ospf-200] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE-ospf-200] <strong>quit</strong></pre>
</p></li><li><span>Configure RIPv2 on the MCE to import the VPN routes of sites 3 and 4.</span><p><p># Configure the MCE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE] <strong>rip 100 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE-rip-100] <strong>version 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-rip-100] <strong>network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-rip-100] <strong>import-route ospf 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-rip-100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE]<strong> rip 200 vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE-rip-200] <strong>version 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-rip-200] <strong>network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-rip-200] <strong>import-route ospf 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>MCE-rip-200] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE-rip-200] <strong>quit</strong></pre>
</p></li><li><span>Configure RIPv2 on <span class="keyword">Device</span> A and <span class="keyword">Device</span> B to implement interworking with the MCE.</span><p><p># Configure <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>A</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A]<strong> rip 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rip-100] <strong>version 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rip-100] <strong>network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rip-100] <strong>network 33.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>A-rip-100] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>A-rip-100] <strong>quit</strong></pre>
<p># Configure <span class="keyword">Device</span>B.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname <span class="keyword">Device</span>B</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B] <strong>rip 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-rip-200]<strong> version 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-rip-200] <strong>network 10.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-rip-200] <strong>network 44.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">Device</span>B-rip-200] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">Device</span>B-rip-200] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># Run the <strong>display ip routing-table</strong> <strong>vpn-instance</strong> command on the MCE to view the routes to the peer CEs.</p>
<p>The following example uses vpna.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>MCE] <strong>display ip routing-table vpn-instance vpna</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : vpna
         Destinations : 12       Routes : 12

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  O_ASE  150  1             D  10.5.1.1        GigabitEthernet<span>0/1/0</span>
       10.3.1.0/24  Direct 0    0             D  10.3.1.2        GigabitEthernet<span>0/3/0</span>
       10.3.1.2/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/3/0</span>
     10.3.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/3/0</span>
    11.11.11.11/32  O_ASE  150  1             D  10.5.1.1        GigabitEthernet<span>0/1/0</span>
    33.33.33.33/32  RIP    100  1             D  10.3.1.1        GigabitEthernet<span>0/3/0</span>
       10.5.1.0/24  Direct 0    0             D  10.5.1.2        GigabitEthernet<span>0/1/0</span>
       10.5.1.1/32  Direct 0    0             D  10.5.1.1        GigabitEthernet<span>0/1/0</span>
       10.5.1.2/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.5.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<p># Run the <a href="cmdqueryname=display+ip+routing-table"><b><span class="cmdname">display ip routing-table</span></b></a> <strong><span>vpn-instance</span></strong> command on the PEs to view the routes to the peer sites.</p>
<p>The following example uses vpna on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table vpn-instance vpna</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : vpna
         Destinations : 9        Routes : 9

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct 0    0             D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.2/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
       10.3.1.0/24  IBGP   255  3             RD 2.2.2.2         GigabitEthernet<span>0/3/0</span>
       10.4.1.0/24  IBGP   255  2             RD 2.2.2.2         GigabitEthernet<span>0/3/0</span>
    11.11.11.11/32  EBGP   255  0             RD 10.1.1.1        GigabitEthernet<span>0/1/0</span>
    33.33.33.33/32  IBGP   255  2             RD 2.2.2.2         GigabitEthernet<span>0/3/0</span>
       10.5.1.0/24  IBGP   255  2             RD 2.2.2.2         GigabitEthernet<span>0/3/0</span>
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<p># Run the <a href="cmdqueryname=ping"><b><span class="cmdname">ping</span></b></a> command on CEs to check the connectivity between CE1 and <span class="keyword">Device</span>A, and between CE2 and <span class="keyword">Device</span>B. The ping operations are successful.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping -a 11.11.11.11 33.33.33.33</strong></pre>
<pre class="screen">  PING 33.33.33.33: 56  data bytes, press CTRL_C to break
    Reply from 33.33.33.33: bytes=56 Sequence=1 ttl=252 time=4 ms
    Reply from 33.33.33.33: bytes=56 Sequence=2 ttl=252 time=2 ms
    Reply from 33.33.33.33: bytes=56 Sequence=3 ttl=252 time=2 ms
    Reply from 33.33.33.33: bytes=56 Sequence=4 ttl=252 time=2 ms
    Reply from 33.33.33.33: bytes=56 Sequence=5 ttl=252 time=2 ms

  --- 33.33.33.33 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/2/4 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369543__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface LoopBack1
 ip address 11.11.11.11 255.255.255.255
#
bgp 65410
 peer 10.1.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.2 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface LoopBack1
 ip address 22.22.22.22 255.255.255.255
#
bgp 65420
 peer 10.2.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.2.1.2 enable
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
ip vpn-instance vpnb
 ipv4-family
  route-distinguisher 100:2
  apply-label per-instance
  vpn-target 222:2 export-extcommunity
  vpn-target 222:2 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpnb
 ip address 10.2.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance vpna
  network 10.1.1.0 255.255.255.0
  peer 10.1.1.1 as-number 65410
 #
 ipv4-family vpn-instance vpnb
  network 10.2.1.0 255.255.255.0
  peer 10.2.1.1 as-number 65420
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
ip vpn-instance vpnb
 ipv4-family
  route-distinguisher 200:2
  apply-label per-instance
  vpn-target 222:2 export-extcommunity
  vpn-target 222:2 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.5.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip binding vpn-instance vpnb
 ip address 10.5.2.1 255.255.255.0
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance vpna
  import-route ospf 100
 #
 ipv4-family vpn-instance vpnb
  import-route ospf 200
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
ospf 100 vpn-instance vpna
 import-route bgp
 area 0.0.0.0
  network 10.5.1.0 0.0.0.255
#
ospf 200 vpn-instance vpnb
 import-route bgp
 area 0.0.0.0
  network 10.5.2.0 0.0.0.255
#
return</pre>
</li><li><p>MCE configuration file</p>
<pre class="screen">#
sysname MCE
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
#
ip vpn-instance vpnb
 ipv4-family
  route-distinguisher 200:2
  apply-label per-instance
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.5.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpnb
 ip address 10.5.2.2 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.3.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance vpnb
 ip address 10.4.1.2 255.255.255.0
#
ospf 100 vpn-instance vpna
 import-route rip 100
 vpn-instance-capability simple
 area 0.0.0.0
  network 10.3.1.0 0.0.0.255
  network 10.5.1.0 0.0.0.255
#
ospf 200 vpn-instance vpnb
 import-route rip 200
 vpn-instance-capability simple
 area 0.0.0.0
  network 10.4.1.0 0.0.0.255
  network 10.5.2.0 0.0.0.255
#
rip 100 vpn-instance vpna
 version 2
 network 10.0.0.0
 import-route ospf 100
#
rip 200 vpn-instance vpnb
 version 2
 network 10.0.0.0
 import-route ospf 200
#
return</pre>
</li><li><p><span class="keyword">Device</span>A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
#
interface LoopBack1
 ip address 33.33.33.33 255.255.255.255
#
rip 100
 version 2
 network 10.0.0.0
 network 33.0.0.0
#
return</pre>
</li><li><p><span class="keyword">Device</span>B configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>B
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
#
interface LoopBack1
 ip address 44.44.44.44 255.255.255.255
#
rip 200
 version 2
 network 10.0.0.0
 network 44.0.0.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2060.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0310.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>