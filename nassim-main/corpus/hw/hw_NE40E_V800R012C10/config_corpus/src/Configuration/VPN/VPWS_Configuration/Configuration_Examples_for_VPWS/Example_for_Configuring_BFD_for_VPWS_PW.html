
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BFD for VPWS PW">
<meta name="abstract" content="Using BFD to detect PW faults involves simple configurations and requires a few packet exchanges.">
<meta name="description" content="Using BFD to detect PW faults involves simple configurations and requires a few packet exchanges.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_5006.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6060.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpws,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="q00824768">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369941">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BFD for VPWS PW</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369941"></a><a name="EN-US_TASK_0172369941"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BFD for VPWS PW</h1>
<div class="taskbody"><p>Using BFD to detect PW faults involves simple configurations and requires a few packet exchanges.</p>
<div class="context"><a name="EN-US_TASK_0172369941__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the MPLS L2VPN:</p>
<ul><li><p>PW1 is established between PE1 and PE2 and serves as the primary PW.</p>
</li><li><p>PW2 is established between PE1 and PE3 and serves as the secondary PW.</p>
</li></ul>
<p>On the network shown in <a href="#EN-US_TASK_0172369941__fig_dc_vrp_vpws_cfg_501301">Figure 1</a>, BFD needs to be configured to monitor the connectivity of the primary and secondary PWs, so that services can switch to the secondary PW within 50 ms if the primary PW fails.</p>
<div class="fignone" id="EN-US_TASK_0172369941__fig_dc_vrp_vpws_cfg_501301"><a name="EN-US_TASK_0172369941__fig_dc_vrp_vpws_cfg_501301"></a><a name="fig_dc_vrp_vpws_cfg_501301"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of configuring BFD for VPWS PW</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, and GE<span>0/1/2</span>, respectively.</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpws_cfg_501301.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369941__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure MPLS capabilities.</p>
</li><li><p>Establish PW1 between PE1 and PE2 and PW2 between PE1 and PE3. Configure PW1 as the primary PW and PW2 as the secondary PW on AC interfaces of PE1.</p>
</li><li><p>Configure BFD to monitor the connectivity of PW1 and PW2.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369941__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP addresses of interfaces</p>
</li><li><p>VC IDs of PWs</p>
</li><li><p>Names and the local and remote discriminators of BFD sessions</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369941__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign IP addresses to CE interfaces that connect to PEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.2.1 30 sub</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> ip address 10.1.2.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
</p></li><li><span>Configure an IGP (OSPF is used as an example) on the MPLS backbone network so that PEs and Ps can communicate.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.2.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>ip address 10.4.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 10.2.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 10.4.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet </strong><span>0/1/0</span></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.3.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.2.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.5.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.4.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0] <strong>network 10.4.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0] <strong>network 10.5.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>ip address 4.4.4.4 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.3.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-LoopBack1] <strong>ip address 5.5.5.5 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.5.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0]<strong> network 5.5.5.5 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 10.5.1.0 0.0.0.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> commit</strong></pre>
<p>After completing the configurations, run the<strong> display ip routing-table</strong> command on each PE. The command output shows that PE1 and PE2 have learned the routes to each other's Loopback1 interface, and PE1 and PE3 have learned the routes to each other's Loopback1 interface.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span></pre>
<pre class="screen">------------------------------------------------------------------------------</pre>
<pre class="screen">Routing Table: Public</pre>
<pre class="screen">         Destinations : 15       Routes : 15</pre>
<pre class="screen">Destination/Mask    Proto  Pre  Cost     Flags NextHop         Interface</pre>
<pre class="screen">        1.1.1.1/32  Direct 0    0           D  127.0.0.1       InLoopBack0</pre>
<pre class="screen"><strong>        2.2.2.2/32  OSPF   10   2           D  10.2.1.2       GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen"><strong>        3.3.3.3/32  OSPF   10   2           D  10.4.1.2       GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen"><strong>        4.4.4.4/32  OSPF   10   3           D  10.2.1.2       GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen"><strong>        5.5.5.5/32  OSPF   10   3           D  10.4.1.2       GigabitEthernet<span>0/1/2</span></strong></pre>
<pre class="screen">      10.2.1.0/30  Direct 0    0           D  10.2.1.1       GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen">      10.2.1.1/32  Direct 0    0           D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">      10.2.1.2/32  Direct 0    0           D  10.2.1.2       GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen">      10.3.1.0/30  OSPF   10   2           D  10.2.1.2       GigabitEthernet<span>0/1/1</span></pre>
<pre class="screen">      127.0.0.0/8   Direct 0    0           D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">      127.0.0.1/32  Direct 0    0           D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">      10.4.1.0/30  Direct 0    0           D  10.4.1.1       GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen">      10.4.1.1/32  Direct 0    0           D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">      10.4.1.2/32  Direct 0    0           D  10.4.1.2       GigabitEthernet<span>0/1/2</span></pre>
<pre class="screen">      10.5.1.0/30  OSPF   10   2           D  10.4.1.2       GigabitEthernet<span>0/1/2</span></pre>
</p></li><li><span>Configure basic MPLS functions on the MPLS backbone network.</span><p><p># Enable MPLS and configure the Loopback1 interface IP address as an LSR ID on each involved device. Enable MPLS and MPLS LDP on involved interfaces connected to the MPLS backbone network.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> mpls lsr-id 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>After completing the configurations, run the<strong> display tunnel-info all</strong> command each PE. The command output shows that an MPLS LSP has been established between PE1 and PE2 and between PE1 and PE3.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display tunnel-info all</strong></pre>
<pre class="screen">Tunnel ID               Type              Destination          Status
----------------------------------------------------------------------
0x000000000300000000    ldp               2.2.2.2              UP
0x000000000300000001    ldp               --                   UP
0x000000000300000002    ldp               3.3.3.3              UP
0x000000000300000003    ldp               --                   UP
<strong>0x000000000300000004    ldp               4.4.4.4              UP</strong>
0x000000000300000005    ldp               --                   UP
<strong>0x000000000300000006    ldp               5.5.5.5              UP</strong>
0x000000000300000007    ldp               --                   UP  </pre>
<p>Run the <strong>display mpls ldp session</strong> command on each PE. The command output shows that <strong>Status</strong> is <strong>Operational</strong>, indicating that an LDP peer relationship has been established between this PE and its neighboring P.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
 ------------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 ------------------------------------------------------------------------------
 2.2.2.2:0          <strong>Operational</strong> DU   Passive  000:00:03   16/16
 3.3.3.3:0          <strong>Operational</strong> DU   Passive  000:00:03   13/13
 ------------------------------------------------------------------------------
 TOTAL: 2 session(s) Found.</pre>
</p></li><li><span>Establish a remote LDP session between PEs.</span><p><p># Configure a remote LDP session, and use the loopback interface address of a remote LDP peer as the remote peer IP address.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If two PEs are directly connected, you do not need to configure a remote LDP session between them.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp remote-peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-4.4.4.4]<strong> remote-ip 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-4.4.4.4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp remote-peer 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-5.5.5.5] <strong>remote-ip 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-5.5.5.5] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-mpls-ldp-remote-5.5.5.5] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp-remote-1.1.1.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display mpls ldp session</strong> command on each PE. The command output shows that the <strong>Status</strong> field is <strong>Operational</strong>, indicating that a remote LDP peer relationship has been established.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
 ------------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 ------------------------------------------------------------------------------
 2.2.2.2:0          Operational DU   Passive  000:00:06   27/27
 3.3.3.3:0          Operational DU   Passive  000:00:05   24/24
<strong> 4.4.4.4</strong>:0          <strong>Operational</strong> DU   Passive  000:00:00   3/3
 5.5.5.5:0          <strong>Operational</strong> DU   Passive  000:00:00   2/2
 ------------------------------------------------------------------------------
 TOTAL: 4 session(s) Found.</pre>
</p></li><li><span>Configure PWs on PEs using PW templates.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pw-template 1to2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to2] <strong>peer-address 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to2] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pw-template 1to3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>peer-address 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls l2vc pw-template 1to2 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls l2vc pw-template 1to3 200 secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>pw-template 2to1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-template-2to1] <strong>peer-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-template-2to1] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-template-2to1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls l2vc pw-template 2to1 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>pw-template 3to1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-template-3to1] <strong>peer-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-template-3to1] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-template-3to1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>]<strong> mpls l2vc pw-template 3to1 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/1</span>]<strong> quit</strong></pre>
<p>After completing the configurations, run the <strong>display pw-template</strong> command on each PE. The command output shows PW template configurations.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display pw-template</strong></pre>
<pre class="screen"> Total PW template number : 2

  PW Template Name : 1to2
  PeerIP           : 4.4.4.4
  Tnl Policy Name  : --
  CtrlWord         : Enable
  MTU              : 1500
  Seq-Number       : Disable
  TDM Encapsulation Number: 32
  Jitter-Buffer           : 20
<span>  Jitter-Buffer-Cep       : 1125   Payload-Compression DBA : UNEQ</span>
  Idle-Code               : ff
  Rtp-Header              : Disable
  VCCV Capability  : cw alert lsp-ping bfd
  Behavior Name    : --
  Total PW         : 1, Static PW : 0, LDP PW : 1  

  PW Template Name : 1to3
  PeerIP           : 5.5.5.5
  Tnl Policy Name  : --
  CtrlWord         : Enable
  MTU              : 1500
  Seq-Number       : Disable
  TDM Encapsulation Number: 32
  Jitter-Buffer           : 20
<span>  Jitter-Buffer-Cep       : 1125   Payload-Compression DBA : UNEQ</span>
  Idle-Code               : ff
  Rtp-Header              : Disable
  VCCV Capability  : cw alert lsp-ping bfd
  Behavior Name    : --
  Total PW         : 1, Static PW : 0, LDP PW : 1  </pre>
<p>After completing the configurations, run the <strong>display mpls l2vc interface</strong> command on each PE to check L2VPN connection information. The command output shows that PWs have been established and are in the <strong>Active</strong> state, and that BFD for PW is not configured for the primary or secondary PW.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls l2vc interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">*client interface       : GigabitEthernet<span>0/1/0</span> is up</pre>
<pre class="screen">  session state          : up</pre>
<pre class="screen">  AC status               : up</pre>
<pre class="screen">  VC state               : <strong>up</strong></pre>
<pre class="screen">  VC ID                  : 100</pre>
<pre class="screen">  VC type                : PPP</pre>
<pre class="screen">  destination            :<strong> 4.4.4.4</strong></pre>
<pre class="screen">  local group ID         : 0            remote group ID      : 0</pre>
<pre class="screen">  local VC label         : 21504        remote VC label      : 21504</pre>
<pre class="screen">  local AC OAM State     : up</pre>
<pre class="screen">  local PSN State        : up</pre>
<pre class="screen">  local forwarding state : forwarding</pre>
<pre class="screen">  local status code      : 0x0 </pre>
<pre class="screen">  remote AC OAM state    : up</pre>
<pre class="screen">  remote PSN state       : up</pre>
<pre class="screen">  remote forwarding state: forwarding</pre>
<pre class="screen">  remote statuscode      : 0x0  </pre>
<pre class="screen">  BFD for PW             : <strong>unavailable</strong></pre>
<pre class="screen">  manual fault           : not set</pre>
<pre class="screen">  active state           : <strong>active</strong></pre>
<pre class="screen">  forwarding entry       : exist</pre>
<pre class="screen">  link state             : up</pre>
<pre class="screen">  local VC MTU           : 4470         remote VC MTU        : 4470</pre>
<pre class="screen">  Local VCCV        : cw alert lsp-ping bfd
  Remote VCCV       : cw alert lsp-ping bfd</pre>
<pre class="screen">  local control word     : enable       remote control word  : enable</pre>
<pre class="screen">  tunnel policy name     : --</pre>
<pre class="screen">  traffic behavior name  : --</pre>
<pre class="screen">  PW template name       : 1to2</pre>
<pre class="screen">  primary or secondary   : primary</pre>
<pre class="screen">  VC tunnel/token info   : 1 tunnels/tokens</pre>
<pre class="screen">    NO.0  TNL type : lsp   , TNL ID : 0x1002004</pre>
<pre class="screen">  create time            : 0 days, 1 hours, 22 minutes, 22 seconds</pre>
<pre class="screen">  up time                : 0 days, 1 hours, 21 minutes, 14 seconds</pre>
<pre class="screen">  last change time       : 0 days, 1 hours, 21 minutes, 14 seconds</pre>
<pre class="screen">  VC last up time : 2008-07-24 12:31:31
  VC total up time: 0 days, 2 hours, 12 minutes, 51 seconds</pre>
<pre class="screen">  CKey                 : 16                                                     
  NKey                 : 15   </pre>
<pre class="screen"> *client interface       : GigabitEthernet<span>0/1/0</span> is up</pre>
<pre class="screen">  session state          : up</pre>
<pre class="screen">  AC status               : up</pre>
<pre class="screen">  VC state               : <strong>up</strong></pre>
<pre class="screen">  VC ID                  : 200</pre>
<pre class="screen">  VC type                : PPP</pre>
<pre class="screen">  destination            : 5.5.5.5</pre>
<pre class="screen">  local group ID         : 0            remote group ID      : 0</pre>
<pre class="screen">  local VC label         : 21505        remote VC label      : 21504</pre>
<pre class="screen">  local AC OAM state     : up</pre>
<pre class="screen">  local PSN state        : up</pre>
<pre class="screen">  local forwarding state : forwarding</pre>
<pre class="screen">  local status code      : 0x0 </pre>
<pre class="screen">  remote AC OAM state    : up</pre>
<pre class="screen">  remote PSN state       : up</pre>
<pre class="screen">  remote forwarding state: forwarding</pre>
<pre class="screen">  remote statuscode      : 0x0  </pre>
<pre class="screen">  BFD for PW             : <strong>unavailable</strong></pre>
<pre class="screen">  manual fault           : not set</pre>
<pre class="screen">  active state           : inactive</pre>
<pre class="screen">  forwarding entry       : existent</pre>
<pre class="screen">  link state             : up</pre>
<pre class="screen">  local VC MTU           : 4470         remote VC MTU        : 4470</pre>
<pre class="screen">  Local VCCV        : cw alert lsp-ping bfd
  Remote VCCV       : cw alert lsp-ping bfd</pre>
<pre class="screen">  local control word     : enable       remote control word : enable</pre>
<pre class="screen">  tunnel policy          : --</pre>
<pre class="screen">  traffic behavior       : --</pre>
<pre class="screen">  PW template name       : 1to3</pre>
<pre class="screen">  primary or secondary   : <strong>secondary</strong></pre>
<pre class="screen">  VC tunnel/token info   : 1 tunnels/tokens</pre>
<pre class="screen">    NO.0  TNL type : lsp   , TNL ID : 0x1002006</pre>
<pre class="screen">  create time            : 0 days, 1 hours, 22 minutes, 9 seconds</pre>
<pre class="screen">  up time                : 0 days, 1 hours, 20 minutes, 22 seconds</pre>
<pre class="screen">  last change time       : 0 days, 1 hours, 20 minutes, 22 seconds</pre>
<pre class="screen">  VC last up time : 2008-07-24 12:31:31
  VC total up time: 0 days, 2 hours, 12 minutes, 51 seconds</pre>
<pre class="screen">  CKey                 : 17                                                     
  NKey                 : 18   </pre>
<pre class="screen"> reroute policy          : delay 30 s, resume 10 s</pre>
<pre class="screen"> reason of last reroute  : --</pre>
<pre class="screen"> time of last reroute    : -- days, -- hours, -- minutes, -- seconds</pre>
<pre class="screen"> delay timer ID          : --           residual time :--</pre>
<pre class="screen"> resume timer ID         : --           residual time :--</pre>
</p></li><li><span>Configure BFD for VPWS PW on PEs.</span><p><p>Currently, static BFD and dynamic BFD are supported. For the same VPWS PW, the static BFD session and dynamic BFD session are mutually exclusive. That is, only a single type of BFD session can be configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, the configuration static BFD for VPWS PW is displayed in the configuration file.</p>
</div></div>
</p><ul><li>Configure static BFD.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For a BFD session, the local discriminator on one end must be the same as the remote discriminator on the other end.</p>
</div></div>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd 1to2 bind pw interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-1to2] <strong>discriminator local 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-1to2] <strong>discriminator remote 21</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-1to2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-lsp-session-1to2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd 1to3 bind pw interface gigabitethernet <span>0/1/0</span> secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-1to3] <strong>discriminator local 13</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-1to3] <strong>discriminator remote 31</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-1to3] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-lsp-session-1to3] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd 2to1 bind pw interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-2to1] <strong>discriminator local 21</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-2to1] <strong>discriminator remote 12</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-2to1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bfd-lsp-session-2to1]<strong> quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> bfd 3to1 bind pw interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bfd-lsp-session-3to1] <strong>discriminator local 31</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bfd-lsp-session-3to1] <strong>discriminator remote 13</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bfd-lsp-session-3to1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bfd-lsp-session-3to1] <strong>quit</strong></pre>
<p>After the configuration is complete, BFD sessions can be created between PE1 and PE2, and between PE1 and PE3. Run the <strong>display bfd session all </strong>command. The command output shows that the <strong>BFD state</strong> field is <strong>up</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bfd session all</strong></pre>
<pre class="screen"><span>(w): State in WTR  (*): State is invalid</span>
--------------------------------------------------------------------------------
Local  Remote PeerIpAddr                     State     Type       InterfaceName
--------------------------------------------------------------------------------
12     21     --.--.--.--                     Up        S_PW(M)    GigabitEthernet<span>0/1/0</span>
13     31     --.--.--.--                     Up        S_PW(S)    GigabitEthernet<span>0/1/0</span>
--------------------------------------------------------------------------------
     Total UP/DOWN Session Number : 2/0</pre>
</li><li>Configure dynamic BFD.<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pw-template 1to2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to2] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to2] <strong>bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>pw-template 1to3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-pw-template-1to3]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls l2vpn pw bfd</strong> <strong>min-rx-interval 100 min-tx-interval 100 detect-multiplier 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls l2vpn pw bfd</strong> <strong>min-rx-interval 100 min-tx-interval 100 detect-multiplier 4 sec</strong><strong>ondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>pw-template 2to1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-template-2to1] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-template-2to1] <strong>bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-pw-template-2to1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet </strong><strong><span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls l2vpn pw bfd</strong> <strong>min-rx-interval 100 min-tx-interval 100 detect-multiplier 4</strong> <strong>track-interface</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>pw-template 3to1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-template-3to1] <strong>control-word</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-template-3to1] <strong>bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-pw-template-3to1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet </strong><strong><span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>mpls l2vpn pw bfd</strong> <strong>min-rx-interval 100 min-tx-interval 100 detect-multiplier 4</strong> <strong>track-interface</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<p>After the configuration is complete, BFD sessions can be created between PE1 and PE2, and between PE1 and PE3. Run the <strong>display bfd session all</strong> command. The command output shows that the <strong>BFD state</strong> field is <strong>up</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bfd session all</strong></pre>
<pre class="screen"><span>(w): State in WTR  (*): State is invalid</span>
--------------------------------------------------------------------------------
Local  Remote PeerIpAddr                     State     Type       InterfaceName
--------------------------------------------------------------------------------
12     21     --.--.--.--                     Up        D_PW(M)    GigabitEthernet<span>0/1/0</span>
13     31     --.--.--.--                     Up        D_PW(S)    GigabitEthernet<span>0/1/0</span>
--------------------------------------------------------------------------------
     Total UP/DOWN Session Number : 2/0</pre>
</li></ul>
</li><li><span>Verify the configuration.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Verify the configuration of static BFD for VPWS PW. The procedure for verifying dynamic BFD for VPWS PW is similar to that for verifying static BFD for VPWS PW.</p>
</div></div>
<p>When the primary PW is working properly, CE1 can use the primary address to ping CE2's 10.1.1.2. Because the secondary PW does not work, CE1 cannot use the secondary address to ping CE2's 10.1.2.2.</p>
<pre class="screen">&lt;CE1&gt; <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">  PING 10.1.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=140 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=90 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=120 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=120 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=130 ms</pre>
<pre class="screen">  --- 10.1.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 90/120/140 ms</pre>
<pre class="screen">&lt;CE1&gt; <strong>ping 10.1.2.2</strong></pre>
<pre class="screen">  PING 10.1.2.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">  --- 10.1.2.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    0 packet(s) received</pre>
<pre class="screen">    100.00% packet loss</pre>
<p># Run the <strong>display mpls l2vc interface</strong> command on each PE to check PW status. The command output shows that <strong>BFD for PW</strong> is <strong>available</strong>, and <strong>BFD state</strong> is <strong>up</strong> for both the primary and secondary PWs.</p>
<pre class="screen">&lt;PE1&gt;<strong> display mpls l2vc interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">*client interface       : GigabitEthernet<span>0/1/0</span> is up</pre>
<pre class="screen">  session state          : up</pre>
<pre class="screen">  AC status               : up</pre>
<pre class="screen">  VC state               : <strong>up</strong></pre>
<pre class="screen">  VC ID                  : 100</pre>
<pre class="screen">  VC type                : Ethernet</pre>
<pre class="screen">  destination            : <strong>4.4.4.4</strong></pre>
<pre class="screen">  local group ID         : 0            remote group ID      : 0</pre>
<pre class="screen">  local VC label         : 21504        remote VC label      : 21504</pre>
<pre class="screen">  local AC OAM State     : up</pre>
<pre class="screen">  local PSN State        : up</pre>
<pre class="screen">  local forwarding state : forwarding</pre>
<pre class="screen">  local status code      : 0x0 </pre>
<pre class="screen">  remote AC OAM state    : up</pre>
<pre class="screen">  remote PSN state       : up</pre>
<pre class="screen">  remote forwarding state: forwarding</pre>
<pre class="screen">  remote statuscode      : 0x0  </pre>
<pre class="screen">  BFD for PW             : <strong>available</strong></pre>
<pre class="screen">    BFD sessionIndex     : 256          BFD state : <strong>up</strong></pre>
<pre class="screen">  manual fault           : not set</pre>
<pre class="screen">  active state           : <strong>active</strong></pre>
<pre class="screen">  forwarding entry       : exist</pre>
<pre class="screen">  link state             : up</pre>
<pre class="screen">  local VC MTU           : 4470         remote VC MTU        : 4470</pre>
<pre class="screen">  Local VCCV        : cw alert lsp-ping bfd
  Remote VCCV       : cw alert lsp-ping bfd</pre>
<pre class="screen">  local control word     : enable       remote control word  : enable</pre>
<pre class="screen">  tunnel policy name     : --</pre>
<pre class="screen">  traffic behavior name  : --</pre>
<pre class="screen">  PW template name       : 1to2</pre>
<pre class="screen">  primary or secondary   :<strong> primary</strong></pre>
<pre class="screen">  VC tunnel/token info   : 1 tunnels/tokens</pre>
<pre class="screen">    NO.0  TNL type : lsp   , TNL ID : 0x1002004</pre>
<pre class="screen">  create time            : 0 days, 1 hours, 17 minutes, 55 seconds</pre>
<pre class="screen">  up time                : 0 days, 1 hours, 16 minutes, 47 seconds</pre>
<pre class="screen">  last change time       : 0 days, 1 hours, 16 minutes, 47 seconds</pre>
<pre class="screen">  VC last up time : 2008-07-24 12:31:31
  VC total up time: 0 days, 2 hours, 12 minutes, 51 seconds</pre>
<pre class="screen">  CKey                 : 16                                                     
  NKey                 : 15   </pre>
<pre class="screen"> *client interface       : GigabitEthernet<span>0/1/0</span> is up</pre>
<pre class="screen">  session state          : up</pre>
<pre class="screen">  AC status               : up</pre>
<pre class="screen">  VC state               : <strong>up</strong></pre>
<pre class="screen">  VC ID                  : 200</pre>
<pre class="screen">  VC type                : Ethernet</pre>
<pre class="screen">  destination            : <strong>5.5.5.5</strong></pre>
<pre class="screen">  local group ID         : 0            remote group ID      : 0</pre>
<pre class="screen">  local VC label         : 21505        remote VC label      : 21504</pre>
<pre class="screen">  local AC OAM state     : up</pre>
<pre class="screen">  local PSN state        : up</pre>
<pre class="screen">  local forwarding state : forwarding</pre>
<pre class="screen">  local status code      : 0x0 </pre>
<pre class="screen">  remote AC OAM state    : up</pre>
<pre class="screen">  remote PSN state       : up</pre>
<pre class="screen">  remote forwarding state: forwarding</pre>
<pre class="screen">  remote statuscode      : 0x0  </pre>
<pre class="screen">  BFD for PW             : <strong>available</strong></pre>
<pre class="screen">    BFD sessionIndex     : 257          BFD state : <strong>up</strong></pre>
<pre class="screen">  manual fault           : not set</pre>
<pre class="screen">  active state           : inactive</pre>
<pre class="screen">  forwarding entry       : existent</pre>
<pre class="screen">  link state             : up</pre>
<pre class="screen">  local VC MTU           : 4470         remote VC MTU        : 4470</pre>
<pre class="screen">  Local VCCV        : cw alert lsp-ping bfd
  Remote VCCV       : cw alert lsp-ping bfd</pre>
<pre class="screen">  local control word     : enable       remote control word : enable</pre>
<pre class="screen">  tunnel policy name     : --</pre>
<pre class="screen">  traffic behavior name  : --</pre>
<pre class="screen">  PW template name       : 1to3</pre>
<pre class="screen">  primary or secondary   :<strong> secondary</strong></pre>
<pre class="screen">  VC tunnel/token info   : 1 tunnels/tokens</pre>
<pre class="screen">    NO.0  TNL type : lsp   , TNL ID : 0x1002006</pre>
<pre class="screen">  create time            : 0 days, 1 hours, 17 minutes, 42 seconds</pre>
<pre class="screen">  up time                : 0 days, 1 hours, 15 minutes, 55 seconds</pre>
<pre class="screen">  last change time       : 0 days, 1 hours, 15 minutes, 55 seconds</pre>
<pre class="screen">  VC last up time : 2008-07-24 12:31:31
  VC total up time: 0 days, 2 hours, 12 minutes, 51 seconds</pre>
<pre class="screen">  CKey                 : 17                                                     
  NKey                 : 18   </pre>
<pre class="screen"> reroute policy          : delay 30 s, resume 10 s</pre>
<pre class="screen"> reason of last reroute  : --</pre>
<pre class="screen"> time of last reroute    : -- days, -- hours, -- minutes, -- seconds</pre>
<pre class="screen"> delay timer ID          : --           residual time :--</pre>
<pre class="screen"> resume timer ID         : --           residual time :--</pre>
<p>Run the <strong>shutdown</strong> command on GigabitEthernet<span>0/1/1</span> of PE1 to simulate a fault on the primary PW. Then, CE1 cannot use the primary address to ping CE2's 10.1.1.2. After the secondary PW takes over services, CE1 can use the secondary IP address to successfully ping CE2's 10.1.2.2.</p>
<pre class="screen">&lt;CE1&gt; <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">  PING 10.1.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">    Request time out</pre>
<pre class="screen">  --- 10.1.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    0 packet(s) received</pre>
<pre class="screen">    100.00% packet loss</pre>
<pre class="screen">&lt;CE1&gt; <strong>ping 10.1.2.2</strong></pre>
<pre class="screen">  PING 10.1.2.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.1.2.2: bytes=56 Sequence=1 ttl=255 time=140 ms</pre>
<pre class="screen">    Reply from 10.1.2.2: bytes=56 Sequence=2 ttl=255 time=160 ms</pre>
<pre class="screen">    Reply from 10.1.2.2: bytes=56 Sequence=3 ttl=255 time=160 ms</pre>
<pre class="screen">    Reply from 10.1.2.2: bytes=56 Sequence=4 ttl=255 time=160 ms</pre>
<pre class="screen">    Reply from 10.1.2.2: bytes=56 Sequence=5 ttl=255 time=160 ms</pre>
<pre class="screen">  --- 10.1.2.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 140/156/160 ms</pre>
<p># Run the <strong>display mpls l2vc interface</strong> command on each PE again to check PW status. The command output shows that <strong>VC state</strong> is <strong>down</strong> and <strong>BFD for PW</strong> is <strong>unavailable</strong> for the primary PW. <strong>VC state</strong> is <strong>up</strong>, <strong>BFD for PW</strong> is <strong>available</strong>, and <strong>BFD state</strong> is also <strong>up</strong> for the secondary PW.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls l2vc interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen"> *client interface       : GigabitEthernet<span>0/1/0</span> is up</pre>
<pre class="screen">  session state          : down</pre>
<pre class="screen">  AC status               : up</pre>
<pre class="screen"><strong>  VC state               : down</strong></pre>
<pre class="screen">  VC ID                  : 100</pre>
<pre class="screen">  VC type                : PPP</pre>
<pre class="screen">  destination            : 4.4.4.4</pre>
<pre class="screen">  local group ID         : 0            remote group ID      : 0</pre>
<pre class="screen">  local VC label         : 21504        remote VC label      : 0</pre>
<pre class="screen">  local AC OAM State     : up</pre>
<pre class="screen">  local PSN State        : up</pre>
<pre class="screen">  local forwarding state : not forwarding</pre>
<pre class="screen">  local status code      : 0x0 </pre>
<pre class="screen">  BFD for PW             :<strong> unavailable</strong></pre>
<pre class="screen">  manual fault           : not set</pre>
<pre class="screen">  active state           : inactive</pre>
<pre class="screen">  forwarding entry       : not exist</pre>
<pre class="screen">  link state             : down</pre>
<pre class="screen">  local VC MTU           : 4470         remote VC MTU        : 4470</pre>
<pre class="screen">  Local VCCV        : cw alert lsp-ping bfd
  Remote VCCV       : none</pre>
<pre class="screen">  local control word     : enable       remote control word  : none</pre>
<pre class="screen">  tunnel policy name     : --</pre>
<pre class="screen">  traffic behavior name  : --</pre>
<pre class="screen">  PW template name       : 1to2</pre>
<pre class="screen">  primary or secondary   : <strong>primary</strong></pre>
<pre class="screen">  VC tunnel/token info   : 0 tunnels/tokens</pre>
<pre class="screen">  create time            : 0 days, 0 hours, 30 minutes, 58 seconds</pre>
<pre class="screen">  up time                : 0 days, 0 hours, 0 minutes, 0 seconds</pre>
<pre class="screen">  last change time       : 0 days, 0 hours, 6 minutes, 46 seconds</pre>
<pre class="screen">  VC last up time : 2008-07-24 12:31:31
  VC total up time: 0 days, 2 hours, 12 minutes, 51 seconds</pre>
<pre class="screen">  CKey                 : 16                                                     
  NKey                 : 15   </pre>
<pre class="screen"> *client interface       : GigabitEthernet<span>0/1/0</span> is up</pre>
<pre class="screen">  session state          : up</pre>
<pre class="screen">  AC status               : up</pre>
<pre class="screen">  VC state               : <strong>up</strong></pre>
<pre class="screen">  VC ID                  : 200</pre>
<pre class="screen">  VC type                : PPP</pre>
<pre class="screen">  destination            : 5.5.5.5</pre>
<pre class="screen">  local group ID         : 0            remote group ID      : 0</pre>
<pre class="screen">  local VC label         : 21505        remote VC label      : 21504</pre>
<pre class="screen">  local AC OAM state     : up</pre>
<pre class="screen">  local PSN state        : up</pre>
<pre class="screen">  local forwarding state : forwarding</pre>
<pre class="screen">  local status code      : 0x0 </pre>
<pre class="screen">  remote AC OAM state    : up</pre>
<pre class="screen">  remote PSN state       : up</pre>
<pre class="screen">  remote forwarding state: forwarding</pre>
<pre class="screen">  remote statuscode      : 0x0  </pre>
<pre class="screen">  BFD for PW             : <strong>available</strong></pre>
<pre class="screen">    BFD sessionIndex     : 257          BFD state :<strong> up</strong></pre>
<pre class="screen">  manual fault           : not set</pre>
<pre class="screen">  active state           : active</pre>
<pre class="screen">  forwarding entry       : existent</pre>
<pre class="screen">  link state             : up</pre>
<pre class="screen">  local VC MTU           : 4470         remote VC MTU        : 4470</pre>
<pre class="screen">  Local VCCV        : cw alert lsp-ping bfd
  Remote VCCV       : cw alert lsp-ping bfd</pre>
<pre class="screen">  local control word     : enable       remote control word : enable</pre>
<pre class="screen">  tunnel policy name     : --</pre>
<pre class="screen">  traffic behavior name  : --</pre>
<pre class="screen">  PW template name       : 1to3</pre>
<pre class="screen">  primary or secondary   : <strong>secondary</strong></pre>
<pre class="screen">  VC tunnel/token info   : 1 tunnels/tokens</pre>
<pre class="screen">    NO.0  TNL type : lsp   , TNL ID : 0x1002008</pre>
<pre class="screen">  create time            : 0 days, 0 hours, 30 minutes, 58 seconds</pre>
<pre class="screen">  up time                : 0 days, 0 hours, 25 minutes, 12 seconds</pre>
<pre class="screen">  last change time       : 0 days, 0 hours, 25 minutes, 12 seconds</pre>
<pre class="screen">  VC last up time : 2008-07-24 12:31:31
  VC total up time: 0 days, 2 hours, 12 minutes, 51 seconds</pre>
<pre class="screen">  CKey                 : 17                                                     
  NKey                 : 18   </pre>
<pre class="screen"> reroute policy          : delay 30 s, resume 10 s</pre>
<pre class="screen"> reason of last reroute  : --</pre>
<pre class="screen"> time of last reroute    : -- days, -- hours, -- minutes, -- seconds</pre>
<pre class="screen"> delay timer ID          : --           residual time :--</pre>
<pre class="screen"> resume timer ID         : --           residual time :--</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369941__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.252
 ip address 10.1.2.1 255.255.255.252 sub
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
pw-template 1to2
 peer-address 4.4.4.4
 control-word
 bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4
#
pw-template 1to3
 peer-address 5.5.5.5
 control-word
 bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4
#
mpls ldp
#
 mpls ldp remote-peer 4.4.4.4
 remote-ip 4.4.4.4
#
 mpls ldp remote-peer 5.5.5.5
 remote-ip 5.5.5.5
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 mpls l2vc pw-template 1to2 100
 mpls l2vc pw-template 1to3 200 secondary
 mpls l2vpn pw bfd min-rx-interval 100 min-tx-interval 100 detect-multiplier 4
 mpls l2vpn pw bfd min-rx-interval 100 min-tx-interval 100 detect-multiplier 4 secondary
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.252
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.2.1.0 0.0.0.3
  network 10.4.1.0 0.0.0.3
#
bfd 1to2 bind pw interface GigabitEthernet<span>0/1/0</span>
 discriminator local 12
 discriminator remote 21
 commit
#
bfd 1to3 bind pw interface GigabitEthernet<span>0/1/0</span> secondary
 discriminator local 13
 discriminator remote 31
 commit
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.252
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.2.1.0 0.0.0.3
  network 10.3.1.0 0.0.0.3
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.5.1.1 255.255.255.252
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.4.1.0 0.0.0.3
  network 10.5.1.0 0.0.0.3
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
bfd
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls l2vpn
#
pw-template 2to1
 peer-address 1.1.1.1
 control-word
 bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4
#
mpls ldp
#
 mpls ldp remote-peer 1.1.1.1
 remote-ip 1.1.1.1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 mpls l2vc pw-template 2to1 100
 mpls l2vpn pw bfd min-rx-interval 100 min-tx-interval 100 detect-multiplier 4 track-interface
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.3.1.0 0.0.0.3
#
bfd 2to1 bind pw interface GigabitEthernet<span>0/1/0</span>
 discriminator local 21
 discriminator remote 12
 commit
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
bfd
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls l2vpn
#
pw-template 3to1
 peer-address 1.1.1.1
 control-word
 bfd-detect min-rx-interval 100 min-tx-interval 100 detect-multiplier 4
#
mpls ldp
#
 mpls ldp remote-peer 1.1.1.1
 remote-ip 1.1.1.1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.5.1.2 255.255.255.252
 mpls
 mpls ldp
 mpls l2vpn pw bfd min-rx-interval 100 min-tx-interval 100 detect-multiplier 4 track-interface
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 mpls l2vc pw-template 3to1 200
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 10.5.1.0 0.0.0.3
#
bfd 3to1 bind pw interface GigabitEthernet<span>0/1/1</span>
 discriminator local 31
 discriminator remote 13
 commit
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.252
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.252
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">Configuration Examples for VPWS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_5006.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6060.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>