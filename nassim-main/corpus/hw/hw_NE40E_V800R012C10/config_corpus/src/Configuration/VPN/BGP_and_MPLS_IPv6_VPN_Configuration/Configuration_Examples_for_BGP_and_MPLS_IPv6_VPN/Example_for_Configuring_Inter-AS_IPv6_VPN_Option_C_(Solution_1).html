
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS IPv6 VPN Option C (Solution 1)">
<meta name="abstract" content="After establishing a multi-hop MP-EBGP peer relationship between PEs of different ASs, you can implement the inter-AS IPv6 VPN Option C solution.">
<meta name="description" content="After establishing a multi-hop MP-EBGP peer relationship between PEs of different ASs, you can implement the inter-AS IPv6 VPN Option C solution.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2098.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369720">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-AS IPv6 VPN Option C (Solution 1)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369720"></a><a name="EN-US_TASK_0172369720"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS IPv6 VPN Option C (Solution 1)</h1>
<div class="taskbody"><p>After establishing a multi-hop MP-EBGP peer relationship between PEs of different ASs, you can implement the inter-AS IPv6 VPN Option C solution.</p>
<div class="context"><a name="EN-US_TASK_0172369720__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172369720__fig_dc_vrp_mpls-l3vpn-v6_cfg_209701">Figure 1</a>, CE1 and CE2 belong to the same VPN; CE1 accesses the network through PE1 in AS100; CE2 accesses the network through PE2 in AS200.</p>
<p>It is required that inter-AS BGP/MPLS IPv6 VPN be implemented in Option C mode.</p>
<div class="fignone" id="EN-US_TASK_0172369720__fig_dc_vrp_mpls-l3vpn-v6_cfg_209701"><a name="EN-US_TASK_0172369720__fig_dc_vrp_mpls-l3vpn-v6_cfg_209701"></a><a name="fig_dc_vrp_mpls-l3vpn-v6_cfg_209701"></a><span class="figcap"><b>Figure 1 </b>Inter-AS IPv6 VPN Option C (solution 1)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v6_cfg_209701.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369720__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Set up an MP-EBGP peer relationship between PEs in different ASs and configure the maximum number of hops between PEs.</p>
</li><li><p>Configure a routing policy on ASBRs, so that each ASBR assigns MPLS labels to the loopback routes received from the PE in the local AS before advertising the routes to the remote ASBR and assigns new MPLS labels to the routes advertised to the PE in the local AS if they are labeled IPv4 routes.</p>
</li><li><p>Configure the PE and ASBR in the same AS to exchange labeled IPv4 routes.</p>
</li><li><p>Configure the ASBRs to exchange labeled IPv4 routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369720__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of PE1 (1.1.1.9), ASBR1 (2.2.2.9), ASBR2 (3.3.3.9), and PE2 (4.4.4.9)</p>
</li><li><p>Name (vpn1), RD (100:1), and export and import VPN targets (1:1) of the VPN instance on each PE</p>
</li><li><p>Route-policies (policy1 and policy2) configured on the ASBR</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369720__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IGP on the MPLS backbone network in AS100 and AS200, so that the PE and ASBR in the same AS can communicate.</span><p><p>This example uses OSPF as the IGP.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The 32-bit loopback interface address used as the LSR ID should be advertised by OSPF.</p>
</div></div>
<p>After the configurations are complete, the OSPF neighbor relationship can be established between the ASBR and PE in the same AS. Run the <strong>display ospf peer</strong> command. The command output shows that the status of the OSPF neighbor relationship is <strong>Full</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ospf peer</strong>
(M) Indicates MADJ neighbor


          OSPF Process 1 with Router ID 1.1.1.9
                Neighbors

 Area 0.0.0.0 interface 10.10.1.2 (GE<span>0/1/0</span>)'s neighbors
 Router ID: 10.10.1.1            Address: 10.10.1.1        
   State: Full           Mode:Nbr is Master     Priority: 1
   DR: 10.10.1.2         BDR: 10.10.1.1         MTU: 0
   Dead timer due in  34  sec
   Retrans timer interval: 5
   Neighbor is up for 00h09m56s
   Neighbor Up Time : 2020-03-03 11:55:21
   Authentication Sequence: [ 0 ]</pre>
<p>The ASBR and PE in the same AS can learn the routes to each other's Loopback1 interface and ping each other.</p>
</p></li><li><span>Configure MPLS and MPLS LDP both globally and per interface on each node of the MPLS backbone networks in AS100 and AS200 and set up LDP LSPs.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Set up IBGP peer relationships between the PEs and ASBRs in each AS.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Configure the VPN instance on the PE and configure the CE to access the PE.</span><p><p>For configuration details, see the configuration files.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The import VPN target configured on PE1 must be the same as the export VPN target configured on PE2; the export VPN target configured on PE1 must be the same as the import VPN target configured on PE2.</p>
</div></div>
</p></li><li><span>Configure the function to exchange labeled IPv4 routes.</span><p><p># Configure PE1 to exchange labeled IPv4 routes with ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.9 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># <span>Enable MPLS on GE <span>0/2/0</span> that connects ASBR1 to ASBR2.</span></p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.21.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure routing policies on ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>route-policy policy1 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>route-policy policy2 permit node 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>if-match mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>apply mpls-label</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-route-policy] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-route-policy]<strong> quit</strong></pre>
<p># Apply the routing policies to the routes advertised to PE1 and enable ASBR1 to exchange label IPv4 routes with PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> peer 1.1.1.9 route-policy policy2 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 1.1.1.9 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>commit</strong></pre>
<p># Apply the routing policies to the routes advertised to ASBR2 and enable ASBR1 to exchange label IPv4 routes with ASBR2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>peer 10.21.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 10.21.1.2 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 10.21.1.2 label-route-capability</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p># Configure ASBR1 to advertise the loopback routes of PE1 to ASBR2, and then to PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp]<strong> network 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The configurations of PE2 and ASBR2 are similar to the configurations of PE1 and ASBR1, respectively. For configuration details, see the configuration files.</p>
</p></li><li><span>Establish an MP-EBGP peer relationship between PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.9 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.9 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.9 ebgp-max-hop 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 4.4.4.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 ebgp-max-hop 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, the CEs can learn routes to each other's interface and can ping through each other.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>display ipv6 routing-table</strong></pre>
<pre class="screen">Routing Table : _public_
         Destinations : 7        Routes : 7

Destination  : ::1                                     PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : ::FFFF:127.0.0.0                        PrefixLength : 104
NextHop      : ::FFFF:127.0.0.1                        Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : ::FFFF:127.0.0.1                        PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : 2001:db8:1::                            PrefixLength : 64
NextHop      : 2001:db8:1::1                           Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : D

Destination  : 2001:db8:1::1                           PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : D

Destination  : 2001:db8:2::                            PrefixLength : 64
NextHop      : 2001:db8:1::2                           Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : 2001:db8:1::2                           TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : RD

Destination  : FE80::                                  PrefixLength : 10
NextHop      : ::                                      Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : NULL0                                   Flags        : D</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ipv6 2001:db8:2::1</strong></pre>
<pre class="screen">  PING 2001:db8:2::1 : 56  data bytes, press CTRL_C to break
    Reply from 2001:db8:2::1
    bytes=56 Sequence=1 hop limit=60 time=6 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=2 hop limit=60 time=3 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=3 hop limit=60 time=3 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=4 hop limit=60 time=2 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=5 hop limit=60 time=2 ms

  ---2001:db8:2::1 ping statistics---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max=2/3/6 ms</pre>
<p>ASBRs do not have VPNv6 routes. Run the <strong>display bgp routing-table label</strong> command on an ASBR. The command output shows the label information of the routes.</p>
<p>The following example uses the command output on ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>display bgp routing-table label</strong></pre>
<pre class="screen"> BGP Local router ID is 10.10.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found


 Total Number of Routes: 2
        Network                       NextHop                       In/Out Label

 *&gt;     1.1.1.9                       0.0.0.0                       48062/NULL             
 *&gt;     4.4.4.9                       10.21.1.2                     48063/48060</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369720__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:1::1/64
#
bgp 65001
 router-id 5.5.5.9
 peer 2001:db8:1::2 as-number 100
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:db8:1::2 enable
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:1::2/64
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bgp 100
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 peer 4.4.4.9 as-number 200
 peer 4.4.4.9 ebgp-max-hop 10
 peer 4.4.4.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.9 enable
  peer 2.2.2.9 label-route-capability
  peer 4.4.4.9 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 4.4.4.9 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  peer 2001:db8:1::1 as-number 65001
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.21.1.1 255.255.255.0
<span> mpls</span>
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bgp 100
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 peer 10.21.1.2 as-number 200
 #
 ipv4-family unicast
  undo synchronization
  network 1.1.1.9 255.255.255.255
  peer 1.1.1.9 enable
  peer 1.1.1.9 route-policy policy2 export
  peer 1.1.1.9 label-route-capability
  peer 10.21.1.2 enable
  peer 10.21.1.2 route-policy policy1 export
  peer 10.21.1.2 label-route-capability
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 apply mpls-label
#
route-policy policy2 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.40.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.21.1.2 255.255.255.0
<span> mpls</span>
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 200
 peer 4.4.4.9 as-number 200
 peer 4.4.4.9 connect-interface LoopBack1
 peer 10.21.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 4.4.4.9 255.255.255.255
  peer 4.4.4.9 enable
  peer 4.4.4.9 route-policy policy2 export
  peer 4.4.4.9 label-route-capability
  peer 10.21.1.1 enable
  peer 10.21.1.1 route-policy policy1 export
  peer 10.21.1.1 label-route-capability
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.40.1.0 0.0.0.255
#
route-policy policy1 permit node 1
 apply mpls-label
#
route-policy policy2 permit node 1
 if-match mpls-label
 apply mpls-label
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.40.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:2::2/64
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
bgp 200
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 ebgp-max-hop 10
 peer 1.1.1.9 connect-interface LoopBack1
 peer 3.3.3.9 as-number 200
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
  peer 3.3.3.9 enable
  peer 3.3.3.9 label-route-capability
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.9 enable
 #
 ipv6-family vpn-instance vpn1
  import-route direct
  peer 2001:db8:2::1 as-number 65002
#
ospf 1
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.40.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:2::1/64
#
bgp 65002
 router-id 6.6.6.9
 peer 2001:db8:2::2 as-number 200
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:db8:2::2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">Configuration Examples for BGP/MPLS IPv6 VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2050.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2098.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>