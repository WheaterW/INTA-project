
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Basic VPN Dual-Stack Access">
<meta name="abstract" content="This section provides an example for configuring basic VPN dual-stack access. After both IPv4 and IPv6 address families are configured in VPN instances, the interfaces bound to the VPN instances can support not only IPv4 VPN access but also IPv6 VPN access. This implementation greatly improves the feasibility of the transition from IPv4 to IPv6.">
<meta name="description" content="This section provides an example for configuring basic VPN dual-stack access. After both IPv4 and IPv6 address families are configured in VPN instances, the interfaces bound to the VPN instances can support not only IPv4 VPN access but also IPv6 VPN access. This implementation greatly improves the feasibility of the transition from IPv4 to IPv6.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2119.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0283977320">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Basic VPN Dual-Stack Access</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0283977320"></a><a name="EN-US_TASK_0283977320"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Basic VPN Dual-Stack Access</h1>
<div class="taskbody"><p>This section provides an example for configuring basic VPN dual-stack access. After both IPv4 and IPv6 address families are configured in VPN instances, the interfaces bound to the VPN instances can support not only IPv4 VPN access but also IPv6 VPN access. This implementation greatly improves the feasibility of the transition from IPv4 to IPv6.</p>
<div class="context"><a name="EN-US_TASK_0283977320__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0283977320__fig_dc_vrp_mpls-l3vpn-v6_cfg_204001">Figure 1</a>, CE1 and CE3 belong to VPN A, and CE2 and CE4 belong to VPN B. CE1 and CE2 need to communicate with CE3 and CE4, respectively, using both IPv4 and IPv6 routes over the public network, but the public network does not need to be aware of routing information within the sites.</p>
<div class="p">With VPN dual-stack access configured, the sites within the same VPN instance are allowed to communicate through the MPLS backbone network, but the sites of different VPN instances are not allowed to communicate. In addition, different methods are used to exchange routes between PEs and CEs:<ul><li><p>BGP and BGP4+ are required between PE1 and CE1, and between PE2 and CE4.</p>
</li><li><p>Static routes are required between PE1 and CE2.</p>
</li><li><p>OSPF and OSPFv3 are required between PE2 and CE3.</p>
</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0283977320__fig_dc_vrp_mpls-l3vpn-v6_cfg_204001"><a name="EN-US_TASK_0283977320__fig_dc_vrp_mpls-l3vpn-v6_cfg_204001"></a><a name="fig_dc_vrp_mpls-l3vpn-v6_cfg_204001"></a><span class="figcap"><b>Figure 1 </b>Networking diagram for configuring basic VPN dual-stack access</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE <span>0/1/0</span>, GE <span>0/2/0</span>, and GE <span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0284307254.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0283977320__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the IPv4 backbone network to implement PE interworking.</p>
</li><li><p>Configure MPLS and MPLS LDP on each PE and the P and establish an LDP LSP between PEs.</p>
</li><li><p>Configure MP-IBGP on PE1 and PE2 so that the PEs can use BGP to exchange IPv4 and IPv6 VPN routes.</p>
</li><li><p>Configure VPN instances that support the IPv4 and IPv6 address families on each PE and bind the PE interfaces that connect to CEs to the VPN instances.</p>
</li><li><p>Configure IPv4 and IPv6 routing protocols between PEs and CEs so that PEs and CEs can exchange IPv4 and IPv6 routes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0283977320__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>AS numbers of PEs and CEs</p>
</li><li><p>VPN instance names:<strong> vpna</strong> and <strong>vpnb</strong></p>
</li><li><p>Attributes of the VPN instance IPv4 and IPv6 address families, such as the RDs and VPN targets</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0283977320__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IPv4 or IPv6 address to each involved interface on devices.</span><p><p># Assign IPv4 and IPv6 addresses to interfaces on CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> ipv6 address 2001:db8:1::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>The configurations of CE2, CE3, CE4, P, PE1, and PE2 are similar to the configuration of CE1. For configuration details, see <a href="#EN-US_TASK_0283977320__example562924779214051">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure an IGP over the IPv4 backbone network to implement communication between PEs. IS-IS is used in this example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> network-entity 10.1111.1111.1111.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitEthernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configurations of the P and PE2 are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0283977320__example562924779214051">Configuration Files</a> in this section.</p>
<p>After the configuration is complete, PE1, PE2, and the P can learn routes, including the routes to loopback interfaces, from one another. You can run the <strong>display ip routing-table</strong> command to view the routes. The command output on PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 11        Routes : 11

Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface

1.1.1.9/32          Direct  0    0           D   127.0.0.1       InLoopBack0
<strong>2.2.2.9/32</strong>         ISIS-L2 15   10          D   10.11.11.2      GigabitEthernet<span>0/3/0</span>
<strong>3.3.3.9/32</strong>         ISIS-L2 15   20          D   10.11.11.2      GigabitEthernet<span>0/3/0</span>
127.0.0.0/8         Direct  0    0           D   127.0.0.1       InLoopBack0
127.0.0.1/32        Direct  0    0           D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0
10.11.11.0/24       Direct  0    0           D   10.11.11.1      GigabitEthernet<span>0/3/0</span>
10.11.11.1/32       Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/3/0</span>
10.11.11.255/32     Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/3/0</span>
10.12.12.0/24       ISIS-L2 15   20          D   10.11.11.2      GigabitEthernet<span>0/3/0</span>
255.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Enable MPLS and MPLS LDP on each device and device interface over the IPv4 backbone network. Create an LDP LSP between PE1 and PE2.</span><p><p># Enable MPLS and MPLS LDP on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitEthernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configurations of the P and PE2 are similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0283977320__example562924779214051">Configuration Files</a> in this section.</p>
<p>After completing the configurations, an LDP LSP can be established between PE1 and PE2. Then, run the <strong>display mpls ldp lsp</strong> command. The command output shows that an LDP LSP has been successfully established on each device. The command output on PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 1.1.1.9/32         3/NULL         2.2.2.9         127.0.0.1       InLoop0
*1.1.1.9/32         Liberal/1024                   DS/2.2.2.9
 2.2.2.9/32         NULL/3         -               10.11.11.2       GE<span>0/3/0</span>
 2.2.2.9/32         1024/3         2.2.2.9         10.11.11.2       GE<span>0/3/0</span>
 3.3.3.9/32         NULL/1025      -               10.11.11.2       GE<span>0/3/0</span>
 3.3.3.9/32         1025/1025      2.2.2.9         10.11.11.2       GE<span>0/3/0</span>
 -------------------------------------------------------------------------------
 TOTAL: 5 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 Frr LSP(s) Found.
<span> An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</span>
</pre>
</p></li><li><span>On each PE, configure a VPN instance that supports the IPv4 and IPv6 address families and bind the PE interfaces that connect to CEs to the VPN instances.</span><p><p># Configure a VPN instance named <strong>vpna</strong> on PE1 to support the IPv4 and IPv6 address families.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 66:77 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>vpn-target 22:22 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>vpn-target 33:33 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Bind the interface that directly connects PE1 to CE1 to the VPN instance named <strong>vpna</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8:1::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure a VPN instance named <strong>vpnb</strong> on PE1 to support the IPv4 and IPv6 address families.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv4] <strong>route-distinguisher 200:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv4] <strong>vpn-target 88:99 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv6] <strong>route-distinguisher 100:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv6] <strong>vpn-target 44:44 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv6]<strong> vpn-target 55:55 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpnb] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Bind the interface that directly connects PE1 to CE2 to the VPN instance named <strong>vpnb</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:db8:3::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see <a href="#EN-US_TASK_0283977320__example562924779214051">Configuration Files</a> in this section.</p>
<p>After the configuration is complete, run the <strong>display ip vpn-instance verbose</strong> command on each PE to view information about the VPN instances. The command output shows that each PE can ping its connected CE. The command output on PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip vpn-instance verbose</strong></pre>
<pre class="screen"> Total VPN-Instances configured      : 3
 Total IPv4 VPN-Instances configured : 3
 Total IPv6 VPN-Instances configured : 2

 VPN-Instance Name and ID : __dcn_vpn__, 2
  Interfaces : LoopBack2147483647
 Address family ipv4
  Create date : 2020-10-09 07:25:13+00:00
  Up time : 9 days, 20 hours, 11 minutes and 54 seconds       
  Vrf Status : UP
  Label Policy : label per instance
  Per-Instance Label : NULL
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe

 VPN-Instance Name and ID : vpna, 4
  Interfaces : GigabitEthernet<span>0/1/0</span>
 Address family ipv4
  Create date : 2020-10-19 02:12:42+00:00
  Up time : 0 days, 01 hours, 24 minutes and 25 seconds       
  Vrf Status : UP
  Route Distinguisher : 200:1
  Export VPN Targets : 66:77
  Import VPN Targets : 66:77
  Label Policy : label per instance
  Per-Instance Label : 48123
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe
 Address family ipv6
  Create date : 2020-10-19 02:14:20+00:00
  Up time : 0 days, 01 hours, 22 minutes and 47 seconds       
  Vrf Status : UP
  Route Distinguisher : 100:1
  Export VPN Targets : 22:22
  Import VPN Targets : 33:33
  Label Policy : label per instance
  Per-Instance Label : 48121
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe

 VPN-Instance Name and ID : vpnb, 5
  Interfaces : GigabitEthernet<span>0/2/0</span>
 Address family ipv4
  Create date : 2020-10-19 02:16:30+00:00
  Up time : 0 days, 01 hours, 20 minutes and 37 seconds       
  Vrf Status : UP
  Route Distinguisher : 200:3
  Export VPN Targets : 88:99
  Import VPN Targets : 88:99
  Label Policy : label per instance
  Per-Instance Label : 48124
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe
 Address family ipv6
  Create date : 2020-10-19 02:16:30+00:00
  Up time : 0 days, 01 hours, 20 minutes and 38 seconds       
  Vrf Status : UP
  Route Distinguisher : 100:3
  Export VPN Targets : 44:44
  Import VPN Targets : 55:55
  Label Policy : label per instance
  Per-Instance Label : 48122
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ping ip -vpn-instance vpna 10.1.1.1</strong></pre>
<pre class="screen">  PING 10.1.1.1: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.1: bytes=56 Sequence=1 ttl=255 time=968 ms
    Reply from 10.1.1.1: bytes=56 Sequence=2 ttl=255 time=9 ms
    Reply from 10.1.1.1: bytes=56 Sequence=3 ttl=255 time=7 ms
    Reply from 10.1.1.1: bytes=56 Sequence=4 ttl=255 time=6 ms
    Reply from 10.1.1.1: bytes=56 Sequence=5 ttl=255 time=8 ms

  --- 10.1.1.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 6/199/968 ms</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ping ipv6 </strong><strong>vpn-instance vpna 2001:db8:1::1</strong>
  PING 2001:DB8:1::1 : 56  data bytes, press CTRL_C to break
    Reply from 2001:DB8:1::1
    bytes=56 Sequence=1 hop limit=64 time=311 ms
    Reply from 2001:DB8:1::1
    bytes=56 Sequence=2 hop limit=64 time=9 ms
    Reply from 2001:DB8:1::1
    bytes=56 Sequence=3 hop limit=64 time=12 ms
    Reply from 2001:DB8:1::1
    bytes=56 Sequence=4 hop limit=64 time=11 ms
    Reply from 2001:DB8:1::1
    bytes=56 Sequence=5 hop limit=64 time=7 ms

  --- 2001:DB8:1::1 ping statistics---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max=7/70/311 ms</pre>
</p></li><li><span>Establish VPNv4 and VPNv6 peer relationships between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv6]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configurations are complete, run the <strong>display bgp vpnv4 all peer</strong> and <strong>display bgp vpnv6 all peer</strong> commands on the PEs to check whether VPNv4 and VPNv6 peer relationships are established. The command output on PE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display bgp vpnv4 all peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.9                          4         100       32       36     0 00:22:36 <strong>Established</strong>        0</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display bgp vpnv6 all peer</strong>
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.9                          4         100       35       39     0 00:25:09 <strong>Established</strong>        2</pre>
<p>The command output shows that the status of VPNv4 and VPNv6 peer relationships is <strong>Established</strong>, indicating that VPNv4 and VPNv6 peer relationships have been established between PE1 and PE2.</p>
</p></li><li><span>Configure BGP4 and BGP4+ on PE1 and CE1.</span><p><p># Configure EBGP on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> ipv6-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpna] <strong>peer 2001:db8:1::1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-6-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure EBGP on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>router-id 10.10.10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv4]<strong> peer 10.1.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv4] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 2001:db8:1::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6]<strong> network 2001:db8:8:: 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6]<strong> peer 2001:db8:1::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>The configuration of the EBGP relationship between PE2 and CE4 is similar to the configuration of the EBGP relationship between PE1 and CE1. For configuration details, see <a href="#EN-US_TASK_0283977320__example562924779214051">Configuration Files</a> in this section.</p>
<p>After the preceding configurations are complete, run the <strong>display bgp vpnv4 vpn-instance</strong> <em>vpn-instance-name</em> <strong>peer</strong> and <strong>display bgp vpnv6 vpn-instance</strong> <em>vpn-instance-name</em> <strong>peer</strong> commands on the PEs to check whether the BGP peer relationships are established. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display bgp vpnv4 vpn-instance vpna peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

 VPN-Instance vpna, Router ID 1.1.1.9:
  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.1.1.1                         4       65410       98       95     0 01:21:55 Established        2</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display bgp vpnv6 vpn-instance vpna peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  VPN-Instance vpna, Router ID 1.1.1.9:
  Peer                             V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  2001:DB8:1::1                    4       65410      298      301     0 04:17:25 Established        3</pre>
</p></li><li><span>Configure static routes between PE1 and CE2.</span><p><p># Configure IPv4 and IPv6 static routes for the VPN instance <strong>vpnb</strong> on PE1 and import the routes to the routing tables of the BGP-VPN instance IPv4 and IPv6 address families.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ip route-static vpn-instance vpnb 1.1.1.1 32 10.2.1.1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ipv6 route-static vpn-instance vpnb 2001:db8:8:: 64 2001:db8:3::1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> ipv4-family vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp4-vpnb]<strong> import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp4-vpnb]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> ipv6-family vpn-instance vpnb</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpnb]<strong> import-route static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpnb] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure IPv4 and IPv6 default routes on CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>ip route-static 0.0.0.0 0 10.2.1.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>ipv6 route-static :: 0 2001:db8:3::2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure OSPF and OSPFv3 between PE2 and CE3.</span><p><p># Configure OSPF and OSPFv3 on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ospf 1 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area 0.0.0.0] <strong>network </strong><strong>3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area 0.0.0.0] <strong>network </strong><strong>10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area 0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1]<strong> import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ospfv3 1 vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospfv3-1]<strong> router-id 10.10.11.11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospfv3-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospfv3-1-area 0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospfv3-1]<strong> import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospfv3-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet <span>0/2/0</span>] <strong>ospfv3 1 area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Gigabitethernet <span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Import OSPF and OSPFv3 routes to the BGP routing table on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp4-vpna]<strong> import-route ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp4-vpna]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> ipv6-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpna]<strong> import-route ospfv3 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-6-vpna]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure OSPF and OSPFv3 on CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-1-area 0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-1-area 0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-1-area 0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>ospfv3 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospfv3-1]<strong> router-id 22.22.22.22</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospfv3-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospfv3-1-area 0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-ospfv3-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>]<strong> ospfv3 1 area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-LoopBack1]<strong> ospfv3 1 area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, a ping (with the source address specified) between CE1 and CE3, and between CE2 and CE4 can succeed. The command output on CE1 is used as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ip -a 1.1.1.1 2.2.2.2</strong></pre>
<pre class="screen">  PING 2.2.2.2: 56  data bytes, press CTRL_C to break
    Reply from 2.2.2.2: bytes=56 Sequence=1 ttl=253 time=45 ms
    Reply from 2.2.2.2: bytes=56 Sequence=2 ttl=253 time=28 ms
    Reply from 2.2.2.2: bytes=56 Sequence=3 ttl=253 time=35 ms
    Reply from 2.2.2.2: bytes=56 Sequence=4 ttl=253 time=22 ms
    Reply from 2.2.2.2: bytes=56 Sequence=5 ttl=253 time=43 ms

  --- 2.2.2.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 22/34/45 ms</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping ipv6 -a 2001:db8:8::1 2001:db8:9::1</strong></pre>
<pre class="screen">  PING 2001:DB8:9::1 : 56  data bytes, press CTRL_C to break
    Reply from 2001:DB8:9::1
    bytes=56 Sequence=1 hop limit=62 time=497 ms
    Reply from 2001:DB8:9::1
    bytes=56 Sequence=2 hop limit=62 time=18 ms
    Reply from 2001:DB8:9::1
    bytes=56 Sequence=3 hop limit=62 time=18 ms
    Reply from 2001:DB8:9::1
    bytes=56 Sequence=4 hop limit=62 time=17 ms
    Reply from 2001:DB8:9::1
    bytes=56 Sequence=5 hop limit=62 time=17 ms

  --- 2001:DB8:9::1 ping statistics---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max=17/113/497 ms</pre>
<p>CE4 also has IP addresses 2.2.2.2 and 2001:db8:9::1/64. Therefore, the data forwarding path is as expected. You only need to run the <strong>display </strong>{ <strong>ipv4 </strong>| <strong>ipv6 </strong>}<strong> statistics interface</strong> command on PE2 to check the change in the number of ICMP packets sent and received on the interface.</p>
<p>For the IPv4 VPN, run the <strong>ping ipv4 -a 1.1.1.1 -c 100 2.2.2.2</strong> command on CE1 to send 100 IPv4 packets with source addresses. In addition, run the <strong>display ipv4 statistics interface gigabitethernet<span>0/1/0</span></strong> or <strong>display ipv4 statistics interface gigabitethernet<span>0/2/0</span></strong> command on PE2 repeatedly to check the change in the number of ICMPv4 messages sent and received by each interface. Since the data on GE <span>0/2/0</span> keeps changing, the IPv4 data has been successfully forwarded to CE3 in the same VPN, which indicates that different VPNs have been isolated from each other.</p>
<p>For the IPv6 VPN, run the <strong>ping ipv6 -a 2001:db8:8::1 -c 100 2001:db8:9::1</strong> command on CE1 to send 100 IPv6 packets with source addresses. In addition, run the <strong>display ipv6 statistics interface gigabitethernet<span>0/1/0</span></strong> or <strong>display ipv6 statistics interface gigabitethernet<span>0/2/0</span></strong> command on PE2 repeatedly to check the change in the number of ICMPv6 messages sent and received by each interface. Since the data on GE <span>0/2/0</span> keeps changing, the IPv6 data has been forwarded to CE3 in the same VPN, which indicates that different VPNs have been isolated from each other.</p>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0283977320__example562924779214051"><a name="EN-US_TASK_0283977320__example562924779214051"></a><a name="example562924779214051"></a><a name="EN-US_TASK_0283977320__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
<span>  apply-label per-instance</span>
  vpn-target 66:77 export-extcommunity
  vpn-target 66:77 import-extcommunity
 ipv6-family
  route-distinguisher 100:1
<span>  apply-label per-instance</span>
  vpn-target 22:22 export-extcommunity
  vpn-target 33:33 import-extcommunity
#
ip vpn-instance vpnb
 ipv4-family
  route-distinguisher 200:3
  apply-label per-instance
  vpn-target 88:99 export-extcommunity
  vpn-target 88:99 import-extcommunity
 ipv6-family
  route-distinguisher 100:3
  apply-label per-instance
  vpn-target 44:44 export-extcommunity
  vpn-target 55:55 import-extcommunity
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.1111.1111.1111.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ipv6 enable
 ip address 10.1.1.2 255.255.255.0
 ipv6 address 2001:DB8:1::2/64
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpnb
 ipv6 enable
 ip address 10.2.1.2 255.255.255.0
 ipv6 address 2001:DB8:3::2/64
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.11.11.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
 isis enable 1
#
bgp 100
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.9 enable
 #
 ipv4-family vpn-instance vpna
  peer 10.1.1.1 as-number 65410
 #
 ipv4-family vpn-instance vpnb
  import-route static
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 3.3.3.9 enable
 #
 ipv6-family vpn-instance vpna
  peer 2001:DB8:1::1 as-number 65410
 #
 ipv6-family vpn-instance vpnb
  import-route static
#
 ip route-static vpn-instance vpnb 1.1.1.1 255.255.255.255 10.2.1.1
#
 ipv6 route-static vpn-instance vpnb 2001:DB8:8:: 64 2001:DB8:3::1
#
return </pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
isis 1
 network-entity 20.2222.2222.2222.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.11.11.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.12.12.1 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
 isis enable 1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:2
  apply-label per-instance
  vpn-target 66:77 export-extcommunity
  vpn-target 66:77 import-extcommunity
 ipv6-family
  route-distinguisher 100:2
  apply-label per-instance
  vpn-target 33:33 export-extcommunity
  vpn-target 22:22 import-extcommunity
#
ip vpn-instance vpnb
 ipv4-family
  route-distinguisher 200:4
  apply-label per-instance
  vpn-target 88:99 export-extcommunity
  vpn-target 88:99 import-extcommunity
 ipv6-family
  route-distinguisher 100:4
  apply-label per-instance
  vpn-target 55:55 export-extcommunity
  vpn-target 44:44 import-extcommunity
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls ldp
#
isis 1
 network-entity 30.3333.3333.3333.00
#
ospfv3 1 vpn-instance vpna
 router-id 10.10.11.11
 import-route bgp
 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpnb
 ip address 10.4.1.2 255.255.255.0
 ipv6 enable
 ipv6 address 2001:DB8:5::2/64
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.3.1.2 255.255.255.0
 ipv6 enable
 ipv6 address 2001:DB8:4::2/64
 ospfv3 1 area 0.0.0.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.12.12.2 255.255.255.0
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.9 enable
 #
 ipv4-family vpn-instance vpna
  import-route ospf 1
 #
 ipv4-family vpn-instance vpnb
  peer 10.4.1.1 as-number 65420
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.9 enable
 #
 ipv6-family vpn-instance vpna
  import-route ospfv3 1
 #
 ipv6-family vpn-instance vpnb
  peer 2001:DB8:5::1 as-number 65420
#
ospf 1 vpn-instance vpna
 import-route bgp
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.1.1.1 255.255.255.0 
 ipv6 address 2001:DB8:1::1/64
#
interface LoopBack1
 ipv6 enable
 ip address 1.1.1.1 255.255.255.255
 ipv6 address 2001:DB8:8::1/64
#
bgp 65410
 router-id 10.10.10.10
 peer 10.1.1.2 as-number 100
 peer 2001:DB8:1::2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 1.1.1.1 255.255.255.255
  import-route direct
  peer 10.1.1.2 enable
 #
 ipv6-family unicast
  undo synchronization
  network 2001:DB8:8:: 64
  import-route direct
  peer 2001:DB8:1::2 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.2.1.1 255.255.255.0
 ipv6 address 2001:DB8:3::1/64
#
interface LoopBack1
 ipv6 enable
 ip address 1.1.1.1 255.255.255.255
 ipv6 address 2001:DB8:8::1/64
#
 ip route-static 0.0.0.0 0 10.2.1.2
#
 ipv6 route-static :: 0 2001:DB8:3::2
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
ospfv3 1
 router-id 22.22.22.22
 area 0.0.0.0
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.3.1.1 255.255.255.0
 ipv6 address 2001:DB8:4::1/64
 ospfv3 1 area 0.0.0.0
#
interface LoopBack1
 ipv6 enable
 ip address 2.2.2.2 255.255.255.255
 ipv6 address 2001:DB8:9::1/64
 ospfv3 1 area 0.0.0.0
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE4 configuration file</p>
<pre class="screen">#
sysname CE4
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ip address 10.4.1.1 255.255.255.0
 ipv6 address 2001:DB8:5::1/64
#
interface LoopBack1
 ipv6 enable
 ip address 2.2.2.2 255.255.255.0
 ipv6 address 2001:DB8:9::1/64
#
bgp 65420
 router-id 33.33.33.33
 peer 10.4.1.2 as-number 100
 peer 2001:DB8:5::2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 10.4.1.2 enable
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:DB8:5::2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">Configuration Examples for BGP/MPLS IPv6 VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2119.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>