
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring BGP SoO">
<meta name="abstract" content="By configuring the BGP SoO attribute, you can prevent routes sent from a VPN site from returning to the same site after these routes travel across the backbone network. This avoids routing loops in the VPN site.">
<meta name="description" content="By configuring the BGP SoO attribute, you can prevent routes sent from a VPN site from returning to the same site after these routes travel across the backbone network. This avoids routing loops in the VPN site.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0105.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0106.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369457">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring BGP SoO </title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369457"></a><a name="EN-US_TASK_0172369457"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring BGP SoO </h1>
<div class="taskbody"><p>By configuring the BGP SoO attribute, you can prevent routes sent from a VPN site from returning to the same site after these routes travel across the backbone network. This avoids routing loops in the VPN site.</p>
<div class="context"><a name="EN-US_TASK_0172369457__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>If multiple CEs in a VPN site access different PEs, VPN routes sent from CEs to PEs may return to this VPN site after traveling across the backbone network. This may cause routing loops in the VPN site.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172369457__fig_dc_vrp_mpls-l3vpn-v4_cfg_200601">Figure 1</a>, CE1 and CE2 belong to site1; CE2 and CE3 access PE2; site1 and site2 have the same AS number. EBGP runs between PEs and CEs. PE1 sends the routes received from CE1 to PE2 through MP-IBGP, and PE2 then sends the received routes to CE2 and CE3. CE2, however, has learned these routes through other protocol in the VPN site. As a result, a routing loop may occur in the VPN site.</p>
<p>After you configure the BGP SoO attribute, PE2 checks the SoO attribute carried in the routes to be sent to CE2. If PE2 finds that this SoO attribute is the same as the locally configured SoO attribute, PE2 refuses to send these routes to CE2. This avoids routing loops in site1. PE2 can still send these routes to CE3.</p>
<div class="fignone" id="EN-US_TASK_0172369457__fig_dc_vrp_mpls-l3vpn-v4_cfg_200601"><a name="EN-US_TASK_0172369457__fig_dc_vrp_mpls-l3vpn-v4_cfg_200601"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_200601"></a><span class="figcap"><b>Figure 1 </b>Configuring the BGP SoO attribute</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, and interface3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_200601.png"></span></div>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top" width="33.55481727574751%"><p>Device Name</p>
</td>
<td valign="top" width="33.222591362126245%"><p>Interface</p>
</td>
<td valign="top" width="33.222591362126245%"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>Loopback 1</p>
</td>
<td valign="top"><p>11.11.11.11/32</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>192.168.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>192.168.4.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>Loopback 1</p>
</td>
<td valign="top"><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>192.168.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>192.168.5.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>Loopback 1</p>
</td>
<td valign="top"><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>192.168.2.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>192.168.3.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/3/0</span></p>
</td>
<td valign="top"><p>192.168.5.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>Loopback 1</p>
</td>
<td valign="top"><p>22.22.22.22/32</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>192.168.2.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>192.168.4.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>CE3</p>
</td>
<td valign="top"><p>Loopback 1</p>
</td>
<td valign="top"><p>33.33.33.33/32</p>
</td>
</tr>
<tr><td valign="top"><p>CE3</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>192.168.3.2/30</p>
</td>
</tr>
</table></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369457__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure interface IP addresses and IGP on the backbone network so that PEs can communicate.</p>
</li><li><p>Enable MPLS and MPLS LDP on the backbone network so that LDP LSPs can be established between PEs.</p>
</li><li><p>Establish an MP-IBGP peer relationship between PEs.</p>
</li><li><p>Configure a VPN instance on each PE and bind the interface that connects a PE to a CE to the VPN instance on that PE.</p>
</li><li><p>Establish EBGP peer relationships between PEs and CEs and enable AS number substitution on PEs.</p>
</li><li><p>Configure the BGP SoO attribute on PEs for CEs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369457__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of PEs</p>
</li><li><p>Names of the VPN instances created on PE1 and PE2, RDs, and VPN targets of the VPN instance IPv4 address family</p>
</li><li><p>Numbers of the ASs where <span class="keyword">Router</span>s reside</p>
</li><li><p>Value of the BGP SoO attribute on PEs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369457__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses and IGP on the backbone network so that the PEs can learn routes to each other's loopback interface.</span><p><p>This example uses OSPF as IGP. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display ip routing-table</strong> command on PEs. The command output shows that the PEs have learned the routes to each other's loopback interface through OSPF.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 9        Routes : 9

Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0           D   127.0.0.1       InLoopBack0
        <strong>2.2.2.2/32</strong>  OSPF    10   1562        D   192.168.5.2      GigabitEthernet<span>0/3/0</span>
      192.168.5.0/30  Direct  0    0           D   192.168.5.1     GigabitEthernet<span>0/3/0</span>
      192.168.5.1/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/3/0</span>
    192.168.5.255/32  Direct  0    0           D   127.0.0.1       GigabitEthernet<span>0/3/0</span>
      127.0.0.0/8   Direct  0    0           D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0           D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0
255.255.255.255/32  Direct  0    0           D   127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Enable MPLS and MPLS LDP on the backbone network so that LDP LSPs can be established between PEs.</span><p><p>You need to enable MPLS and MPLS LDP on the PEs in the system view and interface view.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For configuration details, see the configuration file.</p>
<p>After completing the configurations, run the <strong>display mpls ldp lsp</strong> command on PEs. The command output shows information about the labels assigned to the routes to loopback interfaces on the other PEs. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp lsp</strong>

 LDP LSP Information
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop         OutInterface
 -------------------------------------------------------------------------------
 1.1.1.1/32         3/NULL         2.2.2.2         127.0.0.1       InLoop0
*1.1.1.1/32         Liberal/1024                   DS/2.2.2.2
 2.2.2.2/32         NULL/3         -               192.168.5.2       GE<span>0/3/0</span>
 2.2.2.2/32         1024/3         2.2.2.2         192.168.5.2       GE<span>0/3/0</span>
 -------------------------------------------------------------------------------
 TOTAL: 3 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 Frr LSP(s) Found.
<span> An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</span>
</pre>
</p></li><li><span>Establish an MP-IBGP peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For configuration details, see the configuration file.</p>
<p>After completing the configurations, run the <strong>display bgp peer</strong> or <strong>display bgp vpnv4 all peer</strong> command on PEs. The command output shows that BGP peer relationships have been established between PEs. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp peer</strong>

 BGP local router ID : 192.168.5.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down State       PrefRcv

  2.2.2.2         4         100      187      186     0 02:44:06 <strong>Established</strong>       1</pre>
</p></li><li><span>Configure an IPv4-address-family-supporting VPN instance on each PE and bind the interface that connects a PE to a CE to the VPN instance on that PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 100:100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 100:100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.2.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.3.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display ip vpn-instance</strong> command on PEs to check VPN instance configurations.</p>
</p></li><li><span>Establish EBGP peer relationships between PEs and CEs, enable AS number substitution on PEs, and configure PEs to import routes from CEs.</span><p><p>In this configuration example, the two VPN sites have the same AS number. Therefore, AS number substitution needs to be enabled on PE1 and PE2.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 192.168.1.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 192.168.1.2 substitute-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 192.168.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 192.168.4.0 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 192.168.2.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 192.168.3.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 192.168.2.2 substitute-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 192.168.3.2 substitute-as</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>peer 192.168.2.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>network 22.22.22.22 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>network 192.168.4.0 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-bgp] <strong>peer 192.168.3.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-bgp] <strong>network 33.33.33.33 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on PEs. The command output shows that the status of EBGP peer relationships between PEs and CEs is <strong>Established</strong>. This indicates that EBGP peer relationships have been established between PEs and CEs. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 vpn-instance vpna peer</strong>

 BGP local router ID : 192.168.5.1
 Local AS number : 100

 VPN-Instance vpna, router ID 192.168.5.1:
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down    State       PrefRcv

  192.168.1.2        4       65410      224      231     0 03:02:12 <strong>Established</strong>     1</pre>
<p>Run the <strong>display bgp vpnv4 routing-table</strong> command on PEs. The command output shows information about the routes sent from the PEs to CEs. The following example uses the routes sent from PE2 to CE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>display bgp vpnv4 vpn-instance vpna routing-table peer 192.168.2.2 advertised-routes</strong>

 VPN-Instance vpna, router ID 2.2.2.2:

 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>

 Total Number of Routes: 7
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  11.11.11.11/32     1.1.1.1         0          100        0      65410i
 *&gt;   22.22.22.22/32     192.168.2.2     0                     0      65410i
 *&gt;   33.33.33.33/32     192.168.3.2     0                     0      65410i
 *&gt;i  192.168.1.0/30     1.1.1.1         0          100        0      ?
 *&gt;   192.168.2.0/30     0.0.0.0         0                     0      ?
 *&gt;   192.168.3.0/30     0.0.0.0         0                     0      ?
 *&gt;   192.168.4.0/30     192.168.2.2     0                     0      65410i</pre>
</p></li><li><span>Configure the BGP SoO attribute on PEs.</span><p><p>Because CE1 and CE2 reside in the same site, the same BGP SoO attribute needs to be configured on PE1 and PE2 for CE1 and CE2 respectively. Because PE2 accesses two VPN sites, different SoO attributes need to be configured on PE2 for different CEs.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 192.168.1.2 soo 100:101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 192.168.2.2 soo 100:101</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>peer 192.168.3.2 soo 100:102</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <strong>display bgp vpnv4 routing-table</strong> command on PE2 again. The command output shows that PE2 does not send any VPN route to CE2 and the routes sent from PE2 to CE3 remain unchanged.</p>
<pre class="screen">&lt;PE2&gt; <strong>display bgp vpnv4 vpn-instance vpna routing-table peer 192.168.3.2 advertised-routes</strong></pre>
<pre class="screen"> 
 VPN-Instance vpna, router ID 2.2.2.2:

 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>

 Total Number of Routes: 5
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   22.22.22.22/32     192.168.2.2     0                     0      65410i
 *&gt;   33.33.33.33/32     192.168.3.2     0                     0      65410i
 *&gt;   192.168.2.0/30     0.0.0.0         0                     0      ?
 *&gt;   192.168.3.0/30     0.0.0.0         0                     0      ?
 *&gt;   192.168.4.0/30     192.168.2.2     0                     0      65410i</pre>
<p>Run the <strong>display bgp vpnv4 routing-table</strong> command on PE2. The command output shows information about the SoO attribute carried in the routes sent from PE2 to CE3.</p>
<pre class="screen">&lt;PE2&gt; display bgp vpnv4 vpn-instance vpna routing-table 11.11.11.11 32

 BGP local router ID : 2.2.2.2
 Local AS number : 100

 VPN-Instance vpna, router ID 2.2.2.2:
 Paths:   1 available, 1 best, 1 select
 BGP routing table entry information of 11.11.11.11/32:
 Label information (Received/Applied): 1028/NULL
 From: 1.1.1.1 (192.168.5.1)
 Route Duration: 00h11m12s
 Relay Tunnel Out-Interface: GigabitEthernet<span>0/3/0</span>
 Relay token: 0x800001
 Original nexthop: 1.1.1.1
 Qos information : 0x0
 Ext-Community:RT &lt;100 : 100&gt;, <strong>SoO &lt;100 : 101&gt;</strong>
 AS-path 65410, origin igp, MED 0, localpref 100, pref-val 0, valid, internal, b
est, select, active, pre 255
 Advertised to such 2 peers:
 Update-Group 0 :
    192.168.3.2</pre>
<p>The preceding command output shows that after the BGP SoO attribute is configured, the VPN routes received from CEs carry the SoO attribute, and PE2 does not send any route to CE2. This indicates that the configuration of the BGP SoO attribute has taken effect.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369457__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>CE1 configuration file<pre class="screen">#sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.4.1 255.255.255.252
#
interface LoopBack1
 ip address 11.11.11.11 255.255.255.255
#
bgp 65410
 peer 192.168.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  network 192.168.4.0 255.255.255.252
  peer 192.168.1.1 enable
#
return </pre>
</li><li>CE2 configuration file<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.4.2 255.255.255.252
#
interface LoopBack1
 ip address 22.22.22.22 255.255.255.255
#
bgp 65410
 peer 192.168.2.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  network 192.168.4.0 255.255.255.252
  peer 192.168.2.1 enable
#
return</pre>
</li><li>PE1 configuration file<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 192.168.1.1 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 192.168.5.1 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
  peer 192.168.1.2 as-number 65410
  peer 192.168.1.2 substitute-as
  peer 192.168.1.2 soo 100:101
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.5.0 0.0.0.3
#
return</pre>
</li><li>PE2 configuration file<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:2
  apply-label per-instance
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 192.168.2.1 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 192.168.3.1 255.255.255.252
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 192.168.5.2 255.255.255.252
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance vpna
  import-route direct
  peer 192.168.2.2 as-number 65410
  peer 192.168.2.2 substitute-as
  peer 192.168.2.2 soo 100:101
  peer 192.168.3.2 as-number 65410
  peer 192.168.3.2 substitute-as
  peer 192.168.3.2 soo 100:102
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.5.0 0.0.0.3
#
return  </pre>
</li><li>CE3 configuration file<pre class="screen">#
sysname CE3
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.252
#
interface LoopBack1
 ip address 33.33.33.33 255.255.255.255
#
bgp 65410
 peer 192.168.3.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 33.33.33.33 255.255.255.255
  peer 192.168.3.1 enable
#
return    </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0105.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0106.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>