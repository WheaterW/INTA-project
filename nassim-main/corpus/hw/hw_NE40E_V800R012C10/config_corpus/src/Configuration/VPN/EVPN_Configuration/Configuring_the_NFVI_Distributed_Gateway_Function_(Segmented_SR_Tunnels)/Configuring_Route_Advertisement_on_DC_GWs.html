
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Route Advertisement on DC GWs">
<meta name="abstract" content="Route advertisement can be configured on DC GWs for them to construct their own forwarding entries based on received EVPN or BGP routes.">
<meta name="description" content="Route advertisement can be configured on DC GWs for them to construct their own forwarding entries based on received EVPN or BGP routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0121.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0122.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0124.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370576">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Route Advertisement on DC GWs</title>
</head>
<body><a name="EN-US_TASK_0172370576"></a><a name="EN-US_TASK_0172370576"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Route Advertisement on DC GWs</h1>
<div class="taskbody"><p>Route advertisement can be configured on DC GWs for them to construct their own forwarding entries based on received EVPN or BGP routes.</p>
<div class="steps"><a name="EN-US_TASK_0172370576__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure DC GWs to advertise default static VPN routes and VPN loopback routes through EVPN.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>Loopback</span></strong> <i><span class="varname">interface-number</span></i></span><p><p>The loopback interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname">ip binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The loopback interface is bound to an L3VPN instance.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a></span><p><p>IPv6 is enabled on the loopback interface. This step is mandatory when the loopback interface is configured with an IPv6 address.</p>
</p></li><li class="substepexpand"><span>Configure an IPv4 or IPv6 address for the loopback interface.</span><p><ul><li><p>Run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command to configure an IPv4 address for the loopback interface.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> } command to configure an IPv6 address for the loopback interface.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the loopback interface view.</p>
</p></li><li class="substepexpand"><span>Configure default static VPN routes.</span><p><ul><li><p>Run the <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong>0.0.0.0</strong> { <strong>0.0.0.0</strong> | <strong>0</strong> } { <i><span class="varname">nexthop-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">nexthop-address</span></i> ] } [ <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> ] command to create a default static VPN IPv4 route.</p>
</li><li><p>Run the <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong>::</strong> <strong>0</strong> { <i><span class="varname">nexthop-ipv6âaddress</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">nexthop-ipv6-address</span></i> ] } [ <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> ] command to create a default static VPN IPv6 route.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Create a route-policy so that default static VPN routes and VPN loopback routes of the L3VPN instance can be filtered out. For details about how to create a route-policy, see <a href="dc_vrp_route-policy_cfg_0007.html">Configuring a Route-Policy</a>.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> command to enter the VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> command to enter the VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></span><p><p>An export route-policy is applied to the L3VPN instance, so that the L3VPN instance can filter routes to be advertised to EVPN. This ensures that the L3VPN instance advertises only its default static VPN routes and loopback VPN routes to EVPN.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance IPv4 or IPv6 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance view.</p>
</p></li><li class="substepexpand"><span>Create a route-policy to filter the UE routes received by the DC GW from the L2GW/L3GW and prohibit the advertisement of such UE routes. For details about how to create a route-policy, see <a href="dc_vrp_route-policy_cfg_0007.html">Configuring a Route-Policy</a>.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong></span><p><p>The route-policy is applied to prohibit the DC GW from advertising UE routes to other DC GWs.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-EVPN address family view.</p>
</p></li><li class="substepexpand"><span>Enter the BGP-VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>direct</span></strong> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>VPN loopback routes are imported into the BGP-VPN instance IPv4 or IPv6 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> { <strong>0.0.0.0</strong> <strong>0</strong> | <strong>::</strong> <strong>0</strong> }</span><p><p>Default static VPN routes are imported into the BGP-VPN instance IPv4 or IPv6 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a></span><p><p>The function to advertise IP routes from the VPN instance to the EVPN instance is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-VPN instance IPv4 <span>or IPv6</span> address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li><span>Establish BGP VPN peer relationships between DC GWs and VNFs.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> <strong><span>deny</span></strong> <strong><span>node</span></strong> <i><span class="varname">node</span></i></span><p><p>A route-policy that denies all routes is created.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the route-policy view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the BGP-VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> }</span><p><p>A BGP VPN peer relationship is established.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>connect-interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">ipv4-source-address</span></i> ]</span><p><p>The source interface and source IP address are specified for the TCP connection to be set up between BGP peers.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong></span><p><p>The route-policy is applied so that the DC GW does not advertise BGP VPN routes to VNFs. This prevents routing loops.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-VPN instance IPv4 or IPv6 address family view.</p>
</p></li></ol>
</li><li><span>Configure DC GWs to generate ARP or ND entries for Layer 2 forwarding based on the ARP or ND information in EVPN routes.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i></span><p><p>The VBDIF interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=anycast-gateway+enable"><b><span class="cmdname">anycast-gateway enable</span></b></a></span><p><p>The distributed gateway function is enabled.</p>
</p></li><li class="substepexpand"><span>Configure DC GWs to generate ARP or ND entries for Layer 2 forwarding based on the ARP or ND information in EVPN routes.</span><p><ul><li><p>Run the <a href="cmdqueryname=arp+generate-rd-table+enable"><b><span class="cmdname">arp generate-rd-table enable</span></b></a> command to configure the DC GW to generate ARP entries for Layer 2 forwarding based on the ARP information in EVPN routes.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6+nd+generate-rd-table+enable"><b><span class="cmdname">ipv6 nd generate-rd-table enable</span></b></a> command to configure the DC GW to generate ND entries for Layer 2 forwarding based on the ND information in EVPN routes.</p>
</li></ul>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ipv6+nd+dad+attempts"><b><span class="cmdname">ipv6 nd dad attempts</span></b></a> <strong>0</strong></span><p><p>DAD is prohibited. This command is mandatory in IPv6 scenarios to prevent service interruptions occurred because the system detects that the IPv6 address of another device is the same as the VBDIF interface's IP address.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VBDIF interface view.</p>
</p></li></ol>
</li><li><span>(Optional) Configure the asymmetric mode for IRB routes. If L2GWs/L3GWs are configured to advertise IRB or IRBv6 routes to DC GWs, the asymmetric IRB function needs to be configured on DC GWs.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the BGP-VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=irb+asymmetric"><b><span class="cmdname">irb asymmetric</span></b></a></span><p><p>The asymmetric mode is enabled for IRB routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-VPN instance IPv4 or IPv6 address family view.</p>
</p></li></ol>
</li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0121.html">Configuring the NFVI Distributed Gateway Function (Segmented SR Tunnels)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0122.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0124.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>