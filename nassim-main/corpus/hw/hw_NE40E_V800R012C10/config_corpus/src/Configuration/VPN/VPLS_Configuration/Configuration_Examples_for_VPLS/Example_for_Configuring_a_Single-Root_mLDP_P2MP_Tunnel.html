
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Single-Root mLDP P2MP Tunnel">
<meta name="abstract" content="This section provides an example for configuring mLDP P2MP tunnels.">
<meta name="description" content="This section provides an example for configuring mLDP P2MP tunnels.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5069.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6048.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370278">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Single-Root mLDP P2MP Tunnel</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370278"></a><a name="EN-US_TASK_0172370278"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1"><span>Example for Configuring a Single-Root mLDP P2MP Tunnel</span></h1>
<div class="taskbody"><p>This section provides an example for configuring mLDP P2MP tunnels.</p>
<div class="context"><a name="EN-US_TASK_0172370278__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370278__fig_dc_vrp_vpls_cfg_507201">Figure 1</a>, PE1, PE2, PE3, and PE4 use BGP AD to establish a full-mesh multicast VPLS network. PE1 functions as the root node, PE2 a bud node, and PE3 and PE4 the leaf nodes. (The configurations on bud and leaf nodes are the same.) To carry multicast services, configure mLDP P2MP tunnels. The configuration simplifies network deployment.</p>
<div class="fignone" id="EN-US_TASK_0172370278__fig_dc_vrp_vpls_cfg_507201"><a name="EN-US_TASK_0172370278__fig_dc_vrp_vpls_cfg_507201"></a><a name="fig_dc_vrp_vpls_cfg_507201"></a><span class="figcap"><b>Figure 1 </b>Configuring mLDP P2MP tunnels</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>In this example, interface1, interface2, interface3, and subinterface4.1 represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>.1, respectively.</p>
</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_507201.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370278__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IP address and a routing protocol for each involved interface to ensure IP connectivity at the network layer. This example uses OSPF as the routing protocol.</p>
</li><li><p>Configure an MPLS LSR ID and globally enable MPLS, MPLS LDP, and mLDP P2MP.</p>
</li><li><p>Configure a local LDP session on each PE.</p>
</li><li><p>Configure BGP AD VPLS among PE1, PE2, PE3, and PE4.</p>
</li><li><p>Configure PE1 as the root node.</p>
</li><li><p>Configure PE2, PE3, and PE4 as leaf nodes.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370278__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP addresses of involved interfaces</p>
</li><li><p>OSPF process ID (100) and area ID (0.0.0.0) for each node</p>
</li><li><p>BGP AS numbers of PE1, PE2, PE3, and PE4</p>
</li><li><p>VSI names, VPLS IDs, and VPN targets</p>
</li><li><p>Number of the interface bound to each VSI</p>
</li><li><p>IP address of the mLDP P2MP tunnel's root node (1.1.1.1)</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370278__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and a routing protocol for each involved interface to ensure IP connectivity at the network layer.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370278__section_dc_vrp_vpls_cfg_507201">Configuration Files</a>.</p>
</p></li><li><span>Configure an MPLS LSR ID and globally enable MPLS, MPLS LDP, and mLDP P2MP.</span><p><p># Configure PE1.</p>
<div class="p"><pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>mldp p2mp </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
<p>The configurations of PE2, PE3, and PE4 are similar to the configuration of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370278__section_dc_vrp_vpls_cfg_507201">Configuration Files</a>.</p>
</p></li><li><span>Configure a local LDP session on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>] <strong>commit</strong></pre>
<p>The configurations of PE2, PE3, and PE4 are similar to the configuration of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370278__section_dc_vrp_vpls_cfg_507201">Configuration Files</a>.</p>
</p></li><li><span>Configure BGP AD VPLS on PE1, PE2, PE3, and PE4.</span><p><div class="p"># Configure BGP AD VPLS on PE1.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.4 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgpad] <strong>vpls-id 2:2  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgpad] <strong>vpn-target 2:2 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgpad] <strong>vpn-target 2:2 export-extcommunity  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</div>
<p># Configure BGP AD VPLS on PE2.</p>
<div class="p"><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgpad] <strong>vpls-id 2:2  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgpad] <strong>vpn-target 2:2 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgpad] <strong>vpn-target 2:2 export-extcommunity  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/3</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/3</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/3</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</div>
<p># Configure BGP AD VPLS on PE3.</p>
<div class="p"><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgpad] <strong>vpls-id 2:2  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgpad] <strong>vpn-target 2:2 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgpad] <strong>vpn-target 2:2 export-extcommunity  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet<span>0/1/3</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/3</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/3</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</div>
<p># Configure BGP AD VPLS on PE4.</p>
<div class="p"><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 1.1.1.1 connect-interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgpad] <strong>vpls-id 2:2  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgpad] <strong>vpn-target 2:2 import-extcommunity </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgpad] <strong>vpn-target 2:2 export-extcommunity  </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1-bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>interface gigabitethernet<span>0/1/3</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/3</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/3</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</div>
</p></li><li><span>Configure PE1 as the root node.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>inclusive-provider-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive] <strong>root</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root] <strong>mldp p2mp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root-mldpp2mp] <strong>root-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root-mldpp2mp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive-root] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-inclusive] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure PE2, PE3, and PE4 as leaf nodes.</span><p><p># Configure PE2 as a leaf node.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>inclusive-provider-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive] <strong>leaf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive-leaf] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-inclusive] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>The configurations of PE3 and PE4 are similar to the configuration of PE2. For detailed configurations, see <a href="#EN-US_TASK_0172370278__section_dc_vrp_vpls_cfg_507201">Configuration Files</a>.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display vsi name inclusive-provider-tunnel</strong> command on PE1 to check multicast VPLS tunnel information.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name vsi1 inclusive-provider-tunnel</strong></pre>
<pre class="screen">VSI name: vsi1
 Ingress provider tunnel
    PMSI type      : P2MP mLDP
    Root ip        : 1.1.1.1
    Opaque value   : 01000400002001
    <strong>State         : up</strong>
    Leaf list count: 3
    Leaf list      : 2.2.2.2
                     3.3.3.3
                     4.4.4.4
  Egress provider tunnel
  Egress PMSI count: 0
</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370278__section_dc_vrp_vpls_cfg_507201"><a name="EN-US_TASK_0172370278__section_dc_vrp_vpls_cfg_507201"></a><a name="section_dc_vrp_vpls_cfg_507201"></a><a name="EN-US_TASK_0172370278__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi vsi1
 bgp-ad
  vpls-id 2:2
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
 inclusive-provider-tunnel
  root
   mldp p2mp
    root-ip 1.1.1.1
#
mpls ldp
 mldp p2mp
#                                                                            
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown                            
 ip address 10.1.2.1 255.255.255.0        
 mpls                                     
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown                            
 l2 binding vsi vsi1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown                            
 ip address 10.1.3.1 255.255.255.0        
 mpls                                     
 mpls ldp 
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100 
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1 
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1 
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1 
 #
 l2vpn-ad-family
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
ospf 100                                  
 area 0.0.0.0                             
  network 1.1.1.1 0.0.0.0                 
  network 10.1.2.0 0.0.0.255              
  network 10.1.3.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi vsi1
 bgp-ad
  vpls-id 2:2
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
 inclusive-provider-tunnel
  leaf
#
mpls ldp
 mldp p2mp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown                            
 ip address 10.1.2.2 255.255.255.0        
 mpls                                     
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown                            
 ip address 10.1.5.1 255.255.255.0        
 mpls                                     
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>.1
 vlan-type dot1q 10  
 l2 binding vsi vsi1
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100 
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1 
 #
 l2vpn-ad-family
  peer 1.1.1.1 enable
 #
ospf 100                                  
 area 0.0.0.0                             
  network 2.2.2.2 0.0.0.0                 
  network 10.1.2.0 0.0.0.255
  network 10.1.5.0 0.0.0.255
#                                         
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1
 bgp-ad
  vpls-id 2:2
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
 inclusive-provider-tunnel
  leaf
#
mpls ldp
 mldp p2mp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown                            
 ip address 10.1.3.2 255.255.255.0        
 mpls                                     
 mpls ldp 
#
interface GigabitEthernet<span>0/1/3</span>.1
 vlan-type dot1q 10  
 l2 binding vsi vsi1
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100 
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1 
 #
 l2vpn-ad-family
  peer 1.1.1.1 enable
#
ospf 100                                  
 area 0.0.0.0                             
  network 3.3.3.3 0.0.0.0                 
  network 10.1.3.0 0.0.0.255
#                                         
return</pre>
</li><li><p>PE4 configuration file</p>
<pre class="screen">#
sysname PE4
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls l2vpn
#
vsi vsi1
 bgp-ad
  vpls-id 2:2
  vpn-target 2:2 import-extcommunity
  vpn-target 2:2 export-extcommunity
 inclusive-provider-tunnel
  leaf
#
mpls ldp
 mldp p2mp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown                            
 ip address 10.1.5.2 255.255.255.0        
 mpls                                     
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>.1
 vlan-type dot1q 10  
 l2 binding vsi vsi1
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100 
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1 
 #
 l2vpn-ad-family
  peer 1.1.1.1 enable
#
ospf 100                                  
 area 0.0.0.0                             
  network 4.4.4.4 0.0.0.0                 
  network 10.1.5.0 0.0.0.255    
#                                         
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5069.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6048.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>