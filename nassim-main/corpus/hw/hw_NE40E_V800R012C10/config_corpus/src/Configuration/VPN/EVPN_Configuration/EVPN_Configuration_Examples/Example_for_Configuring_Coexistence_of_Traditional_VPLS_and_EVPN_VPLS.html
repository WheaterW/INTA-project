
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Coexistence of Traditional VPLS and EVPN VPLS">
<meta name="abstract" content="To prevent service interruptions during VPLS-to-EVPN evolution, configure coexistence of traditional VPLS and EVPN VPLS.">
<meta name="description" content="To prevent service interruptions during VPLS-to-EVPN evolution, configure coexistence of traditional VPLS and EVPN VPLS.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0114.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0116.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370646">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Coexistence of Traditional VPLS and EVPN VPLS</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370646"></a><a name="EN-US_TASK_0172370646"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Coexistence of Traditional VPLS and EVPN VPLS</h1>
<div class="taskbody"><p>To prevent service interruptions during VPLS-to-EVPN evolution, configure coexistence of traditional VPLS and EVPN VPLS.</p>
<div class="context"><a name="EN-US_TASK_0172370646__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370646__fig868818241190">Figure 1</a>, traditional VPLS is deployed. It is required that EVPN be deployed on PE1 and PE3, so that BGP EVPN can be used to transmit services between PE1 and PE3. To meet this requirement, an EVPN instance needs to be configured and bound to the BD on PE1 and PE3. Then, a BGP EVPN peer relationship needs to be established between PE1 and PE3.</p>
<div class="fignone" id="EN-US_TASK_0172370646__fig868818241190"><a name="EN-US_TASK_0172370646__fig868818241190"></a><a name="fig868818241190"></a><span class="figcap"><b>Figure 1 </b>Configuring the coexistence of traditional VPLS and EVPN VPLS</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GigabitEthernet<span>0/1/0</span>, GigabitEthernet<span>0/2/0</span>, and GigabitEthernet<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001179249890.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370646__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>For the same EVPN instance, the export VPN target list of one site shares VPN targets with the import VPN target lists of the other sites. Conversely, the import VPN target list of one site shares VPN targets with the export VPN target lists of the other sites.</p>
</li><li><p>Using each PE's local loopback interface address as its EVPN source address is recommended.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370646__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Create an EVPN instance in BD mode and a BD on each of PE1 and PE3, and bind the BD to the EVPN instance on each PE.</p>
</li><li><p>Configure a source address on each of PE1 and PE3.</p>
</li><li><p>Establish a BGP EVPN peer relationship between PE1 and PE3.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370646__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>EVPN instance name: evrf1</p>
</li><li><p>EVPN instance evrf1's RD (100:1) and RT (1:1) on each PE</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370646__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Ensure that an EVC has been configured to carry a VPLS service. For detailed configurations, see <a href="#EN-US_TASK_0172370646__file1">Configuration Files</a>.</span><p><p>Run the <strong>display vsi name e1 verbose</strong> command on PE1. The command output shows that the VSI named <strong>e1</strong> has separate PWs to PE2 and PE3, and the VSI status and PW status are up.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name e1 verbose</strong></pre>
<pre class="screen"> 

 ***VSI Name               : e1
    Work Mode              : bd-mode
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 2
    PW Signaling           : bgp
    Member Discovery Style : --
    Bridge-domain Mode     : enable
    PW MAC Learn Style     : qualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 0 hours, 50 minutes, 49 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : --

    BGP RD                 : 100:1
    SiteID/Range/Offset    : 1/10/0
    Import vpn target      : 1:1                    
    Export vpn target      : 1:1                    
    Remote Label Block     : 294928/8/0 294928/8/0 
    Local Label Block      : 0/294928/8/0 
 
    Access Bridge-domain   : Bridge-domain 10 
    Vac State              : up 
    Last Up Time           : 2018/03/23 11:01:50
    Total Up Time          : 0 days, 0 hours, 37 minutes, 53 seconds

  **PW Information:

   *Peer Ip Address        : 2.2.2.2
    PW State               : <strong>up</strong>
    Local VC Label         : 294930
    Remote VC Label        : 294929
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4bc1 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 129
    Nkey                   : 16777346
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : --
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 2018/03/23 11:38:42
    PW Total Up Time       : 0 days, 0 hours, 1 minutes, 1 seconds
   *Peer Ip Address        : 3.3.3.3
    PW State               : <strong>up</strong>
    Local VC Label         : 294931
    Remote VC Label        : 294929
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4b42 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 130
    Nkey                   : 16777347
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : --
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 2018/03/23 11:39:10
    PW Total Up Time       : 0 days, 0 hours, 0 minutes, 33 seconds</pre>
</p></li><li><span>Configure an EVPN instance on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure a source address on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn source-address 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP EVPN peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <strong>display bgp evpn peer</strong> command on PE1. The command output shows that BGP peer relationships are in the <strong>Established</strong> state, indicating that a BGP peer relationship has been successfully established between PE1 and PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn peer</strong></pre>
<pre class="screen"> 
 BGP local router ID : 10.1.1.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  3.3.3.3         4         100        7        9     0 00:00:07 Established        1</pre>
<p>Run the <strong>display bgp evpn all routing-table</strong> command on PE1. The command output shows the inclusive multicast route received from PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp evpn all routing-table</strong> </pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 10.1.1.1
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 EVPN address family:
 Number of Inclusive Multicast Routes: 2
 Route Distinguisher: 100:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1
 *&gt;i   <strong>0:32:3.3.3.3</strong>                                        3.3.3.3
    

 EVPN-Instance evrf1:
 Number of Inclusive Multicast Routes: 2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:1.1.1.1                                           127.0.0.1
 *&gt;i   <strong>0:32:3.3.3.3</strong>                                        3.3.3.3</pre>
<p>Run the <strong>display alarm active root verbose</strong> command on PE1. The command output shows information about the alarm triggered when the VPLS VC on PE1 goes down. The value of HWL2VpnStateChangeReason (alarm cause parameter) is 98, indicating that the establishment of an EVPN connection causes the VPLS VC to go down.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display alarm active root verbose</strong> </pre>
<pre class="screen">Sequence    : 46        
AlarmId     : 0xD4D0001             AlarmName : <strong>hwVplsVcDown</strong>                                                    
AlarmType   : communication         Severity  : Major            State : active 
RootKindFlag: Independent           
StartTime   : 2018-03-26 02:42:23                     
Description : The status of the VPLS VC turned DOWN. (VsiName=e1, PwId=3, RemoteIp=3.3.3.3, PwType=1, <strong>HWL2VpnStateChangeReason=98</strong>, SysUpTime=23691243, TunnelPolicyName=-)</pre>
<p>Run the <strong>display vsi name e1 verbose</strong> command on PE1. The command output shows that only the PW to PE2 is available and its status is up.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name e1 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : e1
    Work Mode              : bd-mode
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 2
    PW Signaling           : bgp
    Member Discovery Style : --
    Bridge-domain Mode     : enable
    PW MAC Learn Style     : qualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 1 hours, 0 minutes, 52 seconds
    VSI State              : up
    Resource Status        : --

    BGP RD                 : 100:1
    SiteID/Range/Offset    : 1/10/0
    Import vpn target      : 1:1                    
    Export vpn target      : 1:1                    
    Remote Label Block     : 294928/8/0 294928/8/0 
    Local Label Block      : 0/294928/8/0 
 
    Access Bridge-domain   : Bridge-domain 10 
    Vac State              : up 
    Last Up Time           : 2018/03/23 11:01:50
    Total Up Time          : 0 days, 0 hours, 47 minutes, 56 seconds

  **PW Information:

   *Peer Ip Address        : 2.2.2.2
    PW State               : <strong>up</strong>
    Local VC Label         : 294930
    Remote VC Label        : 294929
    PW Type                : label
    Tunnel ID              : 0x0000000001004c4bc1 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 129
    Nkey                   : 16777346
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : --
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 2018/03/23 11:38:42
    PW Total Up Time       : 0 days, 0 hours, 11 minutes, 4 seconds</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370646__file1"><a name="EN-US_TASK_0172370646__file1"></a><a name="file1"></a><a name="EN-US_TASK_0172370646__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn      
#
vsi e1 bd-mode
 pwsignal bgp
  route-distinguisher 100:1
  vpn-target 1:1 import-extcommunity
  vpn-target 1:1 export-extcommunity
  site 1 range 10 default-offset 0
#
bridge-domain 10
 l2 binding vsi e1
 evpn binding vpn-instance evrf1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 bridge-domain 10
#               
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 l2vpn-ad-family
  policy vpn-target
  signaling vpls
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi e1 bd-mode
 pwsignal bgp
  route-distinguisher 100:1
  vpn-target 1:1 import-extcommunity
  vpn-target 1:1 export-extcommunity
  site 2 range 10 default-offset 0
#
bridge-domain 10
 l2 binding vsi e1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#               
interface GigabitEthernet<span>0/1/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
 #
 l2vpn-ad-family
  policy vpn-target
  signaling vpls
  peer 1.1.1.1 enable
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.2.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn      
#
vsi e1 bd-mode
 pwsignal bgp
  route-distinguisher 100:1
  vpn-target 1:1 import-extcommunity
  vpn-target 1:1 export-extcommunity
  site 3 range 10 default-offset 0
#
bridge-domain 10
 l2 binding vsi e1
 evpn binding vpn-instance evrf1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/3/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack0
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 l2vpn-ad-family
  policy vpn-target
  signaling vpls
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
#
ospf 1
 area 0.0.0.0   
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
evpn source-address 3.3.3.3
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port link-type trunk
 port trunk allow-pass vlan 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0114.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0116.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>