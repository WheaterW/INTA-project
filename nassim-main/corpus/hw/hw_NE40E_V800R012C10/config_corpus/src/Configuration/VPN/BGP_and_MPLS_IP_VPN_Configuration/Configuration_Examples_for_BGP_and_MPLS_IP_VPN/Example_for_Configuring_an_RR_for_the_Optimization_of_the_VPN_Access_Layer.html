
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring an RR for the Optimization of the VPN Access Layer">
<meta name="abstract" content="If a PE and its connected CEs are in the same AS, you can deploy a BGP RR to reduce the number of IBGP connections between the CEs and facilitate VPN maintenance and management.">
<meta name="description" content="If a PE and its connected CEs are in the same AS, you can deploy a BGP RR to reduce the number of IBGP connections between the CEs and facilitate VPN maintenance and management.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0107.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0109.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369466">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring an RR for the Optimization of the VPN Access Layer</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369466"></a><a name="EN-US_TASK_0172369466"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring an RR for the Optimization of the VPN Access Layer</h1>
<div class="taskbody"><p>If a PE and its connected CEs are in the same AS, you can deploy a BGP RR to reduce the number of IBGP connections between the CEs and facilitate VPN maintenance and management.</p>
<div class="context"><a name="EN-US_TASK_0172369466__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p><a href="#EN-US_TASK_0172369466__fig_dc_vrp_mpls-l3vpn-v4_cfg_010801">Figure 1</a> shows the networking of a BGP/MPLS IP VPN. CE1, CE2, CE3, and CE4 belong to vpna; CE1, CE2, CE3, and PE1 are in the same AS and the three CEs connect to PE1. It is required that PE1 be configured as an RR to reduce the number of IBGP connections between CE1, CE2, and CE3 and reflect VPN routes.</p>
<div class="fignone" id="EN-US_TASK_0172369466__fig_dc_vrp_mpls-l3vpn-v4_cfg_010801"><a name="EN-US_TASK_0172369466__fig_dc_vrp_mpls-l3vpn-v4_cfg_010801"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_010801"></a><span class="figcap"><b>Figure 1 </b>Configuring an RR for the optimization of the VPN access layer</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>interface1, interface2, interface3, and interface4 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/3/0</span>, and GE<span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_010801.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369466__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When configuring an RR for the optimization of the VPN access layer, note the following:</p>
<ul><li><p>The interfaces that connect PE1 to CE1, CE2, and CE3 are bound to the same VPN instance.</p>
</li><li><p>PE1, CE1, CE2, and CE3 are in the same AS.</p>
</li><li><p>An IBGP connection is set up between PE1 and each of CE1, CE2, and CE3, and direct routes of PE1 are imported to the BGP VPN instance<span> IPv4 address family</span> so that routes from a CE can recurse to the next hop when being reflected to other CEs.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369466__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a basic BGP/MPLS IP VPN.</p>
</li><li><p>Set up an IBGP connection between PE1 and each of CE1, CE2, and CE3.</p>
</li><li><p>Configure PE1 as an RR to reflect routes from each CE.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369466__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of PEs</p>
</li><li><p>Names, RDs, and VPN targets of the VPN instances on PE1 and PE2</p>
</li><li><p>AS numbers of the PEs and CEs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369466__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IGP on the MPLS backbone network so that the PEs can learn the routes to each other's loopback interface. For configuration details, see the configuration files.</span></li><li><span>Set up an LSP on the MPLS backbone network.</span><p><p>Enable MPLS and MPLS LDP on the devices and interfaces along the LSP. For detailed configurations, see Configuration Files.</p>
<p>After completing the configurations, run the <strong>display mpls ldp session</strong> command on PEs. The command output shows that the session status is <strong>Operational</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp session</strong>
                LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted.</span>
 -------------------------------------------------------------------------
 Peer-ID            Status      LAM  SsnRole  SsnAge      KA-Sent/Rcv
--------------------------------------------------------------------------
2.2.2.2:0     <strong>Operational</strong>    DU   Passive    0011:19:20  67949/67949
--------------------------------------------------------------------------
TOTAL: 1 Session(s) Found. </pre>
</p></li><li><span>Set up an MP-BGP peer relationship between PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp vpnv4 all peer</strong> command on PEs. The command output shows that MP-IBGP peer relationships have been established between PEs and CEs.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 all peer</strong></pre>
<pre class="screen"> BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1         Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv

  2.2.2.2         4         100     1633     1641     0 27:09:46 <strong>Established</strong>   0</pre>
</p></li><li><span>Configure an <span>IPv4-address-family-supporting </span>VPN instance on each PE and bind the interface that connects a PE to a CE to the VPN instance on that PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.4.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># After completing the configurations, run the <strong>display ip vpn-instance verbose</strong> command on PEs to check the configurations of VPN instances.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip vpn-instance verbose</strong>
 Total VPN-Instances configured : 1
Total IPv4 VPN-Instances configured : 1 
Total IPv6 VPN-Instances configured : 0

 VPN-Instance Name and ID : vpna, 1
  Interfaces : GigabitEthernet<span>0/1/0</span>,
               GigabitEthernet<span>0/1/1</span>,
               GigabitEthernet<span>0/3/0</span>
 Address family ipv4
  Create date : 2009/12/06 15:39:50
  Up time : 0 days, 00 hours, 02 minutes and 22 seconds
  Vrf Status : UP
  Route Distinguisher : 100:1
  Export VPN Targets :  111:1
  Import VPN Targets :  111:1
  Label policy : label per route
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe</pre>
</p></li><li><span>Set up an IBGP peer relationship between PE1 and each of CE1, CE2, and CE3.</span><p><p># Configure PE1 as an IBGP peer for each of CE1, CE2, and CE3, and import direct routes to the BGP VPN instance<span> IPv4 address family</span> routing table of PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.2.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.3.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>ip address 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Loopback1] <strong>ip address 22.22.22.22 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.2.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>network 22.22.22.22 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>commit</strong></pre>
<p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Loopback1] <strong>ip address 33.33.33.33 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-bgp] <strong>peer 10.3.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-bgp] <strong>network 33.33.33.33 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-bgp] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on PE1. The command output shows that the peer relationship is set up between PE1 and each of CE1, CE2, and CE3.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 vpn-instance vpna peer</strong>

 BGP local router ID : 10.1.1.1
 Local AS number : 100
 Total number of peers : 3         Peers in established state : 3

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.1.1.2        4         100     1058     1058     0 17:37:22 <strong>Established</strong>    0
  10.2.1.2        4         100        3        3     0 00:01:56 <strong>Established</strong>    0
  10.3.1.2        4         100        2        2     0 00:00:32 <strong>Established</strong>    0</pre>
</p></li><li><span>Configure route reflection on PE1.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.2.1.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.3.1.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display ip routing-table</strong> command on each CE. The command output shows that there are routes to the loopback interfaces of the other CEs. The following example uses the command output on CE2.</p>
<pre class="screen">&lt;CE2&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 15       Routes : 15

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  BGP    255  0             RD 10.2.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  BGP    255  0             RD 10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.2/32  BGP    255  0             RD 10.2.1.1        GigabitEthernet<span>0/1/0</span>
       10.2.1.0/24  Direct 0    0             D  10.2.1.2        GigabitEthernet<span>0/1/0</span>
       10.2.1.2/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.2.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
       10.3.1.0/24  BGP    255  0             RD 10.2.1.1        GigabitEthernet<span>0/1/0</span>
   <strong>11.11.11.11/32</strong>  EBGP   255  0             RD 10.1.1.2        GigabitEthernet<span>0/1/0</span>
   <strong>22.22.22.22/32</strong>  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
   <strong>33.33.33.33/32</strong>  EBGP   255  0             RD 10.3.1.2        GigabitEthernet<span>0/1/0</span>
   <strong>44.44.44.44/32</strong>  EBGP   255  0             RD 10.2.1.1        GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369466__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface LoopBack1
 ip address 11.11.11.11 255.255.255.255
#
 bgp 100
 peer 10.1.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.1 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
interface LoopBack1
 ip address 22.22.22.22 255.255.255.255
#
bgp 100
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.2.1.1 enable
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
#
interface LoopBack1
 ip address 33.33.33.33 255.255.255.255
#
bgp 100
 peer 10.3.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 33.33.33.33 255.255.255.255
  peer 10.3.1.1 enable
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.1
#
mpls
# 
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.2.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.3.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 mpls
 mpls ldp
 ip address 10.30.1.1 255.255.255.0
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.30.1.0 0.0.0.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance vpna
  peer 10.1.1.2 as-number 100
  peer 10.2.1.2 as-number 100
  peer 10.3.1.2 as-number 100
  peer 10.1.1.2 reflect-client
  peer 10.2.1.2 reflect-client
  peer 10.3.1.2 reflect-client
  import-route direct
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp 
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.4.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 mpls
 mpls ldp
 ip address 10.30.1.2 255.255.255.0
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.30.1.0 0.0.0.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance vpna
  peer 10.4.1.2 as-number 65410
#
return</pre>
</li><li><p>CE4 configuration file</p>
<pre class="screen">#
sysname CE4
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.0
#
interface LoopBack1
 ip address 44.44.44.44 255.255.255.255
#
bgp 65410
 peer 10.4.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 44.44.44.44 255.255.255.255
  peer 10.4.1.1 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0107.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0109.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>