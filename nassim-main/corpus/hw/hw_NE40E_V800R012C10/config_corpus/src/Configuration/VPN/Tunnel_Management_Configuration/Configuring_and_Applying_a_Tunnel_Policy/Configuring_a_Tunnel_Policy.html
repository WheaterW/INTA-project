
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Tunnel Policy">
<meta name="abstract" content="Tunnel policies are divided into tunnel type prioritizing policies and tunnel binding policies.">
<meta name="description" content="Tunnel policies are divided into tunnel type prioritizing policies and tunnel binding policies.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_tnlm_cfg_0036.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_tnlm_cfg_0038.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPN Tunnel">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPN Tunnel">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPN Tunnel">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPN Tunnel">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369021">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Tunnel Policy</title>
</head>
<body><a name="EN-US_TASK_0172369021"></a><a name="EN-US_TASK_0172369021"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Tunnel Policy</h1>
<div class="taskbody"><p>Tunnel policies are divided into tunnel type prioritizing policies and tunnel binding policies.</p>
<div class="context"><a name="EN-US_TASK_0172369021__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>VPN data needs to be carried over tunnels. By default, the system selects LSPs for VPN service transmission and does not perform load balancing on an IPv4 network. If the default tunnel configuration cannot meet VPN service requirements, a tunnel policy needs to be used.</p>
<p>The tunnel policy may be a tunnel type prioritizing policy or a tunnel binding policy. Select either of the following policies as needed:</p>
<ul><li>A tunnel type prioritizing policy can be used to switch a tunnel type to another one for VPN service transmission and implement load balancing among tunnels.</li><li>A tunnel binding policy can bind multiple TE tunnels to provide QoS guarantee for a VPN.</li></ul>
<p>On an IPv6 network, SRv6 TE Policies and SRv6 TE flow groups can participate in tunnel selection. In this case, only tunnel type prioritizing policies can be configured.</p>
<p>Perform the following steps on the PE that requires a tunnel policy.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172369021__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure a tunnel type prioritizing policy.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tunnel-policy"><b><span class="cmdname">tunnel-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A tunnel policy is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-information</span></i></span><p><p>A description is configured for the tunnel policy.</p>
<p>The tunnel policy description reminds users of the purpose of the tunnel policy.</p>
</p></li><li class="substepexpand"><span>Configure the sequence of priority in which types of tunnels are selected and the maximum number of tunnels that can participate in load balancing.</span><p><ul><li>Run one of the following commands for an IPv4 network:<ul><li><a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> { <strong><span>gre</span></strong> | <strong><span>lsp</span></strong> | <strong><span>cr-lsp</span></strong> | <strong><span>sr-te-policy</span></strong><strong><span> | flex-algo-lsp</span></strong> } <sup>*</sup> <strong><span>load-balance-number</span></strong> <i><span class="varname">load-balance-number</span></i> [ <strong><span>unmix</span></strong> ]</li><li><a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> { <strong><span>gre</span></strong> | <strong><span>ldp</span></strong> | <strong><span>bgp</span></strong> | <strong><span>cr-lsp</span></strong> | <strong><span>sr-lsp</span></strong> | <strong><span>sr-te-policy</span></strong><strong><span> | flex-algo-lsp</span></strong> } <sup>*</sup> <strong><span>load-balance-number</span></strong> <i><span class="varname">load-balance-number</span></i> [ <strong><span>unmix</span></strong> ]</li><li><a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> { <strong><span>gre</span></strong> | <strong><span>lsp</span></strong> | <strong><span>te</span></strong> | <strong><span>sr-te</span></strong> | <strong><span>sr-te-policy</span></strong><strong><span> | flex-algo-lsp</span></strong> | <strong><span>colored-sr-te</span></strong>} <sup>*</sup> <strong><span>load-balance-number</span></strong> <i><span class="varname">load-balance-number</span></i> [ <strong><span>unmix</span></strong> ]</li><li><a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> { <strong><span>gre </span></strong>| <strong><span>ldp</span></strong> | <strong><span>bgp</span></strong> | <strong><span>te</span></strong> | <strong><span>sr-te</span></strong> | <strong><span>sr-lsp</span></strong> | <strong><span>sr-te-policy</span></strong><strong><span> | flex-algo-lsp</span></strong> | <strong><span>colored-sr-te</span></strong> } <sup>*</sup> <strong><span>load-balance-number</span></strong> <i><span class="varname">load-balance-number</span></i> [ <strong><span>unmix</span></strong> ]</li></ul>
<p>After this command is run, the system selects the tunnel type in the specified sequence of priority. If tunnels with higher priorities are unreachable, the system will continue to select tunnels with lower priorities in the specified sequence of priority. For example, if the <strong>tunnel select-seq cr-lsp lsp load-balance-number 3</strong> command is run, the system preferentially selects CR-LSPs followed by LSPs for VPN service transmission and uses a maximum of three tunnels for load balancing. If the number of available CR-LSP tunnels is less than three, LSPs can be used together with CR-LSPs in load balancing.</p>
<p>LSPs include LDP LSPs, SR-LSPs, and BGP LSPs. If <strong><span>lsp</span></strong> is specified, the default sequence of priority, in descending order, is LDP LSP &gt; BGP LSP &gt; SR-LSP. If <strong><span>sr-lsp</span></strong>, <strong><span>ldp</span></strong> or <strong><span>bgp</span></strong> is specified, you can specify the sequence of priority in which LSPs are selected.</p>
<p>CR-LSPs include RSVP-TE and SR-MPLS TE tunnels. If <strong><span>cr-lsp</span></strong> is specified in the command, a tunnel that goes up earlier has a higher priority.</p>
<p>To enable the system to preferentially select RSVP-TE or SR-MPLS TE tunnels for VPN service transmission, specify the sequence of the <strong><span>te</span></strong> or <strong><span>sr-te</span></strong> parameter in the <a href="cmdqueryname=tunnel+select-seq"><b><span class="cmdname">tunnel select-seq</span></b></a> command.</p>
<div class="p">If <strong><span>unmix</span></strong> is configured, only one type of tunnel can be selected. For example, the <strong>tunnel select-seq cr-lsp lsp load-balance-number 3 unmix</strong> command is run for the tunnel policy:<ul><li><p>If three or more CR-LSPs are available, the system randomly selects three of them for service transmission.</p>
</li><li><p>If less than three CR-LSPs are available, the system selects only these available CR-LSPs, but does not select other types of tunnels.</p>
</li></ul>
</div>
</li><li>Run one of the following commands for an IPv6 network:<ul><li><a href="cmdqueryname=tunnel+select-seq+ipv6"><b><span class="cmdname">tunnel select-seq ipv6</span></b></a> { <strong><span>srv6-te-policy</span></strong> | <strong>srv6-te-flow-group</strong> | <strong>gre6</strong> } <strong><span>load-balance-number</span></strong> <i><span class="varname">loadBalanceNumber</span></i></li><li><a href="cmdqueryname=tunnel+select-seq+ipv6"><b><span class="cmdname">tunnel select-seq ipv6</span></b></a><strong><span> srv6-te-policy</span></strong> <strong>srv6-te-flow-group</strong> <strong><span>load-balance-number</span></strong> <i><span class="varname">loadBalanceNumber</span></i> <strong><span>unmix</span></strong></li><li><a href="cmdqueryname=tunnel+select-seq+ipv6"><b><span class="cmdname">tunnel select-seq ipv6</span></b></a> <strong><span>srv6-te-flow-group srv6-te-policy</span></strong> <strong><span>load-balance-number</span></strong> <i><span class="varname">loadBalanceNumber</span></i> <strong><span>unmix</span></strong></li></ul>
<p>After the command is run, the system selects tunnels of different types in the specified sequence. If tunnels that have higher priorities are unreachable, the system will continue to select tunnels that have lower priorities in the specified sequence.</p>
<p>SRv6 TE Policies and SRv6 TE flow groups cannot both be selected.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure a common tunnel binding policy.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface+tunnel"><b><span class="cmdname">interface tunnel</span></b></a> <i><span class="varname">interface-number</span></i></span><p><p>The tunnel interface view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=mpls+te+reserved-for-binding"><b><span class="cmdname">mpls te reserved-for-binding</span></b></a></span><p><p>Tunnel binding is enabled for the TE tunnel.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tunnel-policy"><b><span class="cmdname">tunnel-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>A tunnel policy is created.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-information</span></i></span><p><p>A description is configured for the tunnel policy.</p>
</p><p><p>The tunnel policy description helps users memorize the tunnel policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=tunnel+binding"><b><span class="cmdname">tunnel binding</span></b></a> <span><strong><span>destination</span></strong> <i><span class="varname">dest-ip-address</span></i> <strong><span>te</span></strong> { <em><i><span class="varname">tunnel-type</span></i></em> | <i><span class="varname">tunnel-type interface-number</span></i> }<span> &amp;&lt;1-32&gt;</span> [ <strong><span>ignore-destination-check</span></strong> ] [ <strong><span>down-switch</span></strong><span> | <strong><span>include-ldp</span></strong></span> ]</span></span><p><p>A specified TE tunnel is bound to a specified destination IP address in the tunnel policy view.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>If the <strong><span>down-switch</span></strong> parameter is specified in the command, the system selects an LSP or CR-LSP in descending order of priority for VPN data transmission when the bound TE tunnel is unavailable.</p>
</li><li><p>If a PE has multiple peers, you can run the <a href="cmdqueryname=tunnel+binding"><b><span class="cmdname">tunnel binding</span></b></a> command several times with different destination addresses specified.</p>
<p>If a destination IP address is not bound to a tunnel using the <a href="cmdqueryname=tunnel+binding"><b><span class="cmdname">tunnel binding</span></b></a> command, the tunnel management module searches for a tunnel based on the default tunnel policy. By default, routes can recurse only to an LSP. To change the default type of tunnel to which routes recurse, run the <a href="cmdqueryname=tunnel+policy+binding-default+down-switch+enable"><b><span class="cmdname">tunnel policy binding-default down-switch enable</span></b></a> command to configure a tunnel policy to select a tunnel from available ones in descending order of priority: LSP &gt; TE tunnel<span> &gt; GRE tunnel</span>. LSP tunnels include LDP LSPs, BGP LSPs, and <span>SR-MPLS BE tunnels</span>. Their priorities are as follows: LDP LSP &gt; BGP LSP<span> &gt; SR-MPLS BE tunnel</span>.</p>
</li></ul>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_tnlm_cfg_0036.html">Configuring and Applying a Tunnel Policy
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_tnlm_cfg_0038.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>