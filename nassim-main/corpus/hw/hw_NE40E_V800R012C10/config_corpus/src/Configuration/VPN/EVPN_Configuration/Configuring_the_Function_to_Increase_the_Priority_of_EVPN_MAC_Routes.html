
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring the Function to Increase the Priority of EVPN MAC Routes">
<meta name="abstract" content="Configuring the function to increase the priority of EVPN MAC routes helps prevent MAC routes received from the network side from being suppressed in special scenarios.">
<meta name="description" content="Configuring the function to increase the priority of EVPN MAC routes helps prevent MAC routes received from the network side from being suppressed in special scenarios.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0150.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0280.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001419796597">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring the Function to Increase the Priority of EVPN MAC Routes</title>
</head>
<body><a name="EN-US_TASK_0000001419796597"></a><a name="EN-US_TASK_0000001419796597"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring the Function to Increase the Priority of EVPN MAC Routes</h1>
<div class="taskbody"><p>Configuring the function to increase the priority of EVPN MAC routes helps prevent MAC routes received from the network side from being suppressed in special scenarios.</p>
<div class="context"><a name="EN-US_TASK_0000001419796597__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>On the EVPN VPLS network shown in <a href="#EN-US_TASK_0000001419796597__fig17853203404315">Figure 1</a>, two PEs are connected through both network-side and access-side links. As a result, MAC route flapping may occur, and the local MAC routes learned from the access side may be the same as the remote MAC routes learned from EVPN peers. If this is the case, the MAC routes received from the network side are suppressed. To prevent this situation, configure the function to increase the priority of MAC routes learned from the network side.</p>
<div class="fignone" id="EN-US_TASK_0000001419796597__fig17853203404315"><a name="EN-US_TASK_0000001419796597__fig17853203404315"></a><a name="fig17853203404315"></a><span class="figcap"><b>Figure 1 </b>EVPN VPLS networking</span><br><span><img class="vsd" src="figure/en-us_image_0000001420839945.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001419796597__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring the function to increase the priority of EVPN MAC routes, complete one of the following tasks:</p>
<ul><li><a href="dc_vrp_evpn_cfg_0065.html">Configure EVPN VPLS over MPLS (BD EVPN instance)</a>.</li><li><a href="dc_vrp_srv6_cfg_all_0023_copy.html">Configure EVPN VPLS over SRv6 BE</a>.</li><li><a href="dc_vrp_cfg_evpn-vpls_over_srv6-te_policy_copy.html">Configure EVPN VPLS over SRv6 TE Policy</a>.</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001419796597__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure a route-policy on PE2 to set the community attributes of EVPN MAC routes to be advertised to other PEs. This section uses community attributes as an example. For details about other policy settings, see <a href="dc_vrp_evpn_cfg_0150.html">Configuring an EVPN Route-Policy</a>.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li><span>Run the <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a> command to enter the BGP EVPN address family view.</span></li><li><span>Run the <a href="cmdqueryname=peer+advertise-community"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">ipv6-address</span></i> } <strong><span>advertise-community</span></strong> command to advertise the community attribute to the peer.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } <strong><span>node</span></strong> <i><span class="varname">node</span></i> command to create a route-policy with a specified node and enter the route-policy view.</span></li><li><span>Run the <a href="cmdqueryname=if-match+route-type"><b><span class="cmdname">if-match route-type</span></b></a> <strong><span>evpn</span></strong> <strong><span>mac</span></strong> command to configure a matching rule for the EVPN MAC route type.</span></li><li><span>Run the <a href="cmdqueryname=apply+community"><b><span class="cmdname">apply community </span></b></a>{ <i><span class="varname">cmntyValue</span></i> | <i><span class="varname">cmntyNum</span></i> | <strong><span>internet</span></strong> | <strong><span>no-advertise</span></strong> | <strong><span>no-export</span></strong> | <strong><span>no-export-subconfed</span></strong> } &amp;&lt;1-32&gt; [ <strong><span>additive</span></strong> ] or <a href="cmdqueryname=apply+community+community-list"><b><span class="cmdname">apply community community-list </span></b></a><i><span class="varname">community-list-name</span></i> [ <strong><span>additive</span></strong> ] command to set route attributes.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li><li><span>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong> command to enter the EVPN instance view.</span></li><li><span>Run the <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to apply an export route-policy to the EVPN instance, so that the EVPN instance can filter routes to be advertised.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Route receiver PE1 applies a route-policy to increase the priority of learned EVPN MAC routes.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Configure a community filter.</span><p><ul><li><p>To configure a standard community filter, run the <a href="cmdqueryname=ip+community-filter+basic"><b><span class="cmdname">ip community-filter basic </span></b></a><i><span class="varname">basCfName</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-val</span></i> ] <i><span class="varname">matchMode</span></i> [ <i><span class="varname">cmntyStr</span></i> | <i><span class="varname">cmntyNum</span></i> | <strong><span>internet</span></strong>  | <strong><span>no-advertise</span></strong> | <strong><span>no-export</span></strong> | <strong><span>no-export-subconfed</span></strong> ] &amp;&lt;1-20&gt; or <a href="cmdqueryname=ip+community-filter"><b><span class="cmdname">ip community-filter </span></b></a><i><span class="varname">cfIndex</span></i> [ <strong><span>index</span></strong> <i><span class="varname">index-val</span></i> ] <i><span class="varname">matchMode</span></i> [ <i><span class="varname">cmntyStr</span></i> | <i><span class="varname">cmntyNum</span></i> | <strong><span>internet</span></strong>  | <strong><span>no-advertise</span></strong> | <strong><span>no-export</span></strong> | <strong><span>no-export-subconfed</span></strong> ] &amp;&lt;1-20&gt; command.</p>
</li><li><p>To configure an advanced community filter, run the <a href="cmdqueryname=ip+community-filter"><b><span class="cmdname">ip community-filter</span></b></a> { <strong><span>advanced</span></strong> <i><span class="varname">comm-filter-name</span></i> | <i><span class="varname">adv-comm-filter-num</span></i> } <span>[ <strong><span>index</span></strong> <i><span class="varname">index-number</span></i> ]</span> <i><span class="varname">matchMode</span></i> <i><span class="varname">regular-expression</span></i> command.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> { <strong><span>permit</span></strong> | <strong><span>deny</span></strong> } <strong><span>node</span></strong> <i><span class="varname">node</span></i> command to create a route-policy with a specified node and enter the route-policy view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=if-match+community-filter"><b><span class="cmdname">if-match community-filter</span></b></a> { <i><span class="varname">basIndex</span></i> [ <strong><span>whole-match</span></strong> ] | <em>AdvIndex</em> [ <strong><span>sort-match</span></strong> ]} &amp;&lt;1-16&gt; command to configure a matching rule based on the community filter.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong> command to enter the EVPN instance view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=mac-high-priority+trigger+route-policy"><b><span class="cmdname">mac-high-priority trigger route-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to apply a route-policy to increase the priority of EVPN MAC routes imported into the EVPN instance.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001419796597__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, verify it.</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp+evpn+routing-table"><b><span class="cmdname">display bgp evpn all routing-table mac-route</span></b></a> <i><span class="varname">prefix</span></i> command on PE1 to check whether the received MAC route carries the community attribute. <i><span class="varname">prefix</span></i> is in the format of E:M:H-H-H:L:X.X.X.X or E:M:H-H-H:L: [X:X::X:X]. For example, <i><span class="varname">prefix</span></i> can be 0:48:0001-0001-0001:0:0.0.0.0.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0150.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0280.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>