
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Inter-AS BGP VPLS Option C (with RRs Deployed)">
<meta name="abstract" content="In inter-AS Option C, a network device only needs to establish a public tunnel with a PE in a different AS. ASBRs do not need to maintain inter-AS L2VPN information or reserve AC interfaces for inter-AS L2VPN connections. As L2VPN information is exchanged only between PEs, this solution requires fewer resources and less configuration workload.">
<meta name="description" content="In inter-AS Option C, a network device only needs to establish a public tunnel with a PE in a different AS. ASBRs do not need to maintain inter-AS L2VPN information or reserve AC interfaces for inter-AS L2VPN connections. As L2VPN information is exchanged only between PEs, this solution requires fewer resources and less configuration workload.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6017.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6050.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0209975821">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Inter-AS BGP VPLS Option C (with RRs Deployed)</title>
</head>
<body><a name="EN-US_TASK_0209975821"></a><a name="EN-US_TASK_0209975821"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Inter-AS BGP VPLS Option C (with RRs Deployed)</h1>
<div class="taskbody"><p>In inter-AS Option C, a network device only needs to establish a public tunnel with a PE in a different AS. ASBRs do not need to maintain inter-AS L2VPN information or reserve AC interfaces for inter-AS L2VPN connections. As L2VPN information is exchanged only between PEs, this solution requires fewer resources and less configuration workload.</p>
<div class="steps"><a name="EN-US_TASK_0209975821__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable the function to exchange labeled IPv4 routes.</span><p><ul><li>Configure each PE.<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>label-route-capability</span></strong></p>
<p>The PE is enabled to exchange labeled IPv4 routes with the local ASBR.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li><li>Configure each ASBR.<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i></p>
<p>The view of a local interface connected to the peer ASBR in another AS is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> }</p>
<p>An IP address is configured for the interface.</p>
</li><li><p>Run <a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a></p>
<p>MPLS is enabled.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Return to the system view.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>label-route-capability</span></strong></p>
<p>The function to exchange labeled IPv4 routes with each PE in the local AS is enabled.</p>
<p>In inter-AS Option C, an inter-AS VPN LSP must be established, and the public network routes advertised between PEs and ASBRs must carry MPLS labels.</p>
<p>An EBGP peer relationship must be established between ASBRs in different ASs for them to exchange labeled IPv4 routes.</p>
<p>The public network routes carrying MPLS labels are advertised through MP-BGP. According to relevant standard protocols, label mapping information about a route can be piggybacked inside the BGP Update message that is used to advertise the route. This feature is implemented through a BGP extension attribute, which enables BGP peers to process labeled IPv4 routes.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">peer-as</span></i></p>
<p>The peer ASBR is specified as an EBGP peer.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>label-route-capability</span></strong> [ <strong><span>check-tunnel-reachable</span></strong> ]</p>
<div class="p">The local ASBR is enabled to exchange labeled IPv4 routes with the peer ASBR.<ul><li>If <strong><span>check-tunnel-reachable</span></strong> is configured, the ASBR advertises IPv4 unicast routes to the peer ASBR if the tunnel between them is unreachable and advertises labeled IPv4 routes if the tunnel is reachable. This parameter helps prevent traffic forwarding failures in VPN scenarios where an MP-EBGP peer relationship is established between two PEs but an LSP segment over the peer session fails to be established.</li><li>If <strong><span>check-tunnel-reachable</span></strong> is not configured, the ASBR advertises labeled IPv4 routes to the peer ASBR regardless of whether the tunnel between them is reachable.</li></ul>
</div>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</li></ul>
</p></li><li><span>Configure a route-policy on each ASBR to control label distribution.</span><p><p>Configure a route-policy to control MPLS label distribution for IPv4 routes on each ASBR. The ASBR assigns labels only to routes that match filter rules defined in the policy. Other routes are still IPv4 routes without MPLS labels.</p>
<p>By default, no MPLS labels are assigned to IPv4 routes.</p>
<p>Configure each ASBR.</p>
</p><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">policy-name1</span></i> <strong><span>permit</span></strong> <strong><span>node</span></strong> <i><span class="varname">seq-number</span></i></span><p><p>A route-policy is created to allow the ASBR to allocate MPLS labels to the matching IPv4 routes that are to be advertised to the local PE.</p>
</p><p><p>After the route-policy is configured, if labeled IPv4 routes are to be advertised to the PE within the same AS, the ASBR reallocates MPLS labels to the routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=if-match+mpls-label"><b><span class="cmdname">if-match mpls-label</span></b></a></span><p><p>The ASBR is enabled to match labeled IPv4 routes against the route-policy.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a></span><p><p>The function to allocate labels to IPv4 routes is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">policy-name2</span></i> <strong><span>permit</span></strong> <strong><span>node</span></strong> <i><span class="varname">seq-number</span></i></span><p><p>A route-policy is created to allow the ASBR to allocate MPLS labels to the matching IPv4 routes that are to be advertised to the peer ASBR.</p>
</p><p><p>For matching routes accepted from the PE in the same AS, the ASBR allocates MPLS labels to these routes before advertising them to the peer ASBR.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a></span><p><p>The function to allocate labels to IPv4 routes is configured.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name1</span></i> <strong><span>export</span></strong></span><p><p>The route-policy applied to routes to be advertised to the local PE is specified.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name2</span></i> <strong><span>export</span></strong></span><p><p>The configured route-policy is applied to the routes to be advertised to the peer ASBR.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure the VPLS signaling capability for BGP peers.</span><p><div class="p"><ul><li><div class="p">This configuration requires each ASBR to advertise the local PEs' loopback interface addresses used for BGP sessions to the peer ASBR and then to PEs in the same AS as the peer ASBR. Configure each ASBR.<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">ip-address</span></i> [ <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</p>
<p>Loopback interface addresses used for BGP session creation on the PEs are advertised in the AS.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</div>
</li><li><div class="p">Configure the VPLS signaling capability between the ASBR and the local RR and between the ASBR and the peer ASBR. Configure each ASBR.<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">peer-as</span></i></p>
<p>A peer is specified.</p>
</li><li><div class="p">Enable the VPLS signaling capability between BGP peers.<ol class="substepthirdol"><li><p>Run <a href="cmdqueryname=l2vpn-ad-family"><b><span class="cmdname">l2vpn-ad-family</span></b></a></p>
<p>The L2VPN AD address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong></p>
<p>The device is enabled to exchange routing information with a specified BGP peer.</p>
</li><li><p>Run <a href="cmdqueryname=signaling+vpls"><b><span class="cmdname">signaling vpls</span></b></a> or <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>signaling</span></strong> <strong><span>vpls</span></strong></p>
<p>The VPLS signaling capability is enabled.</p>
</li></ol>
</div>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>next-hop-invariable</span></strong></p>
<p>The device is enabled to advertise label block information to the local RR and peer ASBR without changing the next hops of routes.</p>
</li></ol>
</div>
</li><li><div class="p">Configure each PE.<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">peer-as</span></i></p>
<p>The local RR is specified as an IBGP peer of the PE.</p>
</li><li><div class="p">Enable the VPLS signaling capability between BGP peers.<ol class="substepthirdol"><li><p>Run <a href="cmdqueryname=l2vpn-ad-family"><b><span class="cmdname">l2vpn-ad-family</span></b></a></p>
<p>The L2VPN AD address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong></p>
<p>The PE is enabled to exchange routing information with a specified BGP peer.</p>
</li><li><p>Run <a href="cmdqueryname=signaling+vpls"><b><span class="cmdname">signaling vpls</span></b></a> or <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>signaling</span></strong> <strong><span>vpls</span></strong></p>
<p>The VPLS signaling capability is enabled.</p>
</li></ol>
</div>
</li></ol>
</div>
</li><li><p>Configure each RR.</p>
<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">peer-as</span></i></p>
<p>An IBGP peer is specified. Run this command with the <i><span class="varname">ipv4-address</span></i> value set to the local PE's IPv4 address and then run it again with the value set to the local ASBR's IPv4 address.</p>
</li><li><div class="p">Enable the VPLS signaling capability between BGP peers.<ol class="substepthirdol"><li><p>Run <a href="cmdqueryname=l2vpn-ad-family"><b><span class="cmdname">l2vpn-ad-family</span></b></a></p>
<p>The L2VPN AD address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong></p>
<p>The device is enabled to exchange routing information with a specified local PE or local ASBR.</p>
</li><li><p>Run <a href="cmdqueryname=signaling+vpls"><b><span class="cmdname">signaling vpls</span></b></a> or <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>signaling</span></strong> <strong><span>vpls</span></strong></p>
<p>The VPLS signaling capability is enabled.</p>
</li><li>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>reflect-client</span></strong><p>The device is configured as an RR, and its peer is configured as the client of the RR.</p>
</li></ol>
</div>
</li></ol>
</li></ul>
</div>
</p></li><li><span>Configure BGP VPLS on each PE. For configuration details, see <a href="dc_vrp_vpls_cfg_6005.html">Configuring BGP VPLS</a>.</span></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6023.html">Configuring Inter-AS VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6017.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6050.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>