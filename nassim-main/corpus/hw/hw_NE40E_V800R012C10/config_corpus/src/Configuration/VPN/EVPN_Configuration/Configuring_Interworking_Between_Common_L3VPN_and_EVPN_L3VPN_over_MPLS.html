
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Interworking Between Common L3VPN and EVPN L3VPN over MPLS">
<meta name="abstract" content="During the reconstruction of a common L3VPN into an EVPN L3VPN over MPLS, coexistence of the EVPN L3VPN over MPLS and common L3VPN occurs. To prevent network reconstruction from compromising communication, configure interworking between common L3VPN and EVPN L3VPN over MPLS, so that the common L3VPN and EVPN L3VPN over MPLS can communicate.">
<meta name="description" content="During the reconstruction of a common L3VPN into an EVPN L3VPN over MPLS, coexistence of the EVPN L3VPN over MPLS and common L3VPN occurs. To prevent network reconstruction from compromising communication, configure interworking between common L3VPN and EVPN L3VPN over MPLS, so that the common L3VPN and EVPN L3VPN over MPLS can communicate.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0040.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_mpls-l3vpn-srv6.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370492">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Interworking Between Common L3VPN and EVPN L3VPN over MPLS</title>
</head>
<body><a name="EN-US_TASK_0172370492"></a><a name="EN-US_TASK_0172370492"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Interworking Between Common L3VPN and EVPN L3VPN over MPLS</h1>
<div class="taskbody"><p>During the reconstruction of a common L3VPN into an EVPN L3VPN over MPLS, coexistence of the EVPN L3VPN over MPLS and common L3VPN occurs. To prevent network reconstruction from compromising communication, configure interworking between common L3VPN and EVPN L3VPN over MPLS, so that the common L3VPN and EVPN L3VPN over MPLS can communicate.</p>
<div class="context"><a name="EN-US_TASK_0172370492__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>On the network shown in <a href="#EN-US_TASK_0172370492__fig2056513373518">Figure 1</a>, an L3VPN is already deployed. During the reconstruction of a common L3VPN into an EVPN L3VPN over MPLS, coexistence of the common L3VPN and EVPN L3VPN over MPLS occurs. To ensure communication between the common L3VPN and EVPN L3VPN over MPLS, configure interworking between these two types of VPNs on NPE1.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370492__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><div class="fignone" id="EN-US_TASK_0172370492__fig2056513373518"><a name="EN-US_TASK_0172370492__fig2056513373518"></a><a name="fig2056513373518"></a><span class="figcap"><b>Figure 1 </b>Interworking between common L3VPN and EVPN L3VPN over MPLS</span><br><span><img class="vsd" src="figure/en-us_image_0000001229989409.png" width="NaN" height="NaN"></span></div>
<p>Before configuring interworking between common L3VPN and EVPN L3VPN over MPLS, complete the following tasks:</p>
<ul><li><p>Configure basic MPLS functions on NPE1, NPE2, and the UPE.</p>
</li><li><p>Configure IGP on the UPE, NPE1, and NPE2 to ensure route reachability.</p>
</li><li><p>Configure <a href="dc_vrp_evpn_cfg_0006.html">BGP EVPN peer relationships</a> between NPE1 and NPE2.</p>
</li><li><p>Deploy <a href="dc_vrp_mpls-l3vpn-v4_cfg_0154.html">basic BGP/MPLS IP VPN</a><span> or <a href="dc_vrp_mpls-l3vpn-v6_cfg_2057.html">basic BGP/MPLS IPv6 VPN</a></span> between NPE1 and the UPE.</p>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172370492__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure NPE1 and NPE2 to generate and advertise EVPN IP prefix routes.</span><p><p>For IPv4 services, perform the following configurations.</p>
<ol><li>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a><p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></p>
<p>A VPN instance is created, and its view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a></p>
<p>The VPN instance IPv4 address family is enabled, and its view is displayed.</p>
</li><li>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i><p>An RD is configured for the VPN instance IPv4 address family.</p>
</li><li><p>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] <strong><span>evpn</span></strong></p>
<p>VPN targets are configured for the VPN instance IPv4 address family to exchange routes with the local EVPN instance.</p>
</li><li><p>Run <a href="cmdqueryname=evpn+mpls+routing-enable"><b><span class="cmdname">evpn mpls routing-enable</span></b></a></p>
<p>EVPN is enabled to generate and advertise IP prefix and IRB routes.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></p>
<p>EVPN routes that can be imported into the VPN instance IPv4 address family are associated with a tunnel policy.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Exit the VPN instance IPv4 address family view.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Exit the VPN instance view.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
<p>For IPv6 services, perform the following configurations.</p>
<ol><li>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></p>
<p>A VPN instance is created, and its view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a></p>
<p>The VPN instance IPv6 address family is enabled, and its view is displayed.</p>
</li><li>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i><p>An RD is configured for the VPN instance IPv6 address family.</p>
</li><li><p>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] <strong><span>evpn</span></strong></p>
<p>VPN targets are configured for the VPN instance IPv6 address family to exchange routes with the local EVPN instance.</p>
</li><li><p>Run <a href="cmdqueryname=evpn+mpls+routing-enable"><b><span class="cmdname">evpn mpls routing-enable</span></b></a></p>
<p>EVPN is enabled to generate and advertise IP prefix and IRB routes.</p>
</li><li><p>(Optional) Run <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></p>
<p>EVPN routes that can be imported into the VPN instance IPv6 address family are associated with a tunnel policy.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Exit the VPN instance IPv6 address family view.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Exit the VPN instance view.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</p></li><li><span>Configure NPE1 to advertise routes re-originated by the EVPN address family to the VPNv4<span>/VPNv6</span> peer (UPE).</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=+peer+import+reoriginate"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>import</span></strong> <strong><span>reoriginate</span></strong></span><p><p>The device is configured to add a re-origination flag to routes received from the BGP EVPN peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong></span><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpnv6</span></strong></span></span><p><p>The BGP-VPNv4<span>/VPNv6</span> address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>reflect-client</span></strong></span><p><p>The UPE is specified as a BGP VPNv4<span>/VPNv6</span> RR client to reflect BGP VPNv4<span>/VPNv6</span> routes re-originated from EVPN routes.</p>
</p><p></p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <strong><span>evpn</span></strong> { <strong><span>mac-ip</span></strong> | <strong><span>ip</span></strong><span> | <strong><span>mac-ipv6</span></strong> | <strong><span>ipv6</span></strong></span> }</span><p><p>The device is configured to advertise routes re-originated by the EVPN address family to the BGP VPNv4<span>/VPNv6</span> peer.</p>
</p><p><p>After the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <strong><span>evpn</span></strong> { <strong><span>mac-ip</span></strong> | <strong><span>ip</span></strong><span> | <strong><span>mac-ipv6</span></strong> | <strong><span>ipv6</span></strong></span> } command is run, NPE1 re-originates the EVPN routes received from NPE2 by using MPLS to encapsulate these routes into BGP VPNv4<span>/VPNv6</span> routes and then sends them to the UPE.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure NPE1 to advertise routes re-originated by the VPNv4<span>/VPNv6</span> address family to the BGP EVPN peer (NPE2).</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpnv6</span></strong></span></span><p><p>The BGP-VPNv4<span>/VPNv6</span> address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+import+reoriginate"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>import</span></strong> <strong><span>reoriginate</span></strong></span><p><p>The device is configured to add a re-origination flag to routes received from the VPNv4<span>/VPNv6</span> peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>reflect-client</span></strong></span><p><p>NPE2 is specified as a BGP EVPN RR client to reflect BGP EVPN routes re-originated from BGP VPNv4<span>/VPNv6</span> routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <span>{ </span><strong><span>vpnv4</span></strong><span> | <strong><span>vpnv6</span></strong> }</span></span><p><p>NPE1 is configured to advertise routes re-originated by the VPNv4<span>/VPNv6</span> address family to the BGP EVPN peer (NPE2).</p>
</p><p><p>After the <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <strong><span>route-reoriginated</span></strong> <span>{ </span><strong><span>vpnv4</span></strong><span> | <strong><span>vpnv6</span></strong> }</span> command is run, NPE1 re-encapsulates the MPLS-encapsulated VPNv4<span>/VPNv6</span> routes received from the UPE into EVPN routes and then sends them to NPE2.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The BGP-VPN instance IPv4<span> or IPv6</span> address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a></span></span><p><p>The device is enabled to advertise host IP routes in the VPN instance as EVPN IP prefix routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
<div class="postreq"><a name="EN-US_TASK_0172370492__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li>Run the <a href="cmdqueryname=display+bgp+evpn+all+routing-table"><b><span class="cmdname">display bgp evpn all routing-table</span></b></a> command on NPE2 to check information about EVPN routes received from the UPE.</li><li>Run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance"><b><span class="cmdname">display ip routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> or <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance"><b><span class="cmdname">display ipv6 routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command on NPE2 or the UPE to check information about VPN routes received from the remote end.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0040.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_mpls-l3vpn-srv6.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>