
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an L2VPN Monitoring Group">
<meta name="abstract" content="During fault rectification in a link protection scenario, if service VSI PWs go up prior to protocol VSI PWs, service VSI loops occur. To prevent this issue, you can configure an L2VPN monitoring group to monitor the VSI recovery status and delay the unblocking of service VSI PWs.">
<meta name="description" content="During fault rectification in a link protection scenario, if service VSI PWs go up prior to protocol VSI PWs, service VSI loops occur. To prevent this issue, you can configure an L2VPN monitoring group to monitor the VSI recovery status and delay the unblocking of service VSI PWs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5034.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370159">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an L2VPN Monitoring Group</title>
</head>
<body><a name="EN-US_TASK_0172370159"></a><a name="EN-US_TASK_0172370159"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an L2VPN Monitoring Group</h1>
<div class="taskbody"><p>During fault rectification in a link protection scenario, if service VSI PWs go up prior to protocol VSI PWs, service VSI loops occur. To prevent this issue, you can configure an L2VPN monitoring group to monitor the VSI recovery status and delay the unblocking of service VSI PWs.</p>
<div class="context"><a name="EN-US_TASK_0172370159__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>In a link protection scenario such as RRPP, if a device restarts, a board resets, or both the primary and secondary PWs fail, the service and protocol VSI PWs also fail. (The protocol VSI is a VSI that transmits link protection protocol packets.) When the fault recovers, the service VSI PWs may go up prior to the protocol VSI PWs. This will result in a service VSI loop, adversely affecting service traffic.</p>
<p>To solve this problem, create an L2VPN monitoring group, bind the protocol VSI PWs to the monitoring group, and specify the monitoring group to be tracked in the service VSI. If the service VSI PWs go up prior to the protocol VSI PWs bound to the monitoring group, the device blocks the service VSI PWs. When all the protocol VSI PWs bound to the monitoring group go up, the hold-off timer is started. After the timer expires, the service PWs are unblocked. This ensures that no service VSI loop occurs in such a scenario.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The protocol VSI is a VSI that transmits link protection protocol packets.</p>
</div></div>
<h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring an L2VPN monitoring group, complete the following tasks:</p>
<ul><li>Create the protocol VSI and related PWs.</li><li>Create the service VSI and related PWs.</li><li>Configure link protection.</li></ul>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172370159__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure an L2VPN monitoring group and set a hold-off time for unblocking service VSI PWs.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a> command to enable MPLS.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=mpls+l2vpn"><b><span class="cmdname">mpls l2vpn</span></b></a> command to enter the MPLS L2VPN view.</span></li><li><span>Run the <a href="cmdqueryname=monitor-group"><b><span class="cmdname">monitor-group</span></b></a> <i><span class="varname">monitor-group-name</span></i> command to configure an L2VPN monitoring group.</span></li><li><span>Run the <a href="cmdqueryname=monitor+enable"><b><span class="cmdname">monitor enable</span></b></a> command to enable the monitoring function for the L2VPN monitoring group.</span></li><li><span>(Optional) Run the <a href="cmdqueryname=trigger+unblock-delay"><b><span class="cmdname">trigger unblock-delay</span></b></a> <i><span class="varname">max-delay-time</span></i> command to configure the maximum hold-off time for the L2VPN monitoring group to perform unblocking.</span></li><li><span>Run the <a href="cmdqueryname=binding+pw"><b><span class="cmdname">binding pw</span></b></a> <strong><span>ldp</span></strong> <strong><span>vsi</span></strong> <i><span class="varname">vsi-name</span></i> <strong><span>peer</span></strong> <i><span class="varname">peer-ip</span></i> <strong><span>pw-id</span></strong> <i><span class="varname">pw-id</span></i> <strong><span>encapsulation</span></strong> { <strong><span>vlan</span></strong> | <strong><span>ethernet</span></strong> } command to bind the protocol VSI PWs to the L2VPN monitoring group.</span></li><li><span>(Optional) Run the <a href="cmdqueryname=binding-pw-up+trigger+unblock-delay"><b><span class="cmdname">binding-pw-up trigger unblock-delay</span></b></a> <i><span class="varname">delay-time</span></i> command to configure the hold-off time for unblocking the service VSI PWs after the protocol VSI PWs bound to the L2VPN monitoring group go up.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure service VSI PWs in LDP mode to track the L2VPN monitoring group.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <i><span class="varname">vsi-name</span></i> [ <strong><span>static</span></strong> ] command to enter the service VSI view.</span></li><li><span>Run the <a href="cmdqueryname=pwsignal"><b><span class="cmdname">pwsignal</span></b></a> <strong><span>ldp</span></strong> command to configure LDP as the PW signaling protocol and enter the VSI-LDP view.</span></li><li><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peer-address</span></i> [ <strong><span>negotiation-vc-id</span></strong> <i><span class="varname">vc-id</span></i> ] <strong><span>pw</span></strong> <i><span class="varname">pw-name</span></i> command to configure a VSI peer.</span></li><li><span>Run the <a href="cmdqueryname=track+monitor-group"><b><span class="cmdname">track monitor-group</span></b></a> <i><span class="varname">group-name</span></i> command to configure service VSI PWs to track the L2VPN monitoring group. This step must be performed on both SPEs.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure service VSI PWs in BGP AD mode to track the L2VPN monitoring group.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <i><span class="varname">vsi-name</span></i> [ <strong><span>static</span></strong> ] command to enter the service VSI view.</span></li><li><span>Run the <a href="cmdqueryname=bgp-ad"><b><span class="cmdname">bgp-ad</span></b></a> command to set the PW establishment mode of the VSI to BGP AD and enter the VSI-BGP AD view.</span></li><li><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">peer-address</span></i> <strong><span>pw</span></strong> <i><span class="varname">pw-name</span></i> command to create a PW and enter its view.</span></li><li><span>Run the <a href="cmdqueryname=track+monitor-group"><b><span class="cmdname">track monitor-group</span></b></a> <i><span class="varname">group-name</span></i> command to configure service VSI PWs to track the L2VPN monitoring group. This step must be performed on both SPEs.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5000.html">VPLS Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5018.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5034.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>