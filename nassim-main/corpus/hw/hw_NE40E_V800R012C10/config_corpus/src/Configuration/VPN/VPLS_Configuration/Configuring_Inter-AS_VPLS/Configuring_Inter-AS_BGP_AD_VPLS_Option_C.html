
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Inter-AS BGP AD VPLS Option C">
<meta name="abstract" content="In inter-AS Option C, a network device only needs to establish a public tunnel with a PE in a different AS. ASBRs do not need to maintain inter-AS L2VPN information or reserve AC interfaces for inter-AS L2VPN connections. As L2VPN information is exchanged only between PEs, this solution requires fewer resources and less configuration workload.">
<meta name="description" content="In inter-AS Option C, a network device only needs to establish a public tunnel with a PE in a different AS. ASBRs do not need to maintain inter-AS L2VPN information or reserve AC interfaces for inter-AS L2VPN connections. As L2VPN information is exchanged only between PEs, this solution requires fewer resources and less configuration workload.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6023.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6050.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6026.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370140">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Inter-AS BGP AD VPLS Option C </title>
</head>
<body><a name="EN-US_TASK_0172370140"></a><a name="EN-US_TASK_0172370140"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Inter-AS BGP AD VPLS Option C </h1>
<div class="taskbody"><p>In inter-AS Option C, a network device only needs to establish a public tunnel with a PE in a different AS. ASBRs do not need to maintain inter-AS L2VPN information or reserve AC interfaces for inter-AS L2VPN connections. As L2VPN information is exchanged only between PEs, this solution requires fewer resources and less configuration workload.</p>
<div class="steps"><a name="EN-US_TASK_0172370140__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable the function to exchange labeled IPv4 routes.</span><p><ul><li>Configure each PE.<ol type="a"><li><p>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>label-route-capability</span></strong> command to configure the function to exchange labeled IPv4 routes with the ASBR in the local AS.</p>
</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
</li><li>Configure each ASBR.<ol type="a"><li><p>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command to enter the view of the interface connecting to the peer ASBR.</p>
</li><li><p>Run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } command to configure an IP address for the interface.</p>
</li><li><p>Run the <a href="cmdqueryname=mpls"><b><span class="cmdname">mpls</span></b></a> command to enable MPLS.</p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> } command to enter the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>label-route-capability</span></strong> command to configure the function to exchange labeled IPv4 routes with the PE in the local AS.</p>
<p>In inter-AS Option C, an inter-AS VPN LSP must be established, and the public network routes advertised between PEs and ASBRs must carry MPLS labels.</p>
<p>The local ASBR establishes an EBGP peer relationship with the remote ASBR to exchange labeled IPv4 routes.</p>
<p>The public network routes carrying MPLS labels are advertised through MP-BGP. According to the relevant standard (Carrying Label Information in BGP-4), label mapping information about a route can be piggybacked inside the BGP Update message that is used to advertise the route. This feature is implemented through a BGP extension attribute, which enables BGP peers to process labeled IPv4 routes.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i> command to configure the peer ASBR as an EBGP peer.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>label-route-capability</span></strong> [ <strong><span>check-tunnel-reachable</span></strong> ] command to configure the function to exchange labeled IPv4 routes with the peer ASBR.</p>
<div class="p"><ul><li>If the <strong>check-tunnel-reachable</strong> parameter is configured, BGP advertises IPv4 unicast routes to peers when the tunnels for routes are unreachable or advertises labeled routes to peers when the tunnels for routes are reachable. This parameter helps prevent traffic forwarding failures in VPN scenarios where an MP-EBGP peer relationship is established between two PEs but an LSP segment over the peer session fails to be established.</li><li>If the <strong>check-tunnel-reachable</strong> parameter is not configured, labeled routes are advertised regardless of whether the tunnels for imported routes are reachable.</li></ul>
</div>
</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
</li></ul>
</p></li><li><span>Configure a route-policy on each ASBR to control label distribution.</span><p><p>Configure a route-policy to control MPLS label distribution for IPv4 routes on each ASBR. The ASBR assigns labels only to routes that match filter rules defined in the policy. Other routes are still IPv4 routes without MPLS labels.</p>
<p>Configure each ASBR.</p>
</p><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">policy-name1</span></i> <strong><span>permit</span></strong> <strong><span>node</span></strong> <i><span class="varname">seq-number</span></i> command to create a route-policy for the local PE.</span><p><p>The local ASBR reallocates MPLS labels to labeled IPv4 routes before advertising these routes to PEs in the same AS.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=if-match+mpls-label"><b><span class="cmdname">if-match mpls-label</span></b></a> command to match labeled IPv4 routes against the route-policy.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a> command to configure the function to allocate labels to IPv4 routes.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">policy-name2</span></i> <strong><span>permit</span></strong> <strong><span>node</span></strong> <i><span class="varname">seq-number</span></i> command to create a route-policy for the peer ASBR.</span><p><p>This policy ensures that the local ASBR allocates a new MPLS label to each route received from PEs in the local AS before advertising these routes to the peer ASBR.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a> command to configure the function to allocate labels to IPv4 routes.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name1</span></i> <strong><span>export</span></strong> command to specify the route-policy applied when routes are advertised to the local PE.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name2</span></i> <strong><span>export</span></strong> command to specify the route-policy applied when routes are advertised to the peer ASBR.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Establish MP-EBGP VPLS peer relationships.</span><p><div class="p"><ul><li><div class="p">This configuration requires each ASBR to advertise the local PEs' loopback interface addresses used for BGP sessions to the peer ASBR and then to PEs in the same AS as the peer ASBR. Configure each ASBR.<ol type="a"><li><p>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> } command to enter the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">ip-address</span></i> [ <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] command to advertise the loopback interface addresses used for BGP sessions on the PEs in the local AS.</p>
</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
</div>
</li><li><div class="p">Configure each PE.<ol type="a"><li><p>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> } command to enter the BGP view.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i> command to specify the remote PE as an EBGP peer.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>ebgp-max-hop</span></strong> [ <i><span class="varname">hop-count</span></i> ] command to specify the maximum number of hops allowed for an EBGP peer session.</p>
<p>The PEs in different ASs are generally indirectly connected. To set up an EBGP peer relationship between two PEs in different ASs, configure the maximum number of hops allowed between the PEs and ensure that the PEs are reachable to each other.</p>
</li><li><div class="p">Enable the VPLS signaling capability between BGP peers.<ol class="substepthirdol"><li><p>Run the <a href="cmdqueryname=l2vpn-ad-family"><b><span class="cmdname">l2vpn-ad-family</span></b></a> command to enter the L2VPN AD address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>enable</span></strong> command to enable the function to exchange routing information with the specified BGP peer.</p>
<p>After you specify a peer in the L2VPN AD address family view, the BGP AD signaling capability is enabled by default.</p>
</li><li><p>Run the <a href="cmdqueryname=signaling+vpls"><b><span class="cmdname">signaling vpls</span></b></a> or <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>signaling</span></strong> <strong><span>vpls</span></strong> command to enable the VPLS signaling capability.</p>
</li><li><p>(Optional) Run the <a href="cmdqueryname=signaling+vpls-ad+disable"><b><span class="cmdname">signaling vpls-ad disable</span></b></a> command to disable the BGP AD signaling capability.</p>
<p>The BGP AD signaling capability is automatically enabled after you run the <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer enable</span></b></a> command. Therefore, you can disable the BGP AD signaling capability when configuring BGP VPLS.</p>
</li></ol>
</div>
</li><li><p>(Optional) Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>next-hop-invariable</span></strong> command to configure the function to advertise label block information to EBGP peers without changing the next hops of routes.</p>
<p>This step is used in scenarios where an RR is used to advertise label block information. The next hops of routes cannot be changed when label block information is exchanged between RRs. For other scenarios, skip this step.</p>
</li></ol>
</div>
</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ul>
</div>
</p></li><li><span>Configure BGP VPLS on each PE. For details, see <a href="dc_vrp_vpls_cfg_5057.html">Configuring BGP AD VPLS</a>.</span></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6023.html">Configuring Inter-AS VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6050.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6026.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>