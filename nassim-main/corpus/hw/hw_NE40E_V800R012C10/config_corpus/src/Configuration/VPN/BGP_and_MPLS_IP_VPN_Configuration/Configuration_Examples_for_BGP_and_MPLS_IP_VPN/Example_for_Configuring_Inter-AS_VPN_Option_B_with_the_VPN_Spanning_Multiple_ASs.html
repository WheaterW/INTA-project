
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS VPN Option B with the VPN Spanning Multiple ASs">
<meta name="abstract" content="In the scenario where the backbone network spans multiple ASs, ASBRs advertise labeled VPN-IPv4 routes through MP-EBGP.">
<meta name="description" content="In the scenario where the backbone network spans multiple ASs, ASBRs advertise labeled VPN-IPv4 routes through MP-EBGP.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0118.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0151.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369515">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Inter-AS VPN Option B with the VPN Spanning Multiple ASs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369515"></a><a name="EN-US_TASK_0172369515"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS VPN Option B with the VPN Spanning Multiple ASs</h1>
<div class="taskbody"><p>In the scenario where the backbone network spans multiple ASs, ASBRs advertise labeled VPN-IPv4 routes through MP-EBGP.</p>
<div class="context"><a name="EN-US_TASK_0172369515__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172369515__fig_dc_vrp_mpls-l3vpn-v4_cfg_011901">Figure 1</a>, CE1 and CE2 belong to vpna and need to communicate across across AS 100, AS 200, and AS 300. Like in basic inter-AS VPN Option B, you do not need to create a VPN instance on each ASBR. You only need to configure each ASBR to receive VPNv4 routes and advertise them to the peer ASBR. In addition, an MP-IBGP peer relationship needs to be established between ASBRs in AS 200.</p>
<div class="fignone" id="EN-US_TASK_0172369515__fig_dc_vrp_mpls-l3vpn-v4_cfg_011901"><a name="EN-US_TASK_0172369515__fig_dc_vrp_mpls-l3vpn-v4_cfg_011901"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_011901"></a><span class="figcap"><b>Figure 1 </b>Configuring inter-AS VPN Option B (with the VPN spanning multiple ASs)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0249477987.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="13.24867513248675%" id="mcps1.4.1.4.1.4.1.1" liSelected="liSelected"><p>Device Name</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="37.08629137086292%" id="mcps1.4.1.4.1.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="49.66503349665034%" id="mcps1.4.1.4.1.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="2" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>CE1</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.11.11.11/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>PE1</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.31.1.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>172.16.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR1</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.32.2.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>172.16.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR2</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.33.3.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.162.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR3</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.34.4.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.162.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>ASBR4</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.35.5.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.152.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>192.168.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>PE2</p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.36.6.9/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.152.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/2/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.2.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" valign="top" width="13.24867513248675%" headers="mcps1.4.1.4.1.4.1.1 "><p>CE2</p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="37.08629137086292%" headers="mcps1.4.1.4.1.4.1.2 "><p>Loopback1</p>
</td>
<td class="cellrowborder" valign="top" width="49.66503349665034%" headers="mcps1.4.1.4.1.4.1.3 "><p>10.22.22.22/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.2 "><p>GE<span>0/1/0</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.1.4.1.3 "><p>10.2.1.1/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369515__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>Configure an MP-EBGP peer relationship between the ASBRs in different ASs. Configure an MP-IBGP peer relationship between the ASBRs or the PE and ASBR in the same AS.</p>
</li><li><p>The ASBRs do not filter received VPNv4 routes based on VPN targets.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369515__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP in each AS for communication between devices in the same AS; set up an MPLS LDP LSP between the ASBRs or the ASBR and PE in the same AS.</p>
</li><li><p>Configure an MP-EBGP peer relationship between the ASBRs in different ASs. Configure an MP-IBGP peer relationship between the ASBRs or the PE and ASBR in the same AS.</p>
</li><li><p>Configure VPN instances on PEs and bind the interfaces connected to CEs to the VPN instances.</p>
</li><li><p>Enable MPLS on the interconnection interfaces between ASBRs and establish an MP-EBGP peer relationship between the ASBRs. Configure the ASBRs not to filter received VPNv4 routes based on VPN targets.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369515__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and ASBRs: 10.31.1.9, 10.32.2.9, 10.33.3.9, 10.34.4.9, 10.35.5.9, and 10.36.6.9</p>
</li><li><p>Name (vpna), RD (100:1/200:1), and export and import VPN targets (111:1) of the VPN instance on each PE</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369515__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>On the MPLS backbone network in each AS, configure IGP for IP connectivity between devices on each network.</span><p><p>This example uses OSPF as IGP. For configuration details, see the configuration files.</p>
<p>After the configurations are complete, the OSPF neighbor relationship can be established between the devices in the same AS. Run the <strong>display ospf peer</strong> command. The command output shows that the neighbor relationship is in the <strong>Full</strong> state. The devices in the same AS can learn and successfully ping the address of each other's loopback interface.</p>
</p></li><li><span>Configure basic MPLS capabilities and MPLS LDP on the MPLS backbone network in each AS to establish LDP LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 10.31.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see the configuration file.</p>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls lsr-id 10.32.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>The configurations of ASBR2, ASBR3, and ASBR4 are similar to the configuration of ASBR1. For detailed configurations, see the configuration files.</p>
<p>After the configurations are complete, LDP peer relationships can be established between the PE and ASBR and between the ASBRs. Run the <strong>display mpls ldp session</strong> command on each device. The command output shows that the session status is <strong>Operational</strong>. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt;<strong> display mpls ldp session</strong>

 LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted. </span>
 -------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 -------------------------------------------------------------------------
 10.32.2.9:0        <strong>Operational</strong> DU   Passive 0000:00:01  5/5
 -------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.</pre>
</p></li><li><span>Establish an MP-IBGP peer relationship between the PE and ASBR or between the ASBRs in the same AS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 10.32.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 10.32.2.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 10.32.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 10.31.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 10.31.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 10.31.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The configurations of devices in AS 200 and AS 300 are similar to the configurations of devices in AS 100. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display bgp vpnv4 all peer</strong> command on the PE or ASBR. The command output shows that an MP-IBGP peer relationship has been established between the PE and ASBR or between the ASBRs in the same AS. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 all peer</strong>

 BGP local router ID : 10.31.1.9
 Local AS number : 100
 Total number of peers : 1         Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv

  10.32.2.9       4         100    18970    19008     0 91:51:24   <strong>Established</strong>    0
</pre>
</p></li><li><span>Create a VPN instance on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>vpn-target 111:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display ip vpn-instance verbose</strong> command on each PE to check VPN instance configurations.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip vpn-instance verbose</strong>
 Total VPN-Instances configured : 1
 Total IPv4 VPN-Instances configured : 1 
 Total IPv6 VPN-Instances configured : 0
 
 VPN-Instance Name and ID : vpna, 1
  Interfaces : GigabitEthernet<span>0/2/0</span>
 Address family ipv4 
  Create date : 2009/09/18 11:30:35
  Up time : 0 days, 00 hours, 05 minutes and 19 seconds
  Vrf Status : UP
  Route Distinguisher : 100:1
  Export VPN Targets :  111:1
  Import VPN Targets :  111:1
  Label policy: label per route
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe</pre>
</p></li><li><span>Establish EBGP peer relationships between PEs and CEs, and import loopback routes from CEs into BGP.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>ip address 10.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>The configuration of CE2 is similar to the configuration of CE1. For configuration details, see the configuration file.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.1 as-number 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see the configuration file.</p>
<p>After completing the configurations, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on PEs to check whether BGP peer relationships have been established between the PEs and CEs. The command output shows that the BGP peer relationships have been established between the PEs and CEs and are in the <strong>Established</strong> state.</p>
<p>The following example uses the command output on PE1 to show that a BGP peer relationship has been established between PE1 and CE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 vpn-instance vpna peer</strong>

 BGP local router ID : 10.31.1.9
 Local AS number : 100
 Total number of peers : 1            Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down    State        PrefRcv
  10.1.1.1        4   65001  11     9          0     00:06:37   <strong>Established</strong>  1</pre>
</p></li><li><span>Set up an MP-EBGP peer relationship between ASBRs in different ASs, and disable VPN-target-based filtering for received VPNv4 routes.</span><p><p># On ASBR1, enable MPLS on GE<span>0/2/0</span> connected to ASBR2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># On ASBR2, enable MPLS on GE<span>0/2/0</span> that connects ASBR2 to ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure ASBR1 to establish an MP-EBGP peer with ASBR2, and disable ASBR1 from filtering received VPNv4 routes based on VPN targets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp]<strong> peer 192.168.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 192.168.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4]<strong> undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p># On ASBR2, set up an MP-EBGP peer relationship with ASBR1, and disable ASBR2 from filtering received VPNv4 routes based on VPN targets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2] <strong>bgp 200</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-bgp]<strong> peer 192.168.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv4] <strong>peer 192.168.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv4] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2-bgp] <strong>quit</strong></pre>
<p>The configurations of ASBR3 and ASBR4 are similar to the configurations of ASBR1 and ASBR2.</p>
<p>After completing the configurations, run the <strong>display bgp vpnv4 all peer</strong> command. The command output shows that an MP-EBGP peer relationship has been established between the ASBRs. The following example uses the command output on ASBR1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 all peer</strong>

 BGP local router ID : 10.32.2.9
 Local AS number : 100
 Total number of peers : 2         Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv

  10.31.1.9       4         100    17533    17554     0 127:24:5 Established    1
  10.33.3.9       4         <strong>200</strong>    12343    34554     0 127:24:5 <strong>Established</strong>    1</pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, the CEs can learn routes to the loopback interface of each other, and can ping each other.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 9        Routes : 9
Destination/Mask    Proto  Pre  Cost     Flags NextHop         Interface
       10.1.1.0/24  Direct 0    0             D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
    10.11.11.11/32  Direct 0    0             D  127.0.0.1       LoopBack1
   <strong>10.22.22.22/32</strong>  EBGP   255  0             D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">&lt;CE1&gt; <strong>ping -a 10.11.11.11 10.22.22.22</strong>
  PING 10.22.22.22: 56  data bytes, press CTRL_C to break
    Reply from 10.22.22.22: bytes=56 Sequence=1 ttl=252 time=120 ms
    Reply from 10.22.22.22: bytes=56 Sequence=2 ttl=252 time=73 ms
    Reply from 10.22.22.22: bytes=56 Sequence=3 ttl=252 time=111 ms
    Reply from 10.22.22.22: bytes=56 Sequence=4 ttl=252 time=86 ms
    Reply from 10.22.22.22: bytes=56 Sequence=5 ttl=252 time=110 ms
  --- 10.22.22.22 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 73/100/120 ms </pre>
<p>Run the <strong>display bgp vpnv4 all routing-table</strong> command on an ASBR to check VPNv4 routes.</p>
<p>The following example uses the command output on ASBR1.</p>
<p>&lt;ASBR1&gt;<strong> display bgp vpnv4 all routing-table</strong></p>
<pre class="screen"> BGP Local router ID is 10.32.2.9
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>


 Total number of routes from all PE: 2
 Route Distinguisher: 100:1


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  10.11.11.11/32     10.31.1.9       0          100        0      65001i
 Route Distinguisher: 200:1


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   10.22.22.22/32     192.168.1.2                             0   300 65002i</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369515__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface Loopback 1
 ip address 10.11.11.11 255.255.255.255
#
bgp 65001
 peer 10.1.1.2 as-number 100
 network 10.11.11.11 255.255.255.255
 #
 ipv4-family unicast
  undo synchronization
  peer 10.1.1.2 enable
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 10.31.1.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
#
interface LoopBack1
 ip address 10.31.1.9 255.255.255.255
#
bgp 100
 peer 10.32.2.9 as-number 100
 peer 10.32.2.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 10.32.2.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.32.2.9 enable
#
 ipv4-family vpn-instance vpna
  peer 10.1.1.1 as-number 65001
#
ospf 1
 area 0.0.0.0
  network 10.31.1.9 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
mpls lsr-id 10.32.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 10.32.2.9 255.255.255.255
#
bgp 100
 peer 192.168.1.2 as-number 200
 peer 10.31.1.9 as-number 100
 peer 10.31.1.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.1.2 enable
  peer 10.31.1.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.31.1.9 enable
  peer 192.168.1.2 enable
#
ospf 1
 area 0.0.0.0
  network 10.32.2.9 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
mpls lsr-id 10.33.3.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.162.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 10.33.3.9 255.255.255.255
#
bgp 200
 peer 192.168.1.1 as-number 100
 peer 10.34.4.9 as-number 200
 peer 10.34.4.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.1.1 enable
  peer 10.34.4.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.34.4.9 enable
  peer 192.168.1.1 enable
#
ospf 1
 area 0.0.0.0
  network 10.33.3.9 0.0.0.0
  network 10.162.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR3 configuration file</p>
<pre class="screen">#
sysname ASBR3
#
mpls lsr-id 10.34.4.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.162.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 10.34.4.9 255.255.255.255
#
bgp 200
 peer 192.168.2.2 as-number 300
 peer 10.33.3.9 as-number 200
 peer 10.33.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.2.2 enable
  peer 10.33.3.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.33.3.9 enable
  peer 192.168.2.2 enable
#
ospf 1
 area 0.0.0.0
  network 10.34.4.9 0.0.0.0
  network 10.162.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR4 configuration file</p>
<pre class="screen">#
sysname ASBR4
#
mpls lsr-id 10.35.5.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.152.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 10.35.5.9 255.255.255.255
#
bgp 300
 peer 192.168.2.1 as-number 200
 peer 10.36.6.9 as-number 300
 peer 10.36.6.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.2.1 enable
  peer 10.36.6.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.36.6.9 enable
  peer 192.168.2.1 enable
#
ospf 1
 area 0.0.0.0
  network 10.35.5.9 0.0.0.0
  network 10.152.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 10.36.6.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.152.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.2.1.2 255.255.255.0
#
interface LoopBack1
 ip address 10.36.6.9 255.255.255.255
#
bgp 300
 peer 10.35.5.9 as-number 300
 peer 10.35.5.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 10.35.5.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.35.5.9 enable
#
 ipv4-family vpn-instance vpna
  peer 10.2.1.1 as-number 65002
#
ospf 1
 area 0.0.0.0
  network 10.36.6.9 0.0.0.0
  network 10.152.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface Loopback 1
 ip address 10.22.22.22 255.255.255.255
#
bgp 65002
 peer 10.2.1.2 as-number 300
 network 10.22.22.22 255.255.255.255
 #
 ipv4-family unicast
  undo synchronization
  peer 10.2.1.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0118.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0151.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>