
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Interworking Between VPLS and EVPN VPLS over SRv6 BE">
<meta name="abstract" content="This section provides an example for configuring interworking between VPLS and EVPN VPLS over SRv6 BE when they are both deployed on a network.">
<meta name="description" content="This section provides an example for configuring interworking between VPLS and EVPN VPLS over SRv6 BE when they are both deployed on a network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0078.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_vpls_evpn-over-srv6_exp2.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0307196816">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Interworking Between VPLS and EVPN VPLS over SRv6 BE</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0307196816"></a><a name="EN-US_TASK_0307196816"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Interworking Between VPLS and EVPN VPLS over SRv6 BE</h1>
<div class="taskbody"><p>This section provides an example for configuring interworking between VPLS and EVPN VPLS over SRv6 BE when they are both deployed on a network.</p>
<div class="context"><a name="EN-US_TASK_0307196816__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0307196816__fig_dc_vrp_evpn_cfg_011401">Figure 1</a>, VPLS is deployed between the UPE and SPEs; EVPN VPLS over SRv6 BE is deployed between SPEs and the NPE. Interworking between VPLS and EVPN VPLS over SRv6 BE is implemented by binding a BD to a VSI and an EVPN instance on the SPE, thereby enabling all PWs in the VSI to access the EVPN through the BD.</p>
<div class="fignone" id="EN-US_TASK_0307196816__fig_dc_vrp_evpn_cfg_011401"><a name="EN-US_TASK_0307196816__fig_dc_vrp_evpn_cfg_011401"></a><a name="fig_dc_vrp_evpn_cfg_011401"></a><span class="figcap"><b>Figure 1 </b>Configuring interworking between VPLS and EVPN VPLS over SRv6 BE</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="figure/en-us_image_0307196820.png" width="NaN" height="NaN" title="Click to enlarge"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Device interfaces and their IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="11%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="45.839999999999996%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="43.16%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="11%" headers="mcps1.4.1.4.2.4.1.1 "><p>UPE</p>
</td>
<td class="cellrowborder" char="." valign="top" width="45.839999999999996%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="43.16%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" char="." valign="top" width="11%" headers="mcps1.4.1.4.2.4.1.1 "><p>SPE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="45.839999999999996%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="43.16%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:10::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:20::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:2::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" char="." valign="top" width="11%" headers="mcps1.4.1.4.2.4.1.1 "><p>SPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="45.839999999999996%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="43.16%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:10::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:30::1/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:3::3/64</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" char="." valign="top" width="11%" headers="mcps1.4.1.4.2.4.1.1 "><p>NPE</p>
</td>
<td class="cellrowborder" char="." valign="top" width="45.839999999999996%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="43.16%" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:20::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:30::2/64</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2001:DB8:4::4/64</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0307196816__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on each device. Configure OSPF between the UPE and SPEs (VPLS network) to implement IPv4 route interworking; configure IS-ISv6 on the SPEs and NPE (EVPN network) to implement IPv6 route interworking.</p>
</li><li><p>Configure basic MPLS LDP functions on the UPE and SPEs.</p>
</li><li><p>Configure BD EVPN on the SPEs and NPE.</p>
</li><li>Configure SRv6 BE between the SPEs and NPE.</li><li><p>Configure PWs between the UPE and SPEs.</p>
</li><li>Configure BFD for PW on the UPE and SPEs.</li><li>Configure an interface monitoring group on SPE1 so that SPE1 can detect network-side interface status changes immediately if the changes occur.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0307196816__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interfaces and IP addresses of devices</p>
</li><li><p>MPLS LSR IDs of devices</p>
</li><li><p>Names, RDs, and VPN targets of the EVPN instances created on the SPEs and NPE</p>
</li><li>Locator names, Arguments field lengths, and dynamically generated opcodes on the SPEs and NPE</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0307196816__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses according to <a href="#EN-US_TASK_0307196816__fig_dc_vrp_evpn_cfg_011401">Figure 1</a>. </span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0307196816__file_01">Configuration Files</a>.</p>
</p></li><li><span>Configure an IGP on each device.</span><p><p>Configure OSPF between the UPE and SPEs (VPLS network) to implement IPv4 route interworking; configure IS-ISv6 on the SPEs and NPE (EVPN network) to implement IPv6 route interworking. For detailed configurations, see <a href="#EN-US_TASK_0307196816__file_01">Configuration Files</a>.</p>
</p></li><li><span>Configure basic MPLS LDP functions on the UPE and SPEs.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0307196816__file_01">Configuration Files</a>.</p>
</p></li><li><span>Configure BD EVPN on the SPEs and NPE.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-evpn-instance-evrf1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>evpn source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>router-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>peer 2001:DB8:3::3 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>peer 2001:DB8:4::4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>peer 2001:DB8:4::4 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-evpn] <strong>peer 2001:DB8:3::3</strong> <strong>advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-evpn] <strong>peer 2001:DB8:4::4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-evpn] <strong>peer 2001:DB8:4::4</strong> <strong>advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p>The configuration of SPE2 is similar to that of SPE1. For detailed configurations, see <a href="#EN-US_TASK_0307196816__file_01">Configuration Files</a>.</p>
<p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>evpn vpn-instance evrf1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-evpn-instance-evrf1] <strong>route-distinguisher 100:3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-evpn-instance-evrf1] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-evpn-instance-evrf1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>evpn source-address 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>router-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>peer 2001:DB8:2::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>peer 2001:DB8:2::2 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>peer 2001:DB8:3::3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>peer 2001:DB8:3::3 connect-interface LoopBack 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-evpn] <strong>peer 2001:DB8:2::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-evpn] <strong>peer 2001:DB8:2::2</strong> <strong>advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-evpn] <strong>peer 2001:DB8:3::3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-evpn] <strong>peer 2001:DB8:3::3</strong> <strong>advertise encap-type srv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bd10] <strong>evpn binding vpn-instance evrf1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>interface GigabitEthernet <span>0/1/3</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>.1] <strong>encapsulation dot1q vid 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</p></li><li><span>Configure SRv6 BE between the SPEs and NPE.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>SPE1-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:2::2</strong>
[<span class="keyword">*</span>SPE1-segment-routing-ipv6] <strong>locator SPE1 ipv6-prefix 2001:DB8:11:: 64</strong>
[<span class="keyword">*</span>SPE1-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>SPE1-segment-routing-ipv6] <strong>locator SPE1_ARG ipv6-prefix 2001:DB8:12:: 64 args 10</strong>
[<span class="keyword">*</span>SPE1-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>SPE1-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>SPE1] <strong>isis 1</strong>
[<span class="keyword">*</span>SPE1-isis-1] <strong>segment-routing ipv6 locator SPE1</strong>
[<span class="keyword">*</span>SPE1-isis-1] <strong>segment-routing ipv6 locator SPE1_ARG auto-sid-disable</strong>
[<span class="keyword">*</span>SPE1-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>SPE1] <strong>evpn vpn-instance evrf1 bd-mode</strong>
[<span class="keyword">*</span>SPE1-evpn-instance-evrf1] <strong>segment-routing ipv6 locator SPE1_ARG unicast-locator SPE1</strong>
[<span class="keyword">*</span>SPE1-evpn-instance-evrf1] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>SPE1-evpn-instance-evrf1] <strong>quit</strong>
[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>SPE2-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:3::3</strong>
[<span class="keyword">*</span>SPE2-segment-routing-ipv6] <strong>locator SPE2 ipv6-prefix 2001:DB8:21:: 64</strong>
[<span class="keyword">*</span>SPE2-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>SPE2-segment-routing-ipv6] <strong>locator SPE2_ARG ipv6-prefix 2001:DB8:22:: 64 args 10</strong>
[<span class="keyword">*</span>SPE2-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>SPE2-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>SPE2] <strong>isis 1</strong>
[<span class="keyword">*</span>SPE2-isis-1] <strong>segment-routing ipv6 locator SPE2</strong>
[<span class="keyword">*</span>SPE2-isis-1] <strong>segment-routing ipv6 locator SPE2_ARG auto-sid-disable</strong>
[<span class="keyword">*</span>SPE2-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>SPE2] <strong>evpn vpn-instance evrf1 bd-mode</strong>
[<span class="keyword">*</span>SPE2-evpn-instance-evrf1] <strong>segment-routing ipv6 locator SPE2_ARG unicast-locator SPE2</strong>
[<span class="keyword">*</span>SPE2-evpn-instance-evrf1] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>SPE2-evpn-instance-evrf1] <strong>quit</strong>
[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
<p># Configure the NPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE] <strong>segment-routing ipv6</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>encapsulation source-address 2001:DB8:4::4</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>locator NPE ipv6-prefix 2001:DB8:31:: 64</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>locator NPE_ARG ipv6-prefix 2001:DB8:32:: 64 args 10</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6-locator] <strong>quit</strong>
[<span class="keyword">*</span>NPE-segment-routing-ipv6] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>isis 1</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>segment-routing ipv6 locator NPE</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>segment-routing ipv6 locator NPE_ARG auto-sid-disable</strong>
[<span class="keyword">*</span>NPE-isis-1] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>evpn vpn-instance evrf1 bd-mode</strong>
[<span class="keyword">*</span>NPE-evpn-instance-evrf1] <strong>segment-routing ipv6 locator NPE_ARG unicast-locator NPE</strong>
[<span class="keyword">*</span>NPE-evpn-instance-evrf1] <strong>segment-routing ipv6 best-effort</strong>
[<span class="keyword">*</span>NPE-evpn-instance-evrf1] <strong>quit</strong>
[<span class="keyword">*</span>NPE] <strong>commit</strong></pre>
</p></li><li><span>Configure PWs between the UPE and SPEs.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls l2vpn</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>UPE-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>vsi vsi1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>protect-group vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>protect-mode pw-redundancy master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 2.2.2.2 preference 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 3.3.3.3 preference 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bd10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface GigabitEthernet <span>0/1/3</span>.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/3</span>.1] <strong>encapsulation dot1q vid 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/3</span>.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/3</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-evpn] <strong>esi 0000.1111.1111.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-evpn-esi-0000.1111.1111.1111.1111] <strong>evpn redundancy-mode single-active</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-evpn-esi-0000.1111.1111.1111.1111] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>vsi vsi1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 1.1.1.1 pw pw1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp-pw-pw1] <strong>esi 0000.1111.1111.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp-pw-pw1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bd10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-evpn] <strong>esi 0000.1111.1111.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-evpn-esi-0000.1111.1111.1111.1111] <strong>evpn redundancy-mode single-active</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-evpn-esi-0000.1111.1111.1111.1111] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>vsi vsi1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1-ldp] <strong>peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1-ldp] <strong>peer 1.1.1.1 pw pw1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1-ldp-pw-pw1] <strong>esi 0000.1111.1111.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1-ldp-pw-pw1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bd10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure BFD for PW on the UPE and SPEs.</span><p><p># Configure the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bfd</strong> 
[<span class="keyword">*</span>UPE-bfd] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>bfd 1 bind pw vsi vsi1 peer 2.2.2.2</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-1] <strong>discriminator local 1</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-1] <strong>discriminator remote 1</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-1] <strong>min-tx-interval 10</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-1] <strong>min-rx-interval 10</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-1] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>bfd 2 bind pw vsi vsi1 peer 3.3.3.3</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-2] <strong>discriminator local 2</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-2] <strong>discriminator remote 2</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-2] <strong>min-tx-interval 10</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-2] <strong>min-rx-interval 10</strong>
[<span class="keyword">*</span>UPE-bfd-lsp-session-2] <strong>quit</strong>
[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>bfd</strong>
[<span class="keyword">*</span>SPE1-bfd] <strong>quit</strong>
[<span class="keyword">*</span>SPE1] <strong>bfd 1 bind pw vsi vsi1 peer 1.1.1.1</strong>
[<span class="keyword">*</span>SPE1-bfd-lsp-session-1] <strong>discriminator local 1</strong>
[<span class="keyword">*</span>SPE1-bfd-lsp-session-1] <strong>discriminator remote 1</strong>
[<span class="keyword">*</span>SPE1-bfd-lsp-session-1] <strong>min-tx-interval 10</strong>
[<span class="keyword">*</span>SPE1-bfd-lsp-session-1] <strong>min-rx-interval 10</strong>
[<span class="keyword">*</span>SPE1-bfd-lsp-session-1] <strong>quit</strong>
[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Configure SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE2] <strong>bfd</strong>
[<span class="keyword">*</span>SPE2-bfd] <strong>quit</strong>
[<span class="keyword">*</span>SPE2] <strong>bfd 2 bind pw vsi vsi1 peer 1.1.1.1</strong>
[<span class="keyword">*</span>SPE2-bfd-lsp-session-2] <strong>discriminator local 2</strong>
[<span class="keyword">*</span>SPE2-bfd-lsp-session-2] <strong>discriminator remote 2</strong>
[<span class="keyword">*</span>SPE2-bfd-lsp-session-2] <strong>min-tx-interval 10</strong>
[<span class="keyword">*</span>SPE2-bfd-lsp-session-2] <strong>min-rx-interval 10</strong>
[<span class="keyword">*</span>SPE2-bfd-lsp-session-2] <strong>quit</strong>
[<span class="keyword">*</span>SPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure an interface monitoring group on SPE1.</span><p><p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>monitor-group 1</strong>
[<span class="keyword">*</span>SPE1-monitor-group-1] <strong>monitor enable</strong>
[<span class="keyword">*</span>SPE1-monitor-group-1] <strong>binding interface GigabitEthernet <span>0/1/2</span> down-weight 10</strong>
[<span class="keyword">*</span>SPE1-monitor-group-1] <strong>binding interface GigabitEthernet <span>0/1/3</span> down-weight 10</strong>
[<span class="keyword">*</span>SPE1-monitor-group-1] <strong>quit</strong>
[<span class="keyword">*</span>SPE1] <strong>interface GigabitEthernet <span>0/1/1</span></strong>
[<span class="keyword">*</span>SPE1-GigabitEthernet <span>0/1/1</span>] <strong>track monitor-group 1</strong>
[<span class="keyword">*</span>SPE1-GigabitEthernet <span>0/1/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong><span>display vsi name vsi1 verbose</span></strong> command on SPE1. The command output shows that both the VSI and PW are in the up state.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>display vsi name vsi1 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : vsi1
    Work Mode              : bd-mode
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : ldp
    Member Discovery Style : --
    Bridge-domain Mode     : enable
    PW MAC Learn Style     : qualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    Multicast Fast Switch  : disable
    Create Time            : 0 days, 14 hours, 3 minutes, 23 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : --
                
    VSI ID                 : 1
   *Peer Router ID         : 1.1.1.1
    Negotiation-vc-id      : 1
    Encapsulation Type     : vlan
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 48123
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004c4b42 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    CKey                   : 1
    NKey                   : 16777393
    Stp Enable             : 0
    PwIndex                : 1
    Control Word           : disable
    BFD for PW             : available
 
    Access Bridge-domain   : Bridge-domain 10 
    Vac State              : down 
    Last Up Time           : 0000/00/00 00:00:00
    Total Up Time          : 0 days, 0 hours, 0 minutes, 0 seconds

  **PW Information:

   *Peer Ip Address        : 1.1.1.1
    PW State               : <strong>up</strong>
    Local VC Label         : 48123
    Remote VC Label        : 48122
    Remote Control Word    : disable
    PW Type                : MEHVPLS
    Local  VCCV            : alert lsp-ping bfd 
    Remote VCCV            : alert lsp-ping bfd 
    Tunnel ID              : 0x0000000001004c4b42 
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 1
    Nkey                   : 16777393
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : --
    Backup OutInterface    : --
    Stp Enable             : 0
    Mac Flapping           : 0
    Monitor Group Name     : 1
    PW Last Up Time        : 2019/01/03 12:22:30
    PW Total Up Time       : 0 days, 13 hours, 50 minutes, 43 seconds</pre>
<p>Run the <strong>display bgp evpn all routing-table</strong> command on SPE1 to check EVPN routes. The command output shows the MAC routes on the VPLS-side interface and the ES routes and per-ES Ethernet A-D routes corresponding to the ESI of the PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>display bgp evpn all routing-table</strong></pre>
<pre class="screen"> Local AS number : 100

 BGP Local router ID is 2.2.2.2
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 EVPN address family:
 Number of A-D Routes: 4
 Route Distinguisher: 100:1
       Network(ESI/EthTagId)                                  NextHop
 *&gt;    0000.1111.1111.1111.1111:0                             127.0.0.1
 Route Distinguisher: 100:2
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.1111.1111.1111:0                             2001:DB8:3::3
 Route Distinguisher: 2.2.2.2:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;    0000.1111.1111.1111.1111:4294967295                    127.0.0.1
 Route Distinguisher: 3.3.3.3:0
       Network(ESI/EthTagId)                                  NextHop
 *&gt;i   0000.1111.1111.1111.1111:4294967295                    2001:DB8:3::3
    

 EVPN-Instance evrf1:
 Number of A-D Routes: 3
       Network(ESI/EthTagId)                                  NextHop
 *&gt;    0000.1111.1111.1111.1111:0                             127.0.0.1
 * i                                                          2001:DB8:3::3
 *&gt;i   0000.1111.1111.1111.1111:4294967295                    2001:DB8:3::3
 
 EVPN address family:
 Number of Mac Routes: 1
 Route Distinguisher: 100:1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:00e0-fc12-3456:0:0.0.0.0                          0.0.0.0
    

 EVPN-Instance evrf1:
 Number of Mac Routes: 1
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:00e0-fc12-3456:0:0.0.0.0                          0.0.0.0
 
 EVPN address family:
 Number of Inclusive Multicast Routes: 3
 Route Distinguisher: 100:1
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:2.2.2.2                                           127.0.0.1
 Route Distinguisher: 100:2
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:3.3.3.3                                           2001:DB8:3::3
 Route Distinguisher: 100:3
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;i   0:32:4.4.4.4                                           2001:DB8:4::4
    

 EVPN-Instance evrf1:
 Number of Inclusive Multicast Routes: 3
       Network(EthTagId/IpAddrLen/OriginalIp)                 NextHop
 *&gt;    0:32:2.2.2.2                                           127.0.0.1
 *&gt;i   0:32:3.3.3.3                                           2001:DB8:3::3
 *&gt;i   0:32:4.4.4.4                                           2001:DB8:4::4
 
 EVPN address family:
 Number of ES Routes: 2
 Route Distinguisher: 2.2.2.2:0
       Network(ESI)                                           NextHop
 *&gt;    0000.1111.1111.1111.1111                               127.0.0.1
 Route Distinguisher: 3.3.3.3:0
       Network(ESI)                                           NextHop
 *&gt;i   0000.1111.1111.1111.1111                               2001:DB8:3::3
    

 EVPN-Instance evrf1:
 Number of ES Routes: 2
       Network(ESI)                                           NextHop
 *&gt;    0000.1111.1111.1111.1111                               127.0.0.1
 * i                                                          2001:DB8:3::3</pre>
<p>The route details include information about the associated PW. The following uses MAC routes as an example.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>display bgp evpn all routing-table mac-route 0:48:00e0-fc12-3456:0:0.0.0.0</strong></pre>
<pre class="screen"> BGP local router ID : 2.2.2.2
 Local AS number : 100
 Total routes of Route Distinguisher(100:1): 1
 BGP routing table entry information of 0:48:00e0-fc12-3456:0:0.0.0.0:
 Imported route.
 From: 0.0.0.0 (0.0.0.0) 
 Route Duration: 0d13h48m24s
 Original nexthop: 0.0.0.0
 Qos information : 0x0
 Ext-Community: RT &lt;1 : 1&gt;, SoO &lt;2.2.2.2 : 0&gt;
 AS-path Nil, origin incomplete, pref-val 0, valid, local, best, select, pre 255
 Route Type: 2 (MAC Advertisement Route)
 Ethernet Tag ID: 0, MAC Address/Len: 00e0-fc12-3456/48, IP Address/Len: 0.0.0.0/0, ESI:0000.1111.1111.1111.1111
 Advertised to such 2 peers:
    3.3.3.3
    4.4.4.4

    

 EVPN-Instance evrf1:
 Number of Mac Routes: 1
 BGP routing table entry information of 0:48:00e0-fc12-3456:0:0.0.0.0:
 Route Distinguisher: 100:1
 Imported route.
 From: 0.0.0.0 (0.0.0.0) 
 Route Duration: 0d13h48m26s
 Direct Out-interface: <strong>PW&lt;peerip:1.1.1.1 vcid:1 vctype:vlan&gt;</strong>
 Original nexthop: 0.0.0.0
 Qos information : 0x0
 AS-path Nil, origin incomplete, pref-val 0, valid, local, best, select, pre 255
 Route Type: 2 (MAC Advertisement Route)
 Ethernet Tag ID: 0, MAC Address/Len: 00e0-fc12-3456/48, IP Address/Len: 0.0.0.0/0, ESI:0000.1111.1111.1111.1111
 Not advertised to any peer yet</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0307196816__file_01"><a name="EN-US_TASK_0307196816__file_01"></a><a name="file_01"></a><a name="EN-US_TASK_0307196816__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><div class="p">UPE configuration file<pre class="screen">#
sysname UPE
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi vsi1 bd-mode
 pwsignal ldp
  vsi-id 1      
  peer 2.2.2.2 
  peer 3.3.3.3 
  protect-group vsi1 
   protect-mode pw-redundancy master
   peer 2.2.2.2 preference 1
   peer 3.3.3.3 preference 2
#
bridge-domain 10
 l2 binding vsi vsi1
#
mpls ldp
#
mpls ldp remote-peer 2.2.2.2
 remote-ip 2.2.2.2
#
mpls ldp remote-peer 3.3.3.3
 remote-ip 3.3.3.3
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/3</span>.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 10
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 100
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.2.0 0.0.0.255
  network 10.1.3.0 0.0.0.255
#
bfd 1 bind pw vsi vsi1 peer 2.2.2.2
 discriminator local 1
 discriminator remote 1
 min-tx-interval 10
 min-rx-interval 10
#
bfd 2 bind pw vsi vsi1 peer 3.3.3.3
 discriminator local 2
 discriminator remote 2
 min-tx-interval 10
 min-rx-interval 10
#
return</pre>
</div>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#
sysname SPE1
#
evpn
 #
 mac-duplication
 #
 esi 0000.1111.1111.1111.1111
  evpn redundancy-mode single-active
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:1
 segment-routing ipv6 best-effort
 segment-routing ipv6 locator SPE1_ARG unicast-locator SPE1 
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
bfd
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi vsi1 bd-mode
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe 
  peer 1.1.1.1 pw pw1
   esi 0000.1111.1111.1111.1111
#
bridge-domain 10
 l2 binding vsi vsi1
 evpn binding vpn-instance evrf1
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:2::2
 locator SPE1 ipv6-prefix 2001:DB8:11:: 64
 locator SPE1_ARG ipv6-prefix 2001:DB8:12:: 64 args 10
#
mpls ldp
#
mpls ldp remote-peer 1.1.1.1
 remote-ip 1.1.1.1
#
mpls ldp remote-peer 3.3.3.3
 remote-ip 3.3.3.3
#
monitor-group 1
 monitor enable
 binding interface GigabitEthernet<span>0/1/2</span> down-weight 10
 binding interface GigabitEthernet<span>0/1/3</span> down-weight 10
#
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0002.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator SPE1
 segment-routing ipv6 locator SPE1_ARG auto-sid-disable
 #
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.2.2 255.255.255.0
 track monitor-group 1
 mpls
 mpls ldp
#               
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.2.3.1 255.255.255.0
 ipv6 enable
 ipv6 address 2001:DB8:10::1/64
 isis ipv6 enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:20::1/64
 isis ipv6 enable 1
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 ipv6 enable
 ipv6 address 2001:DB8:2::2/64
 isis ipv6 enable 1  
#
bgp 100
 router-id 2.2.2.2
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack1
 peer 2001:DB8:4::4 as-number 100
 peer 2001:DB8:4::4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 advertise encap-type srv6
  peer 2001:DB8:4::4 enable
  peer 2001:DB8:4::4 advertise encap-type srv6
#
ospf 100
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.2.0 0.0.0.255
  network 10.2.3.0 0.0.0.255
#
bfd 1 bind pw vsi vsi1 peer 1.1.1.1
 discriminator local 1
 discriminator remote 1
 min-tx-interval 10
 min-rx-interval 10
#
evpn source-address 2.2.2.2
#
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#
sysname SPE2
#
evpn
 #
 mac-duplication
 #
 esi 0000.1111.1111.1111.1111
  evpn redundancy-mode single-active
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:2
 segment-routing ipv6 best-effort
 segment-routing ipv6 locator SPE2_ARG unicast-locator SPE2
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
bfd
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1 bd-mode
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe 
  peer 1.1.1.1 pw pw1
   esi 0000.1111.1111.1111.1111
#
bridge-domain 10
 l2 binding vsi vsi1
 evpn binding vpn-instance evrf1
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:3::3
 locator SPE2 ipv6-prefix 2001:DB8:21:: 64
 locator SPE2_ARG ipv6-prefix 2001:DB8:22:: 64 args 10
#
mpls ldp
#
mpls ldp remote-peer 1.1.1.1
 remote-ip 1.1.1.1
#
mpls ldp remote-peer 2.2.2.2
 remote-ip 2.2.2.2
#
isis 1          
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0003.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator SPE2
 segment-routing ipv6 locator SPE2_ARG auto-sid-disable
 #
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.3.2 255.255.255.0
 mpls
 mpls ldp       
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.2.3.2 255.255.255.0
 ipv6 enable
 ipv6 address 2001:DB8:10::2/64
 isis ipv6 enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:30::1/64
 isis ipv6 enable 1
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 ipv6 enable
 ipv6 address 2001:DB8:3::3/64
 isis ipv6 enable 1
#
bgp 100
 router-id 3.3.3.3
 peer 2001:DB8:2::2 as-number 100
 peer 2001:DB8:2::2 connect-interface LoopBack1
 peer 2001:DB8:4::4 as-number 100
 peer 2001:DB8:4::4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:2::2 enable
  peer 2001:DB8:2::2 advertise encap-type srv6
  peer 2001:DB8:4::4 enable
  peer 2001:DB8:4::4 advertise encap-type srv6
#
ospf 100
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.3.0 0.0.0.255
  network 10.2.3.0 0.0.0.255
#
bfd 2 bind pw vsi vsi1 peer 1.1.1.1
 discriminator local 2
 discriminator remote 2
 min-tx-interval 10
 min-rx-interval 10
#
evpn source-address 3.3.3.3
#
return</pre>
</li><li><p>NPE configuration file</p>
<pre class="screen">#
sysname NPE
#
evpn vpn-instance evrf1 bd-mode
 route-distinguisher 100:3
 segment-routing ipv6 best-effort
 segment-routing ipv6 locator NPE_ARG unicast-locator NPE
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
bridge-domain 10
 evpn binding vpn-instance evrf1
#
segment-routing ipv6
 encapsulation source-address 2001:DB8:4::4
 locator NPE ipv6-prefix 2001:DB8:31:: 64
 locator NPE_ARG ipv6-prefix 2001:DB8:32:: 64 args 10
#
isis 1
 is-level level-1
 cost-style wide
 network-entity 10.0000.0000.0004.00
 #
 ipv6 enable topology ipv6
 segment-routing ipv6 locator NPE
 segment-routing ipv6 locator NPE_ARG auto-sid-disable
 #
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:20::2/64
 isis ipv6 enable 1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:DB8:30::2/64
 isis ipv6 enable 1
#
interface GigabitEthernet<span>0/1/3</span>.1 mode l2
 encapsulation dot1q vid 100
 bridge-domain 10
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 ipv6 enable
 ipv6 address 2001:DB8:4::4/64
 isis ipv6 enable 1
#
bgp 100
 router-id 4.4.4.4
 peer 2001:DB8:2::2 as-number 100
 peer 2001:DB8:2::2 connect-interface LoopBack1
 peer 2001:DB8:3::3 as-number 100
 peer 2001:DB8:3::3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2001:DB8:2::2 enable
  peer 2001:DB8:2::2 advertise encap-type srv6
  peer 2001:DB8:3::3 enable
  peer 2001:DB8:3::3 advertise encap-type srv6
#
evpn source-address 4.4.4.4
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0078.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_vpls_evpn-over-srv6_exp2.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>