
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS IPv6 VPN Option B">
<meta name="abstract" content="An MP-EBGP peer relationship can be established between the ASBRs with only one hop to exchange VPNv6 routes.">
<meta name="description" content="An MP-EBGP peer relationship can be established between the ASBRs with only one hop to exchange VPNv6 routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2049.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2097.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369717">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-AS IPv6 VPN Option B</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369717"></a><a name="EN-US_TASK_0172369717"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS IPv6 VPN Option B</h1>
<div class="taskbody"><p>An MP-EBGP peer relationship can be established between the ASBRs with only one hop to exchange VPNv6 routes.</p>
<div class="context"><a name="EN-US_TASK_0172369717__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172369717__fig_dc_vrp_mpls-l3vpn-v6_cfg_205001">Figure 1</a>, CE1 and CE2 belong to the same VPN. CE1 is connected to PE1 in AS 100, and CE2 is connected to PE2 in AS 200. It is required that an MP-EBGP peer relationship be established between the ASBRs to transmit VPNv6 routes, thus implementing inter-AS VPN Option B.</p>
<div class="fignone" id="EN-US_TASK_0172369717__fig_dc_vrp_mpls-l3vpn-v6_cfg_205001"><a name="EN-US_TASK_0172369717__fig_dc_vrp_mpls-l3vpn-v6_cfg_205001"></a><a name="fig_dc_vrp_mpls-l3vpn-v6_cfg_205001"></a><span class="figcap"><b>Figure 1 </b>Networking diagram of inter-AS IPv6 VPN Option B</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v6_cfg_205001.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369717__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>When configuring inter-AS IPv6 VPN Option B, note the following:</p>
<ul><li><p>An MP-EBGP peer relationship is established between ASBR1 and ASBR2, and the ASBRs do not filter received VPNv6 routes based on VPN targets.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369717__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the MPLS backbone network to implement interworking of the ASBR and PE in the same AS, and set up an MPLS LDP LSP between the ASBR and PE in the same AS.</p>
</li><li><p>Set up EBGP peer relationships between the PEs and CEs and set up MP-IBGP peer relationships between the PEs and ASBRs.</p>
</li><li><p>Configure VPN instances on the PEs rather than ASBRs.</p>
</li><li><p><span>Enable MPLS on the interface that connects one ASBR to the other ASBR, set</span> up an MP-EBGP peer relationship between the ASBRs, and configure the ASBRs not to filter received VPNv6 routes based on VPN targets.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369717__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and ASBRs</p>
</li><li><p>Names, RDs, and VPN targets of the VPN instances of the PEs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369717__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>On the MPLS backbone networks in AS 100 and AS 200, configure an IGP to interconnect the PE and ASBR on each network.</span><p><p>In this example, OSPF is used as an IGP. For configuration details, see <a href="#EN-US_TASK_0172369717__example535610981214051">Configuration Files</a> in this section.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The 32-bit IP address of the loopback interface that functions as the LSR ID needs to be advertised by using OSPF.</p>
</div></div>
<p>After the configuration, the OSPF neighbor relationship can be established between the ASBR and PE in the same AS. Run the <strong>display ospf peer</strong> command. The command output shows that the neighbor relationship is in the <strong>Full</strong> state.</p>
<p>The ASBR and PE in the same AS can learn and successfully ping the IP address of the loopback interface of each other.</p>
</p></li><li><span>Configure MPLS and MPLS LDP, and set up MPLS LDP LSPs on the MPLS backbone networks in AS 100 and AS 200.</span><p><p>For configuration details, see <a href="dc_vrp_mpls-l3vpn-v6_cfg_2049.html">Example for Configuring Inter-AS IPv6 VPN Option A</a>.</p>
</p></li><li><span>Configure the basic BGP/MPLS IPv6 VPN functions on PE1 and PE2.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The VPN targets of the VPN instances of PE1 and PE2 must be the same.</p>
</div></div>
<p>For configuration details, see <a href="#EN-US_TASK_0172369717__example535610981214051">Configuration Files</a> in this section.</p>
</p></li><li><span>Configure inter-AS VPN Option B.</span><p><p># Configure ASBR1.<span> Enable MPLS on GE <span>0/2/0</span> connected to ASBR2.</span></p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1]<strong> interface gigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Configure ASBR1. Establish MP-EBGP peer with ASBR2 and perform no VPN-Target filtering on the received VPNv6 routes<span>, and then enable ASBR1 to allocate labels based on the next hop.</span></p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> peer 192.168.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6]<strong> peer 192.168.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6]<strong> undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of ASBR2 are similar to those of ASBR1. For configuration details, see <a href="#EN-US_TASK_0172369717__example535610981214051">Configuration Files</a> in this section.</p>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration, CEs can learn routes to the interface of each other, and CE1 and CE2 can ping each other successfully.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>display ipv6 routing-table</strong></pre>
<pre class="screen">Routing Table : _public_
         Destinations : 7        Routes : 7         

Destination  : ::1                                     PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : ::FFFF:127.0.0.0                        PrefixLength : 104
NextHop      : ::FFFF:127.0.0.1                        Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : ::FFFF:127.0.0.1                        PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : InLoopBack0                             Flags        : D

Destination  : 2001:db8:1::                            PrefixLength : 64
NextHop      : 2001:db8:1::1                           Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : D

Destination  : 2001:db8:1::1                           PrefixLength : 128
NextHop      : ::1                                     Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : D

Destination  : <strong>2001:db8:2::</strong>                           PrefixLength : 64
NextHop      : 2001:db8:1::2                           Preference   : 255
Cost         : 0                                       Protocol     : EBGP
RelayNextHop : 2001:db8:1::2                           TunnelID     : 0x0
Interface    : GigabitEthernet<span>0/1/0</span>                    Flags        : RD

Destination  : FE80::                                  PrefixLength : 10
NextHop      : ::                                      Preference   : 0
Cost         : 0                                       Protocol     : Direct
RelayNextHop : ::                                      TunnelID     : 0x0
Interface    : NULL0                                   Flags        : D</pre>
<pre class="screen">&lt;CE1&gt; <strong>ping ipv6 2001:db8:2::1</strong></pre>
<pre class="screen">  PING 2001:db8:2::1 : 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 2001:db8:2::1</pre>
<pre class="screen">    bytes=56 Sequence=1 hop limit=62  time = 125 ms</pre>
<pre class="screen">    Reply from 2001:db8:2::1</pre>
<pre class="screen">    bytes=56 Sequence=2 hop limit=62  time = 109 ms</pre>
<pre class="screen">    Reply from 2001:db8:2::1</pre>
<pre class="screen">    bytes=56 Sequence=3 hop limit=62  time = 109 ms</pre>
<pre class="screen">    Reply from 2001:db8:2::1</pre>
<pre class="screen">    bytes=56 Sequence=4 hop limit=62  time = 109 ms</pre>
<pre class="screen">    Reply from 2001:db8:2::1</pre>
<pre class="screen">    bytes=56 Sequence=5 hop limit=62  time = 110 ms

</pre>
<pre class="screen">  --- 2001:db8:2::1 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 109/112/125 ms</pre>
<p>Run the <strong>display bgp vpnv6 all routing-table</strong> command on an ASBR. The command output shows the VPNv6 routes on the ASBR.</p>
<p>The following example uses the command output on ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>display bgp vpnv6 all routing-table</strong></pre>
<pre class="screen"> 
 BGP Local router ID is 192.168.1.1
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete

 
 Total number of routes from all PE: 2
 Route Distinguisher: 100:1

 *&gt;i Network  : <strong>2001:db8:1::</strong>                             PrefixLen : 64  
     NextHop  : ::FFFF:1.1.1.1                           LocPrf    : 100 
     MED      : 0                                        PrefVal   : 0
     Label    : 21/23
     Path/Ogn : 65001?
 Route Distinguisher: 200:2

 *&gt;  Network  : <strong>2001:db8:2::</strong>                            PrefixLen : 64  
     NextHop  : ::FFFF:192.168.1.2                         LocPrf    :   
     MED      :                                          PrefVal   : 0
     Label    : 25/25
     Path/Ogn : 200 65002?</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172369717__example535610981214051"><a name="EN-US_TASK_0172369717__example535610981214051"></a><a name="example535610981214051"></a><a name="EN-US_TASK_0172369717__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:1::1/64
#
bgp 65001
 router-id 10.10.10.10
 peer 2001:db8:1::2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:db8:1::2 enable
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:1::2/64
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 2.2.2.2 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:db8:1::1 as-number 65001
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 192.168.1.2 as-number 200
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.1.2 enable
  peer 1.1.1.1 enable
 #
 ipv6-family vpnv6
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 192.168.1.2 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 200
 peer 192.168.1.1 as-number 100
 peer 4.4.4.4 as-number 200
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.1.1 enable
  peer 4.4.4.4 enable
 #
 ipv6-family vpnv6
  undo policy vpn-target
  peer 4.4.4.4 enable
  peer 192.168.1.1 enable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:2::2/64
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 200
 peer 3.3.3.3 as-number 200
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 3.3.3.3 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:db8:2::1 as-number 65002
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:2::1/64
#
bgp 65002
 router-id 11.11.11.11
 peer 2001:db8:2::2 as-number 200
 #
  ipv4-family unicast
  undo synchronization
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:db8:2::2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">Configuration Examples for BGP/MPLS IPv6 VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2049.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2097.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>