
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Exampling for Configuring a Hard-Pipe Static MS-PW">
<meta name="abstract" content="This section provides an example for configuring a hard-pipe static MS-PW to carry a private line service.">
<meta name="description" content="This section provides an example for configuring a hard-pipe static MS-PW to carry a private line service.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ip-hard-pipe_0007.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ip-hard-pipe_0008.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ip-hard-pipe_0013.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="iphardpipe,w00800033,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="IP Hard Pipe">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="IP Hard Pipe">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="IP Hard Pipe">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="IP Hard Pipe">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370043">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Exampling for Configuring a Hard-Pipe Static MS-PW</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370043"></a><a name="EN-US_TASK_0172370043"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Exampling for Configuring a Hard-Pipe Static MS-PW</h1>
<div class="taskbody"><p>This section provides an example for configuring a hard-pipe static MS-PW to carry a private line service.</p>
<div class="context"><a name="EN-US_TASK_0172370043__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>IP hard pipe is a pipe technology that establishes a static PW over a static bidirectional co-routed LSP to simulate an SDH private line.</p>
<p><a href="#EN-US_TASK_0172370043__fig_dc_vrp_cfg_ip-hard-pipe_000901">Figure 1</a> shows an IP hard pipe scenario. CE1 connects to UPE1 and CE2 connects to UPE2. UPE1 and UPE2 need to be connected over a static MS-PW on the MPLS backbone network. A static bidirectional co-routed LSP needs to be configured between UPE1 and UPE2 (with the SPE as the switching node) to carry the static MS-PW.</p>
<div class="fignone" id="EN-US_TASK_0172370043__fig_dc_vrp_cfg_ip-hard-pipe_000901"><a name="EN-US_TASK_0172370043__fig_dc_vrp_cfg_ip-hard-pipe_000901"></a><a name="fig_dc_vrp_cfg_ip-hard-pipe_000901"></a><span class="figcap"><b>Figure 1 </b>Hard-pipe static MS-PW networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_cfg_ip-hard-pipe_000901.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370043__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the backbone network for devices to communicate.</p>
</li><li><p>Enable basic MPLS functions on the MPLS backbone network and establish a static bidirectional co-routed LSP.</p>
</li><li><p>Set up an MPLS L2VC between UPEs.</p>
</li><li><p>Set up a switched PW on the switching node SPE.</p>
</li><li><p>Configure IP hard pipe bandwidth reservation on main interfaces.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370043__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>L2VC IDs of UPE1 and UPE2 (the two IDs must be different)</p>
</li><li><p>MPLS LSR IDs of UPE1, UPE2, and the SPE</p>
</li><li><p>Remote peer IP addresses</p>
</li><li><p>Encapsulation type of the switched PW</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370043__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign IP addresses to CE interfaces that connect to PEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.10.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.10.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> commit</strong></pre>
</p></li><li><span>Configure an IGP on the MPLS backbone network.</span><p><p>Configure an IGP (OSPF in this example) on the MPLS backbone.</p>
<p>Assign IP addresses to the interfaces on UPEs, Ps, and the SPE. Ensure that the 32-bit loopback addresses of UPE1, UPE2, and the SPE are advertised after OSPF is enabled.</p>
<p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-LoopBack1] <strong>ip address 1.1.1.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>ip address 2.2.2.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0]<strong> network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-LoopBack1] <strong>ip address 3.3.3.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.2.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.3.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-ospf-1-area-0.0.0.0]<strong> network 3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>ip address 4.4.4.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.3.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.4.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0] <strong>network 10.4.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0]<strong> network 4.4.4.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-LoopBack1] <strong>ip address 5.5.5.9 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.4.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0] <strong>network 10.4.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> network 5.5.5.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1-area-0.0.0.0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> commit</strong></pre>
</p></li><li><span>Configure basic MPLS functions on the MPLS backbone network.</span><p><p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/1/0</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE]<strong> mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2] <strong>mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>interface gigabitethernet <span>0/2/0</span> </strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>mpls lsr-id 5.5.5.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure MPLS TE tunnel interfaces.</span><p><p># On UPE1, configure an MPLS TE tunnel from UPE1 to the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1]<strong> interface Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>destination 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># On the SPE, configure an MPLS TE tunnel from the SPE to UPE1 and UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE]<strong> interface Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>destination 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>mpls te bidirectional</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE]<strong> interface Tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>destination 5.5.5.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
<p># On UPE2, configure an MPLS TE tunnel from UPE2 to the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2]<strong> interface Tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>ip address unnumbered interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>destination 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>mpls te tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>mpls te signal-protocol cr-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure the ingress, transit node, and egress for a static bidirectional co-routed LSP.</span><p><p># Configure UPE1 as the ingress for Tunnel 10 from UPE1 to the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>bidirectional static-cr-lsp ingress Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-bi-static-ingress-Tunnel10] <strong>forward outgoing-interface gigabitethernet<span>0/2/0</span> nexthop 10.1.1.2 out-label 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-bi-static-ingress-Tunnel10] <strong>backward in-label 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-bi-static-ingress-Tunnel10] <strong>hard-pipe enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-bi-static-ingress-Tunnel10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure P1 as the transit node for Tunnel 10.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P1]<strong>bidirectional static-cr-lsp transit lsp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bi-static-transit-lsp1] <strong>forward in-label 20 outgoing-interface gigabitethernet <span>0/2/0</span> nexthop 10.2.1.2 out-label 40</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bi-static-transit-lsp1] <strong>backward in-label 16 outgoing-interface gigabitethernet <span>0/1/0</span> nexthop 10.1.1.1 out-label 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bi-static-transit-lsp1] <strong>hard-pipe enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-bi-static-transit-lsp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure the SPE as the egress for Tunnel 10 from UPE1 to the SPE and ingress for Tunnel 20 from the SPE to UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>bidirectional static-cr-lsp egress lsp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-bi-static-egress-lsp1] <strong>forward in-label 40 lsrid 1.1.1.9 tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-bi-static-egress-lsp1] <strong>backward outgoing-interface gigabitethernet <span>0/1/0</span> nexthop 10.2.1.1 out-label 16</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-bi-static-egress-lsp1] <strong>hard-pipe enable</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-bi-static-egress-lsp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>bidirectional static-cr-lsp ingress lsp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-bi-static-egress-lsp2] <strong>forward outgoing-interface gigabitethernet <span>0/2/0</span> nexthop 10.3.1.2 out-label 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-bi-static-egress-lsp2] <strong>backward in-label 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-bi-static-egress-lsp2] <strong>hard-pipe enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-bi-static-egress-lsp2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
<p># Configure P2 as the transit node for Tunnel 20.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P2]<strong>bidirectional static-cr-lsp transit lsp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bi-static-transit-lsp2] <strong>forward in-label 60 outgoing-interface gigabitethernet <span>0/2/0</span> nexthop 10.4.1.2 out-label 80</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bi-static-transit-lsp2] <strong>backward in-label 50 outgoing-interface gigabitethernet <span>0/1/0</span> nexthop 10.3.1.1 out-label 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bi-static-transit-lsp2] <strong>hard-pipe enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-bi-static-transit-lsp2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
<p># Configure UPE2 as the egress for Tunnel 20.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>bidirectional static-cr-lsp egress lsp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-bi-static-egress-lsp2] <strong>forward in-label 60 lsrid 3.3.3.9 tunnel-id 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-bi-static-egress-lsp2] <strong>backward outgoing-interface gigabitethernet <span>0/1/0</span> nexthop 10.4.1.1 out-label 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-bi-static-egress-lsp2] <strong>hard-pipe enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-bi-static-egress-lsp2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure a reverse tunnel attribute on the tunnel interface of UPE2 and the SPE and bind each tunnel interface to the static bidirectional co-routed LSP.</span><p><p># Configure the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>interface Tunnel20</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE-Tunnel20] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>mpls te binding bidirectional static-cr-lsp egress lsp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>interface Tunnel20</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2-Tunnel20] <strong>mpls te passive-tunnel</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>mpls te binding bidirectional static-cr-lsp egress lsp2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-Tunnel20] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
</p></li><li><span>Create VCs.</span><p><p>Enable MPLS L2VPN on UPE1, UPE2, and the SPE, configure a static PW on each UPE, and configure static PW switching on the SPE.</p>
<p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.9 te Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls static-l2vc destination 3.3.3.9 transmit-vpn-label 18 receive-vpn-label 18 tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls l2vpn hard-pipe bandwidth 50 expand-ratio 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> commit</strong></pre>
<p># Configure the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-tunnel-policy-policy1] <strong>tunnel binding destination 1.1.1.9 te Tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-tunnel-policy-policy1] <strong>tunnel binding destination 5.5.5.9 te Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-tunnel-policy-policy1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE]<strong> mpls switch-l2vc 1.1.1.9 100 trans 18 recv 18 tunnel-policy policy1 between 5.5.5.9 200 trans 19 recv 19 tunnel-policy policy1 encapsulation ethernet</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE]<strong> mpls switch-l2vc 1.1.1.9 100 encapsulation ethernet hard-pipe bandwidth 60 expand-ratio 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE]<strong> mpls switch-l2vc 5.5.5.9 200 encapsulation ethernet hard-pipe bandwidth 60 expand-ratio 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE]<strong> commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-tunnel-policy-policy1] <strong>tunnel binding destination 3.3.3.9 te Tunnel 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls static-l2vc destination 3.3.3.9 transmit-vpn-label 19 receive-vpn-label 19 tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls l2vpn hard-pipe bandwidth 50 expand-ratio 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
</p></li><li><span>Configure IP hard pipe bandwidth reservation on main interfaces.</span><p><p># Configure UPE1.</p>
<pre class="screen">[<span class="keyword">*</span>UPE1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1-GigabitEthernet<span>0/2/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE1] <strong>commit</strong></pre>
<p># Configure P1.</p>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P1] <strong>commit</strong></pre>
<p># Configure the SPE.</p>
<pre class="screen">[<span class="keyword">*</span>SPE]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE] <strong>commit</strong></pre>
<p># Configure P2.</p>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P2] <strong>commit</strong></pre>
<p># Configure UPE2.</p>
<pre class="screen">[<span class="keyword">*</span>UPE2]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>qos hard-pipe share-mode bandwidth 500 outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><ol type="a"><li><p>Check static MS-PW information on the SPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE] <strong>display mpls switch-l2vc hard-pipe</strong></pre>
<pre class="screen"> Total Switch VC : 1, 1 up, 0 down

*Switch-l2vc type             : SVC&lt;----&gt;SVC
 Peer IP Address              : 1.1.1.9, 5.5.5.9
 VC ID                        : 100, 200
 VC Type                      : Ethernet
 VC State                     : up
 In/Out Label                 : 18/18, 19/19
 InLabel Status               : 0 , 0
 Control Word                 : Disable, Disable
 VCCV Capability              : alert ttl lsp-ping bfd , alert ttl lsp-ping bfd 
 Hard-pipe bandwidth          : 60 Kbps, 60 Kbps
 Hard-pipe expand-ratio       : 20 %, 20 %

 Switch-l2vc tunnel info      :
                                1 tunnels for peer 1.1.1.9
                                NO.0  TNL Type : te    , TNL ID : 0x000000000300000003
                                1 tunnels for peer 5.5.5.9
                                NO.0  TNL Type : te    , TNL ID : 0x000000000300000005
 CKey                         : 1, 2
 NKey                         : 1040187529, 1040187530
 Tunnel policy                : policy1, policy1
 Create time                  : 0 days, 0 hours, 9 minutes, 30 seconds
 UP time                      : 0 days, 0 hours, 9 minutes, 30 seconds
 Last change time             : 0 days, 0 hours, 9 minutes, 30 seconds
 VC last up time              : 2015/07/25 15:36:26
 VC total up time             : 0 days, 0 hours, 9 minutes, 30 seconds</pre>
</li><li><p>Check whether CEs can communicate and the path between them.</p>
<p>CE1 and CE2 can ping each other.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 10.10.1.2</strong></pre>
<pre class="screen">  PING 10.10.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=1 ttl=255 time=180 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=2 ttl=255 time=120 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=3 ttl=255 time=160 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=4 ttl=255 time=160 ms</pre>
<pre class="screen">    Reply from 10.10.1.2: bytes=56 Sequence=5 ttl=255 time=130 ms</pre>
<pre class="screen">  --- 10.10.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 120/150/180 ms</pre>
<p>The following example shows information about the path between CE1 and CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>tracert 10.10.1.2</strong></pre>
<pre class="screen">traceroute to 10.10.1.2 (10.10.1.2), 30 hops max,press CTRL_C to break</pre>
<pre class="screen">traceroute to 10.10.1.2 (10.10.1.2), max hops: 30, packet length: 40, press CTRL_C to break</pre>
<pre class="screen"> 1 10.10.1.2 250 ms  220 ms  130 ms  </pre>
</li></ol>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370043__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen"># 
 sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.0
#
return</pre>
</li><li><p>UPE1 configuration file</p>
<pre class="screen">#
 sysname UPE1
#
mpls lsr-id 1.1.1.9
mpls
 mpls te
#
mpls l2vpn
#
 bidirectional static-cr-lsp ingress Tunnel 10
 forward outgoing-interface GigabitEthernet<span>0/2/0</span> nexthop 10.1.1.2 out-label 20
 backward in-label 20
 hard-pipe enable
#
tunnel-policy policy1
 tunnel binding destination 3.3.3.9 te Tunnel 10
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 mpls static-l2vc destination 3.3.3.9 transmit-vpn-label 18 receive-vpn-label 18 tunnel-policy policy1
 mpls l2vpn hard-pipe bandwidth 50 expand-ratio 20
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 destination 3.3.3.9
 tunnel-protocol mpls te
 mpls te signal-protocol cr-static
 mpls te reserved-for-binding
 mpls te tunnel-id 100
 mpls te bidirectional
#
ospf 1
 area 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 1.1.1.9 0.0.0.0
#
return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
 sysname P1
#
mpls lsr-id 2.2.2.9
mpls
 mpls te
#
 bidirectional static-cr-lsp transit lsp1
 forward in-label 20 outgoing-interface GigabitEthernet<span>0/2/0</span> nexthop 10.2.1.2 out-label 40
 backward in-label 16 outgoing-interface GigabitEthernet<span>0/1/0</span> nexthop 10.1.1.1 out-label 20
 hard-pipe enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
#
return</pre>
</li><li><p>SPE configuration file</p>
<pre class="screen">#
 sysname SPE
#
mpls lsr-id 3.3.3.9
mpls
#
mpls l2vpn
#
bidirectional static-cr-lsp egress lsp1
 forward in-label 40 lsrid 1.1.1.9 tunnel-id 100
 backward outgoing-interface GigabitEthernet<span>0/1/0</span> nexthop 10.2.1.1 out-label 16 
 hard-pipe enable
#
bidirectional static-cr-lsp ingress lsp2
 forward outgoing-interface GigabitEthernet<span>0/2/0</span> nexthop 10.3.1.2 out-label 60 
 backward in-label 60
 hard-pipe enable
#
tunnel-policy policy1
 tunnel binding destination 1.1.1.9 te Tunnel 20
 tunnel binding destination 5.5.5.9 te Tunnel 10
#
 mpls switch-l2vc 1.1.1.9 100 trans 18 recv 18 tunnel-policy policy1 between 5.5.5.9 200 trans 19 recv 19 tunnel-policy policy1 encapsulation ethernet
 mpls switch-l2vc 1.1.1.9 100 encapsulation ethernet hard-pipe bandwidth 60 expand-ratio 20
 mpls switch-l2vc 5.5.5.9 200 encapsulation ethernet hard-pipe bandwidth 60 expand-ratio 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
 mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.9
 mpls te signal-protocol cr-static
 mpls te reserved-for-binding
 mpls te tunnel-id 100
 mpls te bidirectional
#
interface Tunnel20
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 5.5.5.9
 mpls te signal-protocol cr-static
 mpls te reserved-for-binding
 mpls te tunnel-id 200
 mpls te passive-tunnel
 mpls te binding bidirectional static-cr-lsp egress lsp1
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.2.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
 sysname P2
#
mpls lsr-id 4.4.4.9
mpls
 mpls te
#
 bidirectional static-cr-lsp transit lsp2
 forward in-label 60 outgoing-interface GigabitEthernet<span>0/2/0</span> nexthop 10.4.1.2 out-label 80
 backward in-label 50 outgoing-interface GigabitEthernet<span>0/1/0</span> nexthop 10.3.1.1 out-label 20
 hard-pipe enable
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
 mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.3.1.0 0.0.0.255
  network 10.4.1.0 0.0.0.255
#
return</pre>
</li><li><p>UPE2 configuration file</p>
<pre class="screen">#
 sysname UPE2
#
mpls lsr-id 5.5.5.9
mpls
 mpls te
#
mpls l2vpn
#
bidirectional static-cr-lsp egress lsp2
 forward in-label 60 lsrid 3.3.3.9 tunnel-id 200
 backward outgoing-interface GigabitEthernet<span>0/1/0</span> nexthop 10.4.1.1 out-label 50
 hard-pipe enable
#
tunnel-policy policy1
 tunnel binding destination 3.3.3.9 te Tunnel 20
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.0
 mpls
 mpls te
<span> qos hard-pipe share-mode bandwidth 500 outbound</span>
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 mpls static-l2vc destination 3.3.3.9 transmit-vpn-label 19 receive-vpn-label 19 tunnel-policy policy1
 mpls l2vpn hard-pipe bandwidth 50 expand-ratio 20

#
interface LoopBack1
 ip address 5.5.5.9 255.255.255.255
#
interface Tunnel20
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.9
 mpls te signal-protocol cr-static
 mpls te reserved-for-binding
 mpls te tunnel-id 200
 mpls te passive-tunnel
 mpls te binding bidirectional static-cr-lsp egress lsp2
#
ospf 1
 area 0.0.0.0
  network 5.5.5.9 0.0.0.0
  network 10.4.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ip-hard-pipe_0007.html">Configuration Examples for IP Hard Pipe
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ip-hard-pipe_0008.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_cfg_ip-hard-pipe_0013.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>