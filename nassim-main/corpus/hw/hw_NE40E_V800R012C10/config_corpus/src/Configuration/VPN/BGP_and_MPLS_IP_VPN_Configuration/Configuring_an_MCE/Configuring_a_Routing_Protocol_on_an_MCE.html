
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Routing Protocol on an MCE">
<meta name="abstract" content="To enable an MCE to communicate with PEs and VPNs, configure a routing protocol for each type of service on the MCE.">
<meta name="description" content="To enable an MCE to communicate with PEs and VPNs, configure a routing protocol for each type of service on the MCE.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0069.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0071.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00830487">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369397">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Routing Protocol on an MCE</title>
</head>
<body><a name="EN-US_TASK_0172369397"></a><a name="EN-US_TASK_0172369397"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Routing Protocol on an MCE</h1>
<div class="taskbody"><p>To enable an MCE to communicate with PEs and VPNs, configure a routing protocol for each type of service on the MCE.</p>
<div class="context"><a name="EN-US_TASK_0172369397__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">An MCE can communicate with PEs and VPNs using static routes or any of the following routing protocols: EBGP, IBGP, RIP, OSPF, and IS-IS. Choose one of the following configurations as needed:<ul><li><a href="#EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007001">Configure EBGP on the MCE.</a></li><li><a href="#EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007002">Configure IBGP on the MCE.</a></li><li><a href="#EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007003">Configure a static route on the MCE.</a></li><li><a href="#EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007004">Configure RIP on the MCE.</a></li><li><a href="#EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007005">Configure OSPF on the MCE.</a></li><li><a href="#EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007006">Configure IS-IS on the MCE.</a></li></ul>
</div>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172369397__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li id="EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007001"><span id="EN-US_TASK_0172369397__">Configure EBGP on the MCE.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP VPN instance IPv4 address family view.</span></li><li><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i> command to configure the PE as a VPN peer.</span></li><li><span>(Optional) Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ] command to configure the maximum number of hops allowed for an EBGP connection. This step is mandatory if the MCE is not directly connected to the PE.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li id="EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007002"><span id="EN-US_TASK_0172369397__">Configure IBGP on the MCE.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP VPN instance IPv4 address family view.</span></li><li><span>Run the <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i> command to configure the PE as a VPN peer.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li id="EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007003"><span id="EN-US_TASK_0172369397__">Configure a static route on the MCE.</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-source-name</span></i> <i><span class="varname">destination-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } <i><span class="varname">interface-type interface-number</span></i> [ <i><span class="varname">nexthop-address</span></i> ] [ <strong><span>preference</span></strong> <i><span class="varname">preference</span></i> | <strong><span>tag</span></strong> <i><span class="varname">tag</span></i> ] <sup>*</sup> command to configure a static route for a specified VPN instance IPv4 address family.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li id="EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007004"><span id="EN-US_TASK_0172369397__">Configure RIP on the MCE.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=rip"><b><span class="cmdname">rip</span></b></a> <i><span class="varname">process-id</span></i> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to create a RIP instance and enter the RIP view.</span><p><p>A RIP process can be bound to only one VPN instance. If a RIP process is not bound to any VPN instance before it is started, this process becomes a public network process and can no longer be bound to a VPN instance.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">network-address</span></i> command to enable RIP on the network segment where the interface bound to the VPN instance resides.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Deleting a VPN instance or disabling a VPN instance IPv4 address family will also delete all the RIP processes bound to this VPN instance or VPN instance IPv4 address family.</p>
</div></div>
</p></li><li id="EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007005"><span id="EN-US_TASK_0172369397__">Configure OSPF on the MCE.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ospf"><b><span class="cmdname">ospf</span></b></a> <i><span class="varname">process-id</span></i> [ <strong><span>router-id</span></strong> <i><span class="varname">router-id</span></i> ] <strong><span>vpn-instance</span></strong> <i><span class="varname">vpnname</span></i> command to create an OSPF instance on the MCE and enter the OSPF view.</span><p><p>An OSPF process can be bound to only one VPN instance.</p>
<p>Specify a router ID when creating an OSPF process and binding the OSPF process to a VPN instance. The OSPF process bound to the VPN instance cannot automatically use the public network router ID configured in the system view. If no router ID is specified, OSPF uses a specified rule to select an IP address from the IP addresses of the interfaces that are bound to the VPN instance as a router ID.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=domain-id"><b><span class="cmdname">domain-id</span></b></a> <i><span class="varname">domain-id</span></i> [ <strong><span>secondary</span></strong> ] command to configure a domain ID.</span><p><p>The domain ID can be an integer or in dotted decimal notation.</p>
<p>Two domain IDs can be configured for each OSPF process. Different processes can have the same domain ID. The same domain ID must be configured for all OSPF processes of the same VPN to ensure correct route advertisements.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=route-tag"><b><span class="cmdname">route-tag</span></b></a> <i><span class="varname">tag</span></i> command to configure a VPN route tag.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=vpn-instance-capability+simple"><b><span class="cmdname">vpn-instance-capability simple</span></b></a> command to disable routing loop detection.</span><p><p>If OSPF VPN multi-instance is deployed on the MCE, the PE sends the MCE a link-state advertisement (LSA) with the Down (DN) bit set to 1. Because VPN instances have been configured on the MCE, the MCE has routing loop detection enabled. If the MCE detects that the LSA contains the DN bit with the value 1, this LSA cannot be used to calculate routes. In this case, run the <a href="cmdqueryname=vpn-instance-capability+simple"><b><span class="cmdname">vpn-instance-capability simple</span></b></a> command to disable OSPF routing loop detection. After OSPF routing loop detection is disabled, the MCE calculates all OSPF routes without checking the DN bit and route tag.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=area"><b><span class="cmdname">area</span></b></a> <i><span class="varname">area-id</span></i> command to enter the OSPF area view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">address</span></i> <i><span class="varname">wildcard-mask</span></i> command to advertise the IP address of the interface connected to the PE.</span><p><p>OSPF can run properly on an interface only when both of the following conditions are met:</p>
<ul><li><p>The mask length of the IP address of the interface is longer than or equal to that specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li><li><p>The primary IP address of the interface is on the network segment specified in the <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> command.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Deleting a VPN instance or disabling a VPN instance IPv4 address family will also delete all the OSPF processes bound to this VPN instance or VPN instance IPv4 address family.</p>
</div></div>
</p></li><li id="EN-US_TASK_0172369397__step_dc_vrp_mpls-l3vpn-v4_cfg_007006"><span id="EN-US_TASK_0172369397__">Configure IS-IS on the MCE.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=isis"><b><span class="cmdname">isis</span></b></a> <i><span class="varname">process-id</span></i> <strong><span>vpn-instance</span></strong> <em>vpn-instance-name</em> command to create an IS-IS instance on the MCE and enter the IS-IS view.</span><p><p>An IS-IS process can be bound to only one VPN instance. If an IS-IS process is not bound to any VPN instance before it is started, this process becomes a public network process and can no longer be bound to a VPN instance.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=network-entity"><b><span class="cmdname">network-entity</span></b></a> <em>net-addr</em> command to configure a network entity title (NET).</span><p><p>A NET specifies the current IS-IS area address and the system ID of the <span class="keyword">Router</span>.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=is-level"><b><span class="cmdname">is-level</span></b></a> { <strong><span>level-1</span></strong> | <strong><span>level-1-2</span></strong> | <strong><span>level-2</span></strong> } command to configure an IS-IS level for the <span class="keyword">Router</span>.</span><p></p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command to enter the view of the interface bound to the VPN instance.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=isis+enable"><b><span class="cmdname">isis enable</span></b></a> [ <i><span class="varname">process-id</span></i> ] command to enable IS-IS on the interface.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Deleting a VPN instance or disabling a VPN instance IPv4 address family will also delete all the IS-IS processes bound to this VPN instance or VPN instance IPv4 address family.</p>
</div></div>
</p></li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0069.html">Configuring an MCE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0071.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>