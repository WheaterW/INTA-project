
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Interworking Between Traditional Common VPLS and EVPN VPLS over SRv6 (HVPLS Scenario)">
<meta name="abstract" content="To configure interworking between traditional common VPLS and EVPN VPLS over SRv6 in an HVPLS scenario, you need to first configure EVPN VPLS over SRv6 on one side of the HVPLS network and then reconstruct the HVPLS network on the other side as required.">
<meta name="description" content="To configure interworking between traditional common VPLS and EVPN VPLS over SRv6 in an HVPLS scenario, you need to first configure EVPN VPLS over SRv6 on one side of the HVPLS network and then reconstruct the HVPLS network on the other side as required.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0018.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0011.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001560651176">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Interworking Between Traditional Common VPLS and EVPN VPLS over SRv6 (HVPLS Scenario)</title>
</head>
<body><a name="EN-US_TASK_0000001560651176"></a><a name="EN-US_TASK_0000001560651176"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Interworking Between Traditional Common VPLS and EVPN VPLS over SRv6 (HVPLS Scenario)</h1>
<div class="taskbody"><p>To configure interworking between traditional common VPLS and EVPN VPLS over SRv6 in an HVPLS scenario, you need to first configure EVPN VPLS over SRv6 on one side of the HVPLS network and then reconstruct the HVPLS network on the other side as required.</p>
<div class="context"><a name="EN-US_TASK_0000001560651176__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>It is feasible to evolve traditional common VPLS to EVPN VPLS over SRv6 in an HVPLS scenario. However, because the entire network involves a large number of devices, the evolution needs to be performed step by step. During the evolution, interworking between traditional common VPLS and EVPN VPLS over SRv6 is needed temporarily.</p>
<div class="fignone"><span class="figcap"><b>Figure 1 </b>Interworking between traditional common VPLS and EVPN VPLS over SRv6 (HVPLS)</span><br><span><img class="vsd" src="figure/en-us_image_0000001560662414.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001560651176__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring traditional common VPLS and EVPN VPLS over SRv6 to coexist, complete the following tasks:</p>
<ul><li><div class="p"><a href="dc_vrp_vpls_cfg_5009.html">Configure LDP HVPLS</a> between UPEs, SPEs, and NPEs.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this task, a non-BD VSI must be created using the <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <i><span class="varname">vsi-name</span></i> [ <strong><span>static</span></strong> | <strong><span>auto</span></strong> ] command.</p>
</div></div>
</div>
</li><li><p>Configure SRv6 BE, IPv6 IS-IS, and BGP EVPN IPv6 peer relationships between SPEs and NPEs and create a BD EVPN instance on each of these devices.</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001560651176__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Create a BD on SPEs and NPEs and configure evolution from common VPLS to EVPN.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to create a BD and enter its view.</span></li><li><span>Run the <a href="cmdqueryname=vpls-to-evpn+migration+in-process"><b><span class="cmdname">vpls-to-evpn migration in-process</span></b></a> command to indicate that the BD is evolving from VPLS to EVPN.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>On NPEs, add all AC interfaces to the BD (sub-interfaces are used as AC interfaces in this case).</span><ol type="a"><li><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number.sub-number</span></i> command to enter the view of the AC interface that directly connects the PE to a CE.</span></li><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to add the AC interface to the BD.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) On NPEs, configure TC notification on the AC interface's main interface.</span><p><p>If the <a href="cmdqueryname=stp+enable"><b><span class="cmdname">stp enable</span></b></a> command is run on the AC interface's main interface to enable STP but the <a href="cmdqueryname=stp+vpls-subinterface+enable"><b><span class="cmdname">stp vpls-subinterface enable</span></b></a> command is not run before the evolution, during the evolution, the AC interface may be blocked when the broadcast domain switches from the VSI to the BD, and a traffic loop may occur when the broadcast domain switches from the BD to the VSI. You are advised to perform the following operations:</p>
</p><ol type="a"><li><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number</span></i> command to enter the view of the AC interface's main interface.</span></li><li><span>Run the <a href="cmdqueryname=stp+vpls-subinterface+enable"><b><span class="cmdname">stp vpls-subinterface enable</span></b></a> command to enable TC notification on the main interface.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) On SPEs and NPEs, configure the maximum volume of unknown unicast traffic allowed by the BD.</span><p><p>During the evolution, broadcast domain switching occurs, resulting in MAC address relearning. In this case, traffic is forwarded in unknown unicast mode within a short period of time. In response, you are advised to configure unknown unicast traffic suppression in the BD.</p>
</p><ol type="a"><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li><span>Run the <a href="cmdqueryname=unknown-unicast-suppression"><b><span class="cmdname">unknown-unicast-suppression</span></b></a> <strong><span>cir</span></strong> <i><span class="varname">cir-value</span></i> [ <strong><span>cbs</span></strong> <i><span class="varname">cbs-value</span></i> ] { <strong><span>uni-inbound</span></strong> | <strong><span>uni-outbound</span></strong> } command to configure the maximum unknown unicast traffic volume allowed by the BD.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>On SPEs and NPEs, bind the BD to both the VSI and EVPN instance.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li><span>Run the <a href="cmdqueryname=l2+binding"><b><span class="cmdname">l2 binding</span></b></a> <strong><span>vsi</span></strong> <i><span class="varname">vsi-name</span></i> command to bind the BD to the VSI.</span></li><li><span>Run the <a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname">evpn binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to bind the BD to the EVPN instance.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) After the evolution is complete, delete the configuration indicating that the BD is evolving from VPLS to EVPN as well as VSI-related configurations from NPEs.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=undo+vpls-to-evpn+migration+in-process"><b><span class="cmdname">undo vpls-to-evpn migration in-process</span></b></a> command to indicate that the BD has completed evolution from VPLS to EVPN.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=undo+l2+binding"><b><span class="cmdname">undo l2 binding</span></b></a> <strong><span>vsi</span></strong> <i><span class="varname">vsi-name</span></i> command to unbind the BD from the VSI.</span><p><p>Because the <a href="cmdqueryname=undo+vpls-to-evpn+migration+in-process"><b><span class="cmdname">undo vpls-to-evpn migration in-process</span></b></a> command has been run on the device, running this command unbinds all AC interfaces from the VSI.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>(Optional) After the evolution is complete, delete the configuration indicating that the BD is evolving from VPLS to EVPN from SPEs.</span><ol type="a"><li><span>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the BD view.</span></li><li><span>Run the <a href="cmdqueryname=undo+vpls-to-evpn+migration+in-process"><b><span class="cmdname">undo vpls-to-evpn migration in-process</span></b></a> command to indicate that the BD has completed evolution from VPLS to EVPN.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ol></div>
<div class="postreq"><a name="EN-US_TASK_0000001560651176__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li><p>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> } <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> | <strong><span>prefix-route</span></strong> } <i><span class="varname">prefix</span></i> command on the SPE and NPE to check detailed BGP EVPN route information.</p>
</li><li>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">evpn-name-value</span></i> <strong><span>routing-table</span></strong> { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> } <i><span class="varname">prefix</span></i> command on the SPE and NPE to check the EVPN route information of the specified EVPN instance.</li><li><p>In a scenario where a CE is dual-homed to PEs, run the <a href="cmdqueryname=display+evpn+vpn-instance+name"><b><span class="cmdname">display evpn vpn-instance name</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>df result</span></strong> [ <strong><span>esi</span></strong> <i><span class="varname">esi</span></i> ] command on SPEs and NPEs to check the DF election result of the EVPN instance.</p>
</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0000.html">Configuring Evolution from Traditional L2VPN to EVPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0018.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2vpn_to_evpn_cfg_0011.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>