
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN VPLS Accessing EVPN L3VPN (Through VBDIF Interfaces)">
<meta name="abstract" content="If EVPN VPLS is used to carry P2MP Layer 2 services and EVPN L3VPN is used to carry Layer 3 services, you need to configure EVPN VPLS accessing EVPN L3VPN on devices where Layer 2 and Layer 3 services converge.">
<meta name="description" content="If EVPN VPLS is used to carry P2MP Layer 2 services and EVPN L3VPN is used to carry Layer 3 services, you need to configure EVPN VPLS accessing EVPN L3VPN on devices where Layer 2 and Layer 3 services converge.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0155.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_vpws_over_mpls_bras.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001602704389">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN VPLS Accessing EVPN L3VPN (Through VBDIF Interfaces)</title>
</head>
<body><a name="EN-US_TASK_0000001602704389"></a><a name="EN-US_TASK_0000001602704389"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN VPLS Accessing EVPN L3VPN (Through VBDIF Interfaces)</h1>
<div class="taskbody"><p>If EVPN VPLS is used to carry P2MP Layer 2 services and EVPN L3VPN is used to carry Layer 3 services, you need to configure EVPN VPLS accessing EVPN L3VPN on devices where Layer 2 and Layer 3 services converge.</p>
<div class="context"><a name="EN-US_TASK_0000001602704389__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>On the network shown in <a href="#EN-US_TASK_0000001602704389__fig128162610614">Figure 1</a>, the first layer is the user-side access network where Layer 2 services are carried between CPEs and UPEs to implement VLAN forwarding. The second layer is the aggregation network where services are carried using EVPN VPLS and EVPN VPLS is deployed between UPEs and NPEs. The third layer is the core network where services are carried using EVPN L3VPN. In this case, you need to configure EVPN VPLS accessing EVPN L3VPN on NPEs.</p>
<div class="fignone" id="EN-US_TASK_0000001602704389__fig128162610614"><a name="EN-US_TASK_0000001602704389__fig128162610614"></a><a name="fig128162610614"></a><span class="figcap"><b>Figure 1 </b>EVPN VPLS accessing EVPN L3VPN</span><br><span><img class="vsd" src="figure/en-us_image_0000001602854261.png" width="NaN" height="NaN"></span></div>
<p></p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001602704389__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring EVPN VPLS accessing EVPN L3VPN, complete the following tasks:</p>
<ul><li>Ensure route reachability between UPEs and NPEs and between NPEs and gateways.</li><li><div class="p">Complete one of the following tasks on NPEs and UPEs:<ul><li><a href="dc_vrp_srv6_cfg_all_0023_copy.html">Configure EVPN VPLS over IS-IS SRv6 BE</a>.</li><li><a href="dc_vrp_cfg_evpn-vpls_over_srv6-te_policy_copy.html">Configure EVPN VPLS over SRv6 TE Policy</a>.</li><li><a href="dc_vrp_evpn_cfg_0065.html">Configure EVPN VPLS over MPLS (BD EVPN instance)</a>.</li></ul>
</div>
</li><li>Complete one of the following tasks on NPEs and gateways:<ul><li><a href="dc_vrp_evpn_cfg_0152_copy.html">Configure EVPN L3VPN over IS-IS SRv6 BE</a>.</li><li><a href="dc_vrp_cfg_evpn-l3vpn_over_srv6-te_policy_copy.html">Configure EVPN L3VPNv4 over SRv6 TE Policy</a>.</li><li><a href="dc_vrp_evpn_cfg_0038.html">Configure EVPN L3VPN over MPLS</a>.</li></ul>
</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001602704389__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure a VBDIF interface on each of NPE1 and NPE2 for EVPN VPLS accessing EVPN L3VPN.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i> command to create a VBDIF interface and enter its view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname">ip binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to bind the VBDIF interface to the VPN instance.</span></li><li class="substepexpand"><span>Configure an IP address for the VBDIF interface to implement Layer 3 communication.</span><p><div class="p">If the EVPN VPLS service uses dual-homing active-active networking, the same IP address must be configured on NPE1 and NPE2.<ul><li>For an IPv4 network, run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>sub</span></strong> ] command to configure an IPv4 address.</li><li>For an IPv6 network, perform the following operations:<ol type="a"><li>Run the <a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a> command to enable IPv6 on the interface.</li><li>Run the <a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> } or <a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> } <strong><span>eui-64</span></strong> command to configure a global unicast address for the interface.</li></ol>
</li></ul>
</div>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=mac-address"><b><span class="cmdname">mac-address</span></b></a> <i><span class="varname">mac-address</span></i> command to configure a MAC address for the interface.</span><p><p>If the EVPN VPLS service uses dual-homing active-active networking, the same MAC address must be configured on NPE1 and NPE2.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure a VBDIF interface for EVPN VPLS accessing EVPN L3VPN on each of NPE1 and NPE2. Then configure VRRP on each of the devices.</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i> command to create a VBDIF interface and enter its view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname">ip binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to bind the VBDIF interface to the VPN instance.</span></li><li class="substepexpand"><span>Configure an IP address for the VBDIF interface to implement Layer 3 communication.</span><p><ul><li>For an IPv4 network, run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>sub</span></strong> ] command to configure an IPv4 address.</li><li>For an IPv6 network, perform the following operations:<ol type="a"><li>Run the <a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a> command to enable IPv6 on the interface.</li><li>Run the <a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> } or <a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <i><span class="varname">ipv6-address</span></i>/<i><span class="varname">prefix-length</span></i> } <strong><span>eui-64</span></strong> command to configure a global unicast address for the VBDIF interface.</li></ol>
</li></ul>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=vrrp+vrid"><b><span class="cmdname">vrrp vrid</span></b></a> <i><span class="varname">virtual-router-id</span></i> <strong><span>virtual-ip</span></strong> <i><span class="varname">virtual-address</span></i> command to create a VRRP group and assign a virtual IP address to it.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=vrrp+passive"><b><span class="cmdname">vrrp passive</span></b></a> command to enable VRRP passive, so that the device is forced to become the master device when the interface status is up.</span><p><p>If the EVPN VPLS service uses dual-homing active-active networking, this command must be configured on NPE1 and NPE2.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ul></div>
<div class="postreq"><a name="EN-US_TASK_0000001602704389__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li>Run the <a href="cmdqueryname=display+bgp+evpn+all+routing-table"><b><span class="cmdname">display bgp evpn all routing-table</span></b></a> command on NPEs to check information about EVPN routes received from UPEs.</li><li>Run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance"><b><span class="cmdname">display ip routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> or <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance"><b><span class="cmdname">display ipv6 routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command on NPEs or UPEs to check information about VPN routes received from the remote end.</li></ul>
</div></div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0155.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_vpws_over_mpls_bras.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>