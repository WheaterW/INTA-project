
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Interworking Between VPLS in PW Redundancy Mode and Anycast VXLAN with EVPN Active-Active Networking">
<meta name="abstract" content="This section provides an example for configuring interworking between VPLS in PW redundancy mode and anycast VXLAN with EVPN active-active networking.">
<meta name="description" content="This section provides an example for configuring interworking between VPLS in PW redundancy mode and anycast VXLAN with EVPN active-active networking.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0116.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0047.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370658">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Interworking Between VPLS in PW Redundancy Mode and Anycast VXLAN with EVPN Active-Active Networking</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370658"></a><a name="EN-US_TASK_0172370658"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Interworking Between VPLS in PW Redundancy Mode and Anycast VXLAN with EVPN Active-Active Networking</h1>
<div class="taskbody"><p>This section provides an example for configuring interworking between VPLS in PW redundancy mode and anycast VXLAN with EVPN active-active networking.</p>
<div class="context"><a name="EN-US_TASK_0172370658__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370658__fig24272118299">Figure 1</a>, EVPN anycast VXLAN active-active is deployed on the DCN. Specifically, PE1 and PE2, as the egress devices of the DCN, work in active-active mode with a bypass VXLAN tunnel deployed between them. They use an anycast VTEP address to establish a VXLAN tunnel with the TOR switch. In this manner, PE1, PE2, and the TOR switch can communicate. PE1 and PE2 communicate with the external network through the VPLS network, on which PW redundancy is configured. Specifically, the PE-AGG connects to PE1 and PE2 through primary and secondary PWs, respectively.</p>
<div class="fignone" id="EN-US_TASK_0172370658__fig24272118299"><a name="EN-US_TASK_0172370658__fig24272118299"></a><a name="fig24272118299"></a><span class="figcap"><b>Figure 1 </b>Configuring interworking between VPLS in PW redundancy mode and anycast VXLAN with EVPN active-active networking</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GigabitEthernet<span>0/1/1</span>, GigabitEthernet<span>0/1/2</span>, and GigabitEthernet<span>0/1/3</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001353868269.png" width="NaN" height="NaN"></span><br></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP address planning</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="12.62126212621262%" id="mcps1.4.1.4.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.85438543854385%" id="mcps1.4.1.4.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="43.52435243524352%" id="mcps1.4.1.4.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="6" valign="middle" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.14.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.13.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.100/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.20/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="6" valign="top" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.14.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.13.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/3</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack2</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>2.2.2.100/32</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack3</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>1.1.1.20/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>PE-AGG</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.13.3/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.13.3/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" valign="top" width="12.62126212621262%" headers="mcps1.4.1.4.2.4.1.1 "><p>TOR</p>
</td>
<td class="cellrowborder" valign="top" width="43.85438543854385%" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/1</span></p>
</td>
<td class="cellrowborder" valign="top" width="43.52435243524352%" headers="mcps1.4.1.4.2.4.1.3 "><p>10.1.14.4/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>GigabitEthernet<span>0/1/2</span></p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>10.2.14.4/24</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.2 "><p>LoopBack1</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.1.4.2.4.1.3 "><p>4.4.4.100/32</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370658__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure interface IP addresses, an IGP, and MPLS functions on each device.</li><li>Configure BGP EVPN on PE1 and PE2.</li><li>Configure a VXLAN tunnel between PE1 and PE2.</li><li>Configure primary and secondary PWs on the PE-AGG.</li><li>Configure PWs on PE1 and PE2 and set the PWs to AC mode.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370658__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interfaces and their IP addresses</p>
</li><li><p>EVPN instance name</p>
</li><li><p>RD and VPN target of the EVPN instance</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370658__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses, an IGP, and MPLS functions on each device.</span><p><p>For detailed configurations, see <a href="#EN-US_TASK_0172370658__dc_vrp_dci_cfg_003401">Configuration Files</a>.</p>
</p></li><li><span>Configure BGP EVPN on PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>bypass-vxlan enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.100 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.100 connect-interface LoopBack 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.100 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 4.4.4.100 connect-interface LoopBack 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2.2.2.100 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 2.2.2.100 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 4.4.4.100 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 4.4.4.100 advertise encap-type vxlan</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370658__dc_vrp_dci_cfg_003401">Configuration Files</a>.</p>
</p></li><li><span>Configure a VXLAN tunnel between PE1 and PE2.</span><ol type="a"><li class="substepexpand"><span>Configure an EVPN instance and bind it to a BD on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn vpn-instance evpn1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpn1] <strong>route-distinguisher 11:11</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpn1] <strong>vpn-target 1:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpn1] <strong>vpn-target 1:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>vxlan vni 10 split-horizon-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>evpn binding vpn-instance evpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370658__dc_vrp_dci_cfg_003401">Configuration Files</a>.</p>
</p></li><li class="substepexpand"><span>Configure an ingress replication list on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface nve 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Nve1] <strong>source 1.1.1.20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Nve1] <strong>bypass source 1.1.1.100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Nve1] <strong>mac-address 00e0-fc12-3456</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Nve1] <strong>vni 10 head-end peer-list protocol bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Nve1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370658__dc_vrp_dci_cfg_003401">Configuration Files</a>.</p>
</p></li></ol>
</li><li><span>Configure primary and secondary PWs on the PE-AGG.</span><p><p># Configure the PE-AGG.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>vsi vsi1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp] <strong>protect-group 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp-protect-group-10] <strong>protect-mode pw-redundancy master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp-protect-group-10] <strong>peer 1.1.1.1 preference 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp-protect-group-10] <strong>peer 2.2.2.2 preference 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp-protect-group-10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-bd10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-AGG] <strong>commit</strong></pre>
</p></li><li><span>Configure PWs on PE1 and PE2 and set the PWs to AC mode.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>vsi vsi1 bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi1-ldp] <strong>peer 3.3.3.3 ac-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configuration of PE2 is similar to that of PE1. For detailed configurations, see <a href="#EN-US_TASK_0172370658__dc_vrp_dci_cfg_003401">Configuration Files</a>.</p>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display vxlan tunnel</strong> command on PE1 and check information about the VXLAN tunnels.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vxlan tunnel</strong></pre>
<pre class="screen">Number of vxlan tunnel : 2
Tunnel ID   Source                Destination           State  Type     Uptime
-----------------------------------------------------------------------------------
4026531842  1.1.1.100             2.2.2.100             up     dynamic  01:31:05  
4026531843  1.1.1.20              4.4.4.100             up     dynamic  00:32:51</pre>
<p>Run the <strong>display vsi</strong> command on PE1 and check the VSI status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi</strong></pre>
<pre class="screen">Total VSI number is 1, 1 is up, 0 is down, 1 is LDP mode, 0 is BGP mode, 0 is BGPAD mode, 0 is mixed mode, 0 is unspecified mode
--------------------------------------------------------------------------
Vsi                             Mem    PW    Mac       Encap     Mtu   Vsi
Name                            Disc   Type  Learn     Type      Value State
--------------------------------------------------------------------------
vsi1                            --     ldp   qualify   vlan      1500  up </pre>
<p>Run the <strong>display vsi name vsi1 protect-group 10</strong> command on the PE-AGG and check information about the PW protection group in the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-AGG] <strong>display vsi name vsi1 protect-group 10</strong></pre>
<pre class="screen">Protect-group: 10
-------------------------------------------------------------------------------
PeerIp:VcId                Pref   Active
-------------------------------------------------------------------------------
1.1.1.1:1                  1      Active
2.2.2.2:1                  2      Inactive</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172370658__dc_vrp_dci_cfg_003401"><a name="EN-US_TASK_0172370658__dc_vrp_dci_cfg_003401"></a><a name="dc_vrp_dci_cfg_003401"></a><a name="EN-US_TASK_0172370658__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
evpn
 bypass-vxlan enable
#
evpn vpn-instance evpn1 bd-mode
 route-distinguisher 11:11
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#               
mpls
#
mpls l2vpn
#
vsi vsi1 bd-mode
 pwsignal ldp
  vsi-id 1
  peer 3.3.3.3 ac-mode 
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evpn1
 l2 binding vsi vsi1
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0001.00
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.14.1 255.255.255.0
 isis enable 1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.1.13.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown  
 ip address 10.1.1.1 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
interface LoopBack2
 ip address 1.1.1.100 255.255.255.255
 isis enable 1
#
interface LoopBack3
 ip address 1.1.1.20 255.255.255.255
 isis enable 1  
#
interface Nve1
 source 1.1.1.20
 bypass source 1.1.1.100
 mac-address 00e0-fc12-3456
 vni 10 head-end peer-list protocol bgp
#
bgp 100
 peer 2.2.2.100 as-number 100
 peer 2.2.2.100 connect-interface LoopBack2
 peer 4.4.4.100 as-number 100
 peer 4.4.4.100 connect-interface LoopBack2
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.100 enable
  peer 4.4.4.100 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 2.2.2.100 enable
  peer 2.2.2.100 advertise encap-type vxlan
  peer 4.4.4.100 enable
  peer 4.4.4.100 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.13.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
evpn
 bypass-vxlan enable
#
evpn vpn-instance evpn1 bd-mode
 route-distinguisher 11:11
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#               
mpls
#
mpls l2vpn
#
vsi vsi1 bd-mode
 pwsignal ldp
  vsi-id 1
  peer 3.3.3.3 ac-mode 
#
bridge-domain 10
 vxlan vni 10 split-horizon-mode
 evpn binding vpn-instance evpn1
 l2 binding vsi vsi1
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0002.00
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.2.14.1 255.255.255.0
 isis enable 1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.2.13.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown  
 ip address 10.1.1.2 255.255.255.0
 isis enable 1
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
interface LoopBack2
 ip address 2.2.2.100 255.255.255.255
 isis enable 1  
#
interface LoopBack3
 ip address 1.1.1.20 255.255.255.255
 isis enable 1
#
interface Nve1
 source 1.1.1.20
 bypass source 2.2.2.100
 mac-address 00e0-fc12-3456
 vni 10 head-end peer-list protocol bgp
#
bgp 100
 peer 1.1.1.100 as-number 100
 peer 1.1.1.100 connect-interface LoopBack2
 peer 4.4.4.100 as-number 100
 peer 4.4.4.100 connect-interface LoopBack2
 #
 ipv4-family unicast
  undo synchronization
  network 1.1.1.20 255.255.255.255
  peer 1.1.1.100 enable
  peer 4.4.4.100 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.100 enable
  peer 1.1.1.100 advertise encap-type vxlan
  peer 4.4.4.100 enable
  peer 4.4.4.100 advertise encap-type vxlan
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.2.13.0 0.0.0.255
#
return</pre>
</li><li><p>PE-AGG configuration file</p>
<pre class="screen">#
sysname PE-AGG
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1 bd-mode
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1  
  peer 2.2.2.2 
  protect-group 10 
   protect-mode pw-redundancy master
   peer 1.1.1.1 preference 1
   peer 2.2.2.2 preference 2
#
bridge-domain 10
 l2 binding vsi vsi1
#
mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.1.13.3 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 10.2.13.3 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.13.0 0.0.0.255
  network 10.2.13.0 0.0.0.255
#               
return</pre>
</li><li><p>TOR configuration file</p>
<p>See the configuration file of a DC device.</p>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0116.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0047.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>