
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN MAC Redirection">
<meta name="abstract" content="To solve the problem that traffic received on the network side takes a detour in special scenarios, configure EVPN MAC redirection.">
<meta name="description" content="To solve the problem that traffic received on the network side takes a detour in special scenarios, configure EVPN MAC redirection.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0271.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001553074961">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN MAC Redirection</title>
</head>
<body><a name="EN-US_TASK_0000001553074961"></a><a name="EN-US_TASK_0000001553074961"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN MAC Redirection</h1>
<div class="taskbody"><p>To solve the problem that traffic received on the network side takes a detour in special scenarios, configure EVPN MAC redirection.</p>
<div class="context"><a name="EN-US_TASK_0000001553074961__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>On the network shown in <a href="#EN-US_TASK_0000001553074961__fig17853203404315">Figure 1</a>, CE1, CE2, PE1, PE2, and PE3 form an EVPN VPLS dual-homing network. CE1 is dual-homed to PE1 and PE2.</p>
<p>Upon receipt of traffic sent from CE2 to CE1, PE3 load-balances the traffic between PE1 and PE2. Because PE2 does not have CE1's MAC1, it forwards the traffic destined for CE1 to PE1 first. If you want PE2 to directly forward traffic to CE1, configure MAC redirection on the PE.</p>
<div class="fignone" id="EN-US_TASK_0000001553074961__fig17853203404315"><a name="EN-US_TASK_0000001553074961__fig17853203404315"></a><a name="fig17853203404315"></a><span class="figcap"><b>Figure 1 </b>EVPN VPLS networking</span><br><span><img class="vsd" src="figure/en-us_image_0000001504992434.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001553074961__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring EVPN MAC redirection, complete one of the following tasks:</p>
<ul><li><a href="dc_vrp_evpn_cfg_0065.html">Configure EVPN VPLS over MPLS (BD EVPN instance)</a>.</li><li><a href="dc_vrp_srv6_cfg_all_0023_copy.html">Configure EVPN VPLS over SRv6 BE</a>.</li><li><a href="dc_vrp_cfg_evpn-vpls_over_srv6-te_policy_copy.html">Configure EVPN VPLS over SRv6 TE Policy</a>.</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0000001553074961__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure MAC redirection for a single EVPN instance:</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong> command to enter the BD EVPN instance view.</span></li><li><span>Run the <a href="cmdqueryname=mac-redirect-compatible"><b><span class="cmdname">mac-redirect-compatible</span></b></a> <strong><span>enable</span></strong> command to enable MAC redirection for the EVPN instance.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Configure MAC redirection globally:</span><ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=evpn"><b><span class="cmdname">evpn</span></b></a> command to enter the global EVPN configuration view.</span></li><li><span>Run the <a href="cmdqueryname=mac-redirect-compatible"><b><span class="cmdname">mac-redirect-compatible</span></b></a> <strong><span>enable</span></strong> command to enable MAC redirection globally.</span></li><li><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
<p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>By default, an EVPN instance inherits the MAC redirection configuration in the global EVPN configuration view. If MAC redirection has been configured in the view of the EVPN instance, this configuration takes precedence over that in the global EVPN configuration view.</p>
</div></div>
</p></li></ul></div>
<div class="example"><a name="EN-US_TASK_0000001553074961__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>After the configuration is complete, perform the following operations to verify it.</p>
<ul><li>Run the <a href="cmdqueryname=display+bgp+evpn+routing-table"><b><span class="cmdname">display bgp evpn all routing-table mac-route</span></b></a> <i><span class="varname">prefix</span></i> command on PEs to check whether the Redirect Out-Interface field of the received MAC route contains information about the redirected AC interface. <i><span class="varname">prefix</span></i> is in the format of E:M:H-H-H:L:X.X.X.X or E:M:H-H-H:L: [X:X::X:X]. For example, <i><span class="varname">prefix</span></i> can be 0:48:0001-0001-0001:0:0.0.0.0.</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0271.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0015.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>