
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Dual-Homing Single-Active EVPN VPLS over MPLS (Active/Standby Status Determined by E-Trunk)">
<meta name="abstract" content="This section provides an example for configuring Layer 2 traffic forwarding in a scenario where a CE is dual-homed to PEs of a BD EVPN in single-active mode.">
<meta name="description" content="This section provides an example for configuring Layer 2 traffic forwarding in a scenario where a CE is dual-homed to PEs of a BD EVPN in single-active mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0066.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_df-result.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,l00468467,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0263820191">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Dual-Homing Single-Active EVPN VPLS over MPLS (Active/Standby Status Determined by E-Trunk)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0263820191"></a><a name="EN-US_TASK_0263820191"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Dual-Homing Single-Active EVPN VPLS over MPLS (Active/Standby Status Determined by E-Trunk)</h1>
<div class="taskbody"><p>This section provides an example for configuring Layer 2 traffic forwarding in a scenario where a CE is dual-homed to PEs of a BD EVPN in single-active mode.</p>
<div class="context"><a name="EN-US_TASK_0263820191__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0263820191__fig_dc_vrp_dci_cfg_002601">Figure 1</a>, to allow sites to communicate over the backbone network, configure EVPN so that the sites can exchange EVPN routes to transmit Layer 2 traffic. If the sites belong to the same subnet, you need to create an EVPN instance on each PE so that the PEs store MAC routes and perform Layer 2 forwarding based on MAC addresses. An RR needs to be deployed to reflect EVPN routes.</p>
<p>To improve reliability in dual-homing single-active scenarios, configure local-remote FRR for MAC routes on PE1 and PE2.</p>
<div class="fignone" id="EN-US_TASK_0263820191__fig_dc_vrp_dci_cfg_002601"><a name="EN-US_TASK_0263820191__fig_dc_vrp_dci_cfg_002601"></a><a name="fig_dc_vrp_dci_cfg_002601"></a><span class="figcap"><b>Figure 1 </b>Configuring dual-homing single-active EVPN VPLS over MPLS (active/standby status determined by E-Trunk)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GigabitEthernet<span>0/1/0</span>, GigabitEthernet<span>0/2/0</span>, and GigabitEthernet<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0263820195.png" width="NaN" height="NaN"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0263820191__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li>In this example, the E-Trunk is used for dual-homing single-active networking.</li><li><p>VPN targets in the export VPN target list of the EVPN instance on the local PE must be the same as VPN targets in the import VPN target list of the remote PE.</p>
</li><li><p>Using each PE's local loopback interface address as its EVPN source address is recommended.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0263820191__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the backbone network to enable PEs and the RR to communicate.</p>
</li><li><p>Configure basic MPLS functions and enable MPLS LDP to establish MPLS LSPs on the backbone network.</p>
</li><li><p>Configure a BD EVPN instance on each PE.</p>
</li><li><p>Configure the ESI and E-Trunk for dual-homing active-active networking. The E-Trunk uses the default encryption mode <strong>enhanced-hmac-sha256</strong> for authentication.</p>
</li><li>Configure local-remote FRR for MAC routes. </li><li>Create a BFD session and bind it to the E-Trunk on PE1 and PE2 to speed up traffic switching if a fault occurs.</li><li><p>Establish a BGP EVPN peer relationship.</p>
</li><li><p>Configure each CE to access the PEs through the Eth-Trunk interface.</p>
</li><li>Configure IP addresses of the same network segment for CE1 and CE2. Then perform a ping operation on the network segment to trigger the local and remote PEs to learn CE-side MAC addresses.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0263820191__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>EVPN instance name: evpna</li><li><p>EVPN instance evpna's RDs (100:1, 200:1, and 300:1) and RTs (1:1) on each PE</p>
</li><li>Name of the BFD session bound to the E-Trunk: ForEtrunk</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0263820191__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface addresses on the RR and PEs according to <a href="#EN-US_TASK_0263820191__fig_dc_vrp_dci_cfg_002601">Figure 1</a>. For detailed configurations, see Configuration Files.</span></li><li><span>Configure an IGP on the backbone network to enable PEs and the RR to communicate. OSPF is used as an IGP in this example.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-ospf-1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-ospf-1] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 4.4.4.4 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-ospf-1] <strong>quit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1]<strong> area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 10.2.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-ospf-1-area-0.0.0.0] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-ospf-1] <strong>quit</strong></pre>
<p>After the configurations are complete, PE1, PE2, and PE3 can establish OSPF neighbor relationships with the RR. Run the <strong>display ospf peer</strong> command. The command output shows that <strong>State</strong> is <strong>Full</strong>. Run the <strong>display ip routing-table</strong> command. The command output shows that the PEs and RR have learned the routes to Loopback1 of one another.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ospf peer</strong></pre>
<pre class="screen">(M) Indicates MADJ neighbor


          OSPF Process 1 with Router ID 1.1.1.1
                Neighbors

 Area 0.0.0.0 interface 10.1.1.1 (GE<span>0/2/0</span>)'s neighbors
 Router ID: 3.3.3.3              Address: 10.1.1.2         
   State: Full           Mode:Nbr is Master     Priority: 1
   DR: 10.1.1.1          BDR: 10.1.1.2          MTU: 0
   Dead timer due in  38  sec
   Retrans timer interval: 5
   Neighbor is up for 00h01m12s
   Neighbor Up Time : 2020-11-18 01:41:57
   Authentication Sequence: [ 0 ]
</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 13       Routes : 13

Destination/Mask    Proto   Pre  Cost        Flags NextHop         Interface

        1.1.1.1/32  Direct  0    0             D   127.0.0.1       LoopBack1
        2.2.2.2/32  OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
        3.3.3.3/32  OSPF    10   1             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
        4.4.4.4/32  OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct  0    0             D   127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct  0    0             D   127.0.0.1       InLoopBack0
127.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0
      10.1.1.0/24   Direct  0    0             D   10.1.1.1        GigabitEthernet<span>0/2/0</span>
      10.1.1.1/32   Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
    10.1.1.255/32   Direct  0    0             D   127.0.0.1       GigabitEthernet<span>0/2/0</span>
      10.2.1.0/24   OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
      10.3.1.0/24   OSPF    10   2             D   10.1.1.2        GigabitEthernet<span>0/2/0</span>
255.255.255.255/32  Direct  0    0             D   127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure basic MPLS functions and enable MPLS LDP to establish LDP LSPs on the MPLS backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>interface gigabitethernet <span>0/3/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-GigabitEthernet<span>0/3/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR-GigabitEthernet<span>0/3/0</span>] <strong>quit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls lsr-id 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>After the configurations are complete, LDP sessions are established between the PEs (PE1, PE2, and PE3) and RR. Run the <strong>display mpls ldp session</strong> command. The command output shows that <strong>Status</strong> is <strong>Operational</strong>. Then, run the <strong>display mpls ldp lsp</strong> command. The command output shows that an LDP LSP has been successfully established.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.
 --------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
 --------------------------------------------------------------------------
 3.3.3.3:0          Operational DU   Passive  0000:00:05   22/22
 --------------------------------------------------------------------------
 TOTAL: 1 Session(s) Found.</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 1.1.1.1/32         3/NULL         3.3.3.3         127.0.0.1        LoopBack1
*1.1.1.1/32         Liberal/32828                  DS/3.3.3.3       
 2.2.2.2/32         NULL/32829     -               10.1.1.2         GE<span>0/2/0</span>
 2.2.2.2/32         32829/32829    3.3.3.3         10.1.1.2         GE<span>0/2/0</span>
 3.3.3.3/32         NULL/3         -               10.1.1.2         GE<span>0/2/0</span>
 3.3.3.3/32         32828/3        3.3.3.3         10.1.1.2         GE<span>0/2/0</span>
 4.4.4.4/32         NULL/32830     -               10.1.1.2         GE<span>0/2/0</span>
 4.4.4.4/32         32830/32830    3.3.3.3         10.1.1.2         GE<span>0/2/0</span>
 -------------------------------------------------------------------------------
 TOTAL: 7 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 FRR LSP(s) Found.
 An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</pre>
</p></li><li><span>Configure an EVPN instance on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn vpn-instance evpna bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpna] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpna] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn-instance-evpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>evpn binding vpn-instance evpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn vpn-instance evpna bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evpna] <strong>route-distinguisher 200:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evpna] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn-instance-evpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>evpn binding vpn-instance evpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn vpn-instance evpna bd-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evpna] <strong>route-distinguisher 300:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evpna] <strong>vpn-target 1:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-evpn-instance-evpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>evpn binding vpn-instance evpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bd10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure a source address on each PE.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>evpn source-address 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure the ESI and E-Trunk for dual-homing single-active networking.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For security purposes, you are not advised to use weak security algorithms in this feature. If you need to use such an algorithm, run the <a href="cmdqueryname=undo+crypto+weak-algorithm+disable"><b><span class="cmdname">undo crypto weak-algorithm disable</span></b></a> command to enable the weak security algorithm function.</p>
</div></div>
</p><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>lacp e-trunk system-id 00e0-fc00-0000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>priority 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>peer-address 2.2.2.2 source-address 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>security-key cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>esi 0000.1111.2222.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface eth-trunk 10.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>evpn redundancy-mode single-active</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>lacp e-trunk system-id 00e0-fc00-0000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>peer-address 1.1.1.1 source-address 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>security-key cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>esi 0000.1111.2222.1111.1111</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface eth-trunk 10.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong><strong>interface gigabitethernet <span>0/1/0</span></strong></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>evpn redundancy-mode single-active</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface eth-trunk 10.1 mode l2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>encapsulation dot1q vid 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>rewrite pop single</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>bridge-domain 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Eth-Trunk10.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong><strong>interface gigabitethernet <span>0/2/0</span></strong></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure local-remote FRR for MAC routes. </span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>vlan-extend private enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>vlan-extend redirect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>local-remote frr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>vlan-extend private enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>vlan-extend redirect enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>local-remote frr enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Create a BFD session and bind it to the E-Trunk on PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd ForEtrunk bind peer-ip 2.2.2.2 source-ip 1.1.1.1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-ForEtrunk] <strong>discriminator local 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-ForEtrunk] <strong>discriminator remote 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-session-ForEtrunk] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>e-trunk track bfd-session session-name</strong> <strong>ForEtrunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-e-trunk-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd ForEtrunk bind peer-ip 1.1.1.1 source-ip 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-ForEtrunk] <strong>discriminator local 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-ForEtrunk] <strong>discriminator remote 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-session-ForEtrunk] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>e-trunk track bfd-session session-name</strong> <strong>ForEtrunk</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-e-trunk-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Establish a BGP EVPN peer relationship.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure the RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 2.2.2.2 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>peer 4.4.4.4 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>l2vpn-family evpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 1.1.1.1 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 2.2.2.2 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>peer 4.4.4.4 reflect-client</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp-af-evpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>RR] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp evpn peer</strong> command on the RR. The command output shows that BGP peer relationships are in the <strong>Established</strong> state, indicating that BGP peer relationships have been successfully established between the PEs and RR.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>RR] <strong>display bgp evpn peer</strong></pre>
<pre class="screen"> 
 BGP local router ID : 3.3.3.3
 Local AS number : 100
 Total number of peers : 3                 Peers in established state : 3

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  1.1.1.1         4         100       10       18     0 00:00:11 Established        6
  2.2.2.2         4         100       10       20     0 00:00:12 Established        6
  4.4.4.4         4         100        6       18     0 00:00:13 Established        2</pre>
</p></li><li><span>Configure each CE to access the PEs through the Eth-Trunk interface.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 2</strong>
[<span class="keyword">*</span>CE1-vlan2] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>interface Eth-Trunk10</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>portswitch</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>port trunk allow-pass vlan 2</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>mode lacp-static</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>max active-linknumber 1</strong> 
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>lacp preempt enable</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>lacp preempt delay 180</strong>
[<span class="keyword">*</span>CE1-Eth-Trunk10] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 10</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/2/0</span></strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>eth-trunk 10</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan 2</strong>
[<span class="keyword">*</span>CE2-vlan2] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>interface Eth-Trunk10</strong>
[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>portswitch</strong>
[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>port link-type trunk</strong>
[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>port trunk allow-pass vlan 2</strong>
[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>eth-trunk 10</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure IP addresses on the same network segment on CE1 and CE2 and perform a ping operation on the same network segment.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface vlanif2</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-Vlanif2] <strong>ip address 192.168.1.11 24</strong>
[<span class="keyword">*</span>CE1-Vlanif2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>commit</strong></pre>
</p><p><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface vlanif2</strong>
[<span class="keyword">*</span>CE2-Vlanif2] <strong>ip address 192.168.1.12 24</strong>
[<span class="keyword">*</span>CE2-Vlanif2] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>commit</strong></pre>
<p># Ping CE2 from CE1 (with the source and destination IP addresses being on the same network segment). The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 192.168.1.12</strong> </pre>
<pre class="screen"> PING 192.168.1.12: 56  data bytes, press CTRL_C to break                      
    Reply from 192.168.1.12: bytes=56 Sequence=1 ttl=255 time=13 ms             
    Reply from 192.168.1.12: bytes=56 Sequence=2 ttl=255 time=4 ms              
    Reply from 192.168.1.12: bytes=56 Sequence=3 ttl=255 time=3 ms              
    Reply from 192.168.1.12: bytes=56 Sequence=4 ttl=255 time=4 ms              
    Reply from 192.168.1.12: bytes=56 Sequence=5 ttl=255 time=4 ms              

  --- 192.168.1.12 ping statistics ---                                          
    5 packet(s) transmitted                                                     
    5 packet(s) received                                                        
    0.00% packet loss                                                           
    round-trip min/avg/max = 3/5/13 ms </pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display bgp evpn all routing-table </strong><strong>mac-route</strong> command on PE3. The command output shows the MAC route destined for CE1 sent from the remote PE. In the single-active scenario, the next hop of the MAC route on CE1 is PE1 on the primary path.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>display bgp evpn all routing-table</strong> <strong>mac-route</strong></pre>
<pre class="screen"> Local AS number : 100                                                          

 BGP Local router ID is 10.3.1.2                                                
 Status codes: * - valid, &gt; - best, d - damped, x - best external, a - add path,
               h - history,  i - internal, s - suppressed, S - Stale            
               Origin : i - IGP, e - EGP, ? - incomplete                        

 EVPN address family:                                                           
 Number of Mac Routes: 2                                                        
 Route Distinguisher: 100:1                                                     
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop                      
 *&gt;i   0:48:00e0-fc12-5678:32:0.0.0.0                         <strong>1.1.1.1</strong>           
 Route Distinguisher: 300:1                                                     
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop
 *&gt;    0:48:00e0-fc12-3333:0:0.0.0.0                          0.0.0.0           


 EVPN-Instance evpna:                                                           
 Number of Mac Routes: 2                                                        
       Network(EthTagId/MacAddrLen/MacAddr/IpAddrLen/IpAddr)  NextHop                                 
 *&gt;i   0:48:00e0-fc12-5678:32:0.0.0.0                         <strong>1.1.1.1</strong>
 *&gt;    0:48:00e0-fc12-3333:0:0.0.0.0                          0.0.0.0</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0263820191__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
lacp e-trunk system-id 00e0-fc00-0000                                           
lacp e-trunk priority 1
#
evpn redundancy-mode single-active
#
evpn
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
 #                                                                              
 mac-duplication
#
evpn vpn-instance evpna bd-mode
 route-distinguisher 100:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evpna
#
mpls ldp
 #                                                                              
 ipv4-family 
#               
e-trunk 1
 priority 50
 peer-address 2.2.2.2 source-address 1.1.1.1
 e-trunk track bfd-session session-name ForEtrunk
 security-key cipher %^%#F&amp;zi0c6x_2+SrLT_nm4,vfS$SCd]G:r<font style="font-size:8pt" Face="Courier New" >~</font>A_T!C&gt;A$%^%#
 authentication-mode enhanced-hmac-sha256
#
interface Eth-Trunk10
 mode lacp-static
 e-trunk 1
 esi 0000.1111.2222.1111.1111
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 2
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
bfd ForEtrunk bind peer-ip 2.2.2.2 source-ip 1.1.1.1                           
 discriminator local 1                                                          
 discriminator remote 2 
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
evpn source-address 1.1.1.1
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
lacp e-trunk system-id 00e0-fc00-0000                                           
lacp e-trunk priority 1
#
evpn redundancy-mode single-active
#
evpn
 vlan-extend private enable
 vlan-extend redirect enable
 local-remote frr enable
 #
 mac-duplication
#
evpn vpn-instance evpna bd-mode
 route-distinguisher 200:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
bfd
#
mpls lsr-id 2.2.2.2
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evpna
#
mpls ldp
 #                                                                              
 ipv4-family
#               
e-trunk 1
 peer-address 1.1.1.1 source-address 2.2.2.2
 e-trunk track bfd-session session-name ForEtrunk
 security-key cipher %^%#F&amp;zi0c6x_2+SrLT_nm4,vfS$SCd]G:r<font style="font-size:8pt" Face="Courier New" >~</font>A_T!C&gt;A$%^%#
 authentication-mode enhanced-hmac-sha256
#
interface Eth-Trunk10
 mode lacp-static 
 e-trunk 1
 esi 0000.1111.2222.1111.1111
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 2
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
bfd ForEtrunk bind peer-ip 1.1.1.1 source-ip 2.2.2.2                           
 discriminator local 2                                                          
 discriminator remote 1
#
bgp 100         
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.2.1.0 0.0.0.255
#
evpn source-address 2.2.2.2
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
evpn vpn-instance evpna bd-mode
 route-distinguisher 300:1
 vpn-target 1:1 export-extcommunity
 vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.4
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evpna
#
mpls ldp
 #
 ipv4-family
#
interface Eth-Trunk10
#
interface Eth-Trunk10.1 mode l2
 encapsulation dot1q vid 2
 rewrite pop single
 bridge-domain 10
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 eth-trunk 10   
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
evpn source-address 4.4.4.4
#
return</pre>
</li><li><p>RR configuration file</p>
<pre class="screen">#
sysname RR
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
 #                                                                              
 ipv4-family 
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown  
 ip address 10.2.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.1 enable
  peer 1.1.1.1 reflect-client
  peer 2.2.2.2 enable
  peer 2.2.2.2 reflect-client
  peer 4.4.4.4 enable
  peer 4.4.4.4 reflect-client
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.1.0 0.0.0.255
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan batch 2
#
vlan 2
#
interface Vlanif2
 ip address 192.168.1.11 255.255.255.0
#
interface Eth-Trunk10                                                                    
 portswitch
 port link-type trunk
 port trunk allow-pass vlan 2                                                           
 mode lacp-static                                                               
 lacp preempt enable
 max active-linknumber 1
 lacp preempt delay 180
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 eth-trunk 10
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
vlan batch 2
#
vlan 2
#
interface Vlanif2
 ip address 192.168.1.12 255.255.255.0
#
interface Eth-Trunk10
 portswitch
 port link-type trunk
 port trunk allow-pass vlan 2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0066.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_df-result.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>