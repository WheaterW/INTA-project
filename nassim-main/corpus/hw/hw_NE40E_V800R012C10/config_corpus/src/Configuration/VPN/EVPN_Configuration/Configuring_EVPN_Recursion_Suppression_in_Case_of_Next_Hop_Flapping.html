
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN Recursion Suppression in Case of Next Hop Flapping">
<meta name="abstract" content="EVPN recursion suppression in case of next hop flapping prevents the system from processing changes in EVPN routes that recurse to a frequently flapping next hop, thereby reducing system resource consumption and CPU usage.">
<meta name="description" content="EVPN recursion suppression in case of next hop flapping prevents the system from processing changes in EVPN routes that recurse to a frequently flapping next hop, thereby reducing system resource consumption and CPU usage.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_dampening.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_umr.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0315181041">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN Recursion Suppression in Case of Next Hop Flapping</title>
</head>
<body><a name="EN-US_TASK_0315181041"></a><a name="EN-US_TASK_0315181041"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN Recursion Suppression in Case of Next Hop Flapping</h1>
<div class="taskbody"><p>EVPN recursion suppression in case of next hop flapping prevents the system from processing changes in EVPN routes that recurse to a frequently flapping next hop, thereby reducing system resource consumption and CPU usage.</p>
<div class="context"><a name="EN-US_TASK_0315181041__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Usage Scenario</h4><p>If a large number of EVPN routes recurse to the same next hop that flaps frequently, the system will be busy processing changes in these routes, consuming excessive system resources and leading to high CPU usage. To address this issue, configure EVPN recursion suppression in case of next hop flapping.</p>
<p>By default, EVPN recursion suppression in case of next hop flapping is enabled. After EVPN recursion suppression in case of next hop flapping is enabled, an EVPN device determines whether to increase, retain, or reduce the penalty value by comparing the flapping interval with the configured threshold. When the penalty value exceeds 10, the EVPN device suppresses route recursion to the corresponding next hop. For example, if the intervals for increasing, retaining, and clearing the penalty value are T1, T2, and T3, respectively, the device calculates the penalty value as follows:</p>
<ul><li>Increases the penalty value by 1 if the flapping interval is less than T1.</li><li>Retains the penalty value if the flapping interval is greater than or equal to T1, but less than T2.</li><li>Reduces the penalty value by 1 if the flapping interval is greater than or equal to T2, but less than T3.</li><li>Clears the penalty value if the flapping interval is greater than or equal to T3.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0315181041__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring EVPN recursion suppression in case of next hop flapping, complete one of the following tasks:</p>
<ul><li><a href="dc_vrp_evpn_cfg_0003.html">Configure EVPN VPLS over MPLS (common EVPN instance)</a>.</li><li><a href="dc_vrp_evpn_cfg_0065.html">Configure EVPN VPLS over MPLS (BD EVPN instance)</a>.</li><li><a href="dc_vrp_srv6_cfg_all_0023_copy.html">Configure EVPN VPLS over IS-IS SRv6 BE</a>.</li><li><a href="dc_vrp_evpn_cfg_0020.html">Configure EVPN VPWS over MPLS</a>.</li><li><a href="dc_vrp_srv6_cfg_all_0021_copy.html">Configure EVPN VPWS over IS-IS SRv6 BE</a>.</li></ul>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0315181041__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Perform the following configurations in the global EVPN configuration view:</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=nexthop+recursive-lookup+restrain"><b><span class="cmdname">nexthop recursive-lookup restrain</span></b></a> <strong><span>suppress-interval</span></strong> <i><span class="varname">add-count-time</span></i> <strong><span>hold-interval</span></strong> <i><span class="varname">hold-count-time</span></i> <strong><span>clear-interval</span></strong> <i><span class="varname">clear-count-time</span></i> command to configure the intervals for increasing, retaining, and clearing the penalty value for recursion suppression in case of next hop flapping.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=evpn"><b><span class="cmdname">evpn</span></b></a> command to enter the global EVPN configuration view.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=nexthop+recursive-lookup+restrain+disable"><b><span class="cmdname">nexthop recursive-lookup restrain disable</span></b></a> command to disable EVPN recursion in case of next hop flapping globally.</span><p><p>If you do not want to slow down route recursion processing and high CPU usage due to route recursion change processing is not a concern, you can disable recursion suppression in case of next hop flapping. After this step is performed, recursion suppression in case of next hop flapping does not take effect for any EVPN instance.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li><li><span>Perform the following configurations in the specified EVPN instance view:</span><ol><li class="substepexpand"><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enter the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=nexthop+recursive-lookup+restrain"><b><span class="cmdname">nexthop recursive-lookup restrain</span></b></a> <strong><span>suppress-interval</span></strong> <i><span class="varname">add-count-time</span></i> <strong><span>hold-interval</span></strong> <i><span class="varname">hold-count-time</span></i> <strong><span>clear-interval</span></strong> <i><span class="varname">clear-count-time</span></i> command to configure the intervals for increasing, retaining, and clearing the penalty value for recursion suppression in case of next hop flapping.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> [ <strong><span>bd-mode</span></strong> | <strong><span>vpws</span></strong> ] command to enter the view of the EVPN instance with the specified name and mode.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=nexthop+recursive-lookup+restrain+disable"><b><span class="cmdname">nexthop recursive-lookup restrain disable</span></b></a> command to disable EVPN recursion suppression in case of next hop flapping in the current EVPN instance.</span><p><p>If you do not want to slow down route recursion processing and high CPU usage due to route recursion change processing is not a concern, you can disable recursion suppression in case of next hop flapping. After this step is performed, recursion suppression in case of next hop flapping does not take effect for the current EVPN instance.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For an EVPN instance, EVPN recursion suppression in case of next hop flapping takes effect only when this function is enabled in both the global EVPN configuration view and EVPN instance view.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol>
</li></ul></div>
<div class="example"><a name="EN-US_TASK_0315181041__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><p>Run the <a href="cmdqueryname=display+bgp+evpn"><b><span class="cmdname">display bgp evpn</span></b></a> { <strong><span>all</span></strong> | <strong><span>route-distinguisher</span></strong> <i><span class="varname">route-distinguisher</span></i> | <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> } <strong><span>routing-table</span></strong> [ { <strong><span>ad-route</span></strong> | <strong><span>es-route</span></strong> | <strong><span>inclusive-route</span></strong> | <strong><span>mac-route</span></strong> } <i><span class="varname">prefix</span></i> ] command to check BGP EVPN route information.</p>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_dampening.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_umr.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>