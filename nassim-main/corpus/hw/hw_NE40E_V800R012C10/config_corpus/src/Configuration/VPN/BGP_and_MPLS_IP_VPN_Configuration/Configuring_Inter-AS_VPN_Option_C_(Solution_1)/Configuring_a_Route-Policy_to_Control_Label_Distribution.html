
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a Route-Policy to Control Label Distribution">
<meta name="abstract" content="You need to configure a route-policy to control label allocation for each inter-AS BGP LSP. If labeled IPv4 routes are advertised to a PE of the local AS, you need to re-allocate MPLS labels to these routes. If routes sent by a PE of the local AS are advertised to the peer ASBR, you need to allocate MPLS labels to these routes.">
<meta name="description" content="You need to configure a route-policy to control label allocation for each inter-AS BGP LSP. If labeled IPv4 routes are advertised to a PE of the local AS, you need to re-allocate MPLS labels to these routes. If routes sent by a PE of the local AS are advertised to the peer ASBR, you need to allocate MPLS labels to these routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0136.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0137.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0139.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369337">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a Route-Policy to Control Label Distribution</title>
</head>
<body><a name="EN-US_TASK_0172369337"></a><a name="EN-US_TASK_0172369337"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a Route-Policy to Control Label Distribution</h1>
<div class="taskbody"><p>You need to configure a route-policy to control label allocation for each inter-AS BGP LSP. If labeled IPv4 routes are advertised to a PE of the local AS, you need to re-allocate MPLS labels to these routes. If routes sent by a PE of the local AS are advertised to the peer ASBR, you need to allocate MPLS labels to these routes.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0172369337__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Create a route-policy.</span><p><p>Perform the following steps on the ASBR:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">policy-name1</span></i> <strong><span>permit</span></strong> <strong><span>node</span></strong> <i><span class="varname">node</span></i></span><p><p>The route-policy applied to the local PE is created.</p>
</p><p><p>For the labeled IPv4 routes received from the peer ASBR, this policy ensures that the local ASBR allocates a new MPLS label to them when advertising them to PEs in the local AS.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=if-match+mpls-label"><b><span class="cmdname">if-match mpls-label</span></b></a></span><p><p>The IPv4 routes with labels are matched.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a></span><p><p>A label is allocated to the IPv4 routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">policy-name2</span></i> <strong><span>permit</span></strong> <strong><span>node</span></strong> <i><span class="varname">node</span></i></span><p><p>A route-policy applicable to the peer ASBR is created.</p>
</p><p><p>When an ASBR advertises the routes received from a PE in the same AS to the peer ASBR, the ASBR allocates MPLS labels to the routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=apply+mpls-label"><b><span class="cmdname">apply mpls-label</span></b></a></span><p><p>A label is allocated to the IPv4 routes.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Apply a route-policy.</span><p><p>Perform the following steps on each ASBR:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>route-policy</span></strong> <i><span class="varname">policy-name1</span></i> <strong><span>export</span></strong></span><p><p>The route-policy used when routes are advertised to the local PE is applied.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>route-policy</span></strong> <i><span class="varname">policy-name2</span></i> <strong><span>export</span></strong></span><p><p>The route-policy used when routes are advertised to the peer ASBR is applied.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Control the creation of ingress LSPs for labeled BGP routes based on route-policies.</span><p><p>Perform the following steps on the PE.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ingress-lsp+trigger"><b><span class="cmdname">ingress-lsp trigger</span></b></a> <span>{ </span><strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i><span> | <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i> }</span></span><p><p>The device is configured to create ingress LSPs for labeled BGP routes based on route-policies<span> or route-filters</span>.</p>
</p><p><p>On a MAN where the hybrid access mode is used, a large number of labeled BGP routes are used to establish E2E LSPs. On certain transit nodes where VPN services do not need to be supported, excessive ingress LSPs are created, wasting network resources. In this case, you can run this command to create ingress LSPs for desired labeled BGP routes based on route-policies<span> or route-filters</span> to save network resources.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0136.html">Configuring Inter-AS VPN Option C (Solution 1)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0137.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0139.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>