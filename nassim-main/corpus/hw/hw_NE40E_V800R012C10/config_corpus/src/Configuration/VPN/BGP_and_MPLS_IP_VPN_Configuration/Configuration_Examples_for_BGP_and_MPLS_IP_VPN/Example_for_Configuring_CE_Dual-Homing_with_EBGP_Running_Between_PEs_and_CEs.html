
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring CE Dual-Homing with EBGP Running Between PEs and CEs">
<meta name="abstract" content="CE dual-homing indicates that a CE connects to the backbone network over two links that work in either load balancing or primary/backup mode.">
<meta name="description" content="CE dual-homing indicates that a CE connects to the backbone network over two links that work in either load balancing or primary/backup mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2006.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0107.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00830487">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369460">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring CE Dual-Homing with EBGP Running Between PEs and CEs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369460"></a><a name="EN-US_TASK_0172369460"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring CE Dual-Homing with EBGP Running Between PEs and CEs</h1>
<div class="taskbody"><p>CE dual-homing indicates that a CE connects to the backbone network over two links that work in either load balancing or primary/backup mode.</p>
<div class="context"><a name="EN-US_TASK_0172369460__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>With the development of telecommunications services, all telecommunications services will be carried on a unified IP network. Important services, such as 3G/NGN, IPTV streaming media, and VIP customer VPN, require high network reliability. To improve network reliability, consider improving link and network reliability in addition to network device reliability using mechanisms such as fast route convergence, fault detection, fast reroute, and path backup.</p>
<p>At the access layer, CE dual-homing is a common solution to improving network reliability. The networking in which a CE is dual-homed to two PEs that belong to the same VPN is called CE dual-homing. In this case, the CE accesses the backbone network over two links. The two links can work in either load balancing or primary/secondary mode.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172369460__fig_dc_vrp_mpls-l3vpn-v4_cfg_010601">Figure 1</a>, CE1 resides at site1 of vpn1; CE2 resides at site2 of vpn1; CE1 is dual-homed to PE1 and PE2; CE2 is dual-homed to PE3 and PE4.</p>
<p>If the traffic from CE1 to CE2 is heavy whereas the traffic from CE2 to CE1 is light, the data traffic from CE1 to CE2 can be transmitted in load balancing mode; the data traffic from CE2 to CE1 can be forwarded by PE4 with PE3 as a backup.</p>
<div class="fignone" id="EN-US_TASK_0172369460__fig_dc_vrp_mpls-l3vpn-v4_cfg_010601"><a name="EN-US_TASK_0172369460__fig_dc_vrp_mpls-l3vpn-v4_cfg_010601"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_010601"></a><span class="figcap"><b>Figure 1 </b>CE dual-homing</span><br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_010601.png" width="NaN" height="NaN"></span><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p>Device Name</p>
</td>
<td valign="top"><p>Interface</p>
</td>
<td valign="top"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>11.11.11.11/32</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.1.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.2.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.1.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.10.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.2.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.20.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>P1</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>5.5.5.5/32</p>
</td>
</tr>
<tr><td valign="top"><p>P1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.10.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>P1</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.30.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>P2</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>6.6.6.6/32</p>
</td>
</tr>
<tr><td valign="top"><p>P2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.20.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>P2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.40.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE3</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE3</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.30.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE3</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.3.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE4</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE4</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.40.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>PE4</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.4.1.1/30</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>22.22.22.22/32</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.3.1.2/30</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.4.1.2/30</p>
</td>
</tr>
</table></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369460__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>When configuring CE dual-homing with EBGP running between the PEs and CE, ensure that the CE is dual-homed to two PEs configured with VPN instances of different RDs.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369460__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a basic BGP/MPLS IP VPN.</p>
</li><li><p>Configure load balancing for the traffic from CE1 to CE2 in the BGP view of CE1.</p>
</li><li><p>Increase the Multi-Exit Discrimination (MED) value of the BGP VPN route on PE3 to ensure that the next hop of the route selected by CE2 to the users who access CE1 is PE4.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369460__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and P</p>
</li><li><p>Names of the VPN instances, RDs, and VPN targets of the PEs</p>
</li><li><p>AS numbers of the CEs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369460__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IGP on the MPLS backbone network for devices on the network to communicate.</span><p><p># Configure interface IP addresses on PE1. Note that the IP address of a loopback interface has a 32-bit mask.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.10.1.1 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># Configure IS-IS to advertise interface routes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> isis 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1]<strong> network-entity 10.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>isis enable 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># The configurations of other devices on the backbone network are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display ip routing-table</strong> command. The command output shows that PE1 and PE3, and PE2 and PE4 have learned the routes to Loopback1 of each other.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 11        Routes : 11

  Destination/Mask  Proto  Pre  Cost       Flags  NextHop         Interface

        1.1.1.1/32  Direct 0    0              D  127.0.0.1       InLoopBack0
        <strong>3.3.3.3/32</strong>  ISIS   15   20             D  10.10.1.2       GigabitEthernet<span>0/2/0</span>
        5.5.5.5/32  ISIS   15   10             D  10.10.1.2       GigabitEthernet<span>0/2/0</span>
      10.10.1.0/30  Direct 0    0              D  10.10.1.1       GigabitEthernet<span>0/2/0</span>
      10.10.1.1/32  Direct 0    0              D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
    10.10.1.255/32  Direct 0    0              D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
      10.30.1.0/30  ISIS   15   20             D  10.10.1.2       GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0              D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0              D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0              D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0              D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure MPLS and MPLS LDP both globally and per interface on each node of the backbone network and set up LDP LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong><strong>commit</strong></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p># The configurations of other devices on the backbone network are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After the configurations are complete, LDP sessions can be set up between PE1 and the P and between the P and PE2. Run the <strong>display mpls ldp session</strong> command. The command output shows that the <strong>Status</strong> field is <strong>Operational</strong>. Run the <strong>display mpls ldp lsp</strong> command. The command output shows whether LDP LSPs are set up.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp session</strong>

              LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted. </span> ------------------------------------------------------------------------------
 Peer-ID            Status      LAM  SsnRole  SsnAge      KA-Sent/Rcv
 ------------------------------------------------------------------------------
 5.5.5.5:0          <strong>Operational</strong> DU   Passive  0000:07:02   1688/1688
 ------------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.</pre>
<pre class="screen">&lt;PE1&gt; <strong>display mpls ldp lsp</strong>
 LDP LSP Information
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 1.1.1.1/32         3/NULL         5.5.5.5         127.0.0.1         Loop1
*1.1.1.1/32         Liberal/16                     DS/5.5.5.5
 3.3.3.3/32         NULL/17        -               10.10.1.2         GE<span>0/2/0</span>
 3.3.3.3/32         17/17          5.5.5.5         10.10.1.2         GE<span>0/2/0</span>
 5.5.5.5/32         NULL/3         -               10.10.1.2         GE<span>0/2/0</span>
 5.5.5.5/32         16/3           5.5.5.5         10.10.1.2         GE<span>0/2/0</span>
 -------------------------------------------------------------------------------
 TOTAL: 5 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 Frr LSP(s) Found.
<span> An asterisk (*) before an LSP means the LSP is not established  An asterisk (*) before a Label means the USCB or DSCB is stale  An asterisk (*) before an UpstreamPeer means the session is stale  An asterisk (*) before a DS means the session is stale  An asterisk (*) before a NextHop means the LSP is FRR LSP</span></pre>
</p></li><li><span>Configure a VPN instance with the IPv4 address family enabled on each PE and bind the interface that connects a PE to a CE to the VPN instance on that PE.</span><p><p># Configure PE1. Configure vpn1 and specify its RD and VPN targets. The VPN targets configured on the local PE must match the VPN targets of the MP-BGP peer PE so that sites in the same VPN can communicate with each other.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<p># Bind the interface that connects PE1 to a CE to the VPN instance on PE1, and assign an IP address to the interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.2 30</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p># The configurations of PE2, PE3, and PE4 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display ip vpn-instance verbose</strong> command on PEs to check the configurations of VPN instances.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt;<strong> display ip vpn-instance verbose</strong>
Total VPN-Instances configured : 1
Total IPv4 VPN-Instances configured : 1 
Total IPv6 VPN-Instances configured : 0



 VPN-Instance Name and ID : vpn1, 1
  Interfaces : GigabitEthernet<span>0/1/0</span>
 Address family ipv4 
  Create date : 2020-10-09 07:28:20+00:00
  Up time : 0 days, 07 hours, 23 minutes and 53 seconds
  Vrf Status : UP
  Route Distinguisher : 100:1
  Export VPN Targets :  1:1
  Import VPN Targets :  1:1
  Label policy : label per instance
  Per-Instance Label : 48311
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe</pre>
</p></li><li><span>Configure EBGP on the PEs and CEs and import VPN routes.</span><p><p># Configure interface IP addresses on CEs, as shown in <a href="#EN-US_TASK_0172369460__fig_dc_vrp_mpls-l3vpn-v4_cfg_010601">Figure 1</a>. The detailed configuration is not mentioned here. For configuration details, see the configuration files.</p>
<p># On CE1, specify PE1 and PE2 as EBGP peers and import local loopback routes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>ip address 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.2.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-bgp] <strong>quit</strong></pre>
<p># On PE1, specify CE1 as an EBGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>peer 10.1.1.1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpn1] <strong>quit</strong></pre>
<p># On PE2, specify CE1 as an EBGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpn1]<strong> peer 10.2.1.1 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-vpn1] <strong>quit</strong></pre>
<p># On CE2, specify PE3 and PE4 as EBGP peers.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-LoopBack1] <strong>ip address 22.22.22.22 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>bgp 65420</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.3.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.4.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>network 22.22.22.22 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-bgp] <strong>quit</strong></pre>
<p># On PE3, specify CE2 as an EBGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-vpn1] <strong>peer 10.3.1.2 as-number 65420</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp-vpn1] <strong>quit</strong></pre>
<p># On PE4, specify CE2 as an EBGP peer.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp]<strong> ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-vpn1] <strong>peer 10.4.1.2 as-number 65420</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4-bgp-vpn1] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp vpnv4 vpn-instance</strong> <em>vpn-instance-name</em> <strong>peer</strong> command on PEs. The command output shows that BGP peer relationships have been established between PEs and CEs and are in the <strong>Established</strong> state.</p>
<p>The following example uses the peer relationship between PE1 and CE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 vpn-instance vpn1 peer</strong>

 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1

  Peer                 V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv

  10.1.1.1             4 65410      408      435     0 06:16:09 <strong>Established</strong>      5</pre>
<p>Each PE can successfully ping its connected CE. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>ping -vpn-instance vpn1 11.11.11.11</strong>
PING 11.11.11.11: 56  data bytes, press CTRL_C to break
    Reply from 11.11.11.11: bytes=56 Sequence=1 ttl=254 time=80 ms
    Reply from 11.11.11.11: bytes=56 Sequence=2 ttl=254 time=20 ms
    Reply from 11.11.11.11: bytes=56 Sequence=3 ttl=254 time=30 ms
    Reply from 11.11.11.11: bytes=56 Sequence=4 ttl=254 time=50 ms
    Reply from 11.11.11.11: bytes=56 Sequence=5 ttl=254 time=30 ms

  --- 11.11.11.11 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 20/42/80 ms</pre>
</p></li><li><span>Set up an MP-IBGP peer relationship between PEs.</span><p><p># On PE1, specify PE3 as the IBGP peer and establish an IBGP peer relationship between PE1 and PE3 through loopback interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.3 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<p># On PE3, specify PE1 as the IBGP peer and establish an IBGP peer relationship between PE3 and PE1 through loopback interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp] <strong>peer 1.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 1.1.1.1 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv4] <strong>peer 1.1.1.1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3-bgp-af-vpnv4] <strong>quit</strong></pre>
<p># On PE2, specify PE4 as the IBGP peer and establish an IBGP peer relationship between PE2 and PE4 through loopback interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp-af-vpnv4] <strong>quit</strong></pre>
<p># On PE4, specify PE2 as the IBGP peer and establish an IBGP peer relationship between PE4 and PE2 through loopback interfaces.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 2.2.2.2 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4-bgp-af-vpnv4] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp peer</strong> or <strong>display bgp vpnv4 all peer</strong> command on PEs. The command output shows that BGP peer relationships have been established between PEs.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp peer</strong>
 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 1          Peers in established state : 1
  Peer                V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv
  3.3.3.3             4   100        2        6     0 00:00:12 <strong>Established</strong>      0

&lt;PE1&gt; <strong>display bgp vpnv4 all peer</strong>
 BGP local router ID : 1.1.1.1
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv

  3.3.3.3         4   100       12       18     0 00:09:38 <strong>Established</strong>       0
  Peer of vpn instance:
  VPN-Instance vpn1, router ID 1.1.1.1:
  10.1.1.1        4 65410       25       25     0 00:17:57 Established       1</pre>
</p></li><li><span>On CE1, enable load balancing for the traffic from CE1 to CE2.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-bgp] <strong>ipv4-family unicast</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-bgp-af-ipv4] <strong>maximum load-balancing 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv4] <strong>commit</strong></pre>
</p></li><li><span>Configure a route-policy to increase the MED value of the BGP route advertised by PE3 to CE2 and ensure that the traffic from CE2 to CE1 passes through PE4. PE3 functions as a backup.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>route-policy policy1 permit node 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-route-policy] <strong>apply cost 120</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-route-policy] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp]<strong> ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-vpn1] <strong>peer 10.3.1.2 route-policy policy1 export</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-vpn1] <strong>commit</strong></pre>
<p>Check information about the BGP routing table on CE2. The command output shows that for the route to 11.11.11.11/32, the MED value advertised by PE3 is 120. This value is greater than the MED value advertised by PE4. Therefore, the MED value advertised by PE4 is chosen.</p>
<pre class="screen">&lt;CE2&gt; <strong>display bgp routing-table</strong>

 BGP Local router ID is 11.11.11.11
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
 RPKI validation codes: V - valid, I - invalid, N - not-found

 Total Number of Routes: 2
      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   11.11.11.11/32         10.4.1.1                              0      100 65410?
 *                           10.3.1.1        120                   0      100 65410?
 *&gt;   22.22.22.22/32         0.0.0.0         0                     0      ?</pre>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display ip routing-table</strong> command on CE1. The command output shows the routes to the users connected to CE2 and that traffic is transmitted in load balancing mode.</p>
<pre class="screen">&lt;CE1&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 12       Routes : 13

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

       10.1.1.0/30  Direct 0    0             D  10.1.1.1        Gigabitethernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0             D  127.0.0.1       Gigabitethernet<span>0/1/0</span>
     10.1.1.255/32  Direct 0    0             D  127.0.0.1       Gigabitethernet<span>0/1/0</span>
       10.2.1.0/30  Direct 0    0             D  10.2.1.1        Gigabitethernet<span>0/2/0</span>
       10.2.1.1/32  Direct 0    0             D  127.0.0.1       Gigabitethernet<span>0/2/0</span>
     10.2.1.255/32  Direct 0    0             D  127.0.0.1       Gigabitethernet<span>0/2/0</span>
    11.11.11.11/32  Direct 0    0             D  127.0.0.1       LoopBack1
    <strong>22.22.22.22/32</strong>  EBGP   255  0             D  10.1.1.2        Gigabitethernet<span>0/1/0</span>
                    EBGP   255  0             D  10.2.1.2        Gigabitethernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<p>Run the <strong>display ip routing-table</strong> command on CE2. The command output shows the routes to the users connected to CE1. The command output also shows that the next hop of the routes is 10.4.1.1, the IP address of the interface that connects PE4 to CE2.</p>
<pre class="screen">&lt;CE2&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 12       Routes : 12

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

    <strong>11.11.11.11/32</strong>  EBGP    255  0             D  10.4.1.1        Gigabitethernet<span>0/2/0</span>
    22.22.22.22/32  Direct 0    0             D  127.0.0.1         LoopBack1
       10.3.1.0/30  Direct 0    0             D  10.3.1.2        GigabitEthernet<span>0/1/0</span>
       10.3.1.2/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.3.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
       10.4.1.0/30  Direct 0    0             D  10.4.1.2        Gigabitethernet<span>0/2/0</span>
       10.4.1.2/32  Direct 0    0             D  127.0.0.1       Gigabitethernet<span>0/2/0</span>
     10.4.1.255/32  Direct 0    0             D  127.0.0.1       Gigabitethernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369460__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface Gigabitethernet<span>0/1/0</span>
 undo shutdown
ip address 10.1.1.1 255.255.255.252
#
interface Gigabitethernet<span>0/2/0</span>
 undo shutdown
ip address 10.2.1.1 255.255.255.252
#
interface Loopback1
 ip address 11.11.11.11 255.255.255.255
#
bgp 65410
 peer 10.1.1.2 as-number 100
 peer 10.2.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  maximum load-balancing 2
  peer 10.1.1.2 enable
  peer 10.2.1.2 enable
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0001.00
#
interface Gigabitethernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.1.1.2 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
 isis enable 1
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.3 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.3 enable
 #
 ipv4-family vpn-instance vpn1
  peer 10.1.1.1 as-number 65410
#
Return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:2
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0002.00
#
interface Gigabitethernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.2.1.2 255.255.255.252
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.20.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
 isis enable 1
#
bgp 100
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 4.4.4.4 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 4.4.4.4 enable
 #
 ipv4-family vpn-instance vpn1
  peer 10.2.1.1 as-number 65410
#
Return</pre>
</li><li><p>P1 configuration file</p>
<pre class="screen">#
sysname P1
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0005.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.30.1.1 255.255.255.252
 isis enable 1
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
 isis enable 1
#
Return</pre>
</li><li><p>P2 configuration file</p>
<pre class="screen">#
sysname P2
#
mpls lsr-id 6.6.6.6
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0006.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.20.1.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.40.1.1 255.255.255.252
 mpls
 mpls ldp
 isis enable 1
#
interface LoopBack1
 ip address 6.6.6.6 255.255.255.255
 isis enable 1
#
Return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:3
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0003.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.30.1.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 1
#
interface Gigabitethernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.3.1.1 255.255.255.252
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
 isis enable 1
#
bgp 100
 peer 1.1.1.1 as-number 100
 peer 1.1.1.1 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 1.1.1.1 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.1 enable
 #
 ipv4-family vpn-instance vpn1
  peer 10.3.1.2 as-number 65420
  peer 10.3.1.2 route-policy policy1 export
#
route-policy policy1 permit node 10
 apply cost 120
#
Return</pre>
</li><li><p>PE4 configuration file</p>
<pre class="screen">#
sysname PE4
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:4
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls ldp
#
isis 1
 network-entity 10.0000.0000.0004.00
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.40.1.2 255.255.255.252
 mpls
 mpls ldp
 isis enable 1
#
interface Gigabitethernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.4.1.1 255.255.255.252
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
 isis enable 1
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.2 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.2 enable
 #
 ipv4-family vpn-instance vpn1
  peer 10.4.1.2 as-number 65420
#
Return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface Gigabitethernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.252
#
interface Gigabitethernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.252
#
interface Loopback1
 ip address 22.22.22.22 255.255.255.255
#
bgp 65420
 peer 10.3.1.1 as-number 100
 peer 10.4.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.3.1.1 enable
  peer 10.4.1.1 enable
#
Return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2006.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0107.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>