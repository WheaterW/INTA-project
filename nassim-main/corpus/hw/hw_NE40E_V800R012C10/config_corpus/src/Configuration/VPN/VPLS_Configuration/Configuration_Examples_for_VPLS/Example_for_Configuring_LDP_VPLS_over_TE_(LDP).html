
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring LDP VPLS over TE (LDP)">
<meta name="abstract" content="A public network tunnel on an LDP VPLS network can be an MPLS TE tunnel.">
<meta name="description" content="A public network tunnel on an LDP VPLS network can be an MPLS TE tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6053.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5080.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370248">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring LDP VPLS over TE (LDP)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370248"></a><a name="EN-US_TASK_0172370248"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring LDP VPLS over TE (LDP)</h1>
<div class="taskbody"><p>A public network tunnel on an LDP VPLS network can be an MPLS TE tunnel.</p>
<div class="context"><a name="EN-US_TASK_0172370248__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370248__fig_dc_vrp_vpls_cfg_503101">Figure 1</a>, CE1 and CE2 belong to the same VPLS network and access the MPLS backbone network through PE1 and PE2, respectively. OSPF is used as the IGP on the MPLS backbone network.</p>
<p>It is required that LDP VPLS and the dynamic signaling protocol RSVP-TE be used to establish an MPLS TE tunnel between PE1 and PE2 to transmit VPLS services.</p>
<div class="fignone" id="EN-US_TASK_0172370248__fig_dc_vrp_vpls_cfg_503101"><a name="EN-US_TASK_0172370248__fig_dc_vrp_vpls_cfg_503101"></a><a name="fig_dc_vrp_vpls_cfg_503101"></a><span class="figcap"><b>Figure 1 </b>Configuring VPLS over TE (LDP)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, subinterface1.1, and subinterface2.1 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, GE<span>0/1/0</span>.1, and GE<span>0/2/0</span>.1, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_503101.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370248__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>During the configuration, note the following:</p>
<ul><li>PEs belonging to the same VPLS network must have the same VSI ID.</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370248__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure a routing protocol on the PEs and P of the backbone network for connectivity between these devices and enable MPLS on them.</p>
</li><li><p>Set up an MPLS TE tunnel and configure the tunnel policy. For details on how to set up an MPLS TE tunnel, see<em> <span class="keyword">NE40E</span> Configuration Guide - MPLS</em>.</p>
</li><li><p>Enable MPLS L2VPN on PEs.</p>
</li><li><p>Create VSIs, set the signaling protocol to LDP, and bind AC interfaces to VSIs on PEs.</p>
</li><li><p>Configure the VSI to use an MPLS TE tunnel.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370248__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>OSPF areas enabled with TE</p>
</li><li><p>VSI names and IDs</p>
</li><li><p>Peer IP addresses and tunnel policies</p>
</li><li><p>Interfaces bound to VSIs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370248__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign IP addresses to interfaces and configure OSPF.</span><p><p>For detailed configurations, see Configuration Files.</p>
</p></li><li><span>Configure MPLS, MPLS TE, MPLS RSVP-TE, and MPLS CSPF.</span><p><p>Enable MPLS, MPLS TE, and MPLS RSVP-TE both globally and on specific interfaces on each node along the MPLS TE tunnel. Enable MPLS TE CSPF in the system view of the tunnel's ingress.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls]<strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> interface gigabitethernet</strong><span>0/2/0</span></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>mpls te cspf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> mpls rsvp-te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure OSPF TE on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> network 1.1.1.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0]<strong> mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1]<strong> area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 2.2.2.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0]<strong> network 10.10.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 10.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> ospf</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 10.20.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0]<strong> mpls-te enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure a tunnel interface on each device.</span><p><p># Create tunnel interfaces on PEs and specify MPLS TE as the tunnel protocol and RSVP-TE as the signaling protocol.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10]<strong> ip address unnumbered interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10]<strong> destination 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10]<strong> mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10]<strong> mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface Tunnel 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10]<strong> ip address unnumbered interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10]<strong> tunnel-protocol mpls te</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10]<strong> destination 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10]<strong> mpls te tunnel-id 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10]<strong> mpls te reserved-for-binding</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Tunnel10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <strong>display this interface</strong> command in the tunnel interface view. The command output shows that <strong>Line protocol current state</strong> is <strong>UP</strong>, indicating that an MPLS TE tunnel has been established. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Tunnel10] <strong>display this interface</strong></pre>
<pre class="screen">Tunnel10 current state : UP (ifindex: 20)
<strong>Line protocol current state : UP</strong>
Last line protocol up time : 2012-09-11 08:25:42
Description:
Route Port,The Maximum Transmit Unit is 1500
Internet Address is unnumbered, using address of LoopBack1(1.1.1.9/32)
Encapsulation is TUNNEL, loopback not set
Tunnel destination 3.3.3.9
Tunnel up/down statistics 1
Tunnel protocol/transport MPLS/MPLS, ILM is available,
primary tunnel id is 0x33, secondary tunnel id is 0x0
Current system time: 2012-09-11 08:27:00
    0 seconds output rate 0 bits/sec, 0 packets/sec
    0 seconds output rate 0 bits/sec, 0 packets/sec
    0 packets output,  0 bytes
    0 output error
    0 output drop
    Last 300 seconds input utility rate:  0.00%
    Last 300 seconds output utility rate: 0.00% </pre>
<p>Run the <strong>display tunnel-info all</strong> command in the system view. The command output shows that the TE tunnel whose destination address is the MPLS LSR ID of the peer PE exists. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display tunnel-info all</strong></pre>
<pre class="screen">Tunnel ID                     Type                Destination         Status
-----------------------------------------------------------------------------
0x000000000300000001          te                  3.3.3.9             UP</pre>
</p></li><li><span>Configure remote LDP sessions.</span><p><p>Set up a remote peer session between PE1 and PE2.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp remote-peer 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.9]<strong> remote-ip 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.9]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls ldp remote-peer 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.9]<strong> remote-ip 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.9]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure a tunnel policy.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1]<strong> tunnel binding destination 3.3.3.9 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-policy1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1]<strong> tunnel binding destination 1.1.1.9 te Tunnel10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-policy1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Create a VSI on each PE and configure a tunnel policy for the VSI.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp]<strong> peer 3.3.3.9 tnl-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-a2-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2]<strong> pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp]<strong> vsi-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp]<strong> peer 1.1.1.9 tnl-policy policy1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-a2-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Bind interfaces to VSIs on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface gigabitethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1]<strong> l2 binding vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> interface gigabitethernet<span>0/2/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> l2 binding vsi a2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1]<strong> ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> interface gigabitethernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1]<strong> ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, run the <strong>display vsi name a2 verbose</strong> command on PE1. The command output shows that a VSI named <strong>a2</strong> has set up a PW to PE2 and <strong>VSI State</strong> is <strong>up</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi name a2 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : a2
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : ldp
    Member Discovery Style : --
<span>    Bridge-domain Mode     : disable</span>
<span>    PW MAC Learning Style  : unqualify</span>
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 1 days, 8 hours, 46 minutes, 34 seconds
    <strong>VSI State              : up</strong>
<span>    Resource Status        : --</span>

    VSI ID                 : 2
   *Peer Router ID         : 3.3.3.9
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 18
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x000000000300000001
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Tunnel Policy Name     : policy1
    CKey                   : 33
    NKey                   : 1610612843
<span>    Stp Enable             : 0</span>
    PwIndex                : 0
<span>    Control Word           : disable</span>

    Interface Name         : GigabitEthernet<span>0/2/0</span>.1
    State                  : up
    Access Port            : false
    Last Up Time           : 2012/09/10 10:14:46
    Total Up Time          : 1 days, 8 hours, 41 minutes, 37 seconds

  **PW Information:

   *Peer Ip Address        : 3.3.3.9
    PW State               : up
    Local VC Label         : 18
    Remote VC Label        : 18
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x000000000300000001
    Broadcast Tunnel ID    : --
    Broad BackupTunnel ID  : --
    Ckey                   : 33
    Nkey                   : 1610612843
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : te
    OutInterface           : Tunnel10
    Backup OutInterface    : --
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/09/11 09:19:12
    PW Total Up Time       : 1 days, 6 hours, 52 minutes, 3 seconds </pre>
<p>Run the <strong>display mpls lsp include 3.3.3.9 32 verbose</strong> command on PE1. The command output shows information about the LSP to 3.3.3.9/32.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls lsp include 3.3.3.9 32 verbose</strong></pre>
<pre class="screen">----------------------------------------------------------------------
                 LSP Information: RSVP LSP
----------------------------------------------------------------------
  No                  :  1
  SessionID           :  100
  IngressLsrID        :  1.1.1.9
  LocalLspID          :  1
  Tunnel-Interface    :  Tunnel10
  Fec                 :  3.3.3.9/32
  Nexthop             :  10.10.1.2
  In-Label            :  NULL
  Out-Label           :  97
  In-Interface        :  ----------
  Out-Interface       :  GigabitEthernet<span>0/1/0</span>
  LspIndex            :  33
  Token               :  ----------
  LsrType             :  Ingress
  Mpls-Mtu            :  1500
  LspAge              :  4739 sec</pre>
<p>Run the <strong>display vsi pw out-interface vsi a2</strong> command on PE1. The command output shows that the outbound interface of the MPLS TE tunnel between 1.1.1.9 and 3.3.3.9 is Tunnel10.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi pw out-interface vsi a2</strong></pre>
<pre class="screen">Total: 1
--------------------------------------------------------------------------------
Vsi Name                        peer            vcid       interface
--------------------------------------------------------------------------------
a2                              3.3.3.9         2          Tunnel10</pre>
<p>CE1 and CE2 can ping each other.</p>
<pre class="screen">&lt;CE1&gt; <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">  PING 10.1.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=125 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=125 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=94 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=125 ms</pre>
<pre class="screen">    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=125 ms</pre>
<pre class="screen">  --- 10.1.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 94/118/125 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370248__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.1 255.255.255.0
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.9
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
mpls l2vpn
#
vsi a2 
 pwsignal ldp
  vsi-id 2
  peer 3.3.3.9 tnl-policy policy1
#
mpls ldp
#
mpls ldp remote-peer 3.3.3.9
 remote-ip 3.3.3.9
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi a2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.0
 ospf cost 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 3.3.3.9
 mpls te tunnel-id 100
 mpls te reserved-for-binding
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
  mpls-te enable
#
tunnel-policy policy1
 tunnel binding destination 3.3.3.9 te Tunnel10
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 2.2.2.9
#
mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
 ospf cost 1
 mpls
 mpls te
 mpls rsvp-te
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.20.1.1 255.255.255.0
 ospf cost 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
  network 10.20.1.0 0.0.0.255
  mpls-te enable
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.9
#
mpls
 mpls te
 mpls rsvp-te
 mpls te cspf
#
mpls l2vpn
#
vsi a2 
 pwsignal ldp
  vsi-id 2
  peer 1.1.1.9 tnl-policy policy1
#
mpls ldp
#
mpls ldp remote-peer 1.1.1.9
 remote-ip 1.1.1.9
#
interface GigabitEthernet<span>0/2/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 l2 binding vsi a2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.20.1.2 255.255.255.0
 ospf cost 1
 mpls
 mpls te
 mpls rsvp-te
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
interface Tunnel10
 ip address unnumbered interface LoopBack1
 tunnel-protocol mpls te
 destination 1.1.1.9
 mpls te tunnel-id 100
 mpls te reserved-for-binding
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.20.1.0 0.0.0.255
  mpls-te enable
#
tunnel-policy policy1
 tunnel binding destination 1.1.1.9 te Tunnel10
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
 sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>.1
 undo shutdown
 vlan-type dot1q 10
 ip address 10.1.1.2 255.255.255.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6053.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5080.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>