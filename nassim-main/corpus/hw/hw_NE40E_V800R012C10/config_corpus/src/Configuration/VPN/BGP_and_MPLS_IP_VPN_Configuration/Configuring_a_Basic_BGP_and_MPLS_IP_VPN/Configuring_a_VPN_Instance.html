
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a VPN Instance">
<meta name="abstract" content="A VPN instance can be configured on a PE to manage VPN routes.">
<meta name="description" content="A VPN instance can be configured on a PE to manage VPN routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0154.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0156.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369253">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a VPN Instance</title>
</head>
<body><a name="EN-US_TASK_0172369253"></a><a name="EN-US_TASK_0172369253"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a VPN Instance</h1>
<div class="taskbody"><p>A VPN instance can be configured on a PE to manage VPN routes.</p>
<div class="context"><a name="EN-US_TASK_0172369253__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>An instance is created to comprise the VPN forwarding information for each VPN in a BGP/MPLS IP VPN. This instance is called a VPN instance or a VPN routing and forwarding (VRF) table. In related standards, a VPN instance is called a per-site forwarding table.</p>
<p>VPN instances are used to isolate VPN routes from public network routes. Routes of different VPN instances are isolated from one another. VPN instances need to be configured in all types of BGP/MPLS IP VPN networking solutions.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369253__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run the <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a> command to enter the system view.</span></li><li><span>Run the <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172369253__cmdname1527422627214049">ip vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172369253__varname434476869214049">vpn-instance-name</span></i> command to create a VPN instance and enter its view.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The name of a VPN instance is case sensitive. For example, <strong>vpn1</strong> and <strong>VPN1</strong> are considered different VPN instances.</p>
</div></div>
<p>PEs do not have default VPN instances. Multiple VPN instances can be created on a PE.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-information</span></i> command to configure a description for the VPN instance.</span><p><p>Similar to a host name or an interface description, the VPN instance description helps users memorize the VPN instance.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=service-id"><b><span class="cmdname">service-id</span></b></a> <i><span class="varname">id</span></i> command to create a service ID for the VPN instance. </span><p><p>A service ID is unique on a device. It distinguishes a VPN service from other VPN services on the network.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=vpn-id"><b><span class="cmdname">vpn-id</span></b></a> <i><span class="varname">vpn-id</span></i> command to configure a VPN ID. You can run the <a href="cmdqueryname=vpn-id"><b><span class="cmdname">vpn-id</span></b></a> command to create a globally unique ID for a VPN instance based on the plan. In a CU separation scenario, you can run the <a href="cmdqueryname=vpn-id"><b><span class="cmdname">vpn-id</span></b></a> command to set the same VPN ID for the control plane and forwarding plane, preventing VPN ID inconsistency.</span></li><li><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname" id="EN-US_TASK_0172369253__cmdname1443863054214049">ipv4-family</span></b></a> command to enable the VPN instance IPv4 address family and enter its view.</span><p><p>The VPN instance configuration can be performed only after an address family is configured based on the types of routes to be advertised and data to be forwarded.</p>
</p></li><li><span>Run the <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname" id="EN-US_TASK_0172369253__cmdname1760621200214049">route-distinguisher</span></b></a> <i><span class="varname" id="EN-US_TASK_0172369253__varname191997997214049">route-distinguisher</span></i> command to configure an RD for the VPN instance IPv4 address family.</span><p><p>A VPN instance IPv4 address family takes effect only after being assigned an RD. The RDs of different VPN instance IPv4 address families on a PE must be different.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>If you set an RD for the VPN instance IPv4 address family directly after you create a VPN instance and enter its view, the VPN instance IPv4 address family is automatically enabled and its view is displayed.</p>
</li><li>If a large number of VPN instances need to be created and a large number of RDs need to be planned, run the <a href="cmdqueryname=route+route-distinguisher+auto"><b><span class="cmdname">route route-distinguisher auto</span></b></a> <i><span class="varname">rd-ip</span></i> command in the system view to enable automatic RD allocation and set the <i><span class="varname">rd-ip</span></i> parameter to an IPv4 address. Then the device can assign RDs in the format of <em>X.X.X.X:index</em> to all VPN instances that are not assigned RDs. The value of <em>index</em> is a 2-byte value automatically assigned in a range of 1 to 65535. Automatic RD allocation applies to VPN instances without manually configured RDs. If an RD has been configured for the IPv4 or IPv6 address family of a VPN instance using the <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i> command, the device will not dynamically allocate a new RD to that address family of the VPN instance.</li></ul>
</div></div>
</p></li><li><span>Run the <a href="cmdqueryname=vpn-target"><b><span class="cmdname" id="EN-US_TASK_0172369253__cmdname1521053128214049">vpn-target</span></b></a> <i><span class="varname" id="EN-US_TASK_0172369253__varname1842977158214049">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span id="EN-US_TASK_0172369253__cmdparmname1203555322214049">both</span></strong> | <strong><span id="EN-US_TASK_0172369253__cmdparmname1845455024214049">export-extcommunity</span></strong> | <strong><span id="EN-US_TASK_0172369253__cmdparmname12804966214049">import-extcommunity</span></strong> ] command to configure VPN targets for the VPN instance IPv4 address family. </span><p><p>VPN targets are a type of BGP extended community attribute used to control the import and export of VPN routes. A maximum of eight VPN targets can be configured using the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> command. If you want to configure more VPN targets in the VPN instance IPv4 address family view, repeatedly run the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> command.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=prefix+limit"><b><span class="cmdname">prefix limit</span></b></a> <i><span class="varname">number</span></i> { <i><span class="varname">alert-percent</span></i> [ <strong><span>route-unchanged</span></strong> ] | <strong><span>simply-alert</span></strong> } command to configure the maximum number of route prefixes supported by the VPN instance IPv4 address family.</span><p><div class="p">The configuration restricts the number of route prefixes imported from the CEs and peer PEs into a VPN instance IPv4 address family on a local PE, preventing the local PE from receiving too many route prefixes.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In the scenario where the number of route prefixes exceeds a specified maximum number, after the <a href="cmdqueryname=prefix+limit"><b><span class="cmdname">prefix limit</span></b></a> command is run to increase the allowed maximum number of route prefixes in a VPN instance IPv4 address family or the <a href="cmdqueryname=undo+prefix+limit"><b><span class="cmdname">undo prefix limit</span></b></a> command is run to delete the maximum number, the device adds excess route prefixes of various protocols to the VPN IP routing table.</p>
<p>After the number of route prefixes exceeds the maximum number, direct and static routes can still be added to the routing table of the VPN instance IPv4 address family.</p>
</div></div>
</div>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to apply an import route-policy to the VPN instance IPv4 address family.</span><p><p>In addition to using VPN targets to control VPN route import and export, an import route-policy can be configured to better control VPN route import. The import route-policy filters the routes to be imported to the VPN instance IPv4 address family or modify route attributes.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i><span> [ <strong><span>add-ert-first</span></strong> ]</span> command to apply an export route-policy to the VPN instance IPv4 address family.</span><p><p>In addition to using VPN targets to control VPN route import and export, an export route-policy can be configured to better control VPN route export. The export route-policy filters routes to be advertised to other PEs or modify route attributes.</p>
<p>By default, export VPN targets are added to VPN routes after these routes match an export route-policy. If the export route-policy contains VPN target-related filtering rules, the route-policy cannot apply to these routes. To prevent such rule-induced failures, configure the <strong><span>add-ert-first</span></strong> parameter to instruct the device to add export VPN targets to VPN routes before these routes are matched against the export route-policy.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=import+route-filter"><b><span class="cmdname">import route-filter</span></b></a> <i><span class="varname">route-filter-name</span></i> command to apply an import route-filter to the VPN instance IPv4 address family.</span><p><p>In addition to using VPN targets to control VPN route import and export, an import route-filter can be configured to better control VPN route import. The import route-filter filters the routes to be imported to the VPN instance IPv4 address family or modifies route attributes.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=export+route-filter"><b><span class="cmdname">export route-filter</span></b></a> <i><span class="varname">route-filter-name</span></i> [ <strong><span>add-ert-first</span></strong> ] command to apply an export route-filter to the VPN instance IPv4 address family.</span><p><p>In addition to using VPN targets to control VPN route import and export, an export route-filter can be configured to better control VPN route export. The export route-filter filters routes to be advertised to other PEs or modifies route attributes.</p>
<p>By default, export VPN targets are added to VPN routes after these routes match an export route-filter. If the export route-filter contains VPN target-related filtering rules, the route-filter cannot apply to these routes. To prevent such rule-induced failures, configure <strong><span>add-ert-first</span></strong> to instruct the device to add export VPN targets to VPN routes before these routes are matched against the export route-filter.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to apply a tunnel policy to the VPN instance IPv4 address family.</span><p><p>A tunnel can be specified for IPv4 VPN data forwarding using a tunnel policy that is applied to a VPN instance IPv4 address family.</p>
</p></li><li><span>(Optional) Run the <a href="cmdqueryname=apply-label+per-instance+static"><b><span class="cmdname">apply-label per-instance static</span></b></a> <i><span class="varname">static-label-value</span></i> command to configure all routes to be advertised to the peer PEs in the current VPN instance IPv4 address family to use the same static label. </span><p><p>In a VPN scenario where a CE is multi-homed to PEs for load balancing, this command allows VPNv4 routes sent by a downstream device to carry the same static label so that traffic can be load-balanced for the downstream device.</p>
</p></li><li><span>(Optional) Configure a label distribution mode for the VPN instance IPv4 address family.</span><p><ul><li>Run the <a href="cmdqueryname=apply-label+pop-go"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> } <strong><span>pop-go</span></strong> command to configure the VPN instance IPv4 address family to assign a label to each route or routes with the same next hop before the routes are sent to a peer PE. After receiving a data packet with the label, the peer PE removes the label, searches the ILM table for an outbound interface, and forwards the packet through the outbound interface.</li><li>Run the <a href="cmdqueryname=apply-label"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-instance</span></strong> | <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> } command to configure a label distribution mode for the VPN instance IPv4 address family.</li></ul>
<p>The <a href="cmdqueryname=apply-label"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> } <strong><span>pop-go</span></strong> command is mutually exclusive with the <a href="cmdqueryname=apply-label"><b><span class="cmdname">apply-label</span></b></a> { <strong><span>per-instance</span></strong> | <strong><span>per-nexthop</span></strong> | <strong><span>per-route</span></strong> } command. If you run both commands, the later configuration overrides the previous one.</p>
</p></li><li><span>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</span></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0154.html">Configuring a Basic BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0156.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>