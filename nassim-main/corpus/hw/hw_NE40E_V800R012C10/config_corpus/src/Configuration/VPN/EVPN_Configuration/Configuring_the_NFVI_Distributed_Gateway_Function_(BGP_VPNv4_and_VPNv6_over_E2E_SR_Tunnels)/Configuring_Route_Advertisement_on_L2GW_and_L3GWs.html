
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Route Advertisement on L2GW/L3GWs">
<meta name="abstract" content="Route advertisement allows L2GW/L3GWs to construct their own forwarding entries based on received EVPN or BGP routes.">
<meta name="description" content="Route advertisement allows L2GW/L3GWs to construct their own forwarding entries based on received EVPN or BGP routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0131.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0133.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0135.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370584">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Route Advertisement on L2GW/L3GWs</title>
</head>
<body><a name="EN-US_TASK_0172370584"></a><a name="EN-US_TASK_0172370584"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Route Advertisement on L2GW/L3GWs</h1>
<div class="taskbody"><p>Route advertisement allows L2GW/L3GWs to construct their own forwarding entries based on received EVPN or BGP routes.</p>
<div class="steps"><a name="EN-US_TASK_0172370584__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure L2GW/L3GWs to generate ARP or ND entries for Layer 2 forwarding based on the ARP or ND information in EVPN routes.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i></span><p><p>A VBDIF interface is created, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Configure L2GW/L3GWs to generate ARP or ND entries for Layer 2 forwarding based on the ARP or ND information in EVPN routes.</span><p><ul><li><p>Run the <a href="cmdqueryname=arp+generate-rd-table+enable"><b><span class="cmdname">arp generate-rd-table enable</span></b></a> command to configure the L2GW/L3GW to generate ARP entries for Layer 2 forwarding based on the ARP information in EVPN routes.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6+nd+generate-rd-table+enable"><b><span class="cmdname">ipv6 nd generate-rd-table enable</span></b></a> command to configure the L2GW/L3GW to generate ND entries for Layer 2 forwarding based on the ND information in EVPN routes.</p>
</li></ul>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ipv6+nd+dad+attempts"><b><span class="cmdname">ipv6 nd dad attempts</span></b></a> <strong>0</strong></span><p><p>DAD is prohibited. This command is mandatory in IPv6 scenarios to prevent service interruptions occurred because the system detects that the IPv6 address of another device is the same as the VBDIF interface's IP address.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VBDIF interface view.</p>
</p></li></ol>
</li><li><span>Configure the L3VPN instance on L2GW/L3GWs to advertise the static VPN routes destined for VNFs to EVPN.</span><ol type="a"><li class="substepexpand"><span>Create a route-policy to filter the locally generated static VPN routes destined for VNFs. For detailed configurations, see <a href="dc_vrp_route-policy_cfg_0007.html">Configuring a Route-Policy</a>. During the configuration of an apply clause, run the <a href="cmdqueryname=apply+gateway-ip"><b><span class="cmdname">apply gateway-ip</span></b></a> { <strong><span>origin-nexthop</span></strong> | <i><span class="varname">ipv4-address</span></i> } or <a href="cmdqueryname=apply+ipv6+gateway-ip"><b><span class="cmdname">apply ipv6 gateway-ip</span></b></a> { <strong><span>origin-nexthop</span></strong> | <i><span class="varname">ipv6-address</span></i> } command to specify the original next hop address of a static VPN route as a gateway address.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The VPN instance view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> command to enter the VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> command to enter the VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>evpn</span></strong></span><p><p>An export route-policy is applied to the L3VPN instance, so that the L3VPN instance can filter routes to be advertised to EVPN. This ensures that the L3VPN instance advertises only static VPN routes reachable to VNFs to EVPN.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance IPv4 or IPv6 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the VPN instance view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the BGP-VPN instance IPv4 or IPv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> command to enter the BGP-VPN instance IPv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> <strong><span>static</span></strong> [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span><p><p>Static routes are imported into the routing table for the BGP-VPN instance IPv4 or IPv6 address family.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a> [ <strong><span>import-route-multipath</span></strong> ]</span><p><p>The function to advertise IP routes from the VPN instance to the EVPN instance is enabled. If the load balancing function needs to be deployed on the network, specify the <strong><span>import-route-multipath</span></strong> parameter so that the VPN instance can advertise all the routes with the same destination address to the EVPN instance.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=irb+asymmetric"><b><span class="cmdname">irb asymmetric</span></b></a></span><p><p>The asymmetric mode is enabled for IRB routes. If L2GW/L3GWs are configured to advertise ARP or ND routes to each other, skip this step. If L2GW/L3GWs are configured to advertise IRB or IRBv6 routes to each other, perform this step so that L2GW/L3GWs do not generate IP prefix routes. This prevents routing loops.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-VPN instance IPv4 or IPv6 address family view.</p>
</p></li></ol>
</li><li><span>Configure the function to regenerate routes for PEs. Specifically, configure the function to regenerate IP prefix routes as VPNv4/VPNv6 routes.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+import+reoriginate"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>import reoriginate</span></strong></span><p><p>The function to add the regeneration flag to the routes received from the DCGWs is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-EVPN address family view.</p>
</p></li><li class="substepexpand"><span>Enter the BGP-VPNv4/VPNv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong> command to enter the BGP-VPNv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpnv6</span></strong> command to enter the BGP-VPNv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise route-reoriginated evpn</span></strong> { <strong><span>mac-ip</span></strong> | <strong><span>ip</span></strong> | <strong><span>mac-ipv6</span></strong> | <strong><span>ipv6</span></strong> }</span><p><p>The function to advertise the routes re-originated by the EVPN address family to a BGP VPNv4/VPNv6 peer is enabled.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-VPNv4/VPNv6 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li><span>(Optional) Configure a route-policy to allow L2GW/L3GWs to send only the UE routes generated by the directly connected VNFs to PEs. This step is mandatory if a VNF is directly connected to only one L2GW/L3GW. Ensure that this L2GW/L3GW can receive the UE routes generated by the directly connected VNF only from DCGWs.</span><ol type="a"><li class="substepexpand"><span>Create a route-policy to filter the UE routes generated by a locally directly connected VNF. For details about how to create a route-policy, see <a href="dc_vrp_route-policy_cfg_0007.html">Configuring a Route-Policy</a>.</span></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Enter the BGP-VPNv4/VPNv6 address family view.</span><p><ul><li><p>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpnv4</span></strong> command to enter the BGP-VPNv4 address family view.</p>
</li><li><p>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpnv6</span></strong> command to enter the BGP-VPNv6 address family view.</p>
</li></ul>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+route-policy+export"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">group-name</span></i> | <i><span class="varname">ipv4-address</span></i> } <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> <strong><span>export</span></strong></span><p><p>An export route-policy is applied to the routes destined for PEs.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP-VPNv4/VPNv6 address family view.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span><p><p>Exit the BGP view.</p>
</p></li></ol>
</li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0131.html">Configuring the NFVI Distributed Gateway Function (BGP VPNv4/VPNv6 over E2E SR Tunnels)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0133.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0135.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>