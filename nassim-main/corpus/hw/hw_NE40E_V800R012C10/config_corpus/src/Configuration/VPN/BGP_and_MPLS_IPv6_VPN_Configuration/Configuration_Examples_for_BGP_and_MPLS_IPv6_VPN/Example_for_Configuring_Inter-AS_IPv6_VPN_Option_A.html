
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS IPv6 VPN Option A">
<meta name="abstract" content="This section provides an example for deploying an IPv6 VPN instance on ASBRs to implement inter-AS IPv6 VPN Option A, also called VRF-to-VRF.">
<meta name="description" content="This section provides an example for deploying an IPv6 VPN instance on ASBRs to implement inter-AS IPv6 VPN Option A, also called VRF-to-VRF.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2043.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2050.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IPv6 VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369714">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-AS IPv6 VPN Option A</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369714"></a><a name="EN-US_TASK_0172369714"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS IPv6 VPN Option A</h1>
<div class="taskbody"><p>This section provides an example for deploying an IPv6 VPN instance on ASBRs to implement inter-AS IPv6 VPN Option A, also called VRF-to-VRF.</p>
<div class="context"><a name="EN-US_TASK_0172369714__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Inter-AS IPv6 VPN Option A can be deployed if IPv6 VPN services need to be provided to customers across ASs on a carrier's backbone network.</p>
<p>It is easy to configure inter-AS IPv6 VPN Option A. You only need to configure an IPv6-address-family-supporting VPN instance on each ASBR and configure the ASBRs to view each other as a CE. If the services of many VPNs need to be transmitted across ASs, the requirements for ASBR performance will be high.</p>
<p>As shown in <a href="#EN-US_TASK_0172369714__fig_dc_vrp_mpls-l3vpn-v6_cfg_204901">Figure 1</a>, CE1 and CE2 belong to the same VPN. CE1 accesses PE1 in AS100; CE2 accesses PE2 in AS200.</p>
<p>It is required that Option A be configured to implement inter-AS IPv6 VPN so that CE1 and CE2 can access each other.</p>
<div class="fignone" id="EN-US_TASK_0172369714__fig_dc_vrp_mpls-l3vpn-v6_cfg_204901"><a name="EN-US_TASK_0172369714__fig_dc_vrp_mpls-l3vpn-v6_cfg_204901"></a><a name="fig_dc_vrp_mpls-l3vpn-v6_cfg_204901"></a><span class="figcap"><b>Figure 1 </b>Configuring inter-AS VPN Option A</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0229044818.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369714__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Establish EBGP peer relationships between PEs and CEs and establish MP-IBGP peer relationships between the PEs and ASBRs.</p>
</li><li><p>Configure an IPv6-address-family-supporting VPN instance and bind the VPN instance to the interface connecting to the peer ASBR on each ASBR.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369714__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and ASBRs</p>
</li><li><p>Name of the IPv6-address-family-supporting VPN instance configured on each PE and ASBR, and the RD and VPN targets of the VPN instance</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369714__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IGP on the MPLS backbone networks in AS100 and AS200 for IP connectivity between the ASBR and the PE within each MPLS backbone network.</span><p><p>This example uses OSPF as the IGP. For configuration details, see <a href="#EN-US_TASK_0172369714__example71757200214051">Configuration Files</a> in this section.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The 32-bit IP address of the loopback interface that functions as the LSR ID needs to be advertised by using OSPF.</p>
</div></div>
<p>After the configurations are complete, the OSPF neighbor relationship can be established between the ASBR and the PE in the same AS. Run the <strong>display ospf peer</strong> command. The command output shows that the neighbor relationship is in the <strong>Full</strong> state.</p>
<p>The ASBR and PE in the same AS can learn the LSR ID (IP address of Loopback1) of each other and ping each other successfully.</p>
</p></li><li><span>Configure MPLS and MPLS LDP both globally and per interface on each node of the MPLS backbone networks in AS100 and AS200 and set up LDP LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface gigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1]<strong> mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> interface gigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Configure ASBR2.</p>
<pre class="screen">&lt;ASBR2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2]<strong> mpls lsr-id 3.3.3.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-mpls]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2]<strong> interface gigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface gigabitEthernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p>After the configurations are complete, an LDP peer relationship can be set up between the PE and the ASBR in the same AS. Run the <strong>display mpls ldp session</strong> command on each device. The command output shows that the session state is <strong>Operational</strong>.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp session</strong>

 LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted. </span>
-------------------------------------------------------------------------- 
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
-------------------------------------------------------------------------- 
2.2.2.9:0          <strong>Operational</strong> DU   Passive  0000:00:02  9/9
--------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.</pre>
</p></li><li><span>Configure a basic BGP/MPLS IPv6 VPN in AS100 and AS200.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The VPN targets of the IPv6-address-family-supporting VPN instance configured on the ASBR and the PE in the same AS must match. This is not required for the PEs in different ASs.</p>
</div></div>
<p># Configure CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8:1::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>router-id 10.10.10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 2001:db8:1::2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp]<strong> ipv6-family unicast</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>peer 2001:db8:1::2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE1 to set up an EBGP peer relationship with CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:db8:1::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpn1] <strong>peer 2001:db8:1::1 as-number 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE1 to set up an MP-IBGP peer relationship with ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 2.2.2.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure ASBR1 to set up an MP-IBGP peer relationship with PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv6-family vpnv6</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configurations of CE2, PE2, and ASBR2 are similar to the configurations of CE1, PE1, and ASBR1 respectively. For configuration details, see <a href="#EN-US_TASK_0172369714__example71757200214051">Configuration Files</a> in this section.</p>
</div></div>
<p>After completing the configurations, run the <strong>display bgp vpnv6 vpn-instance peer</strong> command on PEs. The command output shows that the BGP peer relationships between the PEs and the CEs are in the <strong>Established</strong> state. Run the <strong>display bgp vpnv6 all peer</strong> command on the PE or ASBR. The command output shows that the BGP peer relationship is established between the PEs and the CEs, and between the PEs and ASBRs.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv6 vpn-instance vpn1 peer</strong>

 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1                 Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv

  <strong>2001:db8:1::1</strong>  4 65001       14       12     0 00:08:36 <strong>Established</strong>       1</pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display bgp vpnv6 all peer</strong>

 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 2                 Peers in established state : 2

  Peer            V    AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv

  2.2.2.9         4   100       13       12     0 00:09:10 Established       0

    Peer of vpn instance :

  VPN-Instance vpn1, router ID 1.1.1.9:
  2001:db8:1::1   4 65001       17       14     0 00:11:09 Established       1</pre>
</p></li><li><span>Configure inter-AS VPN in VRF-to-VRF mode.</span><p><p># Create an IPv6-address-family-supporting VPN instance on ASBR1 and bind the interface that connects ASBR1 to ASBR2 (viewed as a CE by ASBR1) to the VPN instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-vpn-instance-vpn1] <strong>ipv6-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface gigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:db8:3::1 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Create an IPv6-address-family-supporting VPN instance on ASBR2 and bind the interface that connects ASBR2 to ASBR1 (viewed as a CE by ASBR2) to the VPN instance.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2] <strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-vpn-instance-vpn1] <strong><strong>ipv6-family</strong></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-vpn-instance-vpn1-af-ipv6] <strong>route-distinguisher 200:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-vpn-instance-vpn1-af-ipv6] <strong>vpn-target 2:2 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-vpn-instance-vpn1-af-ipv6] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2] <strong>interface gigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>ipv6 address 2001:db8:3::2 64</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2] <strong>commit</strong></pre>
<p># Configure ASBR1 to set up an EBGP peer relationship with ASBR2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1]<strong> bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp6-vpn1] <strong>peer 2001:db8:3::2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp6-vpn1]<strong> import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp6-vpn1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p># Configure ASBR2 to set up an EBGP peer relationship with ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR2]<strong> bgp 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp]<strong> ipv6-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp6-vpn1] <strong>peer 2001:db8:3::1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp6-vpn1] <strong>import-route direct</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp6-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR2] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp vpnv6 vpn-instance peer</strong> command. The command output shows that the BGP peer relationship between the ASBRs is in the <strong>Established</strong> state.</p>
</p></li><li><span>Verify the configuration.</span><p><p>After the configurations are complete, the CEs can learn the routes to each other's interfaces and ping each other. The following example uses the command output on CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> display ipv6 routing-table</strong>
Routing Table : _public_
         Destinations : 8        Routes : 8

 Destination  : ::1                             PrefixLength : 128
 NextHop      : ::1                             Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : InLoopBack0                     Flags        : D

 Destination  : ::FFFF:127.0.0.0                PrefixLength : 104
 NextHop      : ::FFFF:127.0.0.1                Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : InLoopBack0                     Flags        : D
 
 Destination  : ::FFFF:127.0.0.1                PrefixLength : 128
 NextHop      : ::1                             Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : InLoopBack0                     Flags        : D 

 Destination  : 2001:db8:1::                    PrefixLength : 64
 NextHop      : 2001:db8:1::1                   Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : GigabitEthernet<span>0/1/0</span>            Flags        : D

 Destination  : 2001:db8:1::1                   PrefixLength : 128
 NextHop      : ::1                             Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : GigabitEthernet<span>0/1/0</span>            Flags        : D

 Destination  : 2001:db8:2::                    PrefixLength : 64
 NextHop      : 2001:db8:1::2                   Preference   : 255
 Cost         : 0                               Protocol     : EBGP
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : GigabitEthernet<span>0/1/0</span>            Flags        : D

 Destination  : 2001:db8:3::                    PrefixLength : 64
 NextHop      : 2001:db8:1::2                   Preference   : 255
 Cost         : 0                               Protocol     : EBGP
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : GigabitEthernet<span>0/1/0</span>            Flags        : D

 Destination  : FE80::                          PrefixLength : 10
 NextHop      : ::                              Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : NULL0                           Flags        : D </pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> ping ipv6 2001:db8:2::1</strong>
  PING 2001:db8:2::1 : 56  data bytes, press CTRL_C to break
    Reply from 2001:db8:2::1
    bytes=56 Sequence=1 hop limit=60  time = 94 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=2 hop limit=60  time = 109 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=3 hop limit=60  time = 110 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=4 hop limit=60  time = 94 ms
    Reply from 2001:db8:2::1
    bytes=56 Sequence=5 hop limit=60  time = 110 ms

  --- 2001:db8:2::1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 94/103/110 ms</pre>
<p>Run the <strong>display ipv6 routing-table vpn-instance</strong> command on either of ASBRs. The command output shows the routing table of the VPN instance IPv6 address maintained on the ASBR. The following example uses the command output on ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>display ipv6 routing-table vpn-instance vpn1</strong>
Routing Table : vpn1
         Destinations : 5        Routes : 5

 Destination  : 2001:db8:1::                    PrefixLength : 64
 NextHop      : ::FFFF:1.1.1.9                  Preference   : 255
 Cost         : 0                               Protocol     : IBGP
 RelayNextHop : ::                              TunnelID     : 0xa0010082
 Interface    : NULL0                           Flags        : RD

 Destination  : 2001:db8:2::                    PrefixLength : 64
 NextHop      : 2001:db8:3::2                   Preference   : 255
 Cost         : 0                               Protocol     : EBGP
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : GigabitEthernet<span>0/2/0</span>            Flags        : D

 Destination  : 2001:db8:3::                    PrefixLength : 64
 NextHop      : 2001:db8:3::1                   Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : GigabitEthernet<span>0/2/0</span>            Flags        : D

 Destination  : 2001:db8:3::1                   PrefixLength : 128
 NextHop      : ::1                             Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : GigabitEthernet<span>0/2/0</span>            Flags        : D

 Destination  : FE80::                          PrefixLength : 10
 NextHop      : ::                              Preference   : 0
 Cost         : 0                               Protocol     : Direct
 RelayNextHop : ::                              TunnelID     : 0x0
 Interface    : NULL0                           Flags        : D</pre>
<p>Run the <strong>display bgp vpnv6 all routing-table</strong> command on either ASBR. The command output shows the VPNv6 routes on the ASBR. The following example uses the command output on ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>display bgp vpnv6 all routing-table</strong>

BGP Local router ID is 2.2.2.9
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete


 Total number of routes from all PE: 4
 Route Distinguisher: 100:1


 *&gt;i Network  : 2001:db8:1::                             PrefixLen : 64
     NextHop  : ::FFFF:1.1.1.9                           LocPrf    : 100
     MED      : 0                                        PrefVal   : 0
     Label    : 105472
     Path/Ogn : ?

 Route Distinguisher: 100:2


 *&gt;  Network  : 2001:db8:2::                             PrefixLen : 64
     NextHop  : 2001:db8:3::2                            LocPrf    :
     MED      :                                          PrefVal   : 0
     Label    : NULL
     Path/Ogn : 200 ?
 *&gt;  Network  : 2001:db8:3::                             PrefixLen : 64
     NextHop  : ::                                       LocPrf    :
     MED      : 0                                        PrefVal   : 0
     Label    : NULL
     Path/Ogn : ?
 *
     NextHop  : 2001:db8:3::2                            LocPrf    :
     MED      : 0                                        PrefVal   : 0
     Label    : NULL
     Path/Ogn : 200 ?

 VPN-Instance vpn1 :

 Total Number of Routes: 4  
 *&gt;i Network  : 2001:db8:1::                             PrefixLen : 64
     NextHop  : ::FFFF:1.1.1.9                           LocPrf    : 100
     MED      : 0                                        PrefVal   : 0
     Label    : 105472
     Path/Ogn : ?
 *&gt;  Network  : 2001:db8:2::                             PrefixLen : 64
     NextHop  : 2001:db8:3::2                            LocPrf    :
     MED      :                                          PrefVal   : 0
     Label    : NULL
     Path/Ogn : 200 ?
 *&gt;  Network  : 2001:db8:3::                             PrefixLen : 64
     NextHop  : ::                                       LocPrf    :
     MED      : 0                                        PrefVal   : 0
     Label    : NULL
     Path/Ogn : ?
 *
     NextHop  : 2001:db8:3::2                            LocPrf    :
     MED      : 0                                        PrefVal   : 0
     Label    : NULL
     Path/Ogn : 200 ?</pre>
</p></li></ol></div>
<div class="example" id="EN-US_TASK_0172369714__example71757200214051"><a name="EN-US_TASK_0172369714__example71757200214051"></a><a name="example71757200214051"></a><a name="EN-US_TASK_0172369714__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:1::1/64
#
bgp 65001
 router-id 10.10.10.10
 peer 2001:db8:1::2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:db8:1::2 enable
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:1::2/64
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bgp 100
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.9 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 2.2.2.9 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:db8:1::1 as-number 65001
  import-route direct
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 100:2
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:3::1/64
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bgp 100
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  import-route direct
  peer 1.1.1.9 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 1.1.1.9 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:db8:3::2 as-number 200
  import-route direct
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 200:2
  apply-label per-instance
  vpn-target 2:2 export-extcommunity
  vpn-target 2:2 import-extcommunity
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.40.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:3::2/64
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 200
 peer 4.4.4.9 as-number 200
 peer 4.4.4.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 4.4.4.9 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 4.4.4.9 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:db8:3::1 as-number 100
  import-route direct
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.40.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv6-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 2:2 export-extcommunity
  vpn-target 2:2 import-extcommunity
#
mpls lsr-id 4.4.4.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.40.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ipv6 enable
 ipv6 address 2001:db8:2::2/64
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
bgp 200
 peer 3.3.3.9 as-number 200
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #
 ipv6-family vpnv6
  policy vpn-target
  peer 3.3.3.9 enable
#
 ipv6-family vpn-instance vpn1
  peer 2001:db8:2::1 as-number 65002
  import-route direct
#
ospf 1
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.40.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ipv6 enable
 ipv6 address 2001:db8:2::1/64
#
bgp 65002
 router-id 11.11.11.11
 peer 2001:db8:2::2 as-number 200
 #
 ipv4-family unicast
  undo synchronization
 #
 ipv6-family unicast
  undo synchronization
  import-route direct
  peer 2001:db8:2::2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2039.html">Configuration Examples for BGP/MPLS IPv6 VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2043.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v6_cfg_2050.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>