
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring EVPN VPLS over MPLS (Inter-AS Option B)">
<meta name="abstract" content="This section provides an example for configuring EVPN VPLS over MPLS. A single-hop MP-EBGP peer relationship is established between ASBRs to exchange EVPN routes.">
<meta name="description" content="This section provides an example for configuring EVPN VPLS over MPLS. A single-hop MP-EBGP peer relationship is established between ASBRs to exchange EVPN routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_srv6_cfg_0005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0096.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370615">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring EVPN VPLS over MPLS (Inter-AS Option B)</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370615"></a><a name="EN-US_TASK_0172370615"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring EVPN VPLS over MPLS (Inter-AS Option B)</h1>
<div class="taskbody"><p>This section provides an example for configuring EVPN VPLS over MPLS. A single-hop MP-EBGP peer relationship is established between ASBRs to exchange EVPN routes.</p>
<div class="context"><a name="EN-US_TASK_0172370615__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in the following figure, CE1 and CE2 belong to the same EVPN. CE1 is connected to PE1 in AS 100, and CE2 is connected to PE2 in AS 200. It is required that an MP-EBGP peer relationship be established between the ASBRs to transmit EVPN routes, implementing inter-AS EVPN Option B.</p>
<div class="fignone"><span class="figcap"><b>Figure 1 </b>Configuring EVPN VPLS over MPLS (inter-AS Option B)</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_evpn_mpls_optionB_03.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370615__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Precautions</h4><p>During the configuration process, note the following:</p>
<ul><li><p>Configure an MP-EBGP peer relationship between ASBR1 and ASBR2, and disable the ASBRs from filtering received EVPN routes based on VPN targets.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370615__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure an IGP on the MPLS backbone network to implement interworking between the ASBRs and PEs in each AS, and establish an MPLS LDP LSP between the ASBRs and PEs in each AS.</p>
</li><li><p>Configure the CE access function on the PE and establish an MP-IBGP peer relationship between the PE and ASBR in each AS.</p>
</li><li><p>Configure EVPN instances on PEs (no EVPN instance needs to be configured on ASBRs).</p>
</li><li><p>Enable MPLS on the ASBR interfaces connected to each other. Establish an MP-EBGP peer relationship between ASBRs and configure ASBRs not to filter EVPN routes based on VPN targets.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370615__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interfaces and their IP addresses</p>
</li><li><p>MPLS LSR IDs of the PEs and ASBRs</p>
</li><li><p>Names, RDs, and VPN targets of the EVPN instances on PE1 and PE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370615__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>On the MPLS backbone networks in AS 100 and AS 200, configure an IGP for communication between the PEs on each network.</span><p><p>In this example, OSPF is used. For detailed configurations, see Configuration Files.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Configure OSPF to advertise the 32-bit loopback interface addresses used as LSR IDs.</p>
</div></div>
<p>After completing the preceding configurations, run the <strong>display ospf peer </strong>command on the ASBR and PE in each AS. The command output shows that the OSPF neighbor relationship is in the <strong>Full</strong> state, which indicates that the OSPF neighbor relationship has been established between the ASBR and PE in the same AS.</p>
<p>The ASBR and PE in the same AS can learn the loopback interface address of each other and successfully ping each other.</p>
</p></li><li><span>Configure basic MPLS capabilities and MPLS LDP on the MPLS backbone networks of AS 100 and AS 200 to establish LDP LSPs.</span><p><p>For detailed configurations, see Configuration Files.</p>
</p></li><li><span>Configure basic EVPN functions on PE1 and PE2.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>PE1's EVPN instance import and export VPN targets must match PE2's EVPN instance export and import VPN targets, respectively.</p>
</div></div>
<p>For detailed configurations, see Configuration Files.</p>
</p></li><li><span>Configure inter-AS EVPN Option B.</span><p><div class="p"># On ASBR1, enable MPLS on GE<span>0/2/0</span> connected to ASBR2.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
</div>
<p>On ASBR1, specify ASBR2 as an MP-EBGP peer, and disable ASBR1 from filtering received EVPN routes based on VPN targets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> peer 192.168.1.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-EVPN] <strong>peer 192.168.1.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-EVPN]<strong> undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-EVPN] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-EVPN] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The configuration of ASBR2 is similar to that of ASBR1. For detailed configurations, see Configuration Files.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370615__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
evpn vpn-instance evrf_1 bd-mode
  route-distinguisher 100:1
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.9
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evrf_1
#
mpls ldp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.21.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bgp 100
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 #
 ipv4-family unicast
 undo synchronization
 peer 2.2.2.9 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 2.2.2.9 enable
  peer 2.2.2.9 esad-route-compatible enable
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 172.21.1.0 0.0.0.255
#
evpn source-address 1.1.1.9
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.21.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bgp 100
 peer 192.168.1.2 as-number 200
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.1.2 enable
  peer 1.1.1.9 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 1.1.1.9 enable
  peer 1.1.1.9 esad-route-compatible enable
  peer 192.168.1.2 enable
  peer 192.168.1.2 esad-route-compatible enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 172.21.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls ldp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.22.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 200
 peer 192.168.1.1 as-number 100
 peer 4.4.4.9 as-number 200
 peer 4.4.4.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 192.168.1.1 enable
  peer 4.4.4.9 enable
 #
 l2vpn-family evpn
  undo policy vpn-target
  peer 4.4.4.9 enable
  peer 4.4.4.9 esad-route-compatible enable
  peer 192.168.1.1 enable
  peer 192.168.1.1 esad-route-compatible enable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 172.22.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
evpn vpn-instance evrf_1 bd-mode
  route-distinguisher 200:1
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.9
#
mpls
#
bridge-domain 10
 evpn binding vpn-instance evrf_1
#
mpls ldp
 #
 ipv4-family
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.22.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/2/0</span>.1 mode l2
 encapsulation dot1q vid 10
 rewrite pop single
 bridge-domain 10
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
bgp 200
 peer 3.3.3.9 as-number 200
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
 undo synchronization
 peer 3.3.3.9 enable
 #
 l2vpn-family evpn
  policy vpn-target
  peer 3.3.3.9 enable
  peer 3.3.3.9 esad-route-compatible enable
#
#
ospf 1
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 172.22.1.0 0.0.0.255
#
evpn source-address 4.4.4.9
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0010.html">EVPN Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_srv6_cfg_0005.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0096.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>