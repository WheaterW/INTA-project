
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS VPN Option B with ASBRs Functioning as PEs">
<meta name="abstract" content="In a scenario in which the backbone network spans two ASs, ASBRs need to advertise VPN-IPv4 routes through MP-EBGP and ASBRs also need to function as PEs.">
<meta name="description" content="In a scenario in which the backbone network spans two ASs, ASBRs need to advertise VPN-IPv4 routes through MP-EBGP and ASBRs also need to function as PEs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0115.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0118.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369509">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-AS VPN Option B with ASBRs Functioning as PEs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369509"></a><a name="EN-US_TASK_0172369509"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS VPN Option B with ASBRs Functioning as PEs</h1>
<div class="taskbody"><p>In a scenario in which the backbone network spans two ASs, ASBRs need to advertise VPN-IPv4 routes through MP-EBGP and ASBRs also need to function as PEs.</p>
<div class="context"><a name="EN-US_TASK_0172369509__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>In inter-AS VPN Option B networking, the ASBRs function as inter-AS devices to transmit VPNv4 routes and also function as PEs to manage VPN routes. In this case, inter-AS VPN Option B with ASBRs functioning as PEs can be deployed. This decreases the number of PEs being deployed but imposes higher requirements on ASBR performance.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172369509__fig_dc_vrp_mpls-l3vpn-v4_cfg_011601">Figure 1</a>, it is required that inter-AS VPN Option B be configured and ASBRs be configured to function as PEs to interconnect the CEs.</p>
<div class="fignone" id="EN-US_TASK_0172369509__fig_dc_vrp_mpls-l3vpn-v4_cfg_011601"><a name="EN-US_TASK_0172369509__fig_dc_vrp_mpls-l3vpn-v4_cfg_011601"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_011601"></a><span class="figcap"><b>Figure 1 </b>Inter-AS VPN Option B with ASBRs functioning as PEs</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 through 3 in this example represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0285327530.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369509__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Notes</h4><p>When configuring inter-AS VPN Option B with ASBRs functioning as PEs, note the following:</p>
<ul><li><p>VPN instances must be configured on ASBRs and ASBRs and CEs need to communicate.</p>
</li><li><p>The ASBRs do not filter received VPNv4 routes based on VPN targets.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369509__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP on the MPLS backbone network for IP connectivity between the ASBR and PE in the same AS, and set up an MPLS LDP LSP between the ASBR and PE in the same AS.</p>
</li><li><p>Set up MP-IBGP peer relationships between PEs and ASBRs.</p>
</li><li><p>Configure VPN instances on PEs and ASBRs and set up EBGP peer relationships between the PEs, ASBRs, and CEs.</p>
</li><li><p><span>Enable MPLS on the interface that connects one ASBR to the other ASBR and set</span> up an MP-EBGP peer relationship between the ASBRs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369509__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of PE1 (1.1.1.9), ASBR1 (2.2.2.9), ASBR2 (3.3.3.9), and PE2 (4.4.4.9)</p>
</li><li><p>Name (vpna), RD (100:1, 100:3, 200:1 and 200:4), and export and import VPN targets (1:1) of the VPN instance on each PE and ASBRs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369509__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IGP for communication between the PE and ASBR on each MPLS backbone network (one is in AS 100 and the other in AS 200).</span><p><p>This example uses OSPF as IGP. For configuration details, see the configuration files.</p>
<p>After the configurations are complete, the OSPF neighbor relationship can be established between the ASBR and PE in the same AS. Run the <strong>display ospf peer</strong> command. The command output shows that the neighbor relationship is in the <strong>Full</strong> state. The ASBR and PE in the same AS can learn and ping the IP address of each other's loopback interface.</p>
</p></li><li><span>Configure MPLS and MPLS LDP both globally and per interface on each node of the MPLS backbone networks in AS 100 and AS 200 and set up LDP LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see the configuration file.</p>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls lsr-id 2.2.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1]<strong> mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For detailed configurations, see Configuration Files.</p>
<p>After the configurations are complete, the LDP session can be established between the PE and ASBR. Run the <strong>display mpls ldp session</strong> command on each device. The command output shows that the session status is <strong>Operational</strong>. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt;<strong> display mpls ldp session</strong>

 LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
<span> An asterisk (*) before a session means the session is being deleted. </span>
 -------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge      KASent/Rcv
 -------------------------------------------------------------------------
 2.2.2.9:0          <strong>Operational</strong> DU  Passive  0000:00:01  5/5
 -------------------------------------------------------------------------
 TOTAL: 1 session(s) Found.</pre>
</p></li><li><span>Set up an MP-IBGP peer relationship between the PE and ASBR in the same AS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 2.2.2.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>quit</strong></pre>
<p>The configuration of PE2 is similar to the configuration of PE1. For configuration details, see the configuration file.</p>
<p># Configure ASBR1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For configuration details, see the configuration file.</p>
<p>After completing the configurations, run the <strong>display bgp vpnv4 all peer</strong> command on the PE or ASBR. The command output shows that an MP-IBGP peer relationship has been established between the PE and ASBR in the same AS. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 all peer</strong>

 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 1         Peers in established state : 1

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv

  2.2.2.9         4         100       54       59     0 00:45:03 <strong>Established</strong>    2</pre>
</p></li><li><span>Configure VPN instances on PEs and ASBRs and connect the CEs to the PEs through the VPN instances.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>vpn-target 1:1 both</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.1.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p>The configurations of PE2, ASBR1, and ASBR2 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display ip vpn-instance verbose</strong> command on the PE or ASBR to view the configurations of VPN instances. The following example uses the command output on PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display ip vpn-instance verbose</strong>
 Total VPN-Instances configured : 1
 Total IPv4 VPN-Instances configured : 1 
 Total IPv6 VPN-Instances configured : 0

 VPN-Instance Name and ID : vpna, 1
  Interfaces : GigabitEthernet<span>0/2/0</span>
 Address family ipv4 
  Create date : 2009/09/18 11:30:35
  Up time : 0 days, 00 hours, 05 minutes and 19 seconds
  Vrf Status : UP
  Route Distinguisher : 100:1
  Export VPN Targets :  1:1
  Import VPN Targets :  1:1
  Label policy: label per route
  The diffserv-mode Information is : uniform
  The ttl-mode Information is : pipe</pre>
</p></li><li><span>Set up EBGP peer relationships between the PEs, ASBRs, and CEs, and import VPN routes to the loopback interfaces of the CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>ip address 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>The configurations of CE2, CE3, and CE4 are similar to the configuration of CE1. For configuration details, see the configuration files.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>peer 10.1.1.1 as-number 65001</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpna] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp-vpna] <strong>quit</strong></pre>
<p>The configurations of PE2, ASBR1, and ASBR2 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display bgp vpnv4 vpn-instance peer</strong> command on the PEs or ASBRs. The command output shows that BGP peer relationships have been established between PEs and CEs. The following example uses the peer relationship between PE1 and CE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>display bgp vpnv4 vpn-instance vpna peer</strong>

 BGP local router ID : 10.1.1.2
 Local AS number : 100
 Total number of peers : 1            Peers in established state : 1
  Peer            V    AS  MsgRcvd  MsgSent    OutQ  Up/Down    State        PrefRcv
  10.1.1.1        4   65001  11     9          0     00:06:37   <strong>Established</strong>  1</pre>
</p></li><li><span>Enable MPLS on the interface that connects one ASBR to the other ASBR.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 10.12.12.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>commit</strong></pre>
<p>The configuration of ASBR2 is similar to that of ASBR1. For configuration details, see the configuration file.</p>
</p></li><li><span>Set up an MP-EBGP peer relationship between the ASBRs, and configure the ASBRs not to filter received VPNv4 routes based on VPN targets.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp]<strong> peer 10.12.12.2 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 10.12.12.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4]<strong> undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
<p>The configuration of ASBR2 is similar to the configuration of ASBR1. For configuration details, see the configuration file.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The ASBR does not filter the received VPNv4 routes based on VPN targets. Instead, it advertises the received routes to the peer ASBR or the PE in the same AS. The VPN routing table on the ASBR is used to match the VPN targets. Routes that have matching VPN targets in the VPN routing table on the ASBR are received.</p>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p>After completing the configurations, run the <strong>display ip routing-table</strong> command on the CEs. The command output shows the routes learned by the local CE from other CEs. The following example uses the command output on CE3.</p>
<pre class="screen">&lt;CE3&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table: _public_
         Destinations : 11        Routes : 11
Destination/Mask    Proto  Pre  Cost      Flags  NextHop         Interface
       10.3.1.0/24  Direct 0    0             D  10.3.1.1        GigabitEthernet<span>0/1/0</span>
       10.3.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.3.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
      <strong>11.11.11.11/32</strong>  EBGP   255  0            RD  10.3.1.2        GigabitEthernet<span>0/1/0</span>
      <strong>22.22.22.22/32</strong>  EBGP   255  0            RD  10.3.1.2        GigabitEthernet<span>0/1/0</span>
    33.33.33.33/32  Direct 0    0             D  127.0.0.1       LoopBack1
      <strong>44.44.44.44/32</strong>  EBGP   255  0            RD  10.3.1.2        GigabitEthernet<span>0/1/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<p>Run the <strong>display bgp vpnv4 all routing-table</strong> command on an ASBR. The command output shows the VPNv4 routes on the ASBRs. The following example uses the command output on ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt;<strong> display bgp vpnv4 all routing-table</strong>
 BGP Local router ID is 2.2.2.9
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>


 Total number of routes from all PE: 4
 Route Distinguisher: 100:1


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  11.11.11.11/32     1.1.1.9                    100        0      65001i
 Route Distinguisher: 200:1


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   22.22.22.22/32     3.3.3.9                             0       200 65002i
 Route Distinguisher: 100:3


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn
*&gt;i  33.33.33.33/32     0.0.0.0         0                     0      65003i
 Route Distinguisher: 200:4


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn
 *&gt;i  44.44.44.44/32        3.3.3.9         0          100        0      200 65004i</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369509__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface Loopback1
 ip address 11.11.11.11 255.255.255.255
#
bgp 65001
 peer 10.1.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.2 enable
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 1.1.1.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.2 255.255.255.0
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
bgp 100
 peer 2.2.2.9 as-number 100
 peer 2.2.2.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 2.2.2.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 2.2.2.9 enable
#
 ipv4-family vpn-instance vpna
  peer 10.1.1.1 as-number 65001
#
ospf 1
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:3
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 2.2.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.10.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.12.12.1 255.255.255.0
 mpls
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.3.1.2 255.255.255.0
#
interface LoopBack1
 ip address 2.2.2.9 255.255.255.255
#
bgp 100
 peer 10.12.12.2 as-number 200
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 10.12.12.2 enable
  peer 1.1.1.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 1.1.1.9 enable
  peer 10.12.12.2 enable
#
 ipv4-family vpn-instance vpna
  peer 10.3.1.1 as-number 65003
#
ospf 1
 area 0.0.0.0
  network 2.2.2.9 0.0.0.0
  network 10.10.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
#
interface Loopback1
 ip address 33.33.33.33 255.255.255.255
#
bgp 65003
 peer 10.3.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 33.33.33.33 255.255.255.255
  peer 10.3.1.2 enable
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:4
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 3.3.3.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.40.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.12.12.2 255.255.255.0
 mpls
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.4.1.2 255.255.255.0
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 200
 peer 10.12.12.1 as-number 100
 peer 4.4.4.9 as-number 200
 peer 4.4.4.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 10.12.12.1 enable
  peer 4.4.4.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 4.4.4.9 enable
  peer 10.12.12.1 enable
#
 ipv4-family vpn-instance vpna
  peer 10.4.1.1 as-number 65004
#
ospf 1
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.40.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE4 configuration file</p>
<pre class="screen">#
sysname CE4
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
#
interface Loopback1
 ip address 44.44.44.44 255.255.255.255
#
bgp 65004
 peer 10.4.1.2 as-number 200
 #
 ipv4-family unicast
  undo synchronization
  network 44.44.44.44 255.255.255.255
  peer 10.4.1.2 enable
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 4.4.4.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.40.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.2.1.2 255.255.255.0
#
interface LoopBack1
 ip address 4.4.4.9 255.255.255.255
#
bgp 200
 peer 3.3.3.9 as-number 200
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 3.3.3.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.9 enable
#
 ipv4-family vpn-instance vpna
  peer 10.2.1.1 as-number 65002
#
ospf 1
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.40.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface Loopback1
 ip address 22.22.22.22 255.255.255.255
#
bgp 65002
 peer 10.2.1.2 as-number 200
 #
 ipv4-family unicast
  undo synchronization
  network 22.22.22.22 255.255.255.255
  peer 10.2.1.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0115.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0118.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>