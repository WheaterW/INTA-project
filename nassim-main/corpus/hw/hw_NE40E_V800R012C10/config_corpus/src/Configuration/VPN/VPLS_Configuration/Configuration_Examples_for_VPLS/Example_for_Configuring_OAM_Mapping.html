
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring OAM Mapping">
<meta name="abstract" content="This section provides an example for configuring OAM mapping. When an intermediate device such as a switch exists between a PE and a CE, you can configure OAM mapping to associate the OAM status on an AC interface with the PW status.">
<meta name="description" content="This section provides an example for configuring OAM mapping. When an intermediate device such as a switch exists between a PE and a CE, you can configure OAM mapping to associate the OAM status on an AC interface with the PW status.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6041.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_erps_cfg_0021_1.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370296">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring OAM Mapping</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370296"></a><a name="EN-US_TASK_0172370296"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring OAM Mapping</h1>
<div class="taskbody"><p>This section provides an example for configuring OAM mapping. When an intermediate device such as a switch exists between a PE and a CE, you can configure OAM mapping to associate the OAM status on an AC interface with the PW status.</p>
<div class="context"><a name="EN-US_TASK_0172370296__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>When the AC interface bound to a VPLS changes, a PE sends an LDP MAC-Withdraw message to its peer. On the network shown in <a href="#EN-US_TASK_0172370296__fig_dc_vrp_vpls_cfg_605401">Figure 1</a>, an intermediate device exists between CE1 and PE1, and another intermediate device exists between CE1 and PE2. When CE1's GE<span>0/1/0</span> goes down, PE1's GE<span>0/1/0</span> (AC interface) does not go down immediately. As a result, PE1 does not immediately send an LDP MAC-Withdraw message to PE3, causing the downstream traffic from PE3 to PE1 to be lost. To prevent this problem, you can configure OAM mapping on CE1, PE1, and PE2 so that OAM monitors the links between the CE and PEs and the OAM status is associated with the PW status. When the CE1's GE<span>0/1/0</span> goes down, a primary/secondary PW switchover is rapidly triggered.</p>
<div class="fignone" id="EN-US_TASK_0172370296__fig_dc_vrp_vpls_cfg_605401"><a name="EN-US_TASK_0172370296__fig_dc_vrp_vpls_cfg_605401"></a><a name="fig_dc_vrp_vpls_cfg_605401"></a><span class="figcap"><b>Figure 1 </b>Configuring OAM mapping</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and GE<span>0/3/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_605401.png" width="NaN" height="NaN"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370296__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>On the backbone network, configure a routing protocol to implement connectivity between devices and configure basic MPLS functions.</p>
</li><li><p>Establish LSPs between PEs.</p>
</li><li><p>Enable MPLS L2VPN on PEs.</p>
</li><li><p>Configure LDP VPLS on PEs.</p>
</li><li><p>Configure OAM mapping.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370296__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Peer IP addresses</p>
</li><li><p>VSI names on PEs</p>
</li><li><p>Names and VLAN IDs of the interfaces to be bound to VSIs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370296__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for involved devices on the backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Loopback1] <strong>ip address 2.2.2.2 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>192.168.20.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Loopback1] <strong>ip address 3.3.3.3 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-Loopback1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>ip address 192.168.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.20.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Vlanif10] <strong>ip address 10.10.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-Vlanif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 10.10.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Configure an IGP. In this example, OSPF is used.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 192.168.20.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>network 192.168.20.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Enable MPLS and establish LSPs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls lsr-id 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>interface GigabitEthernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Enable MPLS L2VPN on PEs.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3]<strong> mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure LDP VPLS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>vsi-id 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>vsi-id 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>interface-status-change mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>vsi-id 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>peer 2.2.2.2 secondary</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Create an AC interface and bind it to the VSI on each PE.</span><p><p># Create a sub-interface on PE1 and bind it to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Create a sub-interface on PE2 and bind it to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Create a sub-interface on PE3 and bind it to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>interface GigabitEthernet<span>0/3/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/3/0</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-GigabitEthernet<span>0/3/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure OAM mapping.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>cfm trigger vlan 10 mac-renew</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>cfm md md1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>map vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>mep mep-id 1 interface GigabitEthernet <span>0/1/0</span> outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>mep ccm-send mep-id 1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>remote-mep mep-id 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>remote-mep ccm-receive mep-id 2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1] <strong>ma ma2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma2] <strong>mep mep-id 3 interface GigabitEthernet <span>0/2/0</span> outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma2] <strong>mep ccm-send mep-id 3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma2] <strong>remote-mep mep-id 4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma2] <strong>remote-mep ccm-receive mep-id 4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1-ma-ma2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-md-md1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>cfm md md1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1] <strong>ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma2] <strong>map vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>mep mep-id 2 interface GigabitEthernet <span>0/1/0</span>.1 outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>mep ccm-send mep-id 2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>remote-mep mep-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>remote-mep ccm-receive mep-id 1 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1-ma-ma1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-md-md1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn oam-mapping 1ag md md1 ma ma1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>cfm enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>cfm md md1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1] <strong>ma ma2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma2] <strong>map vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma2] <strong>mep mep-id 4 interface GigabitEthernet <span>0/1/0</span>.1 outward</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma2] <strong>mep ccm-send mep-id 4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma2] <strong>remote-mep mep-id 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma2] <strong>remote-mep ccm-receive mep-id 3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1-ma-ma2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-md-md1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface GigabitEthernet <span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>mpls l2vpn oam-mapping 1ag md md1 ma ma2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After completing the configurations, run the <a href="cmdqueryname=display+vsi+verbose"><b><span class="cmdname">display vsi verbose</span></b></a> command on PE1 to view the VPLS connection status. The following command output shows that the VPLS is up.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi verbose</strong></pre>
<pre class="screen"> ***VSI Name               : 1
    Work Mode              : normal
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 1
    PW Signaling           : ldp
    Member Discovery Style : -
    Bridge-domain Mode     : disable
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : -
    Color                  : -
    DomainId               : 255
    Domain Name            : 
    Ignore AcState         : disable
    P2P VSI                : disable
    VSI MAC-WITHDRAW       : Interface-status-change Enable
                           : mac-withdraw Enable
    Multicast Fast Switch  : disable
    Create Time            : 0 days, 2 hours, 51 minutes, 10 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : -

    VSI ID                 : 20
   *Peer Router ID         : 3.3.3.3
    Negotiation-vc-id      : 20
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 32828
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x0000000001004c4b42 
    Broadcast Tunnel ID    : -
    Broad BackupTunnel ID  : -
    CKey                   : 1
    NKey                   : 4076863613
    Stp Enable             : 0
    PwIndex                : 1
    Control Word           : disable
 
    Interface Name         : GigabitEthernet<span>0/1/0</span>.1
    State                  : up
    AC OAM State           : up
    Access Port            : false
    Last Up Time           : 2017/03/02 07:29:29
    Total Up Time          : 0 days, 2 hours, 41 minutes, 17 seconds

  **PW Information:

   *Peer Ip Address        : 3.3.3.3
    PW State               : up
    Local VC Label         : 32828
    Remote VC Label        : 33008
    Remote Control Word    : disable
    PW Type                : label
    Local  VCCV            : alert lsp-ping 
    Remote VCCV            : alert lsp-ping 
    Tunnel ID              : 0x0000000001004c4b42 
    Broadcast Tunnel ID    : -
    Broad BackupTunnel ID  : -
    Ckey                   : 1
    Nkey                   : 4076863613
    Main PW Token          : 0x0
    Slave PW Token         : 0x0
    Tnl Type               : ldp
    OutInterface           : -
    Backup OutInterface    : -
    Stp Enable             : 0
    Mac Flapping           : 0
    PW Last Up Time        : 2017/03/02 07:53:41
    PW Total Up Time       : 0 days, 2 hours, 17 minutes, 4 seconds
</pre>
<p># Ping CE2 from CE1. The following command output shows that CE1 can ping CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 10.10.1.2</strong></pre>
<pre class="screen">PING 10.10.1.2: 56  data bytes, press CTRL_C to break
    Reply from 10.10.1.2: bytes=56 Sequence=1 ttl=255 time=31 ms
    Reply from 10.10.1.2: bytes=56 Sequence=2 ttl=255 time=2 ms
    Reply from 10.10.1.2: bytes=56 Sequence=3 ttl=255 time=2 ms
    Reply from 10.10.1.2: bytes=56 Sequence=4 ttl=255 time=2 ms
    Reply from 10.10.1.2: bytes=56 Sequence=5 ttl=255 time=2 ms

  -- 10.10.1.2 ping statistics --
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 2/7/31 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370296__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan batch 10
#
cfm enable
cfm trigger vlan 10 mac-renew
#
interface Vlanif10
 ip address 10.10.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port trunk allow-pass vlan 10
 #
interface GigabitEthernet<span>0/2/0</span>
 portswitch
 undo shutdown
 port trunk allow-pass vlan 10
#
cfm md md1
 ma ma1
  map vlan 10
  mep mep-id 1 interface GigabitEthernet<span>0/1/0</span> outward
  mep ccm-send mep-id 1 enable
  remote-mep mep-id 2
  remote-mep ccm-receive mep-id 2 enable
 ma ma2
  map vlan 10
  mep mep-id 3 interface GigabitEthernet<span>0/2/0</span> outward
  mep ccm-send mep-id 3 enable
  remote-mep mep-id 4
  remote-mep ccm-receive mep-id 4 enable
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 ip address 10.10.1.2 255.255.255.0
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
cfm enable
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi vsi1
 mac-withdraw enable
 interface-status-change mac-withdraw enable
 pwsignal ldp
  vsi-id 20
  peer 3.3.3.3 
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi vsi1
 mpls l2vpn oam-mapping 1ag md md1 ma ma1
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
cfm md md1
 ma ma1
  map vsi vsi1
  mep mep-id 2 interface GigabitEthernet<span>0/1/0</span>.1 outward
  mep ccm-send mep-id 2 enable
  remote-mep mep-id 1
  remote-mep ccm-receive mep-id 1 enable
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
cfm enable
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi vsi1
 mac-withdraw enable
 interface-status-change mac-withdraw enable
 pwsignal ldp
  vsi-id 20
  peer 3.3.3.3 
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi vsi1
 mpls l2vpn oam-mapping 1ag md md1 ma ma2
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.20.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.20.0 0.0.0.255
#
cfm md md1
 ma ma2
  map vsi vsi1
  mep mep-id 4 interface GigabitEthernet<span>0/1/0</span>.1 outward
  mep ccm-send mep-id 4 enable
  remote-mep mep-id 3
  remote-mep ccm-receive mep-id 3 enable
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1
 mac-withdraw enable
 interface-status-change mac-withdraw enable
 pwsignal ldp
  vsi-id 20
  peer 1.1.1.1 
  peer 2.2.2.2 secondary
#
mpls ldp
#
interface GigabitEthernet<span>0/3/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/3/0</span>.1
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.20.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6041.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_erps_cfg_0021_1.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>