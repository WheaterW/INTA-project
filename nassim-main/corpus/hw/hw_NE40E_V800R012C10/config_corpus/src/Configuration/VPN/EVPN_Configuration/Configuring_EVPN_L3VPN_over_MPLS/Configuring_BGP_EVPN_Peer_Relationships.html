
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring BGP EVPN Peer Relationships">
<meta name="abstract" content="You can configure BGP EVPN peer relationships between PEs or between PEs and ASBRs as required to exchange EVPN routes between the PEs. Additionally, you can configure BGP RRs to minimize the number of peer relationships, saving network resources.">
<meta name="description" content="You can configure BGP EVPN peer relationships between PEs or between PEs and ASBRs as required to exchange EVPN routes between the PEs. Additionally, you can configure BGP RRs to minimize the number of peer relationships, saving network resources.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0038.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0073.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370488">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring BGP EVPN Peer Relationships</title>
</head>
<body><a name="EN-US_TASK_0172370488"></a><a name="EN-US_TASK_0172370488"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring BGP EVPN Peer Relationships</h1>
<div class="taskbody"><p>You can configure BGP EVPN peer relationships between PEs or between PEs and ASBRs as required to exchange EVPN routes between the PEs. Additionally, you can configure BGP RRs to minimize the number of peer relationships, saving network resources.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0172370488__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure BGP EVPN peers.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If a BGP RR needs to be configured on the network, establish BGP EVPN peer relationships between all the PEs and the RR.</p>
</div></div>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>BGP is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span><p><p>The remote PE is specified as the peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>connect-interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">ipv4-source-address</span></i> ]</span><p><p>A source interface and a source IP address are specified to set up a TCP connection between the BGP peers.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If loopback interfaces are used to establish a BGP connection, it is recommended that the <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer connect-interface</span></b></a> command be run on both ends to ensure correct connection. If this command is run on only one end, the BGP connection may fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <a href="cmdqueryname=ebgp-max-hop"><b><span class="cmdname">ebgp-max-hop</span></b></a> [ <i><span class="varname">hop-count</span></i> ]</span><p><p>The maximum allowable number of hops is set for an EBGP EVPN connection.</p>
</p><p><p>Generally, EBGP EVPN peers are directly connected. If they are not directly connected, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command to allow the EBGP EVPN peers to establish a multi-hop TCP connection.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If loopback interfaces are used for an EBGP EVPN connection, the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command must be run, with the <i><span class="varname">hop-count</span></i> value greater than or equal to 2. If this configuration is absent, the EBGP EVPN connection fails to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></span><p><p>The BGP VPN instance IPv4<span>/IPv6</span> address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> { <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong><span> | <strong><span>ospfv3</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ripng</span></strong> <i><span class="varname">process-id</span></i></span> } [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup></span></span><p><p>The device is enabled to import non-BGP routing protocol routes into the BGP-VPN instance IPv4<span>/IPv6</span> address family. To advertise host IP routes, only enable the device to import direct routes. To advertise the routes of the network segment where a host resides, configure a dynamic routing protocol (such as OSPF) to advertise the network segment routes. Then enable the device to import routes of the configured routing protocol.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a></span><p><p>The device is configured to advertise IP prefix routes. This type of route can be used to advertise host IP routes as well as the routes on the subnet where the device resides.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Exit the BGP-VPN instance IPv4<span>/IPv6</span> address family view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong></span><p><p>The device is enabled to exchange EVPN routes with a peer or peer group.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the BGP view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span></span><p><p>Return to the system view.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>(Optional) Configure an RR. To minimize the number of BGP EVPN peers on the network, deploy an RR.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>BGP is enabled, and its view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a></span><p><p>The RR and its client are configured.</p>
</p><p><p>The <span class="keyword">Router</span> where the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command is run functions as the RR, and the specified peer or peer group functions as a client.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a></span><p><p>Route reflection between clients through the RR is disabled.</p>
</p><p><p>If the clients of an RR have established full-mesh connections with each other, run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command to disable route reflection between clients through the RR to reduce the link cost. The <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command applies only to RRs.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> { <i><span class="varname">cluster-id-value</span></i> | <i><span class="varname">cluster-id-ipv4</span></i> }</span><p><p>A cluster ID is configured for the RR.</p>
</p><p><p>If a cluster has multiple RRs, run this command to set the same cluster ID for these RRs to prevent routing loops.</p>
<p>The <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> command applies only to RRs.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0038.html">Configuring EVPN L3VPN over MPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0039.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0073.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>