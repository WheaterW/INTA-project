
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a CE to Access a VPN Through a GRE Tunnel Traversing Another VPN">
<meta name="abstract" content="This section provides an example for configuring a CE to access a VPN through a GRE tunnel traversing another VPN. In this networking scheme, the PE is indirectly connected to the CE; no physical interface can be bound to the VPN instance on the PE. A GRE tunnel traversing a VPN is required between the CE and PE, and the GRE tunnel needs to be bound to the VPN instance on the PE. This allows the CE to access the VPN through the GRE tunnel.">
<meta name="description" content="This section provides an example for configuring a CE to access a VPN through a GRE tunnel traversing another VPN. In this networking scheme, the PE is indirectly connected to the CE; no physical interface can be bound to the VPN instance on the PE. A GRE tunnel traversing a VPN is required between the CE and PE, and the GRE tunnel needs to be bound to the VPN instance on the PE. This allows the CE to access the VPN through the GRE tunnel.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2020.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2039.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2037.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="GRE">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369107">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a CE to Access a VPN Through a GRE Tunnel Traversing Another VPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369107"></a><a name="EN-US_TASK_0172369107"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a CE to Access a VPN Through a GRE Tunnel Traversing Another VPN</h1>
<div class="taskbody"><p>This section provides an example for configuring a CE to access a VPN through a GRE tunnel traversing another VPN. In this networking scheme, the PE is indirectly connected to the CE; no physical interface can be bound to the VPN instance on the PE. A GRE tunnel traversing a VPN is required between the CE and PE, and the GRE tunnel needs to be bound to the VPN instance on the PE. This allows the CE to access the VPN through the GRE tunnel.</p>
<div class="context"><a name="EN-US_TASK_0172369107__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>As shown in <a href="#EN-US_TASK_0172369107__fig_dc_vrp_gre_cfg_204001">Figure 1</a>:</p>
<ul><li><p>PE1 and PE2 are located on the Level 1 carrier's MPLS backbone network.</p>
</li><li><p>vpn2 is a Level 2 carrier's VPN. CE1 in vpn2 is directly connected to PE1.</p>
</li><li><p>CE2 and CE3 are user devices. CE2 is directly connected to PE2, and CE3 is directly connected to CE1 CE2 and CE3 both belong to vpn1 and need to communicate.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0172369107__fig_dc_vrp_gre_cfg_204001"><a name="EN-US_TASK_0172369107__fig_dc_vrp_gre_cfg_204001"></a><a name="fig_dc_vrp_gre_cfg_204001"></a><span class="figcap"><b>Figure 1 </b>Configuring a CE to access a VPN through a GRE tunnel traversing another VPN</span><br><span><img class="vsd" src="images/fig_dc_vrp_gre_cfg_204001.png"></span><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p>Device Name</p>
</td>
<td valign="top"><p>Interface</p>
</td>
<td valign="top"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p>CE3</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.21.1.2/24</p>
</td>
</tr>
<tr><td valign="top"><p>CE3</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.3.1.1/24</p>
</td>
</tr>
<tr><td valign="top"><p>CE3</p>
</td>
<td valign="top"><p>Tunnel2</p>
</td>
<td valign="top"><p>2.2.2.1/24</p>
</td>
</tr>
<tr><td valign="top"><p>CE3</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>5.5.5.9/32</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.3.1.2/24</p>
</td>
</tr>
<tr><td valign="top"><p>CE1</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.5.1.1/24</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>1.1.1.9/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>Loopback0</p>
</td>
<td valign="top"><p>4.4.4.9/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.5.1.2/24</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.11.1.1/24</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>Tunnel1</p>
</td>
<td valign="top"><p>2.2.2.2/24</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>Loopback1</p>
</td>
<td valign="top"><p>3.3.3.9/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.11.1.2/24</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.1.1.2/24</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
</td>
<td valign="top"><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td valign="top"><p>CE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
</td>
<td valign="top"><p>10.41.1.2/24</p>
</td>
</tr>
</table></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369107__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>Because PE1 and CE3 are indirectly connected, the physical interface on PE1 cannot be bound to the VPN instance on PE1. In such a situation, a GRE tunnel is required between CE3 and PE1. The GRE tunnel can be bound to vpn1 on PE1, and CE3 can then access the VPN through the GRE tunnel.</p>
<p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure OSPF10 on the Level 1 carrier's backbone network devices PE1 and PE2 for them to communicate. Then enable MPLS.</p>
</li><li><p>Configure vpn2 on PE1. Then configure OSPF20 on PE1, CE1, and CE3 for them to communicate.</p>
</li><li><p>Establish a GRE tunnel between CE3 and PE1. Note that PE1 is connected to CE3 through vpn2. So the interfaces directly connecting CE3 and CE1 and the interfaces directly connecting PE1 and CE1 all belong to vpn2. In addition, when the GRE tunnel is established on PE1, the specified destination address of the GRE tunnel must belong to vpn2.</p>
</li><li><p>Create a VPN instance named vpn1 on PE1 and PE2, bind vpn1 on PE1 to the GRE tunnel interface, and bind vpn1 on PE2 to the physical interface connected to CE2.</p>
</li><li><p>Configure IS-IS routes to PEs on CE2 and CE3 to ensure communication between CEs and PEs.</p>
</li><li><p>Configure BGP between PEs for CE2 and CE3 to communicate.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369107__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>Interface IP addresses, routing protocol process IDs, and AS numbers</p>
</li><li><p>Source and destination addresses of the GRE tunnel</p>
</li><li><p>VPN instance names, RDs, and VPN targets on PEs</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369107__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure interface IP addresses.</span><p><p># Configure CE3.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE3</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3]<strong> vlan batch 10 20</strong>
[<span class="keyword">*</span>CE3]<strong> interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 10</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>CE3]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/2/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/2/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/2/0</span>]<strong> port default vlan 20</strong>
[<span class="keyword">*</span>CE3-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>CE3]<strong> interface vlanif 10</strong>
[<span class="keyword">*</span>CE3-Vlanif10]<strong> ip address 10.21.1.2 24</strong>
[<span class="keyword">*</span>CE3-Vlanif10]<strong> quit</strong>
[<span class="keyword">*</span>CE3]<strong> interface vlanif 20</strong>
[<span class="keyword">*</span>CE3-Vlanif20]<strong> ip address 10.3.1.1 24</strong>
[<span class="keyword">*</span>CE3-Vlanif20]<strong> quit</strong>
<span>[<span class="keyword">*</span>CE3]<strong> interface loopback1</strong>
[<span class="keyword">*</span>CE3-LoopBack1]<strong> ip address 5.5.5.9 32</strong>
[<span class="keyword">*</span>CE3-LoopBack1]<strong> quit</strong></span>
[<span class="keyword">*</span>CE3]<strong> commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> vlan batch 10 20</strong>
[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 20</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>CE1]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> port default vlan 10</strong>
[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>CE1]<strong> interface vlanif 10</strong>
[<span class="keyword">*</span>CE1-Vlanif10]<strong> ip address 10.3.1.2 24</strong>
[<span class="keyword">*</span>CE1-Vlanif10]<strong> quit</strong>
[<span class="keyword">*</span>CE1]<strong> interface vlanif 20</strong>
[<span class="keyword">*</span>CE1-Vlanif20]<strong> ip address 10.5.1.1 24</strong>
[<span class="keyword">*</span>CE1-Vlanif20]<strong> quit</strong>
[<span class="keyword">*</span>CE1]<strong> commit</strong></pre>
<p># Configure PE1. Do not configure IP addresses for interfaces to be bound to VPN instances, because all configurations on these interfaces will be deleted when these interfaces are bound to VPN instances.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname PE1</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> vlan batch 10 20</strong>
[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 10</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> port default vlan 20</strong>
[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> interface vlanif 20</strong>
[<span class="keyword">*</span>PE1-Vlanif20]<strong> ip address 10.11.1.1 24</strong>
[<span class="keyword">*</span>PE1-Vlanif20]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> interface loopback 1</strong>
[<span class="keyword">*</span>PE1-LoopBack1]<strong> ip address 1.1.1.9 32</strong>
[<span class="keyword">*</span>PE1-LoopBack1]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2. Do not configure IP addresses for interfaces to be bound to VPN instances, because all configurations on these interfaces will be deleted when these interfaces are bound to VPN instances.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname PE2</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> vlan batch 10 20</strong>
[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 20</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> port default vlan 10</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> interface vlanif 20</strong>
[<span class="keyword">*</span>PE2-Vlanif10]<strong> ip address 10.11.1.2 24</strong>
[<span class="keyword">*</span>PE2-Vlanif10]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> interface loopback 1</strong>
[<span class="keyword">*</span>PE2-LoopBack1]<strong> ip address 3.3.3.9 32</strong>
[<span class="keyword">*</span>PE2-LoopBack1]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt;<strong> system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>]<strong> sysname CE2</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> vlan batch 10 20</strong>
[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> port default vlan 10</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>CE2]<strong> interface gigabitethernet <span>0/2/0</span></strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>]<strong> undo shutdown</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>]<strong> portswitch</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>]<strong> port link-type hybrid</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>]<strong> port default vlan 20</strong>
[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/2/0</span>]<strong> quit</strong>
[<span class="keyword">*</span>CE2]<strong> interface vlanif 10</strong>
[<span class="keyword">*</span>CE2-Vlanif10]<strong> ip address 10.1.1.1 24</strong>
[<span class="keyword">*</span>CE2-Vlanif10]<strong> quit</strong>
[<span class="keyword">*</span>CE2]<strong> interface vlanif 20</strong>
[<span class="keyword">*</span>CE2-Vlanif20]<strong> ip address 10.41.1.2 24</strong>
[<span class="keyword">*</span>CE2-Vlanif20]<strong> quit</strong>
[<span class="keyword">*</span>CE2]<strong> commit</strong></pre>
</p></li><li><span>Configure a routing protocol on backbone network PEs for them to communicate and enable MPLS.</span><p><p># Configure PE1. Specifically, enable MPLS LDP and use OSPF10 routes to ensure route reachability between PEs. LSPs are then set up automatically.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> mpls lsr-id 1.1.1.9</strong>
[<span class="keyword">*</span>PE1]<strong> mpls</strong>
[<span class="keyword">*</span>PE1-mpls]<strong> lsp-trigger all</strong>
[<span class="keyword">*</span>PE1-mpls]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> mpls ldp</strong>
[<span class="keyword">*</span>PE1-mpls-ldp]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> ospf 10</strong>
[<span class="keyword">*</span>PE1-ospf-10]<strong> area 0</strong>
[<span class="keyword">*</span>PE1-ospf-10-area-0.0.0.0]<strong> network 1.1.1.9 0.0.0.0</strong>
[<span class="keyword">*</span>PE1-ospf-10-area-0.0.0.0]<strong> network 10.11.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>PE1-ospf-10-area-0.0.0.0]<strong> quit</strong>
[<span class="keyword">*</span>PE1-ospf-10]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> interface vlanif 20</strong>
[<span class="keyword">*</span>PE1-Vlanif20]<strong> mpls</strong>
[<span class="keyword">*</span>PE1-Vlanif20]<strong> mpls ldp</strong>
[<span class="keyword">*</span>PE1-Vlanif20]<strong> quit</strong>
[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure PE2. Specifically, enable MPLS LDP and use OSPF10 routes to ensure route reachability between PEs. LSPs are then set up automatically.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> mpls lsr-id 3.3.3.9</strong>
[<span class="keyword">*</span>PE2]<strong> mpls</strong>
[<span class="keyword">*</span>PE2-mpls]<strong> lsp-trigger all</strong>
[<span class="keyword">*</span>PE2-mpls]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> mpls ldp</strong>
[<span class="keyword">*</span>PE2-mpls-ldp]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> ospf 10</strong>
[<span class="keyword">*</span>PE2-ospf-10]<strong> area 0</strong>
[<span class="keyword">*</span>PE2-ospf-10-area-0.0.0.0]<strong> network 3.3.3.9 0.0.0.0</strong>
[<span class="keyword">*</span>PE2-ospf-10-area-0.0.0.0]<strong> network 10.11.1.0 0.0.0.255</strong>
[<span class="keyword">*</span>PE2-ospf-10-area-0.0.0.0]<strong> quit</strong>
[<span class="keyword">*</span>PE2-ospf-10]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> interface vlanif 10</strong>
[<span class="keyword">*</span>PE2-Vlanif10]<strong> mpls</strong>
[<span class="keyword">*</span>PE2-Vlanif10]<strong> mpls ldp</strong>
[<span class="keyword">*</span>PE2-Vlanif10]<strong> quit</strong>
[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure a VPN instance named vpn2 on PE1 and configure a routing protocol on PE1, CE1, and CE3.</span><p><p># Configure vpn2 and OSPF20 on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> ip vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2] <strong>route-distinguisher 100:2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2] <strong>vpn-target 222:2 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2] <strong>vpn-target 222:2 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Vlanif10]<strong> ip binding vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Vlanif10]<strong> ip address 10.5.1.2 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Vlanif10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack0]<strong> ip binding vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack0]<strong> ip address 4.4.4.9 255.255.255.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack0]<strong> binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> ospf 20 vpn-instance vpn2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-20] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-20-area-0.0.0.0] <strong>network 10.5.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-20-area-0.0.0.0] <strong>network 4.4.4.9 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-20-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-20]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<p># Configure OSPF20 between CE1 and CE3 to ensure communication between PE1, CE1, and CE3.</p>
</p></li><li><span>Establish a GRE tunnel between CE3 and PE1.</span><p><p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3]<strong> interface loopback1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-LoopBack1]<strong> binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-LoopBack1]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3-LoopBack1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3]<strong> interface tunnel2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Tunnel2]<strong> ip address 2.2.2.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Tunnel2]<strong> tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Tunnel2]<strong> source 5.5.5.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Tunnel2]<strong> destination 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Tunnel2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack0]<strong> binding tunnel gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack0]<strong> commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-LoopBack0]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> ip address 2.2.2.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>tunnel-protocol gre</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1] <strong>source 4.4.4.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> destination vpn-instance vpn2 5.5.5.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The specified destination tunnel address must belong to vpn2 because the GRE tunnel between PE1 and CE3 traverses vpn2.</p>
</div></div>
<p># After the configurations are complete, a GRE tunnel is established between CE3 and PE1.</p>
</p></li><li><span>Create a VPN instance named vpn1 on PE1 and bind the GRE tunnel to the VPN instance.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong>ip vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>vpn-target 111:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>vpn-target 111:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> ip binding vpn-instance vpn1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> ip address 2.2.2.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
</p></li><li><span>Create a VPN instance named vpn1 on PE2 and bind the VLANIF interface to the VPN instance.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong>ip vpn-instance vpn1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>route-distinguisher 200:1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>vpn-target 111:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>vpn-target 111:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vpn-instance-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface vlanif 20 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Vlanif20]<strong> ip binding vpn-instance vpn1 </strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Vlanif20]<strong> ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Vlanif20]<strong> undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Vlanif20]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Configure IS-IS routes between CE3 and PE1.</span><p><p># Configure CE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE3]<strong> isis 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-isis-50]<strong> network-entity 50.0000.0000.0001.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-isis-50]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Vlanif10]<strong> isis enable 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Vlanif10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> interface tunnel2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Tunnel2]<strong> isis enable 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3-Tunnel2]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE3]<strong> commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> isis 50 vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-50]<strong> network-entity 50.0000.0000.0002.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-50]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> interface tunnel1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> isis enable 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-Tunnel1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1]<strong> commit</strong></pre>
</p></li><li><span>Configure IS-IS routes between CE2 and PE2.</span><p><p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2]<strong> isis 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-isis-50]<strong> network-entity 50.0000.0000.0004.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-isis-50]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Vlanif10]<strong> isis enable 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Vlanif10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> interface vlanif 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Vlanif20]<strong> isis enable 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Vlanif20]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2]<strong> commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> isis 50 vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-50]<strong> network-entity 50.0000.0000.0003.00</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-50]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Vlanif10]<strong> isis enable 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-Vlanif10]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2]<strong> commit</strong></pre>
</p></li><li><span>Set up an MP-IBGP peer relationship between PEs.</span><p><p># On PE1, specify PE2 as an IBGP peer, use a loopback interface to set up an IBGP connection with PE2, and enable the capability of exchanging VPN-IPv4 routes with PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>peer 3.3.3.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> peer 3.3.3.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 3.3.3.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> commit</strong></pre>
<p># Enter the view of the BGP VPN instance vpn1 and import OSPF and IS-IS routes.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bgp]<strong> ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>import-route isis 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>import-route ospf 20</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bgp]<strong> quit</strong></pre>
<p># On PE2, specify PE1 as an IBGP peer, use a loopback interface to set up an IBGP connection with PE1, and enable the capability of exchanging VPN-IPv4 routes with PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 1.1.1.9 connect-interface loopback 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 1.1.1.9 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-vpnv4]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> commit</strong></pre>
<p># Import IS-IS routes into the BGP VPN instance named vpn1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bgp]<strong> ipv4-family vpn-instance vpn1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>import-route isis 50</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-vpn1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp]<strong> quit</strong></pre>
</p></li><li><span>Import BGP routes into IS-IS.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1]<strong> isis 50</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-isis-50] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-isis-50] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2]<strong> isis 50</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-isis-50] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-isis-50] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p># After the configurations are complete, CE2 and CE3 can ping each other.</p>
<pre class="screen">&lt;CE3&gt; <strong>ping 10.41.1.2</strong></pre>
<pre class="screen">  PING 10.41.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.41.1.2: bytes=56 Sequence=1 ttl=253 time=160 ms</pre>
<pre class="screen">    Reply from 10.41.1.2: bytes=56 Sequence=2 ttl=253 time=90 ms</pre>
<pre class="screen">    Reply from 10.41.1.2: bytes=56 Sequence=3 ttl=253 time=160 ms</pre>
<pre class="screen">    Reply from 10.41.1.2: bytes=56 Sequence=4 ttl=253 time=100 ms</pre>
<pre class="screen">    Reply from 10.41.1.2: bytes=56 Sequence=5 ttl=253 time=160 ms</pre>
<pre class="screen"> </pre>
<pre class="screen">  --- 10.41.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 90/134/160 ms</pre>
<pre class="screen"> </pre>
<pre class="screen">&lt;CE2&gt;<strong> ping 10.21.1.2</strong></pre>
<pre class="screen">  PING 10.21.1.2: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.21.1.2: bytes=56 Sequence=1 ttl=253 time=440 ms</pre>
<pre class="screen">    Reply from 10.21.1.2: bytes=56 Sequence=2 ttl=253 time=100 ms</pre>
<pre class="screen">    Reply from 10.21.1.2: bytes=56 Sequence=3 ttl=253 time=100 ms</pre>
<pre class="screen">    Reply from 10.21.1.2: bytes=56 Sequence=4 ttl=253 time=120 ms</pre>
<pre class="screen">    Reply from 10.21.1.2: bytes=56 Sequence=5 ttl=253 time=120 ms</pre>
<pre class="screen"> </pre>
<pre class="screen">  --- 10.21.1.2 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 100/176/440 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369107__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE3 configuration file</p>
<pre class="screen">#
sysname CE3
#
vlan batch 10 20
#
isis 50
 network-entity 50.0000.0000.0001.00
#
interface Vlanif10
 ip address 10.21.1.2 255.255.255.0
 isis enable 50
#
interface Vlanif20
 ip address 10.3.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port default vlan 10
#
interface GigabitEthernet<span>0/2/0</span>
 portswitch
 undo shutdown
 port default vlan 20
<span>#
interface LoopBack1
 ip address 5.5.5.9 255.255.255.255
 binding tunnel gre</span>
#
interface Tunnel2
 ip address 2.2.2.1 255.255.255.0
 tunnel-protocol gre
 source 5.5.5.9
 destination 4.4.4.9

 isis enable 50
#
ospf 20
 area 0.0.0.0
<span>  network 5.5.5.9 0.0.0.0</span>
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
vlan batch 10 20
#
interface Vlanif10
 ip address 10.5.1.1 255.255.255.0
#
interface Vlanif20
 ip address 10.3.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port default vlan 20
#
interface GigabitEthernet<span>0/2/0</span>
 portswitch
 undo shutdown
 port default vlan 10
#
ospf 20
 area 0.0.0.0
  network 10.3.1.0 0.0.0.255
  network 10.5.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
vlan batch 10 20
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
ip vpn-instance vpn2
 ipv4-family
  route-distinguisher 100:2
  apply-label per-instance
  vpn-target 222:2 export-extcommunity
  vpn-target 222:2 import-extcommunity
#
mpls lsr-id 1.1.1.9
#
mpls
 lsp-trigger all
#
mpls ldp
#
isis 50 vpn-instance vpn1
 network-entity 50.0000.0000.0002.00
 import-route bgp
#
interface Vlanif10
 ip binding vpn-instance vpn2
 ip address 10.5.1.2 255.255.255.0
#
interface Vlanif20
 ip address 10.11.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port default vlan 10
#
interface GigabitEthernet<span>0/2/0</span>
 portswitch
 undo shutdown
 port default vlan 20
#
interface LoopBack1
 ip address 1.1.1.9 255.255.255.255
#
interface LoopBack0
 ip binding vpn-instance vpn2
 ip address 4.4.4.9 255.255.255.255
<span> binding tunnel gre</span>
#
interface Tunnel1
 ip binding vpn-instance vpn1
 ip address 2.2.2.2 255.255.255.0
 tunnel-protocol gre
 source 4.4.4.9
 destination vpn-instance vpn2 5.5.5.9
 isis enable 50
#
bgp 100
 peer 3.3.3.9 as-number 100
 peer 3.3.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization 
  peer 3.3.3.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 3.3.3.9 enable
 #
 ipv4-family vpn-instance vpn1
  import-route ospf 20
  import-route isis 50
#
ospf 10
 area 0.0.0.0
  network 1.1.1.9 0.0.0.0
  network 10.11.1.0 0.0.0.255
#
ospf 20 vpn-instance vpn2
 area 0.0.0.0
  network 4.4.4.9 0.0.0.0
  network 10.5.1.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
vlan batch 10 20
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 111:1 export-extcommunity
  vpn-target 111:1 import-extcommunity
#
mpls lsr-id 3.3.3.9
#
mpls
 lsp-trigger all
#
mpls ldp
#
isis 50 vpn-instance vpn1
 network-entity 50.0000.0000.0003.00
 import-route bgp
#
interface Vlanif10
 ip binding vpn-instance vpn1
 ip address 10.1.1.2 255.255.255.0
 isis enable 50
#
interface Vlanif20
 ip address 10.11.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port default vlan 20
#
interface GigabitEthernet<span>0/2/0</span>
 portswitch
 undo shutdown
 port default vlan 10
#
interface LoopBack1
 ip address 3.3.3.9 255.255.255.255
#
bgp 100
 peer 1.1.1.9 as-number 100
 peer 1.1.1.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization 
  peer 1.1.1.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 1.1.1.9 enable
 #
 ipv4-family vpn-instance vpn1
  import-route isis 50
#
ospf 10
 area 0.0.0.0
  network 3.3.3.9 0.0.0.0
  network 10.11.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
vlan batch 10 20
#
isis 50
 network-entity 50.0000.0000.0004.00
#
interface Vlanif10
 ip address 10.1.1.1 255.255.255.0
 isis enable 50
#
interface Vlanif20
 ip address 10.41.1.2 255.255.255.0
 isis enable 50
#
interface GigabitEthernet<span>0/1/0</span>
 portswitch
 undo shutdown
 port default vlan 10
#
interface GigabitEthernet<span>0/2/0</span>
 portswitch
 undo shutdown
 port default vlan 20
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2020.html">Configuration Examples for GRE
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2039.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_gre_cfg_2037.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>