
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring an EVPN Instance">
<meta name="abstract" content="You can configure EVPN instances on PEs to manage EVPN routes.">
<meta name="description" content="You can configure EVPN instances on PEs to manage EVPN routes.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0003.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="p00915595">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370435">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring an EVPN Instance</title>
</head>
<body><a name="EN-US_TASK_0172370435"></a><a name="EN-US_TASK_0172370435"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring an EVPN Instance</h1>
<div class="taskbody"><p>You can configure EVPN instances on PEs to manage EVPN routes.</p>
<div class="context"><a name="EN-US_TASK_0172370435__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>EVPN instances are used to isolate EVPN routes from public routes and isolate the routes of EVPN instances from each other.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370435__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span><p><p>An EVPN instance is created, and its view is displayed.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=description"><b><span class="cmdname">description</span></b></a> <i><span class="varname">description-information</span></i></span><p><p>A description is configured for the EVPN instance.</p>
<p>Similar to a hostname or an interface description, an EVPN instance description helps you memorize the EVPN instance.</p>
</p></li><li><span>Run <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i></span><p><p>An RD is configured for the EVPN instance.</p>
</p><p><p>An EVPN instance takes effect only after an RD is configured for it. The RDs of different EVPN instances on a PE must be different.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If you need to create a large number of EVPN instances and plan a large number of RDs, you can run the <strong>evpn route-distinguisher auto</strong> <em>rd-ip</em> command in the system view to enable automatic RD allocation, thereby avoiding RD conflicts. The <em>rd-ip</em> parameter specifies an IPv4 address, enabling a device to allocate RDs in the format of <em>X.X.X.X</em>:<em>index</em> to all EVPN instances that are not allocated RDs. <em>X.X.X.X</em> indicates a user-defined RD-IP value, and <em>index</em> is a 2-byte value automatically allocated by the system in the range from 1 to 65535.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ]</span><p><p>One or multiple VPN targets are configured for the EVPN instance.</p>
<p>VPN targets are BGP extended community attributes used to control the acceptance and advertisement of EVPN routes. A maximum of eight import VPN targets and eight export VPN targets can be configured each time the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> command is run. To configure more VPN targets for an EVPN instance address family, run the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> command multiple times.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>An RT of an Ethernet segment route is generated using the middle six bytes of an ESI. For example, if the ESI is 0011.1001.1001.1001.1002, the Ethernet segment route uses 11.1001.1001.10 as its RT.</p>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=filter-policy"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>export</span></strong></span><p><p>The EVPN instance is configured to filter MAC advertisement routes to be advertised.</p>
<p>To precisely control EVPN routes, an export route-policy must be configured. An export route-policy filters routes before they are sent to other PEs.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=filter-policy"><b><span class="cmdname">filter-policy</span></b></a> { <i><span class="varname">acl-number</span></i> | <strong><span>acl-name</span></strong> <i><span class="varname">acl-name</span></i> } <strong><span>import</span></strong></span><p><p>The EVPN instance is configured to filter received MAC advertisement routes.</p>
<p>To precisely control EVPN routes, an import route-policy must be configured. An import route-policy filters routes that are received from other PEs.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> <i><span class="varname">number</span></i> [ <strong><span>simply-alert</span></strong> | <strong><span>mac-unchanged</span></strong> ]</span><p><p>The maximum number of MAC addresses allowed in the EVPN instance is set.</p>
<p>A device consumes more system resources as it learns more MAC addresses, meaning that the device may fail to operate when busy processing services. To limit the maximum number of MAC addresses allowed in an EVPN instance and thereby improve device security and reliability, run the <a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> command. After this configuration, if the number of MAC addresses exceeds the preset value, an alarm is triggered to prompt you to check the validity of existing MAC addresses.</p>
<p>After the maximum number of MAC addresses allowed by an EVPN instance is configured, you can run the <a href="cmdqueryname=mac+threshold-alarm"><b><span class="cmdname">mac threshold-alarm</span></b></a> <strong><span>upper-limit</span></strong> <i><span class="varname">upper-limit-value</span></i> <strong><span>lower-limit</span></strong> <i><span class="varname">lower-limit-value</span></i> command to configure alarm thresholds for MAC addresses allowed by the EVPN instance. The alarm generation and clearance help a device detect threshold-crossing events of MAC addresses.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i></span><p><p>The EVPN instance is associated with a tunnel policy.</p>
<p>This configuration enables PEs to use TE tunnels to transmit data packets.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=isolate+spoken"><b><span class="cmdname">isolate spoken</span></b></a></span><p><p>The forwarding isolation function is enabled for the EVPN instance.</p>
</p><p><p>When users with the same service are bound to the same EVPN instance, you can configure the forwarding isolation function for the EVPN instance to prevent mutual access between them.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=control-word+enable"><b><span class="cmdname">control-word enable</span></b></a></span><p><p>The control word function is enabled for the EVPN instance.</p>
<p>In load balancing mode, out-of-order packets may be generated when the device performs in-depth parsing on MPLS packets. In this case, you can enable the control word function in the EVPN instances on both ends to reassemble MPLS packets.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=reserve-interface+fast-switch+enable"><b><span class="cmdname">reserve-interface fast-switch enable</span></b></a></span><p><p>The reserve-interface fast switching function is enabled.</p>
<p>When the active interface board fails, you can perform this step to enable reserve-interface fast switching, so that broadcast traffic can be quickly switched to the standby interface board.</p>
</p></li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0003.html">Configuring EVPN VPLS over MPLS (Common EVPN Instance)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0012.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>