
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring TDMoPSN">
<meta name="abstract" content="Time division multiplexing (TDM) transparent transmission provides a new alternative for wireless carriers. It enables services between the base transceiver stations (BTSs) and base station controllers (BSCs) in the same city to be transparently transmitted over simple and cost-effective links on a metro Ethernet. The data of fractional E1 interfaces can be transmitted from GSM BTSs to BSCs in Structure-Aware TDM Circuit Emulation Service over Packet Switched Network (CESoPSN) mode.">
<meta name="description" content="Time division multiplexing (TDM) transparent transmission provides a new alternative for wireless carriers. It enables services between the base transceiver stations (BTSs) and base station controllers (BSCs) in the same city to be transparently transmitted over simple and cost-effective links on a metro Ethernet. The data of fractional E1 interfaces can be transmitted from GSM BTSs to BSCs in Structure-Aware TDM Circuit Emulation Service over Packet Switched Network (CESoPSN) mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6071.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6017.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369963">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring TDMoPSN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369963"></a><a name="EN-US_TASK_0172369963"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring TDMoPSN</h1>
<div class="taskbody"><p>Time division multiplexing (TDM) transparent transmission provides a new alternative for wireless carriers. It enables services between the base transceiver stations (BTSs) and base station controllers (BSCs) in the same city to be transparently transmitted over simple and cost-effective links on a metro Ethernet. The data of fractional E1 interfaces can be transmitted from GSM BTSs to BSCs in Structure-Aware TDM Circuit Emulation Service over Packet Switched Network (CESoPSN) mode.</p>
<div class="context"><a name="EN-US_TASK_0172369963__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>Generally, on a 2G RAN, one to three E1 interfaces on a BTS are connected to a BSC. Some mobile carriers do not have fixed network infrastructure, and have to rent E1 lines from fixed-line network carriers at a high price. By deploying the TDMoPSN service, that is, TDM transparent transmission on a 2G RAN, carriers can transmit services between the BTSs and BSCs in the same city over TDM links on a simple and cost-effective metro Ethernet network.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172369963__fig_dc_vrp_vpws_cfg_601301">Figure 1</a>, it is required that the BTS and PE1 be connected through two E1 links, and the BSC and PE2 be connected through CPOS interfaces. On the channelized serial interface of an E1 link, the encapsulation protocol is TDM. Then, a PW is set up between PE1 and PE2 to transparently transmit TDM frames.</p>
<div class="fignone" id="EN-US_TASK_0172369963__fig_dc_vrp_vpws_cfg_601301"><a name="EN-US_TASK_0172369963__fig_dc_vrp_vpws_cfg_601301"></a><a name="fig_dc_vrp_vpws_cfg_601301"></a><span class="figcap"><b>Figure 1 </b>Network diagram of configuring TDMoPSN</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><div class="p"><ul><li>In this example, interfaces 1 through 3 represent GE<span>0/1/0</span>, GE<span>0/2/0</span>, and CPOS<span>0/3/0</span>, respectively.</li></ul>
</div>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001308753274.png" width="NaN" height="NaN"></span><br><div class="tableBorder"><table cellpadding="4" cellspacing="0" summary=""><tr><td valign="top"><p>Router</p>
</td>
<td valign="top"><p>Interface</p>
</td>
<td valign="top"><p>IP Address</p>
</td>
</tr>
<tr><td valign="top"><p>PE1</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.1.1.1/24</p>
<p>192.168.2.2/32</p>
</td>
</tr>
<tr><td valign="top"><p>P</p>
</td>
<td valign="top"><p>GE<span>0/1/0</span></p>
<p>GE<span>0/2/0</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.1.1.2/24</p>
<p>10.2.1.1/24</p>
<p>192.168.4.4/32</p>
</td>
</tr>
<tr><td valign="top"><p>PE2</p>
</td>
<td valign="top"><p>GE<span>0/2/0</span></p>
<p>Loopback0</p>
</td>
<td valign="top"><p>10.2.1.2/24</p>
<p>192.168.3.3/32</p>
</td>
</tr>
</table></div>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369963__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Run an IGP on the backbone network so that devices can communicate with each other.</p>
</li><li><p>Configure basic MPLS functions on the backbone network, and configure MPLS L2VPN functions on PEs. Then, establish a remote MPLS LDP peer relationship between the endpoint PEs of the PW.</p>
</li><li><p>Configure parameters for the TDM interface.</p>
</li><li><p>Configure PWs.</p>
</li><li><p>Establish MPLS L2VC connections on PEs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369963__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>Same L2VC ID at both ends of the PW</li><li>MPLS LSR IDs of the PEs and P router</li><li>IP addresses assigned to the remote peers of PEs</li><li>Coding mode and frame format of the E1/CE1 interface</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369963__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run an IGP on the backbone network so that devices can communicate with each other. For detailed configurations, see Configuration Files.</span></li><li><span>Configure basic MPLS functions on the backbone network, and configure MPLS L2VPN functions on PEs. Establish a remote MPLS LDP peer relationship between the endpoint PEs of the PW. For detailed configurations, see Configuration Files.</span><p><p>The remote MPLS LDP peer relationship is required only for the dynamic PW.</p>
</p></li><li><span>Configure parameters for the TDM interface.</span><p><ol type="a"><li><p>Configure PE1.</p>
<p># Configure the channelized mode, AMI code, and CRC4 frames for CE1 <span>0/2/1</span>1 and CE1 <span>0/2/2</span> on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>controller e1 <span>0/2/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-E1 <span>0/2/1</span>] <strong>using ce1</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/1</span>] <strong>code ami</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/1</span>] <strong>frame-format crc4</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/1</span>] <strong>channel-set 1 timeslot-list 1-15</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>controller e1 <span>0/2/2</span></strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/2</span>] <strong>using ce1</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/2</span>] <strong>code ami</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/2</span>] <strong>frame-format crc4</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/2</span>] <strong>channel-set 1 timeslot-list 16-31</strong>
[<span class="keyword">*</span>PE1-E1 <span>0/2/2</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Configure PE2.</p>
<p># Set parameters for the CPOS interface on PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>controller cpos <span>0/3/1</span></strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Cpos<span>0/3/1</span>] <strong>e1 1 channel-set 1 timeslot-list 1-15</strong>
[<span class="keyword">*</span>PE2-Cpos<span>0/3/1</span>] <strong>e1 2 channel-set 2 timeslot-list 16-31</strong>
[<span class="keyword">*</span>PE2-Cpos<span>0/3/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure the encapsulation protocol on the serial interface as TDM.</span><p><ol type="a"><li><p>Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface serial<span>0/2/1</span>:1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-Serial<span>0/2/1</span>:1] <strong>link-protocol tdm</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/1</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface serial<span>0/2/2</span>:1</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/2</span>:1] <strong>link-protocol tdm</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/2</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>interface serial<span>0/3/1</span>:1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-Serial<span>0/3/1</span>:1] <strong>link-protocol tdm</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface serial<span>0/3/1</span>:2</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:2] <strong>link-protocol tdm</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:2] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure PWs.</span><p><ol type="a"><li><p>Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>pw-template 1to3</strong>
[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>peer-address 192.168.3.3</strong>
[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>jitter-buffer depth 20</strong>
[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>tdm-encapsulation-number 40</strong>
<span>[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>idle-code 33</strong></span>
[<span class="keyword">*</span>PE1-pw-template-1to3] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface serial<span>0/2/1</span>:1</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/1</span>:1] <strong>mpls l2vc pw-template 1to3 100</strong>
[<span class="keyword">*</span>PE1] <strong>interface serial<span>0/2/2</span>:1</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/2</span>:1] <strong>mpls l2vc pw-template 1to3 200</strong>
[<span class="keyword">*</span>PE1-Serial<span>0/2/2</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>pw-template 3to1</strong>
[<span class="keyword">*</span>PE2-pw-template-3to1] <strong>peer-address 192.168.2.2</strong>
[<span class="keyword">*</span>PE2-pw-template-3to1] <strong>jitter-buffer depth 20</strong>
[<span class="keyword">*</span>PE2-pw-template-3to1] <strong>tdm-encapsulation-number 40</strong>
<span>[<span class="keyword">*</span>PE2-pw-template-3to1] <strong>idle-code 33</strong></span>
[<span class="keyword">*</span>PE2-pw-template-3to1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface serial<span>0/3/1</span>:1</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:1] <strong>mpls l2vc pw-template 3to1 100</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:1] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface serial<span>0/3/1</span>:2</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:2] <strong>mpls l2vc pw-template 3to1 200</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:2] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE2-Serial<span>0/3/1</span>:2] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display mpls l2vc</strong> command on PEs to check PW status. The command output shows that the status is up.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">&lt;<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1&gt; <strong>display mpls l2vc interface serial<span>0/2/1</span>:1</strong>
*client interface       : Serial<span>0/2/1</span>:1 is up
<strong>  session state          : up</strong>
<strong>  AC status              : up</strong>
<strong>  VC state               : up</strong>
  VC ID                  : 100
  VC type                : CESoPSN basic mode
  destination            : 192.168.3.3
  local group ID         : 0 
  remote group ID        : 0
  local VC label         : 146432
  remote VC label        : 145287
  TDM encapsulation number : 40
  jitter-buffer            : 20
  <span>idle-code                : 33</span>
  rtp-header               : disable
  local AC OAM State     : up
  local PSN State        : up
  local forwarding state : forwarding
  local status code      : 0x0
  remote AC OAM state    : up
  remote PSN state       : up
  remote forwarding state: forwarding
  remote statuscode      : 0x0   
  BFD for PW             : unavailable
  manual fault           : not set
  active state           : active
  forwarding entry       : not exist
  link state             : up
  local VC MTU           : 1500         
  remote VC MTU          : 1500
  local VCCV             : alert lsp-ping bfd
  remote VCCV            : none
  local control word     : disable      
  remote control word    : disable
  tunnel policy name     : --
  traffic behavior name  : --
  PW template name       : --
  primary or secondary   : primary
  VC tunnel/token info  : 1 tunnels/tokens
  NO.0 TNL type : lsp , TNL ID : 0x208000
  create time            : 0 days, 4 hours, 48 minutes, 51 seconds
  up time                : 0 days, 3 hours, 43 minutes, 49 seconds
  last change time       : 0 days, 0 hours, 39 minutes, 29 seconds
  VC last up time        : 2008/12/26 12:02:49
  VC total up time       : 0 days, 3 hours, 43 minutes, 49 seconds
  CKey                   : 11
  NKey                   : 10
  PW redundancy mode     : frr
  AdminPw interface      : --
  AdminPw link state     : --
<span>  Forward state          : send inactive, receive inactive </span>
  Diffserv Mode          : uniform
  Service Class          : --
  Color                  : --
  DomainId               : --
  Domain Name            : --

</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369963__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 192.168.2.2
#
mpls
#
mpls l2vpn
#
pw-template 1to3
 peer-address 192.168.3.3
 jitter-buffer depth 20
 tdm-encapsulation-number 40
 <span>idle-code 33</span>
#
mpls ldp
#
 mpls ldp remote-peer 192.168.3.3
 remote-ip 192.168.3.3 
#
controller e1 <span>0/2/1</span>
 using ce1
 code ami
 frame-format crc4
 channel-set 1 timeslot-list 1-15
 undo shutdown
#
controller e1 <span>0/2/2</span>
 using ce1
 code ami
 frame-format crc4
 channel-set 1 timeslot-list 16-31
 undo shutdown
#
interface serial<span>0/2/1</span>:1
 link-protocol tdm
 mpls l2vc pw-template 1to3 100
 undo shutdown
#
interface serial<span>0/2/2</span>:1
 link-protocol tdm
 mpls l2vc pw-template 1to3 200
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 192.168.2.2 255.255.255.255
#
ospf 1
area 0.0.0.0
  network 192.168.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
#
return
</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 192.168.3.3
#
mpls
#
mpls l2vpn
#
pw-template 3to1
 peer-address 192.168.2.2
 jitter-buffer depth 20
 tdm-encapsulation-number 40
 <span>idle-code 33</span>
#
mpls ldp
#
mpls ldp remote-peer 192.168.2.2
 remote-ip 192.168.2.2
#
controller cpos <span>0/3/1</span>
 e1 1 channel-set 1 timeslot-list 1-15
 code ami
 e1 2 channel-set 2 timeslot-list 16-31
#
interface serial<span>0/3/1</span>:1
 link-protocol tdm
 mpls l2vc pw-template 3to1 100
 undo shutdown
#
interface serial<span>0/3/1</span>:2
 link-protocol tdm
 mpls l2vc pw-template 3to1 200
 undo shutdown
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 192.168.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 192.168.3.3 0.0.0.0
  network 10.2.2.0 0.0.0.255
#
return
</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 192.168.4.4
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 192.168.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 192.168.4.4 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.2.0 0.0.0.255
#
return
</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">Configuration Examples for VPWS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6071.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_6017.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>