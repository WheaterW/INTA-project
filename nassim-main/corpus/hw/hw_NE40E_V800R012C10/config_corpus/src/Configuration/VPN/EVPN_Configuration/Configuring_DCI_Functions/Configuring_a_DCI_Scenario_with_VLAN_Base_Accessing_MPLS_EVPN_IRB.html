
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring a DCI Scenario with VLAN Base Accessing MPLS EVPN IRB">
<meta name="abstract" content="In a DCI scenario, to enable a DCI network to carry Layer 2 or Layer 3 services, you can associate Ethernet sub-interfaces with VLANs for gateway or DCN access and configure EVPN IRB.">
<meta name="description" content="In a DCI scenario, to enable a DCI network to carry Layer 2 or Layer 3 services, you can associate Ethernet sub-interfaces with VLANs for gateway or DCN access and configure EVPN IRB.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0002.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0027.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00556928,l00468467,w00606909,evpnvrp,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370570">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring a DCI Scenario with VLAN Base Accessing MPLS EVPN IRB</title>
</head>
<body><a name="EN-US_TASK_0172370570"></a><a name="EN-US_TASK_0172370570"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring a DCI Scenario with VLAN Base Accessing MPLS EVPN IRB</h1>
<div class="taskbody"><p>In a DCI scenario, to enable a DCI network to carry Layer 2 or Layer 3 services, you can associate Ethernet sub-interfaces with VLANs for gateway or DCN access and configure EVPN IRB.</p>
<div class="context"><a name="EN-US_TASK_0172370570__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><div class="p">VXLAN tunnels are established in each DC for intra-DC VM communication. To implement Layer 2 or Layer 3 service communication between VMs in different DCs, associate Ethernet sub-interfaces with VLANs, create L3VPN or EVPN instances, and configure EVPN IRB on PEs on the DCI backbone network. This type of networking can be deployed in either of the following modes:<ul><li><p>Integrated deployment: As shown in <a href="#EN-US_TASK_0172370570__fig_dc_vrp_dci_cfg_002901">Figure 1</a>, the DC gateway and DCI-PE are the same device (DCI-PE-GW). That is, the PE also functions as the DC gateway for DCN access.</p>
<div class="fignone" id="EN-US_TASK_0172370570__fig_dc_vrp_dci_cfg_002901"><a name="EN-US_TASK_0172370570__fig_dc_vrp_dci_cfg_002901"></a><a name="fig_dc_vrp_dci_cfg_002901"></a><span class="figcap"><b>Figure 1 </b>Configuring a DCI scenario with VLAN base accessing MPLS EVPN IRB (PEs also functioning as gateways)</span><br><span><img class="vsd" src="images/fig_dc_vrp_dci_cfg_002901.png" width="NaN" height="NaN"></span></div>
</li><li><p>Separate deployment: As shown in <a href="#EN-US_TASK_0172370570__fig_dc_vrp_dci_cfg_002801">Figure 2</a>, the DC gateway and PE (DCI-PE) are separately deployed. The DCI-PEs consider DC gateways as CEs, receive Layer 2 and Layer 3 service traffic through Ethernet sub-interfaces and VBDIF interfaces associated with VLANs, and forward the traffic to other DCs through the DCI backbone network.</p>
<div class="fignone" id="EN-US_TASK_0172370570__fig_dc_vrp_dci_cfg_002801"><a name="EN-US_TASK_0172370570__fig_dc_vrp_dci_cfg_002801"></a><a name="fig_dc_vrp_dci_cfg_002801"></a><span class="figcap"><b>Figure 2 </b>Configuring a DCI scenario with VLAN base accessing MPLS EVPN IRB (separate deployment of PEs and gateways)</span><br><span><img class="vsd" src="images/fig_dc_vrp_dci_cfg_000401.png" width="NaN" height="NaN"></span></div>
</li></ul>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370570__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring a DCI scenario with VLAN base accessing MPLS EVPN IRB, complete the following task:</p>
<p>Configure Layer 3 route reachability on the IPv4 network.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370570__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure BGP EVPN peers.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If a BGP RR needs to be configured on the network, establish BGP EVPN peer relationships between all the PEs and the RR.</p>
</div></div>
</p><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enable BGP and enter its view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer+as-number"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> { <i><span class="varname">as-number-plain</span></i> | <i><span class="varname">as-number-dot</span></i> } command to configure the remote PE as a peer.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>connect-interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">ipv4-source-address</span></i> ] command to specify a source interface and a source address for the setup of a TCP connection with the BGP peer. </span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If loopback interfaces are used to establish a BGP connection, it is recommended that the <a href="cmdqueryname=peer+connect-interface"><b><span class="cmdname">peer connect-interface</span></b></a> command be run on both ends to ensure correct connection. If this command is run on only one end, the BGP connection may fail to be established.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i><span> or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span> command to enter the BGP-VPN instance IPv4<span> or IPv6</span> address family view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> { <strong><span>direct</span></strong> | <strong><span>isis</span></strong> <i><span class="varname">process-id</span></i> | <strong><span>ospf</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>rip</span></strong> <i><span class="varname">process-id</span></i></span> | <strong><span>static</span></strong><span> | <strong><span>ospfv3</span></strong> <i><span class="varname">process-id</span></i><span> | <strong><span>ripng</span></strong> <i><span class="varname">process-id</span></i></span></span> } [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> | <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <sup>*</sup> command to import other protocol routes into the BGP-VPN instance IPv4<span>/IPv6</span> address family. If host IP route advertisement is required, configure <strong><span>direct</span></strong> in the command. To advertise the subnet route of the host, use a dynamic routing protocol (such as OSPF) to advertise the route and then perform this step to import the routes of the dynamic routing protocol. To advertise host IP routes, you only need to configure import of direct routes. To advertise the subnet route of the host, use a dynamic routing protocol (such as OSPF) to advertise the route and then perform this step to import the routes of the dynamic routing protocol.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a> command to configure IP prefix route advertisement. This type of route can be used to advertise host IP routes as well as the routes on the subnet where the device resides. This type of route can be used to advertise host IP routes as well as the routes on the subnet where the device resides.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a> command to enter the BGP-EVPN address family view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer+enable"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>enable</span></strong> command to enable the function to exchange EVPN routes with a specified peer or peer group.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer+advertise"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>advertise</span></strong> <span>{ </span><strong><span>irb</span></strong><span> | <strong><span>irbv6</span></strong> }</span> command to enable the function to advertise IRB<span>/IRBv6</span> routes.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li></ol>
</li><li><span>(Optional) Configure an L3VPN instance to store and manage received VM routes. Perform this step if you want the network to carry Layer 3 services.</span><p><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1256296168214055">For IPv4 services, configure an IPv4 L3VPN instance.</p>
<ol type="a" id="EN-US_TASK_0172370570__en-us_task_0172370455_ol411147739214055"><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li403992803214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1711231854214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li403992803214055"></a><a name="en-us_task_0172370455_li403992803214055"></a>Run the <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname161683155214055">ip vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname154384487389">vpn-instance-name</span></i> command to create a VPN instance and enter its view.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li2094488633214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p518513207214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li2094488633214055"></a><a name="en-us_task_0172370455_li2094488633214055"></a>Run the <a href="cmdqueryname=ipv4-family"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname798433783214055">ipv4-family</span></b></a> command to create the VPN instance IPv4 address family and enter its view.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1943663141214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1772656270214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1943663141214055"></a><a name="en-us_task_0172370455_li1943663141214055"></a>Run the <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname1919668482214055">route-distinguisher</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname1823772699214055">route-distinguisher</span></i> command to set an RD for the VPN instance IPv4 address family.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li2136177506214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1103732796214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li2136177506214055"></a><a name="en-us_task_0172370455_li2136177506214055"></a>Run the <a href="cmdqueryname=vpn-target"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname1475133414214055">vpn-target</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname1215753496214055">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname1811851144214055">both</span></strong> | <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname926767063214055">export-extcommunity</span></strong> | <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname510799724214055">import-extcommunity</span></strong> ] <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname64755322214055">evpn</span></strong> command to set one or multiple VPN targets of the VPN instance IPv4 address family.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li2100336584214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p20777902214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li2100336584214055"></a><a name="en-us_task_0172370455_li2100336584214055"></a>Run the <a href="cmdqueryname=evpn+mpls+routing-enable"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname582688485214055">evpn mpls routing-enable</span></b></a> command to enable the device to generate and advertise EVPN IP prefix routes and IRB routes.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1107081080214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p913393952214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1107081080214055"></a><a name="en-us_task_0172370455_li1107081080214055"></a>(Optional) Run the <a href="cmdqueryname=tnl-policy"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname320888508214055">tnl-policy</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname1022252676214055">policy-name</span></i> <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname1317942734214055">evpn</span></strong> command to apply a specified tunnel policy to the VPN instance IPv4 address family to associate the tunnel policy with the EVPN routes leaked to the VPN instance IPv4 address family.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li209184187214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p327900770214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li209184187214055"></a><a name="en-us_task_0172370455_li209184187214055"></a>Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname34877456214055">quit</span></b></a> command to exit the VPN instance IPv4 address family view.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1708439845214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1892114525214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1708439845214055"></a><a name="en-us_task_0172370455_li1708439845214055"></a>Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname1142585052214055">quit</span></b></a> command to exit the VPN instance view.</p>
</li></ol>
<p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1790058968214055">For IPv6 services, configure an IPv6 L3VPN instance.</p>
<ol type="a" id="EN-US_TASK_0172370570__en-us_task_0172370455_ol636855173214055"><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1769426637214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p399944403214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1769426637214055"></a><a name="en-us_task_0172370455_li1769426637214055"></a>Run the <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname397601010116">ip vpn-instance</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname14976121019119">vpn-instance-name</span></i> command to create a VPN instance and enter its view.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1057355604214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p548457503214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1057355604214055"></a><a name="en-us_task_0172370455_li1057355604214055"></a>Run the <a href="cmdqueryname=ipv6-family"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname1793458005214055">ipv6-family</span></b></a> command to create the VPN instance IPv6 address family and enter its view.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1272204040214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1586110748214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1272204040214055"></a><a name="en-us_task_0172370455_li1272204040214055"></a>Run the <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname1163985399214055">route-distinguisher</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname948563513214055">route-distinguisher</span></i> command to set an RD for the VPN instance IPv6 address family.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li805779894214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p710800476214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li805779894214055"></a><a name="en-us_task_0172370455_li805779894214055"></a>Run the <a href="cmdqueryname=vpn-target"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname910854590214055">vpn-target</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname2039626045214055">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname1194374931214055">both</span></strong> | <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname1202431025214055">export-extcommunity</span></strong> | <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname134065371214055">import-extcommunity</span></strong> ] <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname1824613054214055">evpn</span></strong> command to set one or multiple VPN targets for the VPN instance IPv6 address family.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1989316533214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p270069988214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1989316533214055"></a><a name="en-us_task_0172370455_li1989316533214055"></a>Run the <a href="cmdqueryname=evpn+mpls+routing-enable"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname1858371036214055">evpn mpls routing-enable</span></b></a> command to enable the device to generate and advertise EVPN IP prefix routes and IRB routes.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1769778048214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p2011141786214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1769778048214055"></a><a name="en-us_task_0172370455_li1769778048214055"></a>(Optional) Run the <a href="cmdqueryname=tnl-policy"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname370949840214055">tnl-policy</span></b></a> <i><span class="varname" id="EN-US_TASK_0172370570__en-us_task_0172370455_varname7920141991316">policy-name</span></i> <strong><span id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdparmname17920191912134">evpn</span></strong> command to apply a specified tunnel policy to the VPN instance IPv6 address family to associate the tunnel policy with the EVPN routes leaked to the VPN instance IPv6 address family.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li1429083569214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p1150436135214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li1429083569214055"></a><a name="en-us_task_0172370455_li1429083569214055"></a>Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname1283922487214055">quit</span></b></a> command to exit the VPN instance IPv6 address family view.</p>
</li><li id="EN-US_TASK_0172370570__en-us_task_0172370455_li90265400214055"><p id="EN-US_TASK_0172370570__en-us_task_0172370455_p967123018214055"><a name="EN-US_TASK_0172370570__en-us_task_0172370455_li90265400214055"></a><a name="en-us_task_0172370455_li90265400214055"></a>Run the <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172370570__en-us_task_0172370455_cmdname266122991715">quit</span></b></a> command to exit the VPN instance view.</p>
</li></ol>
</p></li><li><span>Configure access-side interfaces.</span><p><ul><li><p>If you want the network to carry both Layer 2 and Layer 3 services, perform the following configurations:</p>
<ol type="a"><li><p>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the view of the BD to be bound to an EVPN instance.</p>
</li><li><p>Run the <a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname">evpn binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i><span> [ <strong><span>bd-tag</span></strong> <i><span class="varname">bd-tag</span></i> ]</span> command to bind the BD to the EVPN instance. <span>By specifying different <i><span class="varname">bd-tag</span></i> values, you can bind multiple BDs to the same EVPN instance. In this way, VLAN services of different BDs can access the same EVPN instance while being isolated.</span></p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number.subnum</span></i> <strong><span>mode l2</span></strong> command to create a Layer 2 sub-interface and enter its view.</p>
</li><li><p>Run the <a href="cmdqueryname=encapsulation"><b><span class="cmdname">encapsulation</span></b></a> { <strong><span>dot1q</span></strong> [ <strong><span>vid</span></strong> <i><span class="varname">low-pe-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-pe-vid</span></i> ] ] | <strong><span>untag</span></strong> | <strong><span>qinq</span></strong> [ <strong><span>vid</span></strong> <i><span class="varname">pe-vid</span></i> <strong><span>ce-vid</span></strong> { <i><span class="varname">low-ce-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-ce-vid</span></i> ] | <strong><span>default</span></strong> } ] } command to specify the encapsulation type of packets allowed to pass through the interface.</p>
</li><li><p>Run the <a href="cmdqueryname=rewrite+pop"><b><span class="cmdname">rewrite pop</span></b></a> { <strong><span>single</span></strong> | <strong><span>double</span></strong> } command to enable the function to remove VLAN tags from received packets.</p>
</li><li><p>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to add the Layer 2 sub-interface to a BD, so that the sub-interface can transmit data packets through this BD.</p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <strong><span>vbdif</span></strong> <i><span class="varname">bd-id</span></i> command to create a VBDIF interface and enter its view.</p>
</li><li><p>Run the <a href="cmdqueryname=ip+binding+vpn-instance"><b><span class="cmdname">ip binding vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command to bind the VBDIF interface to a VPN instance.</p>
</li><li><p>(Optional) Run the <a href="cmdqueryname=ipv6+enable"><b><span class="cmdname">ipv6 enable</span></b></a> command to enable IPv6 on the interface.</p>
</li><li><p>Run the <a href="cmdqueryname=ip+address"><b><span class="cmdname">ip address</span></b></a> <i><span class="varname">ip-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>sub</span></strong> ]<span> or <a href="cmdqueryname=ipv6+address"><b><span class="cmdname">ipv6 address</span></b></a> { <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> | <span><i><span class="varname">ipv6-address/prefix-length</span></i></span> }</span> command to configure an IP<span>v4/IPv6</span> address for the VBDIF interface to implement Layer 3 communication.</p>
</li><li><p>(Optional) Run the <a href="cmdqueryname=mac-address"><b><span class="cmdname">mac-address</span></b></a> <i><span class="varname">mac-address</span></i> command to configure a MAC address for the VBDIF interface.</p>
</li><li><p>Run the <span><a href="cmdqueryname=vxlan+anycast-gateway+enable"><b><span class="cmdname">vxlan anycast-gateway enable</span></b></a></span> command to enable the distributed gateway function.</p>
<p>After the distributed gateway function is enabled, the device discards ARP packets received from the network side and learns only ARP packets received from the user side and generates host routes accordingly.</p>
</li><li><p>Run the <a href="cmdqueryname=arp+collect+host+enable"><b><span class="cmdname">arp collect host enable</span></b></a><span> or <a href="cmdqueryname=ipv6+nd+collect+host+enable"><b><span class="cmdname">ipv6 nd collect host enable</span></b></a></span> command to enable the function to collect host information.</p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</p>
</li></ol>
</li><li><p>If you want the network to carry only Layer 2 services, perform the following configurations:</p>
<ol type="a"><li><p>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to enter the view of the BD to be bound to an EVPN instance.</p>
</li><li><p>Run the <a href="cmdqueryname=evpn+binding+vpn-instance"><b><span class="cmdname">evpn binding vpn-instance</span></b></a> <i><span class="varname">evpn-name</span></i><span> [ <strong><span>bd-tag</span></strong> <i><span class="varname">bd-tag</span></i> ]</span> command to bind the BD to the EVPN instance. <span>By specifying different <i><span class="varname">bd-tag</span></i> values, you can bind multiple BDs to the same EVPN instance. In this way, VLAN services of different BDs can access the same EVPN instance while being isolated.</span></p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</p>
</li><li><p>Run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number.subnum</span></i> <strong><span>mode l2</span></strong> command to create a Layer 2 sub-interface and enter its view.</p>
</li><li><p>Run the <a href="cmdqueryname=encapsulation"><b><span class="cmdname">encapsulation</span></b></a> { <strong><span>dot1q</span></strong> [ <strong><span>vid</span></strong> <i><span class="varname">low-pe-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-pe-vid</span></i> ] ] | <strong><span>untag</span></strong> | <strong><span>qinq</span></strong> [ <strong><span>vid</span></strong> <i><span class="varname">pe-vid</span></i> <strong><span>ce-vid</span></strong> { <i><span class="varname">low-ce-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-ce-vid</span></i> ] | <strong><span>default</span></strong> } ] } command to specify the encapsulation type of packets allowed to pass through the interface.</p>
</li><li><p>Run the <a href="cmdqueryname=rewrite+pop"><b><span class="cmdname">rewrite pop</span></b></a> { <strong><span>single</span></strong> | <strong><span>double</span></strong> } command to enable the function to remove VLAN tags from received packets.</p>
</li><li><p>Run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command to add the Layer 2 sub-interface to a BD, so that the sub-interface can transmit data packets through this BD.</p>
</li><li><p>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</p>
</li></ol>
</li><li><p>If you want the network to carry only Layer 3 services, see <a href="dc_vrp_mpls-l3vpn-v4_cfg_0156.html">Binding Interfaces to a VPN Instance</a><span> or <a href="dc_vrp_mpls-l3vpn-v6_cfg_2059.html">Binding Interfaces to a VPN Instance</a></span>.</p>
</li></ul>
</p></li><li><span>Configure an EVPN instance in BD mode.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong> command to create a BD EVPN instance and enter the EVPN instance view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=route-distinguisher"><b><span class="cmdname">route-distinguisher</span></b></a> <i><span class="varname">route-distinguisher</span></i> command to configure an RD for the EVPN instance.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=vpn-target"><b><span class="cmdname">vpn-target</span></b></a> <i><span class="varname">vpn-target</span></i> &amp;&lt;1-8&gt; [ <strong><span>both</span></strong> | <strong><span>export-extcommunity</span></strong> | <strong><span>import-extcommunity</span></strong> ] command to configure VPN targets for the EVPN instance. The export VPN target of the local end must be the same as the import VPN target of the remote end, and the import VPN target of the local end must be the same as the export VPN target of the remote end.</span></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=import+route-policy"><b><span class="cmdname">import route-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to associate the current EVPN instance with an import route-policy.</span><p><p>To more precisely control the import of routes into the EVPN instance, perform this step to specify an import route-policy and set attributes for eligible routes.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=export+route-policy"><b><span class="cmdname">export route-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to associate the current EVPN instance with an export route-policy.</span><p><p>To more precisely control the advertisement of EVPN routes, perform this step to specify an export route-policy and set attributes for eligible routes.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=tnl-policy"><b><span class="cmdname">tnl-policy</span></b></a> <i><span class="varname">policy-name</span></i> command to associate the EVPN instance with a tunnel policy.</span><p><p>This configuration enables PEs to use TE tunnels to transmit data packets.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> <i><span class="varname">number</span></i> { <strong><span>simply-alert</span></strong> | <strong><span>mac-unchanged</span></strong> } command to specify the maximum number of MAC addresses allowed in the EVPN instance.</span><p><p>A device consumes more system resources as it learns more MAC addresses, and may fail to operate when busy with service processing. To limit the maximum number of MAC addresses allowed in an EVPN instance and thereby improving device security and reliability, run the <a href="cmdqueryname=mac+limit"><b><span class="cmdname">mac limit</span></b></a> command. After this configuration, if the number of MAC addresses exceeds the preset value, an alarm is reported to prompt you to check the validity of existing MAC addresses.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li></ol>
</li><li><span>(Optional) Configure an RR. To minimize the number of BGP EVPN peers on the network, deploy an RR.</span><ol type="a"><li class="substepexpand"><span>Run the <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i> command to enable BGP and enter its view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a> command to enter the BGP-EVPN address family view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <a href="cmdqueryname=reflect-client"><b><span class="cmdname">reflect-client</span></b></a> command to configure the device as an RR, and its peer as an RR client.</span><p><p>The <span class="keyword">Router</span> on which the <a href="cmdqueryname=peer+reflect-client"><b><span class="cmdname">peer reflect-client</span></b></a> command is run functions as the RR, and the specified peer or peer group functions as its client or clients.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command to disable route reflection between clients through the RR.</span><p><p>If the clients of an RR have established full-mesh connections with each other, run the <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command to disable route reflection between clients through the RR to reduce cost. The <a href="cmdqueryname=undo+reflect+between-clients"><b><span class="cmdname">undo reflect between-clients</span></b></a> command applies only to RRs.</p>
</p></li><li class="substepexpand"><span>(Optional) Run the <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> { <i><span class="varname">cluster-id-value</span></i> | <i><span class="varname">cluster-id-ipv4</span></i> } command to configure a cluster ID for the RR.</span><p><p>If a cluster has multiple RRs, you can use this command to set the same cluster ID for these RRs to prevent routing loops.</p>
<p>The <a href="cmdqueryname=reflector+cluster-id"><b><span class="cmdname">reflector cluster-id</span></b></a> command applies only to RRs.</p>
</p></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the BGP view.</span></li><li class="substepexpand"><span>Run the <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a> command to return to the system view.</span></li></ol>
</li><li><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0002.html">Configuring DCI Functions
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0005.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_dci_cfg_0027.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>