
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring EVPN L3VPN HoVPN over SRv6">
<meta name="abstract" content="An EVPN L3VPN HoVPN over SRv6 is a hierarchical EVPN over SRv6 network. Multiple PEs play different roles and form a hierarchical structure to implement the functions of a single PE, reducing PE performance requirements.">
<meta name="description" content="An EVPN L3VPN HoVPN over SRv6 is a hierarchical EVPN over SRv6 network. Multiple PEs play different roles and form a hierarchical structure to implement the functions of a single PE, reducing PE performance requirements.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0079.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0009.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="p00915595,w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="EVPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="p00915595">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00878323">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0289315207">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring EVPN L3VPN HoVPN over SRv6</title>
</head>
<body><a name="EN-US_TASK_0289315207"></a><a name="EN-US_TASK_0289315207"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring EVPN L3VPN HoVPN over SRv6</h1>
<div class="taskbody"><p>An EVPN L3VPN HoVPN over SRv6 is a hierarchical EVPN over SRv6 network. Multiple PEs play different roles and form a hierarchical structure to implement the functions of a single PE, reducing PE performance requirements.</p>
<div class="context"><a name="EN-US_TASK_0289315207__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Currently, EVPN over SRv6 is used as a mainstream transport solution for 5G services. For an EVPN over SRv6 network, you can deploy EVPN HVPN over SRv6 to improve scalability and prevent an individual PE from becoming a bottleneck. In this mode, the functions of a PE are distributed to multiple PEs. These PEs play different roles and form a hierarchical architecture to provide the functions of the single PE. In <a href="#EN-US_TASK_0289315207__fig16042462166">Figure 1</a>, an HVPN mainly consists of UPEs, SPEs, and NPEs.</p>
<ul><li><p>UPE: a device that is directly connected to users. UPEs provide user access functions. For example, CSGs connected to base stations function as UPEs in the following figure.</p>
</li><li><p>SPE: a device that connects to a UPE and resides inside a service transport network. SPEs manage and advertise VPN routes. For example, ASGs function as SPEs in the following figure.</p>
</li><li><p>NPE: a device that connects to an SPE and to the backbone network. For example, RSGs function as NPEs in the following figure.</p>
</li></ul>
<div class="fignone" id="EN-US_TASK_0289315207__fig16042462166"><a name="EN-US_TASK_0289315207__fig16042462166"></a><a name="fig16042462166"></a><span class="figcap"><b>Figure 1 </b>EVPN L3VPN HVPN over SRv6 networking</span><br><span><img class="vsd" src="figure/en-us_image_0000001232690293.png" width="NaN" height="NaN"></span></div>
<p>HVPN can be deployed in either of the following modes:</p>
<ul><li>HoVPN: SPEs advertise only default or summary routes to UPEs. The UPEs do not have specific routes destined for NPEs and can only use default routes to send VPN service data to SPEs, implementing route isolation. The HoVPN supports devices, such as UPEs, with relatively low route management capabilities, reducing network deployment costs.</li><li><p>H-VPN: SPEs can advertise specific routes to UPEs. The UPEs function as RR clients and receive the specific routes reflected by SPEs functioning as RRs, facilitating route management and traffic forwarding control.</p>
</li></ul>
<p>Currently, the EVPN HVPN over SRv6 network carrying Layer 3 services is deployed in EVPN L3VPN HoVPN over SRv6 mode.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0289315207__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Pre-configuration Tasks</h4><p>Before configuring EVPN L3VPN HoVPN over SRv6, complete the following tasks:</p>
<ul><li>Configure an IGP between UPEs and SPEs and between SPEs and NPEs to implement network-layer connectivity.</li><li>Complete the task of <a href="dc_vrp_srv6_cfg_all_0252.html">Configuring EVPN L3VPN over IS-IS SRv6 BE</a>, <a href="dc_vrp_cfg_evpn-l3vpn_over_srv6-te_policy.html">Configuring EVPN L3VPNv4 over SRv6 TE Policy</a>, or <a href="dc_vrp_cfg_evpn-l3vpnv6_over_srv6-te_policy.html">Configuring EVPN L3VPNv6 over SRv6 TE Policy</a> between the UPEs and SPEs, and between the SPEs and NPEs.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>According to related standards, the VPN instance status obtained through an NMS can be up only when at least one interface bound to the VPN instance is up. In an HoVPN scenario, an SPE does not require any interface to be bound to a VPN instance. Consequently, the VPN instance status obtained by an NMS is down according to the standards, which is opposite to the actual VPN instance status. In this case, you can run the <strong>transit-vpn</strong> command in the VPN instance view or VPN instance IPv4/IPv6 address family view on the SPE. Then, the VPN instance status obtained by the NMS remains up, regardless of the binding between the VPN instance and interface.</p>
</div></div>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0289315207__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure each SPE to advertise only the default or summary route to each UPE.</span><p><ul><li><p>Configure the SPE to advertise a default route to each UPE.</p>
<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ip+route-static+vpn-instance"><b><span class="cmdname">ip route-static vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong>0.0.0.0</strong> { <strong>0.0.0.0</strong> | <strong>0</strong> } { <i><span class="varname">nexthop-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">nexthop-address</span></i> ] } <span>or <a href="cmdqueryname=ipv6+route-static+vpn-instance"><b><span class="cmdname">ipv6 route-static vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong>0::0</strong> <strong>0</strong> { <i><span class="varname">nexthop-ipv6-address</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <i><span class="varname">nexthop-ipv6-address</span></i> ] }</span></p>
<p>A default VPN IPv4<span>/IPv6</span> static route is configured.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <em>as-number</em></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <span>or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></p>
<p>The BGP-VPN instance IPv4<span>/IPv6</span> address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <strong>0.0.0.0</strong> [ <strong>0.0.0.0</strong> | <strong>0</strong> ] [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ] <span>or <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <strong>0::0</strong> <strong>0</strong> [ <strong><span>route-policy</span></strong> <i><span class="varname">route-policy-name</span></i> ]</span></p>
<p>The default route is imported to the routing table of the IPv4<span>/IPv6</span> VPN instance.</p>
</li><li><p>Run <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a></p>
<p>EVPN IP prefix route advertisement is enabled.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Return to the BGP view.</p>
</li><li><p>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></p>
<p>The BGP-EVPN address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+upe"><b><span class="cmdname">peer</span></b></a> { <em>peerIpv6Addr</em> | <em>peerGroupName</em> } <strong><span>upe</span></strong></p>
<p>A BGP EVPN peer is specified as a UPE, or a group of BGP EVPN peers are specified as UPEs.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this case, you also need to configure a route-policy on each NPE to prevent the NPEs from receiving the default route.</p>
</div></div>
</li><li><p>Configure the SPE to advertise a summary route to each UPE.</p>
<ol type="a"><li><p>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></p>
<p>The system view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <em>as-number</em></p>
<p>The BGP view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i> <span>or <a href="cmdqueryname=ipv6-family"><b><span class="cmdname">ipv6-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span></p>
<p>The BGP-VPN instance IPv4<span>/IPv6</span> address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=aggregate"><b><span class="cmdname">aggregate</span></b></a> <i><span class="varname">ipv4-address</span></i> { <i><span class="varname">mask</span></i> | <i><span class="varname">mask-length</span></i> } [ <strong><span>as-set</span></strong> | <strong><span>attribute-policy</span></strong> <i><span class="varname">route-policy-name1</span></i> | <strong><span>detail-suppressed</span></strong> | <strong><span>origin-policy</span></strong> <i><span class="varname">route-policy-name2</span></i> | <strong><span>suppress-policy</span></strong> <i><span class="varname">route-policy-name3</span></i> ] <sup>*</sup> <span>or <a href="cmdqueryname=aggregate"><b><span class="cmdname">aggregate</span></b></a> <i><span class="varname">ipv6-address</span></i> <i><span class="varname">prefix-length</span></i> [ <strong><span>as-set</span></strong> | <strong><span>attribute-policy</span></strong> <i><span class="varname">route-policy-name1</span></i> | <strong><span>detail-suppressed</span></strong> | <strong><span>origin-policy</span></strong> <i><span class="varname">route-policy-name2</span></i> | <strong><span>suppress-policy</span></strong> <i><span class="varname">route-policy-name3</span></i> ] <sup>*</sup></span></p>
<p>A summary route is configured.</p>
</li><li><p>Run <a href="cmdqueryname=advertise+l2vpn+evpn"><b><span class="cmdname">advertise l2vpn evpn</span></b></a></p>
<p>EVPN IP prefix route advertisement is enabled.</p>
</li><li><p>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></p>
<p>Return to the BGP view.</p>
</li><li><p>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></p>
<p>The BGP-EVPN address family view is displayed.</p>
</li><li><p>Run <a href="cmdqueryname=peer+upe"><b><span class="cmdname">peer</span></b></a> { <em>peerIpv6Addr</em> | <em>peerGroupName</em> } <strong><span>upe</span></strong></p>
<p>A BGP EVPN peer is specified as a UPE, or a group of BGP EVPN peers are specified as UPEs.</p>
</li><li><p>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></p>
<p>The configuration is committed.</p>
</li></ol>
</li></ul>
</p></li><li><span>Configure the SPE to advertise regenerated routes to each NPE.</span><ol type="a"><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <em>as-number</em></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=l2vpn-family+evpn"><b><span class="cmdname">l2vpn-family evpn</span></b></a></span><p><p>The BGP-EVPN address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+import+reoriginate"><b><span class="cmdname">peer</span></b></a> { <em>peerIpv6Addr</em> | <em>peerGroupName</em> }<strong> import</strong> <strong>reoriginate</strong></span><p><p>The device is enabled to add a regeneration flag to EVPN routes received from a UPE peer or UPE peer group.</p>
<p>The <em>peerIpv6Addr</em> parameter specifies the IP address of a UPE peer, and the <em>peerGroupName</em> parameter specifies the name of a UPE peer group.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <em>peerIpv6Addr</em> | <em>peerGroupName</em> } <strong>advertise</strong> <strong>route-reoriginated</strong> <strong>evpn </strong><strong>ip</strong> or <a href="cmdqueryname=peer+advertise+route-reoriginated"><b><span class="cmdname">peer</span></b></a> { <em>peerIpv6Addr</em> | <em>peerGroupName</em> }<strong> advertise</strong><strong> route-reoriginated</strong> <strong>evpn</strong> <strong>ipv6</strong></span><p><p>The SPE is enabled to regenerate the EVPN routes received from the UPEs as local EVPN routes and advertise these routes to the NPEs if EVPN L3VPNv4 or L3VPNv6 services are transmitted.</p>
<p>The <em>peerIpv6Addr</em> parameter specifies the IP address of an NPE peer, and the <em>peerGroupName</em> parameter specifies the name of an NPE peer group.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ol></div>
<div class="example"><a name="EN-US_TASK_0289315207__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Verifying the Configuration</h4><ul><li><p>Run the <a href="cmdqueryname=display+ip+routing-table+vpn-instance"><b><span class="cmdname">display ip routing-table vpn-instance</span></b></a> <span>or <a href="cmdqueryname=display+ipv6+routing-table+vpn-instance"><b><span class="cmdname">display ipv6 routing-table vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i></span> command on a UPE or NPE to check the VPN routing table. The command output shows the default routes or specific routes sent by the remote ends.</p>
</li><li><p>Run the <a href="cmdqueryname=display+bgp+evpn+all+routing-table"><b><span class="cmdname">display bgp evpn all routing-table</span></b></a> <strong>prefix-route</strong> command on a UPE or NPE to check the EVPN IP prefix routing table. The command output shows the EVPN IP prefix routes sent by the remote ends.</p>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0000.html">EVPN Configuration
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0079.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_evpn_cfg_0009.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>