
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VPLS PW Redundancy in an HVPLS Scenario">
<meta name="abstract" content="This section provides an example for configuring VPLS PW redundancy in an HVPLS scenario.">
<meta name="description" content="This section provides an example for configuring VPLS PW redundancy in an HVPLS scenario.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6033.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5062.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370266">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring VPLS PW Redundancy in an HVPLS Scenario</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370266"></a><a name="EN-US_TASK_0172370266"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VPLS PW Redundancy in an HVPLS Scenario</h1>
<div class="taskbody"><p>This section provides an example for configuring VPLS PW redundancy in an HVPLS scenario.</p>
<div class="context"><a name="EN-US_TASK_0172370266__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370266__fig_dc_vrp_vpls_cfg_505601">Figure 1</a>, access and aggregation rings are deployed on the MAN. E2E LDP LSPs are deployed between PEs. A VPLS network is established among the UPE, SPEs, and NPEs to carry multicast services, such as IPTV, on the MAN. Upstream traffic on the MAN is aggregated on the NPEs for transmission to the egress. CE2 is deployed at the egress of the MAN to assign IP addresses to users and provide IPTV services.</p>
<p>The service provider requires that multicast services be reliably transmitted even if an NPE or a PW fails, or an AC of CE2 fails. The service provider also requires that the deployed features be not vendor-specific and consume as less bandwidth as possible.</p>
<p>To meet the preceding requirements, configure VPLS PW redundancy in the HVPLS scenario. Connect the UPE to SPE1 and SPE2 using two spoke PWs and configure the two PWs to protect each other. Connect the SPEs and NPEs using hub PWs. Configure CE2 to access the VPLS network through an E-Trunk to ensure AC link reliability. This configuration enhances network reliability with non-vendor-specific features. At the same time, the HVPLS networking reduces required PWs and in turn bandwidth consumption at the core layer.</p>
<div class="fignone" id="EN-US_TASK_0172370266__fig_dc_vrp_vpls_cfg_505601"><a name="EN-US_TASK_0172370266__fig_dc_vrp_vpls_cfg_505601"></a><a name="fig_dc_vrp_vpls_cfg_505601"></a><span class="figcap"><b>Figure 1 </b>Configuring VPLS PW redundancy to protect multicast services</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>In this example, interfaces 1 through 4 represent GE<span>0/1/0</span>, GE<span>0/1/1</span>, GE<span>0/1/2</span>, and GE<span>0/1/3</span>, respectively.</p>
</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_505601.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interfaces and IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="33.33%" id="mcps1.4.1.6.2.4.1.1" liSelected="liSelected"><p>Device</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="36%" id="mcps1.4.1.6.2.4.1.2" liSelected="liSelected"><p>Interface</p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="30.669999999999998%" id="mcps1.4.1.6.2.4.1.3" liSelected="liSelected"><p>IP Address</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33%" headers="mcps1.4.1.6.2.4.1.1 "><p>UPE</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.10.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.20.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="33.33%" headers="mcps1.4.1.6.2.4.1.1 "><p>SPE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.10.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.30.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="33.33%" headers="mcps1.4.1.6.2.4.1.1 "><p>SPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.20.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.50.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33%" headers="mcps1.4.1.6.2.4.1.1 "><p>NPE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.30.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.60.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="33.33%" headers="mcps1.4.1.6.2.4.1.1 "><p>NPE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.50.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/3</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>192.168.60.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Loopback 1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>5.5.5.5/32</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" width="33.33%" headers="mcps1.4.1.6.2.4.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span>.10</p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.6.2.4.1.3 "><p>10.1.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="3" char="." valign="top" width="33.33%" headers="mcps1.4.1.6.2.4.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="36%" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="30.669999999999998%" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.2 "><p>Vlanif 10</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.6.2.4.1.3 "><p>10.1.1.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370266__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure an IP address and a routing protocol for each involved interface so that PEs can communicate at the network layer. This example uses OSPF as the routing protocol.</li><li><p>Configure MPLS and public network tunnels to carry PWs.</p>
<p>In this example, LDP LSPs are used as tunnels between PEs.</p>
<ul><li>Enable MPLS and MPLS LDP globally on each PE.</li><li>Establish remote LDP peer relationships between SPE1 and NPE2 and between SPE2 and NPE1.</li><li>Enable MPLS on each PE interface.</li><li>Enable MPLS LDP on the ingress and egress PE interfaces of each LDP LSP.</li></ul>
</li><li><p>Configure PWs on the HVPLS network.</p>
<ul><li>Enable MPLS L2VPN on PEs.</li><li>Create a VSI on each PE.</li><li>Specify the VSI peer on each PE. Configure two spoke PWs between the UPE and SPEs. Configure four hub PWs between the SPEs and NPEs.</li></ul>
</li><li><p>Add PWs to a PW redundancy protection group for the PWs to protect each other.</p>
<ul><li>Configure a PW redundancy protection group on the UPE.</li><li>Configure the master/slave PW redundancy mode.</li><li>Add specified PWs to the protection group and specify the priorities of the PWs.</li><li>Set the revertive switching delay to 60s.</li></ul>
</li><li><p>Configure CE1 and CE2 to access the HVPLS network so that they can communicate.</p>
<ul><li>Configure CE2 to be dual-homed to NPEs through an E-Trunk.</li><li>Connect CE1 to the UPE over a VLAN.</li></ul>
</li><li><p>Configure BFD for PW to detect the faults of the primary PW, so that services can be immediately switched to the secondary PW if the primary PW fails.</p>
<ul><li>Enable BFD globally.</li><li>Establish a BFD session between the end PEs of the primary PW.</li></ul>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370266__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address, OSPF process ID (1), and OSPF area ID (0) of each interface</p>
</li><li><p>LSR ID of each node and the names and numbers of the interfaces on which LDP sessions are to be set up</p>
</li><li><p>VSI name (vsi1), member discovery mode (static), VSI signaling type (LDP), VSI ID (1), VSI peer IP address, and AC interface types and numbers</p>
</li><li><p>VPLS PW redundancy protection group name (vsi1), redundancy mode (master), revertive switching mode (delayed switching), revertive switching delay (60s), and PW priorities (1 and 2)</p>
</li><li><p>E-Trunk ID (1), system ID (00e0-fc12-3456), LACP priority (1), Eth-Trunk ID (10), E-Trunk priorities (150 and default 100), local and peer IP addresses, VLAN ID (10), and VLAN encapsulation type (dot1q)</p>
</li><li><p>BFD configuration name, peer IP address of the PW tracked by BFD, local interface name and number, and local and remote BFD session discriminators</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370266__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and a routing protocol for each involved interface on the backbone network so that PEs can communicate at the network layer.</span><p><p>OSPF is used in this example. For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on the UPE, SPEs, and NPEs. The command output shows that the UPE, SPEs, and NPEs have learned each other's loopback interface address.</p>
</p></li><li><span>Configure MPLS, public network tunnels, and remote LDP peers.</span><p><p>This example uses LDP LSPs as public network tunnels. For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on the UPE, SPEs, and NPEs. The command output shows that <strong>Status</strong> is <strong>Operational</strong> for the peer relationship between the UPE and SPE and between the NPE and SPE, indicating that the peer relationships have been set up. Run the <strong>display mpls lsp</strong> command. The command output shows whether LSPs have been set up.</p>
</p></li><li><span>Configure PWs.</span><p><p># Create a VSI on the UPE and specify SPE1 and SPE2 as the VSI peers.</p>
<pre class="screen">&lt;UPE&gt; <strong>system-view</strong></pre>
<p># Enable MPLS L2VPN.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-l2vpn] <strong>quit</strong></pre>
<p># Create a VSI, configure LDP as the signaling protocol, and specify the VSI ID.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<p># Specify VSI peers so that two PWs can be established between the UPE and SPE1, and between the UPE and SPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE-vsi-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>You do not need to specify the <strong><span>secondary</span></strong> parameter for the secondary PW in this step, because the protection group determines the primary/secondary status of PWs based on PW priorities when PWs are added.</p>
</div></div>
<p># Create a VSI on each SPE and specify the UPE and NPEs as VSI peers. The following example uses SPE1. The configuration of SPE2 is similar to the configuration of SPE1.</p>
<pre class="screen">&lt;SPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>peer 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>commit</strong></pre>
<p># Create a VSI on each NPE and specify the SPEs as VSI peers. The following example uses NPE1. The configuration of NPE2 is similar to the configuration of NPE1.</p>
<pre class="screen">&lt;NPE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>commit</strong></pre>
</p></li><li><span>Add the PWs to a PW redundancy protection group.</span><p><p># Configure a PW redundancy protection group on the UPE and configure the redundancy mode as master/slave. Add specified PWs to the protection group and specify the priorities of the PWs. Set the revertive switching delay to 60s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>protect-group vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>protect-mode pw-redundancy master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 2.2.2.2 preference 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 3.3.3.3 preference 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>reroute delay 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp-protect-group-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Before adding PWs to a PW redundancy protection group, ensure that the protection group already exists and its redundancy mode is specified. The revertive switching policy can be configured for only PW redundancy protection groups with the master/slave PW redundancy mode.</p>
</div></div>
</p></li><li><span>Configure CE2 to be dual-homed to NPEs through an E-Trunk.</span><p><p># Configure an E-Trunk between the NPEs.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>lacp e-trunk system-id 00e0-fc12-3456</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> e-trunk 1</strong></pre>
<p># Configure the local and peer IP addresses of the E-Trunk.</p>
<pre class="screen">[<span class="keyword">*</span>NPE1-e-trunk-1]<strong> peer-address 5.5.5.5 source-address 4.4.4.4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>NPE1 uses the default E-Trunk priority of 100 and the default revertive switching delay of 120s.</p>
</div></div>
<p># Add an Eth-Trunk to the E-Trunk.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1]<strong> commit</strong></pre>
<p># Configure NPE2 as a standby device by configuring its E-Trunk priority to be 150. Other configurations of NPE2 are similar to the configurations of NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2] <strong>lacp e-trunk system-id 00e0-fc12-3456</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2] <strong>lacp e-trunk priority 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-e-trunk-1]<strong> priority 150</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-e-trunk-1]<strong> peer-address 4.4.4.4 source-address 5.5.5.5</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-e-trunk-1]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2]<strong> interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10] <strong>e-trunk 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2] <strong>commit</strong></pre>
<p># Bind the VSI on NPE1 to the Eth-Trunk sub-interface on NPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE1] <strong>interface eth-trunk 10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10.10] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10.10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1-Eth-Trunk10.10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE1] <strong>commit</strong></pre>
<p># Bind the VSI on NPE2 to the Eth-Trunk sub-interface on NPE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>NPE2] <strong>interface eth-trunk 10.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10.10] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10.10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2-Eth-Trunk10.10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>NPE2] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE2</strong></pre>
<pre class="screen">[<span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<p># Create VLAN 10.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-vlan10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Configure the Eth-Trunks to work in static LACP mode.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface eth-trunk 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>portswitch</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>mode lacp-static</strong></pre>
<p># Add a member interface to the Eth-Trunk interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-Eth-Trunk10] <strong>port trunk allow-pass vlan 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>trunkport gigabitethernet <span>0/1/0</span> to <span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Eth-Trunk10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Connect CE1 to the UPE over a VLAN.</span><p><p># Bind the VSI to the Ethernet sub-interface on the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>interface gigabitethernet<span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>interface gigabitethernet<span>0/1/0</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-GigabitEthernet<span>0/1/0</span>.10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname CE1</strong></pre>
<pre class="screen">[<span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<p># Associate sub-interface GE <span>0/1/0</span>.10 with VLAN 10 and specify the VLAN encapsulation type as dot1q.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet <span>0/1/0</span>.10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.10] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.10] <strong>ip address 10.1.1.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
</p></li><li><span>Configure BFD for PW to detect primary PW connectivity.</span><p><p># Enable BFD globally and configure a BFD session on the UPE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE] <strong>bfd vplspw1 bind pw vsi vsi1 peer 2.2.2.2 remote-peer 2.2.2.2 pw-ttl auto-calculate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-vplspw1] <strong>discriminator local 104</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-vplspw1] <strong>discriminator remote 401</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-vplspw1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>UPE-bfd-lsp-session-vplspw1] <strong>quit</strong></pre>
<p># Configure SPE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>SPE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1] <strong>bfd vplspw1 bind pw vsi vsi1 peer 1.1.1.1 remote-peer 1.1.1.1 pw-ttl auto-calculate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-vplspw1] <strong>discriminator local 401</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-vplspw1] <strong>discriminator remote 104</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-vplspw1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>SPE1-bfd-lsp-session-vplspw1] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><div class="p">After the configuration is complete, run the following commands to check the configuration.<ol type="a"><li><p>Ping the VLANIF interface address of CE2 from CE1.</p>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface vlanif 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Vlanif10] <strong>ip address 10.1.1.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-Vlanif10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p># Perform the ping operation.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 10.1.1.2</strong></pre>
<pre class="screen">  PING 10.1.1.2: 56  data bytes, press CTRL_C to break
    Reply from 10.1.1.2: bytes=56 Sequence=1 ttl=255 time=220 ms
    Reply from 10.1.1.2: bytes=56 Sequence=2 ttl=255 time=140 ms
    Reply from 10.1.1.2: bytes=56 Sequence=3 ttl=255 time=140 ms
    Reply from 10.1.1.2: bytes=56 Sequence=4 ttl=255 time=170 ms
    Reply from 10.1.1.2: bytes=56 Sequence=5 ttl=255 time=220 ms

  --- 10.1.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 140/178/220 ms                          </pre>
</li><li><p>Run the <strong>display vsi name protect-group</strong> command on the UPE to check PW redundancy protection group information. The command output shows that the forwarding state is <strong>Active</strong> for the primary PW and <strong>Inactive</strong> for the secondary PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] display vsi name vsi1 protect-group vsi1

Protect-group: vsi1
-------------------------------------------------------------------------------
PeerIp:VcId                Pref   Active
-------------------------------------------------------------------------------
2.2.2.2:1                  1      <strong>Active</strong>
3.3.3.3:1                  2      <strong>Inactive</strong></pre>
</li><li><p>Run the <strong>display vsi name vsi1 verbose</strong> command on the UPE to check information about the VSI and corresponding PWs. The command output shows that <strong>VSI State</strong> is <strong>up</strong>, and <strong>PW State</strong> is <strong>up</strong> for the primary PW and <strong>backup</strong> for the secondary PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display vsi name vsi1 verbose</strong></pre>
<pre class="screen"> ***VSI Name               : vsi1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : ldp
    Member Discovery Style : static
<span>    Bridge-domain Mode     : disable</span>
<span>    PW MAC Learning Style  : unqualify</span>
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 1 hours, 2 minutes, 50 seconds
    VSI State              : <strong>up</strong>
    Resource Status        : --    

    VSI ID                 : 1
   *Peer Router ID         : 2.2.2.2
    primary or secondary   : primary
    Protect group          : vsi1
    Priority               : 1
    Active state           : active
    ignore-standby-state   : no
    VC Label               : 1024
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800005
    Broadcast Tunnel ID    : 0x800005
    Broad BackupTunnel ID  : 0x0
    CKey                   : 2
    NKey                   : 1
    Stp Enable             : 0
    PwIndex                : 0
<span>    Control Word           : disable</span>
    BFD for PW             : unavailable

   *Peer Router ID         : 3.3.3.3
    primary or secondary   : primary
    Protect group          : vsi1
    Priority               : 2
    Active state           : inactive
    ignore-standby-state   : no
    VC Label               : 1025
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800008
    Broadcast Tunnel ID    : 0x800008
    Broad BackupTunnel ID  : 0x0
    CKey                   : 4
    NKey                   : 3
    Stp Enable             : 0
    PwIndex                : 0
<span>    Control Word           : disable</span>

    Interface Name         : GigabitEthernet<span>0/1/0</span>.10
    State                  : up
    Access Port            : false
    Last Up Time           : 2011/12/16 15:14:40
    Total Up Time          : 0 days, 0 hours, 26 minutes, 16 seconds

  **PW Information:

   *Peer Ip Address        : 2.2.2.2
    PW State               : <strong>up</strong>
    Local VC Label         : 1024
    Remote VC Label        : 1024
<span>    Remote Control Word    : disable</span>

    PW Type                : label
    Tunnel ID              : 0x800005
    Broadcast Tunnel ID    : 0x800005
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x2
    Nkey                   : 0x1
    Main PW Token          : 0x800005
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/1</span>
    Backup OutInterface    :
    Stp Enable             : 0
    PW Last Up Time        : 2011/12/16 15:14:40
    PW Total Up Time       : 0 days, 0 hours, 26 minutes, 16 seconds
   *Peer Ip Address        : 3.3.3.3
    PW State               : <strong>backup</strong>
    Local VC Label         : 1025
    Remote VC Label        : 1024
<span>    Remote Control Word    : disable</span>

    PW Type                : label
    Tunnel ID              : 0x800008
    Broadcast Tunnel ID    : 0x800008
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x4
    Nkey                   : 0x3
    Main PW Token          : 0x800008
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/2</span>
    Backup OutInterface    :
    Stp Enable             : 0
    PW Last Up Time        : 2011/12/16 15:14:40
    PW Total Up Time       : 0 days, 0 hours, 26 minutes, 17 seconds </pre>
</li><li><p>Simulate that the primary PW between the UPE and SPE1 fails. Then service traffic is switched to the secondary PW between the UPE and SPE2.</p>
<p>Run the <strong>display vpls forwarding-info vsi</strong> command on the UPE. The command output shows that <strong>PwState</strong> is <strong>up</strong> for the secondary PW and <strong>backup</strong> for the primary PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display vpls forwarding-info vsi vsi1</strong></pre>
<pre class="screen">Total Number   : 2,        2  up,  0  down

Vsi-Name                        PeerIP          VcOrSiteId  PwState
vsi1                            2.2.2.2         1           <strong>BACKUP</strong>
vsi1                            3.3.3.3         1           <strong>UP</strong>    </pre>
</li><li><p>If the primary PW between the UPE and SPE1 recovers, service traffic will be switched back to the primary PW after the specified revertive switching delay expires.</p>
<p>Run the <a href="cmdqueryname=display+vpls+forwarding-info+vsi"><b><span class="cmdname">display vpls forwarding-info vsi</span></b></a> command on the UPE. The command output shows that <strong>PwState</strong> is <strong>UP</strong> for the primary PW and <strong>BACKUP</strong> for the secondary PW.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>UPE] <strong>display vpls forwarding-info vsi vsi1</strong></pre>
<pre class="screen">Total Number   : 2,        2  up,  0  down

Vsi-Name                        PeerIP          VcOrSiteId  PwState
vsi1                            3.3.3.3         1           <strong>BACKUP</strong>
vsi1                            2.2.2.2         1           <strong>UP</strong>    </pre>
</li></ol>
</div>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370266__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>UPE configuration file</p>
<pre class="screen">#
sysname UPE
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
  protect-group vsi1
   protect-mode pw-redundancy master
   reroute delay 60
   peer 2.2.2.2 preference 1
   peer 3.3.3.3 preference 2
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/0</span>.10
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.10.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.20.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.20.0 0.0.0.255
#
bfd vplspw1 bind pw vsi vsi1 peer 2.2.2.2 remote-peer 2.2.2.2 pw-ttl auto-calculate
 discriminator local 104
 discriminator remote 401
 commit
#
return  </pre>
</li><li><p>SPE1 configuration file</p>
<pre class="screen">#
sysname SPE1
#
bfd
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe
  peer 4.4.4.4
  peer 5.5.5.5
#
mpls ldp
#
mpls ldp remote-peer 5.5.5.5
 remote-ip 5.5.5.5
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.10.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.30.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.10.0 0.0.0.255
  network 192.168.30.0 0.0.0.255
#
bfd vplspw1 bind pw vsi vsi1 peer 1.1.1.1 remote-peer 1.1.1.1 pw-ttl auto-calculate
 discriminator local 401
 discriminator remote 104
 commit
#
return</pre>
</li><li><p>SPE2 configuration file</p>
<pre class="screen">#
sysname SPE2
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe
  peer 4.4.4.4
  peer 5.5.5.5
#
mpls ldp
#
mpls ldp remote-peer 4.4.4.4
 remote-ip 4.4.4.4
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.20.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.50.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.20.0 0.0.0.255
  network 192.168.50.0 0.0.0.255
#
return   </pre>
</li><li><p>NPE1 configuration file</p>
<pre class="screen">#
sysname NPE1
#
lacp e-trunk system-id 00e0-fc12-3456
lacp e-trunk priority 1
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
#
mpls ldp
#
mpls ldp remote-peer 3.3.3.3
 remote-ip 3.3.3.3
#
e-trunk 1
 peer-address 5.5.5.5 source-address 4.4.4.4
#
interface Eth-Trunk10
 portswitch
 mode lacp-static
 e-trunk 1
#
interface Eth-Trunk10.10
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.30.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 192.168.60.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 4.4.4.4 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.30.0 0.0.0.255
  network 192.168.60.0 0.0.0.255
#
return </pre>
</li><li><p>NPE2 configuration file</p>
<pre class="screen">#
sysname NPE2
#
lacp e-trunk system-id 00e0-fc12-3456
lacp e-trunk priority 1
#
mpls lsr-id 5.5.5.5
#
mpls
#
mpls l2vpn
#
vsi vsi1
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
#
mpls ldp
#
mpls ldp remote-peer 2.2.2.2
 remote-ip 2.2.2.2
#
e-trunk 1
 priority 150
 peer-address 4.4.4.4 source-address 5.5.5.5
#
interface Eth-Trunk10
 portswitch
 mode lacp-static
 e-trunk 1
#
interface Eth-Trunk10.10
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.50.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/3</span>
 undo shutdown
 ip address 192.168.60.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 5.5.5.5 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 5.5.5.5 0.0.0.0
  network 192.168.50.0 0.0.0.255
  network 192.168.60.0 0.0.0.255
#
return
</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
#
interface GigabitEthernet<span>0/1/0</span>.10
 vlan-type dot1q 10
 ip address 10.1.1.1 255.255.255.0
#
return                            </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
vlan batch 10
#
interface Vlanif10
 ip address 10.1.1.2 255.255.255.0
#
interface Eth-Trunk10
 portswitch
 port trunk allow-pass vlan 10
 mode lacp-static
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 eth-trunk 10
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 eth-trunk 10
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_6033.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5062.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>