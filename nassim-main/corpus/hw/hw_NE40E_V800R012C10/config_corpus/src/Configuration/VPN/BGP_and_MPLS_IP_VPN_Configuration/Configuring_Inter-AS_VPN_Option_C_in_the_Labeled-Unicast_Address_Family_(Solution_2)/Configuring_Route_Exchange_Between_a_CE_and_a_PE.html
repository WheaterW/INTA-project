
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Route Exchange Between a CE and a PE">
<meta name="abstract" content="A PE and a CE can communicate using BGP, IGP, or a static route.">
<meta name="description" content="A PE and a CE can communicate using BGP, IGP, or a static route.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0193.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0198.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0185.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="h00847023">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369361">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Route Exchange Between a CE and a PE</title>
</head>
<body><a name="EN-US_TASK_0172369361"></a><a name="EN-US_TASK_0172369361"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Route Exchange Between a CE and a PE</h1>
<div class="taskbody"><p>A PE and a CE can communicate using BGP, IGP, or a static route.</p>
<div class="steps-unordered"><a name="EN-US_TASK_0172369361__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Configure the PE.</span><p><p>Perform the following steps on the PE:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=ipv4-family"><b><span class="cmdname">ipv4-family</span></b></a> <strong><span>vpn-instance</span></strong> <i><span class="varname">vpn-instance-name</span></i></span><p><p>The BGP VPN instance IPv4 address family view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong> <i><span class="varname">as-number</span></i></span><p><p>The CE is configured as a VPN peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>ebgp-max-hop</span></strong> [ <i><span class="varname">hop-count</span></i> ]</span><p><p>The maximum number of hops allowed for the EBGP connection is specified.</p>
</p><p><p>In most cases, a directly connected physical link must be available between EBGP peers. If you want to establish an EBGP peer relationship between indirectly connected peers, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command to set the maximum number of hops allowed for a TCP connection.</p>
<p>The default <i><span class="varname">hop-count</span></i> value is 255. If the maximum number of hops is set to 1, the device can establish an EBGP connection with only a directly connected peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=network"><b><span class="cmdname">network</span></b></a> <i><span class="varname">ip-address</span></i> <i><span class="varname">mask</span></i></span><p><p>The direct routes are advertised to the local CE.</p>
</p><p><p>The PE automatically learns direct routes to the local CE. These learned routes take precedence over the direct routes advertised by the local CE through EBGP. If this step is not performed, the PE does not use MP-BGP to advertise direct routes destined for the local CE to the remote PE.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <span><a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>allow-as-loop</span></strong> [ <i><span class="varname">number</span></i> ]</span></span><p><p>Routing loops are permitted.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>substitute-as</span></strong></span><p><p>The function to substitute BGP AS numbers is enabled.</p>
</p><p><p>In a scenario where VPN sites in the same site or those that have different private AS numbers communicate through the BGP/MPLS IP VPN backbone network, if a CE and its connected PE in a VPN site establish an EBGP connection, VPN routes from other VPN sites may carry the AS number of this VPN site. As a result, the CE discards the VPN routes, causing a failure in VPN site communication. To prevent this situation from occurring, run the <a href="cmdqueryname=peer+substitute-as"><b><span class="cmdname">peer substitute-as</span></b></a> command on the PE to enable AS number substitution.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure the CE.</span><p><p>Perform the following steps on the CE:</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=bgp"><b><span class="cmdname">bgp</span></b></a> <i><span class="varname">as-number</span></i></span><p><p>The BGP view is displayed.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> <i><span class="varname">ipv4-address</span></i> <strong><span>as-number</span></strong></span><p><p>The PE is configured as a VPN peer.</p>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=peer"><b><span class="cmdname">peer</span></b></a> { <i><span class="varname">ipv4-address</span></i> | <i><span class="varname">group-name</span></i> } <strong><span>ebgp-max-hop</span></strong> [ <i><span class="varname">hop-count</span></i> ]</span><p><p>The maximum number of hops allowed for the EBGP connection is specified.</p>
</p><p><p>In most cases, a directly connected physical link must be available between EBGP peers. If you want to establish an EBGP peer relationship between indirectly connected peers, run the <a href="cmdqueryname=peer+ebgp-max-hop"><b><span class="cmdname">peer ebgp-max-hop</span></b></a> command to set the maximum number of hops allowed for a TCP connection.</p>
<p>The default <i><span class="varname">hop-count</span></i> value is 255. If the maximum number of hops is set to 1, the device can establish an EBGP connection with only a directly connected peer.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=import-route"><b><span class="cmdname">import-route</span></b></a> { <strong><span>rip</span></strong> | <strong><span>isis</span></strong> | <strong><span>ospf</span></strong> } <i><span class="varname">process-id</span></i> [ [ <strong><span>med</span></strong> <i><span class="varname">med</span></i> ] | [ [ <a href="cmdqueryname=route-policy"><b><span class="cmdname">route-policy</span></b></a> <i><span class="varname">route-policy-name</span></i> ] | [ <strong><span>route-filter</span></strong> <i><span class="varname">route-filter-name</span></i> ] ] ] * [ <strong><span>non-relay-tunnel</span></strong> ]</span><p><p>Routes of the local site are imported.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0193.html">Configuring Inter-AS VPN Option C in the Labeled-Unicast Address Family (Solution 2)
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0198.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0185.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>