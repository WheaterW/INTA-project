
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring VPN IP FRR">
<meta name="abstract" content="If multiple CEs at a VPN site connect to the same PE and VPN IP FRR is configured on the PE, the PE can rapidly switch traffic to a link between another CE and the PE if a link between one CE and the PE fails.">
<meta name="description" content="If multiple CEs at a VPN site connect to the same PE and VPN IP FRR is configured on the PE, the PE can rapidly switch traffic to a link between another CE and the PE if a link between one CE and the PE fails.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0126.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369561">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/thickbox.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/imageResize.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-migrate-1.2.1.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery-ui.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/jquery.mousewheel.min.js"></script>
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/thickbox.js"></script>
<title>Example for Configuring VPN IP FRR</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369561"></a><a name="EN-US_TASK_0172369561"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring VPN IP FRR</h1>
<div class="taskbody"><p>If multiple CEs at a VPN site connect to the same PE and VPN IP FRR is configured on the PE, the PE can rapidly switch traffic to a link between another CE and the PE if a link between one CE and the PE fails.</p>
<div class="context"><a name="EN-US_TASK_0172369561__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>At a VPN site, different CEs use BGP to access the same PE. The PE learns multiple IP VPN routes with the same VPN prefix from the CEs. To enable the PE to select a pair of primary and backup routes, deploy VPN IP FRR. After this feature is deployed, the PE generates a pair of primary and backup routes destined for the VPN prefix. If the primary route fails, the PE quickly switches VPN IP traffic to the backup route.</p>
<p>On the network shown in <a href="#EN-US_TASK_0172369561__fig_dc_vrp_mpls-l3vpn-v4_cfg_201401">Figure 1</a>, an EBGP peer relationship is established between the PE and each CE. There are two BGP routes from the PE to Loopback 1 on <span class="keyword">Device</span>A. The optimal route resides on Link_A, and the second optimal route resides on Link_B. VPN IP FRR must be deployed on the PE to enable traffic to be quickly switched to Link_B when Link_A fails.</p>
<div class="fignone" id="EN-US_TASK_0172369561__fig_dc_vrp_mpls-l3vpn-v4_cfg_201401"><a name="EN-US_TASK_0172369561__fig_dc_vrp_mpls-l3vpn-v4_cfg_201401"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_201401"></a><span class="figcap"><b>Figure 1 </b>Configuring VPN IP FRR</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent GE <span>0/1/0</span> and GE <span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="imgResize" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_201401.png" width="526.6800000000001" title="Click to enlarge"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369561__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>In a VPN FRR scenario, after the primary path recovers, traffic is switched back to this path. Because the order in which nodes undergo IGP convergence differs, packet loss may occur during the switchback. To resolve this problem, run the <a href="cmdqueryname=route-select+delay"><b><span class="cmdname">route-select delay</span></b></a> <em>delay-value</em> command to configure a route selection delay so that traffic is switched back only after forwarding entries on the devices along the primary path are updated. The delay specified using <em>delay-value</em> depends on various factors, such as the number of routes on the devices. Set an appropriate delay as needed.</p>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369561__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP at the VPN site, so that the route to Loopback 1 on <span class="keyword">Device</span>A can be advertised to CE1 and CE2.</p>
</li><li><p>Configure a VPN instance named vpna on the PE and bind GE <span>0/1/0</span> and GE <span>0/2/0</span> to vpna.</p>
</li><li><p>Establish an EBGP peer relationship between the PE and CE1, and between the PE and CE2. On CE1 and CE2, configure IGP and BGP to import routes from each other.</p>
</li><li><p>Enable BGP VPN auto FRR on the PE.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369561__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>VPN instance name (vpna) and attributes of the VPN instance IPv4 address family, for example, the RD (100:1) and VPN targets (100:100), on the PE</p>
</li><li><p>MEDs configured for the IGP routes imported into BGP on CE1 and CE2</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369561__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure IP addresses for the interfaces on the <span class="keyword">Router</span>s at the VPN site.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Configure IGP at the VPN site, so that the route to Loopback 1 on <span class="keyword">Device</span>A can be advertised to CE1 and CE2. This example uses OSPF as IGP.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-1-area-0.0.0.0] <strong>network 10.3.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>The configurations of CE2 and <span class="keyword">Device</span>A are similar to the configuration of CE1. For configuration details, see the configuration files.</p>
<p>After completing the configurations, run the <strong>display ip routing-table</strong> command on the CEs. The command output shows that CE1 and CE2 have learned the route to Loopback 1 on <span class="keyword">Device</span>A. The following example uses the command output on CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>display ip routing-table</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : _public_
         Destinations : 12       Routes : 12        

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct 0    0             D  10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
    <strong>11.11.11.11/32</strong>  OSPF   10   1             D  10.3.1.2        GigabitEthernet<span>0/2/0</span>
       10.3.1.0/24  Direct 0    0             D  10.3.1.1        GigabitEthernet<span>0/2/0</span>
       10.3.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.3.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
       10.4.1.0/24  OSPF   10   2             D  10.3.1.2        GigabitEthernet<span>0/2/0</span>
      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0
      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0
127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Configure a VPN instance on the PE and bind the interfaces connecting the PE to CEs to the VPN instance.</span><p><p># Configure a VPN instance named vpna on the PE, and bind GE<span>0/1/0</span> and GE<span>0/2/0</span> to the instance.</p>
<pre class="screen">&lt;PE&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE]<strong> ip vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-vpna] <strong>ipv4-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-vpna-af-ipv4]<strong> route-distinguisher 100:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-vpna-af-ipv4] <strong>vpn-target 100:100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-vpna-af-ipv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-vpn-instance-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>]<strong> ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>]<strong> ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>]<strong> ip binding vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>]<strong> ip address 10.2.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>quit</strong></pre>
</p></li><li><span>Establish EBGP peer relationships between the PE and CEs.</span><p><p># Configure the PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-vpna] <strong>peer 10.1.1.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-vpna] <strong>peer 10.2.1.2 as-number 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-vpna] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-bgp] <strong>quit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1-bgp] <strong>quit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.2.1.1 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2-bgp] <strong>quit</strong></pre>
<p>After completing the configurations, run the <strong>display bgp vpnv4 vpn-instance vpna peer</strong> command on the PE. The command output shows that the status of the EBGP peer relationship between the PE and CEs is <strong>Established</strong>.</p>
<pre class="screen">&lt;PE&gt; <strong>display bgp vpnv4 vpn-instance vpna peer</strong>
 
 BGP local router ID : 1.1.1.9
 Local AS number : 100
 Total number of peers : 2         Peers in established state : 2

  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State  PrefRcv
  10.1.1.2        4       65410       21       23     0 00:17:47 <strong>Established</strong>        1
  10.2.1.2        4       65410       51       64     0 00:15:03 <strong>Established</strong>        1</pre>
</p></li><li><span>Configure OSPF and BGP to import routes from each other on the CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>network 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-1] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>bgp 65410</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>network 11.11.11.11 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-1] <strong>import-route bgp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-ospf-10] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<p>After completing the configurations, run the <strong>display ip routing-table vpn-instance</strong> command on the PE. The command output shows the route to the loopback interface on <span class="keyword">Device</span>A.</p>
<pre class="screen">&lt;PE&gt; <strong>display ip routing-table vpn-instance vpna</strong>
display ip routing-table  vpn-instance vpna
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : vpna
         Destinations : 8        Routes : 8         

Destination/Mask    Proto  Pre  Cost        Flags NextHop         Interface

       10.1.1.0/24  Direct 0    0             D  10.1.1.1        GigabitEthernet<span>0/1/0</span>
       10.1.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
     10.1.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span>
    <strong>11.11.11.11/32</strong>  EBGP   255  1             RD 10.1.1.2        GigabitEthernet<span>0/1/0</span>
       10.2.1.0/24  Direct 0    0             D  10.2.1.1        GigabitEthernet<span>0/2/0</span>
       10.2.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
     10.2.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/2/0</span>
255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
</p></li><li><span>Enable VPN BGP auto FRR on the PE.</span><p><p># Configure the PE.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE-bgp]<strong> ipv4-family vpn-instance vpna</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-vpna]<strong> auto-frr</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-vpna]<strong> route-select delay 300</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp-vpna]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE-bgp]<strong> quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE]<strong> commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=auto-frr"><b><span class="cmdname">auto-frr</span></b></a> command configured in the BGP-VPN instance IPv4 address family view is valid only for the networking where BGP runs between the PE and CEs.</p>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p>Run the <strong>display ip routing-table vpn-instance</strong> command on the PE. The command output shows that the next hop to 11.11.11.11/32 is <strong>10.1.1.2</strong>, and the PE has a backup next hop and a backup outbound interface.</p>
<pre class="screen">&lt;PE&gt; <strong>display ip routing-table vpn-instance vpna 11.11.11.11 verbose</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : vpna
Summary Count : 1

Destination: 11.11.11.11/32          
     Protocol: EBGP            Process ID: 0              
   Preference: 255                   Cost: 1              
      NextHop: <strong>10.1.1.2</strong>         Neighbour: 0.0.0.0        
        State: Active Adv Relied      Age: 00h35m31s           
          Tag: 0                 Priority: low            
        Label: NULL               QoSInfo: 0x0            
   IndirectID: 0xc7          
 RelayNextHop: 10.1.1.2         Interface: GigabitEthernet<span>0/1/0</span>
     TunnelID: 0x0                  Flags: RD             
    <strong>BkNextHop: 10.2.1.2       BkInterface: GigabitEthernet<span>0/2/0</span></strong>
      BkLabel: NULL           SecTunnelID: 0x0              
 BkPETunnelID: 0x0        BkPESecTunnelID: 0x0              
 BkIndirectID: 0xc8</pre>
<p>Run the <a href="cmdqueryname=shutdown"><b><span class="cmdname">shutdown</span></b></a> command on GE <span>0/2/0</span> of CE1 to simulate a link fault.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface Gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>quit</strong></pre>
<p>Run the <strong>display ip routing-table vpn-instance</strong> command on the PE. The command output shows that the next hop to 11.11.11.11/32 is 10.2.1.2, and the PE does not have a backup next hop or a backup outbound interface.</p>
<pre class="screen">&lt;PE&gt; <strong>display ip routing-table vpn-instance vpna 11.11.11.11 verbose</strong>
<span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span>
------------------------------------------------------------------------------
Routing Table : vpna
Summary Count : 1

Destination: 11.11.11.11/32          
     Protocol: EBGP            Process ID: 0              
   Preference: 255                   Cost: 1              
      <strong>NextHop: 10.2.1.2</strong>         Neighbour: 0.0.0.0        
        State: Active Adv Relied      Age: 00h00m04s           
          Tag: 0                 Priority: low            
        Label: NULL               QoSInfo: 0x0            
   IndirectID: 0xc8          
 RelayNextHop: 10.2.1.2         Interface: GigabitEthernet<span>0/2/0</span>
     TunnelID: 0x0                  Flags: RD  </pre>
<p>Private network IP FRR has taken effect.</p>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369561__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>PE configuration file<pre class="screen">#
sysname PE
#
ip vpn-instance vpna
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 100:100 export-extcommunity
  vpn-target 100:100 import-extcommunity
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpna
 ip address 10.2.1.1 255.255.255.0
#
bgp 100
 #
 ipv4-family unicast
  undo synchronization
  #
 ipv4-family vpn-instance vpna
  auto-frr
  route-select delay 300
  peer 10.1.1.2 as-number 65410
  peer 10.2.1.2 as-number 65410
#
return
</pre>
</li><li>CE1 configuration file<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.3.1.1 255.255.255.0
#
bgp 65410
 peer 10.1.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.1.1.1 enable
#
ospf 1 
 import-route bgp
 area 0.0.0.0
  network 10.3.1.0 0.0.0.255
#
return</pre>
</li><li>CE2 configuration file<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.1 255.255.255.0
#
bgp 65410
 peer 10.2.1.1 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 11.11.11.11 255.255.255.255
  peer 10.2.1.1 enable
#
ospf 1 
  import-route bgp
  area 0.0.0.0
   network 10.4.1.0 0.0.0.255
#
return</pre>
</li><li><p><span class="keyword">Device</span> A configuration file</p>
<pre class="screen">#
sysname <span class="keyword">Device</span>A
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.3.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.4.1.2 255.255.255.0
#
interface LoopBack1
 ip address 11.11.11.11 255.255.255.255
#
ospf 1 
 area 0.0.0.0
  network 11.11.11.11 0.0.0.0
  network 10.3.1.0 0.0.0.255
  network 10.4.1.0 0.0.0.255
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0126.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_2015.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>

<script language="JavaScript">
<!--
image_size('.imgResize');
var msg_imageMax = "view original image";
var msg_imageClose = "close";
//--></script></body>
</html>