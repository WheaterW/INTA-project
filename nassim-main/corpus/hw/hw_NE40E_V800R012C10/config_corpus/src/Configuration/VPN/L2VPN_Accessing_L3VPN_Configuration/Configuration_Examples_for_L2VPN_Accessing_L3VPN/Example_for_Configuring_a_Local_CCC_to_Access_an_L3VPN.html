
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Local CCC to Access an L3VPN">
<meta name="abstract" content="A local CCC can access an L3VPN through a VE group.">
<meta name="description" content="A local CCC can access an L3VPN through a VE group.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5015.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00556928,w00606909,l00455378,l2-l3">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="L2VPN Accessing L3VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370368">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Local CCC to Access an L3VPN</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370368"></a><a name="EN-US_TASK_0172370368"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Local CCC to Access an L3VPN</h1>
<div class="taskbody"><p>A local CCC can access an L3VPN through a VE group.</p>
<div class="context"><a name="EN-US_TASK_0172370368__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370368__fig_dc_vrp_l2-l3_cfg_501401">Figure 1</a>, the local CCC configured on PE1 accesses the L3VPN between PE1 and PE2.</p>
<div class="fignone" id="EN-US_TASK_0172370368__fig_dc_vrp_l2-l3_cfg_501401"><a name="EN-US_TASK_0172370368__fig_dc_vrp_l2-l3_cfg_501401"></a><a name="fig_dc_vrp_l2-l3_cfg_501401"></a><span class="figcap"><b>Figure 1 </b>Configuring a local CCC to access an L3VPN</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1 and interface2 represent GE<span>0/1/0</span> and GE<span>0/1/1</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_l2-l3_cfg_501401.png"></span><br></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370368__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Assign an IP address to each interface.</p>
</li><li>Configure public network routes between PE1 and PE2 and advertise IP addresses of loopback interfaces.</li><li>Enable MPLS and MPLS LDP on PE1 and PE2, and enable MPLS L2VPN on PE1.</li><li>Configure a local CCC on PE1.</li><li>Configure an L3VPN on PE1 and PE2.</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370368__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li>VE-Group ID</li><li>IP addresses of the interfaces</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370368__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Assign an IP address to each interface. Configuration details are not mentioned here. For details, please check Configuration Files.</span></li><li><span>Configure public network routes between PE1 and PE2 and advertise IP addresses of loopback interfaces. IS-IS is adopted here, and configuration details are not mentioned. For details, please check Configuration Files.</span></li><li><span>Enable MPLS and MPLS LDP on PE1 and PE2. Enable MPLS L2VPN on PE1. For detailed configurations, see Configuration Files.</span></li><li><span>Configure a local CCC on PE1.</span><ol type="a"><li class="substepexpand"><span>Configure an L2VE interface and an L3VE interface on PE1, and add these interfaces to a VE group.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface virtual-ethernet<span>0/1/0</span></strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>] <strong>ve-group 1 l2-terminate</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface virtual-ethernet<span>0/1/1</span></strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>] <strong>ve-group 1 l3-access</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<div class="note" id="EN-US_TASK_0172370368__global-ve_01"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TASK_0172370368__p3507024143810">This example uses VE interfaces to implement L2VPN accessing L3VPN. Because VE interfaces are bound to only one board, services are interrupted when the board fails. To improve service reliability, create two global VE interfaces on NPEs: Global-VE1 (L2VE interface used to terminate L2VPN services) and Global-VE2 (L3VE interface used to access an L3VPN network). Other configurations do not need to be changed.</p>
</div></div>
</p></li><li class="substepexpand"><span>Configure a local CCC on PE1, with the inbound interface as the PE1 interface connecting to CE1 and the outbound interface as the L2VE interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface virtual-ethernet<span>0/1/0</span>.1</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 100</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/0</span>.1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>ccc ccc-ve interface gigabitethernet <span>0/1/0</span> out-interface virtual-ethernet<span>0/1/0</span>.1</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Verify the configuration. Run the <strong>display vll ccc</strong> command to check whether the local CCC is in the up state.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vll ccc</strong>
total  ccc vc : 1
local  ccc vc : 1,  1 <strong>up</strong>
remote ccc vc : 0,  0 up

name: ccc-ve, type: local, state: up,
intf1: GigabitEthernet<span>0/1/0</span> (up),access-port: false

intf2: Virtual-Ethernet<span>0/1/0</span>.1 (up),access-port: false

VC last up time : 2013/01/23 15:13:10
VC total up time:  4 days, 4 hours, 58 minutes, 1 seconds</pre>
</p></li></ol>
</li><li><span>Configure an L3VPN on PE1 and PE2.</span><ol type="a"><li class="substepexpand"><span>Configure a VPN instance and bind the corresponding interface to the VPN instance.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ip vpn-instance VPN1</strong>
[<span class="keyword">*</span>PE1-vpn-instance-VPN1] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE1-vpn-instance-VPN1-af-ipv4] <strong>route-distinguisher 200:1</strong>
[<span class="keyword">*</span>PE1-vpn-instance-VPN1-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>PE1-vpn-instance-VPN1-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-vpn-instance-VPN1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>interface virtual-ethernet<span>0/1/1</span>.1</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>vlan-type dot1q 100</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ip binding vpn-instance VPN1</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>ip address 10.1.1.2 24</strong>
[<span class="keyword">*</span>PE1-Virtual-Ethernet<span>0/1/1</span>.1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ip vpn-instance VPN1</strong>
[<span class="keyword">*</span>PE2-vpn-instance-VPN1] <strong>ipv4-family</strong>
[<span class="keyword">*</span>PE2-vpn-instance-VPN1-af-ipv4] <strong>route-distinguisher 200:1</strong>
[<span class="keyword">*</span>PE2-vpn-instance-VPN1-af-ipv4] <strong>vpn-target 111:1 both</strong>
[<span class="keyword">*</span>PE2-vpn-instance-VPN1-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>PE2-vpn-instance-VPN1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet<span>0/1/1</span></strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>ip binding vpn-instance VPN1</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.10.2.2 24</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>undo shutdown</strong>
[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Set up EBGP peer relationships between PEs and CEs and import VPN routes.</span><p><p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>bgp 65010</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>peer 10.1.1.2 as-number 100</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>import-route direct</strong>
[<span class="keyword">*</span>CE1-bgp] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>bgp 65020</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>peer 10.10.2.2 as-number 100</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>import-route direct</strong>
[<span class="keyword">*</span>CE2-bgp] <strong>commit</strong></pre>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpn-instance VPN1</strong>
[<span class="keyword">*</span>PE1-bgp-VPN1] <strong>peer 10.1.1.1 as-number 65010</strong>
[<span class="keyword">*</span>PE1-bgp-VPN1] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE1-bgp-VPN1] <strong>quit</strong>
[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpn-instance VPN1</strong>
[<span class="keyword">*</span>PE2-bgp-VPN1] <strong>peer 10.10.2.1 as-number 65020</strong>
[<span class="keyword">*</span>PE2-bgp-VPN1] <strong>import-route direct</strong>
[<span class="keyword">*</span>PE2-bgp-VPN1] <strong>quit</strong>
[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Set up the MP-IBGP peer relationship between PE1 and PE2.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 as-number 100</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>peer 2.2.2.2 connect-interface loopback 0</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>peer 2.2.2.2 enable</strong>
[<span class="keyword">*</span>PE1-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>PE1-bgp] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 as-number 100</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 connect-interface loopback 0</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>ipv4-family vpnv4</strong>
[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>peer 4.4.4.4 enable</strong>
[<span class="keyword">*</span>PE2-bgp-af-vpnv4] <strong>quit</strong>
[<span class="keyword">*</span>PE2-bgp] <strong>commit</strong></pre>
</p></li></ol>
</li><li><span>Verify the configuration. CE1 and CE2 can ping each other successfully. The following example uses the command output on CE1.</span><p><pre class="screen">&lt;CE1&gt; <strong>ping 10.10.2.1</strong>
  PING 10.10.2.1: 56  data bytes, press CTRL_C to break
    Reply from 10.10.2.1: bytes=56 Sequence=1 ttl=255 time=180 ms
    Reply from 10.10.2.1: bytes=56 Sequence=2 ttl=255 time=60 ms
    Reply from 10.10.2.1: bytes=56 Sequence=3 ttl=255 time=10 ms
    Reply from 10.10.2.1: bytes=56 Sequence=4 ttl=255 time=70 ms
    Reply from 10.10.2.1: bytes=56 Sequence=5 ttl=255 time=60 ms
  --- 10.10.2.1 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 10/76/180 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370368__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#                                                                               
 sysname CE1                                                              
#                                                                                                                     
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.1.1.1 255.255.255.0                                              
#                                                      
bgp 65010                                                                       
 peer 10.1.1.2 as-number 100                                                    
 #                                                                              
 ipv4-family unicast    
  undo synchronization                                                        
  import-route direct                                                           
  peer 10.1.1.2 enable                                                          
 #                                                                              
return                  </pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#                                                                               
 sysname PE1                                                              
#                                                                               
ip vpn-instance VPN1<span>
 ipv4-family</span>
 route-distinguisher 200:1
 apply-label per-instance
 vpn-target 111:1 export-extcommunity                                           
 vpn-target 111:1 import-extcommunity                                           
#                                                                               
 mpls lsr-id 4.4.4.4                                                            
 mpls                                                                           
#                                                                               
 mpls l2vpn                                                                     
#                                                                               
mpls ldp                                                                        
isis 1                                                                          
 network-entity 10.0000.0000.0004.00                                            
#                                                                               
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip address 10.10.1.1 255.255.255.0                                             
 isis enable 1                                                                  
 mpls                                                                           
 mpls ldp                                                                       
#                                      
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
#                                             
interface Virtual-Ethernet<span>0/1/0</span>                                                 
 ve-group 1 l2-terminate                                                        
#                                                                               
interface Virtual-Ethernet<span>0/1/0</span>.1                                               
 vlan-type dot1q 100                                                            
#                                                                               
interface Virtual-Ethernet<span>0/1/1</span>                                                 
 ve-group 1 l3-access                                                           
#                                                                               
interface Virtual-Ethernet<span>0/1/1</span>.1                                               
 vlan-type dot1q 100                                                            
 ip binding vpn-instance VPN1                                                   
 ip address 10.1.1.2 255.255.255.0                                              
#                                                               
 ccc ccc-ve interface GigabitEthernet<span>0/1/0</span> out-interface Virtual-Ethernet<span>0/1/0</span>.1
#                                                                               
interface LoopBack0                                                             
 ip address 4.4.4.4 255.255.255.255                                             
 isis enable 1                                                                  
#                                                   
bgp 100                                                                         
 peer 2.2.2.2 as-number 100                                                     
 peer 2.2.2.2 connect-interface LoopBack0                                       
 #                                                                              
 ipv4-family unicast      
  undo synchronization                                                         
  peer 2.2.2.2 enable                                                           
 #                                                                              
 ipv4-family vpnv4                                                              
  policy vpn-target                                                             
  peer 2.2.2.2 enable                                                           
 #                                                                              
 ipv4-family vpn-instance VPN1                                                  
  import-route direct                                                           
  peer 10.1.1.1 as-number 65010                                                 
#                                         
return                                                </pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#                                                                               
sysname PE2                                                              
#                                            
ip vpn-instance VPN1<span>
 ipv4-family</span>
 route-distinguisher 200:1
 apply-label per-instance                                                     
 vpn-target 111:1 export-extcommunity                                           
 vpn-target 111:1 import-extcommunity                                           
#                                                                               
 mpls lsr-id 2.2.2.2                                                            
 mpls                                                                           
#                                                                               
mpls ldp                                                                        
#                                              
isis 1                                                                          
 network-entity 10.0000.0000.0003.00                                            
#                                    
interface GigabitEthernet<span>0/1/1</span>                                                  
 undo shutdown                                                                  
 ip binding vpn-instance VPN1                                                   
 ip address 10.10.2.2 255.255.255.0                                             
#                                   
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.10.1.2 255.255.255.0                                             
 isis enable 1                                                                  
 mpls                                                                           
 mpls ldp                                                                       
#                                  
interface LoopBack0                                                             
 ip address 2.2.2.2 255.255.255.255                                             
 isis enable 1                                                                  
#                                                        
bgp 100                                                                         
 peer 4.4.4.4 as-number 100                                                     
 peer 4.4.4.4 connect-interface LoopBack0                                       
 #                                                                              
 ipv4-family unicast                                                            
  undo synchronization 
  peer 4.4.4.4 enable                                                           
 #                                                                              
 ipv4-family vpnv4                                                              
  policy vpn-target                                                             
  peer 4.4.4.4 enable                                                           
 #                                                                              
 ipv4-family vpn-instance VPN1                                                  
  import-route direct                                                           
  peer 10.10.2.1 as-number 65020                                                
#                                     
return                                     </pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#                                                                               
sysname CE2                                                              
#                                    
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ip address 10.10.2.1 255.255.255.0                                             
#                                       
bgp 65020                                                                       
 peer 10.10.2.2 as-number 100                                                   
 #                                                                              
 ipv4-family unicast                                                              
  undo synchronization                                                         
  import-route direct                                                           
  peer 10.10.2.2 enable                                                         
#                                                   
return                            </pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5013.html">Configuration Examples for L2VPN Accessing L3VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_l2-l3_cfg_5015.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>