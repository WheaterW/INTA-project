
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Inter-AS VPN Option B with a P Between ASBRs">
<meta name="abstract" content="An LSP is set up between ASBRs through LDP + IGP to traverse MPLS networks that do not support VPN. A P is deployed between the ASBRs.">
<meta name="description" content="An LSP is set up between ASBRs through LDP + IGP to traverse MPLS networks that do not support VPN. A P is deployed between the ASBRs.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0114.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0116.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,l3vpnvrp,w00556928,l00468467,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="BGP/MPLS IP VPN">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="h00847023">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172369506">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring Inter-AS VPN Option B with a P Between ASBRs</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172369506"></a><a name="EN-US_TASK_0172369506"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Inter-AS VPN Option B with a P Between ASBRs</h1>
<div class="taskbody"><p>An LSP is set up between ASBRs through LDP + IGP to traverse MPLS networks that do not support VPN. A P is deployed between the ASBRs.</p>
<div class="context"><a name="EN-US_TASK_0172369506__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172369506__fig_dc_vrp_mpls-l3vpn-v4_cfg_011501">Figure 1</a>, CE1 and CE2 belong to the same VPN. CE1 connects to PE1 in AS 100, and CE2 connects to PE2 in AS 200. The MPLS network between ASBRs does not support VPN. In other words, there must be a P between the ASBRs. It is required that an LSP be set up between the ASBRs in different ASs to implement inter-AS VPN Option B.</p>
<div class="fignone" id="EN-US_TASK_0172369506__fig_dc_vrp_mpls-l3vpn-v4_cfg_011501"><a name="EN-US_TASK_0172369506__fig_dc_vrp_mpls-l3vpn-v4_cfg_011501"></a><a name="fig_dc_vrp_mpls-l3vpn-v4_cfg_011501"></a><span class="figcap"><b>Figure 1 </b>Inter-AS VPN Option B networking with a P between ASBRs</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>interface1 and interface2 in this example represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_mpls-l3vpn-v4_cfg_011501.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369506__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Precautions</h4><p>When configuring inter-AS VPN Option B with a P between ASBRs, note the following:</p>
<ul><li><p>ASBRs do not need to have VPN instances or filter received VPNv4 routes based on VPN targets.</p>
</li><li><p>IGP + LDP needs to be deployed between ASBRs.</p>
</li><li><p>The MP-EBGP connection between ASBRs involves multiple hops.</p>
</li></ul>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369506__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Configure IGP on the backbone network for IP connectivity between the ASBR and PE in the same AS, and set up an MPLS LDP LSP between the ASBR and PE in the same AS.</p>
</li><li><p>Set up EBGP peer relationships between PEs and CEs and MP-IBGP peer relationships between PEs and ASBRs.</p>
</li><li><p>Configure VPN instances on the PEs rather than ASBRs.</p>
</li><li><p>Set up an EBGP peer relationship and an MPLS LDP LSP between ASBRs.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172369506__1.4.4"></a><a name="1.4.4"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>MPLS LSR IDs of the PEs and ASBRs: 10.31.1.9, 10.32.2.9, 10.33.3.9, 10.34.4.9, and 10.35.5.9</p>
</li><li><p>Name (vpn1), RD (100:1/200:1), and export and import VPN targets (1:1) of the VPN instance on each PE</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172369506__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>On the MPLS backbone networks in AS 100 and AS 200, configure IGP for IP connectivity between the PE and ASBR on each network.</span><p><p>In this example, OSPF is used as an IGP. For configuration details, see the configuration files.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The 32-bit IP address of the loopback interface that functions as the LSR ID needs to be advertised using OSPF.</p>
</div></div>
<p>After the configuration is complete, run the <strong>display ospf peer </strong>command on the ASBR and PE in each AS. The command output shows that the OSPF neighbor relationship is in the <strong>Full</strong> state, which indicates that the OSPF neighbor relationship has been established between the ASBR and PE in the same AS.</p>
<p>The ASBR and PE in the same AS can learn and successfully ping the address of each other's loopback interface.</p>
</p></li><li><span>Configure basic MPLS capabilities and MPLS LDP on the MPLS backbone networks in AS 100 and AS 200 to establish LDP LSPs.</span><p><p>For configuration details, see the configuration files.</p>
</p></li><li><span>Configure the basic BGP/MPLS IP VPN functions on PE1 and PE2.</span><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>PE1's import and export VPN targets must match PE2's export and import VPN targets, respectively.</p>
</div></div>
<p>For configuration details, see the configuration files.</p>
</p></li><li><span>Establish an MPLS LDP LSP and an MP-EBGP peer relationship between ASBRs.</span><p><p>Configure IGP between the ASBRs. This example uses OSPF as IGP.</p>
<p># Configure ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>interface gigabitethernet <span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>ip address 192.168.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>ospf 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-ospf-2] <strong>area 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-ospf-2-area-0.0.0.0] <strong>network 10.32.2.10 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-ospf-2-area-0.0.0.0] <strong>network 192.168.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-ospf-2-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-ospf-2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-ospf-2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>quit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The process ID of the OSPF protocol running between ASBRs must be different from the process ID of the OSPF protocol running in each AS.</p>
</div></div>
<p>The configurations of ASBR2 and the P are similar to the configuration of ASBR1. For configuration details, see the configuration files.</p>
<p># Set up an MPLS LDP LSP between ASBRs.</p>
<pre class="screen">&lt;ASBR1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>mpls lsr-id 10.32.2.9</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1] <strong>interface gigabitethernet<span>0/2/0</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-GigabitEthernet<span>0/2/0</span>] <strong>quit</strong></pre>
<p>The configurations of ASBR2 and the P are similar to the configuration of ASBR1. For configuration details, see the configuration files.</p>
<p>After the configuration is complete, run the <strong>display mpls ldp lsp</strong> command on ASBRs. The command output shows that an MPLS LDP LSP has been established between ASBRs.</p>
<pre class="screen">&lt;ASBR1&gt;<strong>display mpls ldp lsp</strong></pre>
<pre class="screen"> LDP LSP Information
 -------------------------------------------------------------------------------
 Flag after Out IF: (I) - RLFA Iterated LSP, (I*) - Normal and RLFA Iterated LSP
 -------------------------------------------------------------------------------
 DestAddress/Mask   In/OutLabel    UpstreamPeer    NextHop          OutInterface
 -------------------------------------------------------------------------------
 10.31.1.9/32       NULL/3         -               172.16.1.2       GigabitEthernet<span>0/1/0</span>
 10.31.1.9/32       48060/3        10.31.1.9       172.16.1.2       GigabitEthernet<span>0/1/0</span>
 10.31.1.9/32       48060/3        10.35.5.9       172.16.1.2       GigabitEthernet<span>0/1/0</span>
 10.32.2.9/32       3/NULL         10.31.1.9       127.0.0.1        Loop1
 10.32.2.9/32       3/NULL         10.35.5.9       127.0.0.1        Loop1
*10.32.2.9/32       Liberal/48061                  DS/10.31.1.9
*10.32.2.9/32       Liberal/48077                  DS/10.35.5.9
 10.32.2.10/32      3/NULL         10.31.1.9       127.0.0.1        Loop2
 10.32.2.10/32      3/NULL         10.35.5.9       127.0.0.1        Loop2
*10.32.2.10/32      Liberal/48076                  DS/10.35.5.9
 10.33.3.9/32       NULL/48079     -               192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.33.3.9/32       48080/48079    10.31.1.9       192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.33.3.9/32       48080/48079    10.35.5.9       192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.33.3.10/32      NULL/48078     -               192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.33.3.10/32      48079/48078    10.31.1.9       192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.33.3.10/32      48079/48078    10.35.5.9       192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.35.5.9/32       NULL/3         -               192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.35.5.9/32       48078/3        10.31.1.9       192.168.1.2      GigabitEthernet<span>0/2/0</span>
 10.35.5.9/32       48078/3        10.35.5.9       192.168.1.2      GigabitEthernet<span>0/2/0</span>
 -------------------------------------------------------------------------------
 TOTAL: 5 Normal LSP(s) Found.
 TOTAL: 1 Liberal LSP(s) Found.
 TOTAL: 0 Frr LSP(s) Found.
<span> An asterisk (*) before an LSP means the LSP is not established
 An asterisk (*) before a Label means the USCB or DSCB is stale
 An asterisk (*) before an UpstreamPeer means the session is stale
 An asterisk (*) before a DS means the session is stale
 An asterisk (*) before a NextHop means the LSP is FRR LSP</span></pre>
<p># Configure ASBR1 to establish an MP-EBGP peer with ASBR2, and disable ASBR1 from filtering received VPNv4 routes based on VPN targets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> peer 10.33.3.10 as-number 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> peer 10.33.3.10 connect-interface loopback2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp]<strong> peer 10.33.3.10 ebgp-max-hop 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp] <strong>ipv4-family vpnv4</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>peer 10.33.3.10 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4]<strong> undo policy vpn-target</strong></pre>
<pre class="screen">[<span class="keyword">*</span>ASBR1-bgp-af-vpnv4] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp-af-vpnv4] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>ASBR1-bgp] <strong>quit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>After the configuration is complete, CE1 and CE2 can learn routes to interfaces on each other and ping each other successfully.</p>
<p>The following example uses the command output on CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>display ip routing-table</strong></pre>
<pre class="screen"><span class="keyword">Route Flags: R - relay, D - download to fib, T - to vpn-instance, B - black hole route</span></pre>
<pre class="screen">------------------------------------------------------------------------------</pre>
<pre class="screen">Routing Table: _public_</pre>
<pre class="screen">         Destinations : 8        Routes : 8</pre>
<pre class="screen">Destination/Mask    Proto  Pre  Cost     Flags NextHop         Interface</pre>
<pre class="screen">       10.1.1.0/24  Direct 0    0             D  10.1.1.1        GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">       10.1.1.1/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">     10.1.1.255/32  Direct 0    0             D  127.0.0.1       GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">   <strong>10.22.22.22/32</strong>  EBGP   255  0             D  10.1.1.2        GigabitEthernet<span>0/1/0</span></pre>
<pre class="screen">      127.0.0.0/8   Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">      127.0.0.1/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">127.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">255.255.255.255/32  Direct 0    0             D  127.0.0.1       InLoopBack0</pre>
<pre class="screen">&lt;CE1&gt; <strong>ping -a 10.11.11.11 10.22.22.22</strong></pre>
<pre class="screen">  PING 10.22.22.22: 56  data bytes, press CTRL_C to break</pre>
<pre class="screen">    Reply from 10.22.22.22: bytes=56 Sequence=1 ttl=252 time=120 ms</pre>
<pre class="screen">    Reply from 10.22.22.22: bytes=56 Sequence=2 ttl=252 time=73 ms</pre>
<pre class="screen">    Reply from 10.22.22.22: bytes=56 Sequence=3 ttl=252 time=111 ms</pre>
<pre class="screen">    Reply from 10.22.22.22: bytes=56 Sequence=4 ttl=252 time=86 ms</pre>
<pre class="screen">    Reply from 10.22.22.22: bytes=56 Sequence=5 ttl=252 time=110 ms</pre>
<pre class="screen">  --- 22.22.22.22 ping statistics ---</pre>
<pre class="screen">    5 packet(s) transmitted</pre>
<pre class="screen">    5 packet(s) received</pre>
<pre class="screen">    0.00% packet loss</pre>
<pre class="screen">    round-trip min/avg/max = 73/100/120 ms </pre>
<p>Run the <strong>display bgp vpnv4 all routing-table</strong> command on either ASBR to view information about VPNv4 routes.</p>
<p>The following example uses the command output on ASBR1.</p>
<pre class="screen">&lt;ASBR1&gt;<strong> display bgp vpnv4 all routing-table</strong></pre>
<pre class="screen"> BGP Local router ID is 10.32.2.9
 Status codes: * - valid, &gt; - best, d - damped,<span> x - best external,</span><span> a - add path,</span>
               h - history,  i - internal, s - suppressed, S - Stale
               Origin : i - IGP, e - EGP, ? - incomplete
<span> RPKI validation codes: V - valid, I - invalid, N - not-found</span>


 Total number of routes from all PE: 2
 Route Distinguisher: 100:1


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;i  <strong>10.11.11.11/32</strong>   10.31.1.9       0          100        0      65001i
 Route Distinguisher: 200:1


      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn

 *&gt;   <strong>10.22.22.22/24</strong>   10.33.3.10                           0      200 65002i</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172369506__1.4.6"></a><a name="1.4.6"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface Loopback 1
 ip address 10.11.11.11 255.255.255.255
#
bgp 65001
 peer 10.1.1.2 as-number 100
 #
 ipv4-family unicast
  undo synchronization
  network 10.11.11.11 255.255.255.255
  peer 10.1.1.2 enable
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 100:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 10.31.1.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.1.1.2 255.255.255.0
#
interface LoopBack1
 ip address 10.31.1.9 255.255.255.255
#
bgp 100
 peer 10.32.2.9 as-number 100
 peer 10.32.2.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 10.32.2.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.32.2.9 enable
#
 ipv4-family vpn-instance vpn1
  peer 10.1.1.1 as-number 65001
#
ospf 1
 area 0.0.0.0
  network 10.31.1.9 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR1 configuration file</p>
<pre class="screen">#
sysname ASBR1
#
mpls lsr-id 10.32.2.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 172.16.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 10.32.2.9 255.255.255.255
#
interface LoopBack2
 ip address 10.32.2.10 255.255.255.255
#
bgp 100
 peer 10.31.1.9 as-number 100
 peer 10.31.1.9 connect-interface LoopBack1
 peer 10.33.3.10 as-number 200
 peer 10.33.3.10 connect-interface LoopBack2
 peer 10.33.3.10 ebgp-max-hop 3
 #
 ipv4-family unicast
  undo synchronization
  peer 10.33.3.10 enable
  peer 10.31.1.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.31.1.9 enable
  peer 10.33.3.10 enable
#
ospf 1
 area 0.0.0.0
  network 10.32.2.9 0.0.0.0
  network 172.16.1.0 0.0.0.255
#
ospf 2
 import-route direct
 area 0.0.0.0
  network 10.32.2.10 0.0.0.0
  network 192.168.1.0 0.0.0.255
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
mpls lsr-id 10.35.5.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 10.35.5.9 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 10.35.5.9 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>ASBR2 configuration file</p>
<pre class="screen">#
sysname ASBR2
#
mpls lsr-id 10.33.3.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.162.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack1
 ip address 10.33.3.9 255.255.255.255
#
interface LoopBack2
 ip address 10.33.3.10 255.255.255.255
#
bgp 200
 peer 10.32.2.10 as-number 100
 peer 10.32.2.10 connect-interface LoopBack2
 peer 10.32.2.10 ebgp-max-hop 3
 peer 10.34.4.9 as-number 200
 peer 10.34.4.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 10.32.2.10 enable
  peer 10.34.4.9 enable
 #
 ipv4-family vpnv4
  undo policy vpn-target
  peer 10.34.4.9 enable
  peer 10.32.2.10 enable
#
ospf 1
 area 0.0.0.0
  network 10.33.3.9 0.0.0.0
  network 10.162.1.0 0.0.0.255
#
ospf 2
 import-route direct
 area 0.0.0.0
  network 10.33.3.10 0.0.0.0
  network 192.168.2.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
ip vpn-instance vpn1
 ipv4-family
  route-distinguisher 200:1
  apply-label per-instance
  vpn-target 1:1 export-extcommunity
  vpn-target 1:1 import-extcommunity
#
mpls lsr-id 10.34.4.9
#
mpls
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.162.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip binding vpn-instance vpn1
 ip address 10.2.1.2 255.255.255.0
#
interface LoopBack1
 ip address 10.34.4.9 255.255.255.255
#
bgp 200
 peer 10.33.3.9 as-number 200
 peer 10.33.3.9 connect-interface LoopBack1
 #
 ipv4-family unicast
  undo synchronization
  peer 10.33.3.9 enable
 #
 ipv4-family vpnv4
  policy vpn-target
  peer 10.33.3.9 enable
#
 ipv4-family vpn-instance vpn1
  peer 10.2.1.1 as-number 65002
#
ospf 1
 area 0.0.0.0
  network 10.34.4.9 0.0.0.0
  network 10.162.1.0 0.0.0.255
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.1.1 255.255.255.0
#
interface Loopback 1
 ip address 10.22.22.22 255.255.255.255
#
bgp 65002
 peer 10.2.1.2 as-number 200
 #
 ipv4-family unicast
  undo synchronization
  network 10.22.22.22 255.255.255.255
  peer 10.2.1.2 enable
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0101.html">Configuration Examples for BGP/MPLS IP VPN
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0114.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_mpls-l3vpn-v4_cfg_0116.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>