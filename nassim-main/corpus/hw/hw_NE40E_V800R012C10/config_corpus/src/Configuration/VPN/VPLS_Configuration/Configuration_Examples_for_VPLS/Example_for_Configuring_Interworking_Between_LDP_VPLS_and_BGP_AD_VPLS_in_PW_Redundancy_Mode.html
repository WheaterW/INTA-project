
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring Interworking Between LDP VPLS and BGP AD VPLS in PW Redundancy Mode">
<meta name="abstract" content="This section provides an example of configuring interworking between Label Distribution Protocol (LDP) virtual private LAN service (VPLS) and Border Gateway Protocol Auto-Discovery (BGP AD) VPLS in pseudo wire (PW) redundancy mode.">
<meta name="description" content="This section provides an example of configuring interworking between Label Distribution Protocol (LDP) virtual private LAN service (VPLS) and Border Gateway Protocol Auto-Discovery (BGP AD) VPLS in pseudo wire (PW) redundancy mode.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5068.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5072.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,vpls,w00556928,w00606909,l00455378">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPLS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172370275">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Example for Configuring Interworking Between LDP VPLS and BGP AD VPLS in PW Redundancy Mode</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0172370275"></a><a name="EN-US_TASK_0172370275"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring Interworking Between LDP VPLS and BGP AD VPLS in PW Redundancy Mode</h1>
<div class="taskbody"><p>This section provides an example of configuring interworking between Label Distribution Protocol (LDP) virtual private LAN service (VPLS) and Border Gateway Protocol Auto-Discovery (BGP AD) VPLS in pseudo wire (PW) redundancy mode.</p>
<div class="context"><a name="EN-US_TASK_0172370275__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0172370275__fig_dc_vrp_vpls_cfg_506901">Figure 1</a>, PE1 supports LDP VPLS, PE4 supports BGP AD VPLS, and PE2 and PE3 support both LDP VPLS and BGP AD VPLS. It is required that interworking between LDP VPLS and BGP AD VPLS be configured in PW redundancy mode for CE1 and CE2 to communicate.</p>
<div class="p">The specific PW deployment requirements are as follows:<ul><li>Establish an LDP hub PW from PE1 to PE2 and from PE1 to PE3. The two PWs work in master/slave PW redundancy mode.</li><li>Establish an LDP spoke PW from PE2 to PE1. Establish a BGP AD hub PW from PE2 to PE3 and from PE2 to PE4.</li><li>Establish an LDP spoke PW from PE3 to PE1. Establish a BGP AD hub PW from PE3 to PE2 and from PE3 to PE4.</li><li>Establish a BGP AD hub PW from PE4 to PE2 and from PE4 to PE3.</li></ul>
</div>
<div class="fignone" id="EN-US_TASK_0172370275__fig_dc_vrp_vpls_cfg_506901"><a name="EN-US_TASK_0172370275__fig_dc_vrp_vpls_cfg_506901"></a><a name="fig_dc_vrp_vpls_cfg_506901"></a><span class="figcap"><b>Figure 1 </b>LDP VPLS accessing BGP AD VPLS in PW redundancy mode</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>In this example, interface1 represents GE<span>0/1/2</span>.</li></ul>
</div></div>
<br><span><img class="vsd" src="images/fig_dc_vrp_vpls_cfg_506901.png"></span></div>

<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Interface IP addresses</caption><thead align="left"><tr><th align="left" class="cellrowborder" char="." valign="top" width="20%" id="mcps1.4.1.5.2.4.1.1" liSelected="liSelected"><p><strong>Device</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="60%" id="mcps1.4.1.5.2.4.1.2" liSelected="liSelected"><p><strong>Interface</strong></p>
</th>
<th align="left" class="cellrowborder" char="." valign="top" width="20%" id="mcps1.4.1.5.2.4.1.3" liSelected="liSelected"><p><strong>IP Address</strong></p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.1.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.2.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>1.1.1.1/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.1.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.4.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.3.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>2.2.2.2/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE3</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.5.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.2.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.3.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>3.3.3.3/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="4" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.1 "><p>PE4</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/0</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.5.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/1</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.4.2/24</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>Loopback 0</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>4.4.4.4/32</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.1 "><p>CE1</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.10.1/24</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="2" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.1 "><p>CE2</p>
</td>
<td class="cellrowborder" char="." valign="top" width="60%" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span></p>
</td>
<td class="cellrowborder" char="." valign="top" width="20%" headers="mcps1.4.1.5.2.4.1.3 "><p>-</p>
</td>
</tr>
<tr><td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.2 "><p>GE <span>0/1/2</span>.1</p>
</td>
<td class="cellrowborder" char="." valign="top" headers="mcps1.4.1.5.2.4.1.3 "><p>192.168.10.2/24</p>
</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370275__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure an IP address and a routing protocol for each involved interface so that PEs can communicate at the network layer. This example uses OSPF as the routing protocol.</li><li><p>Configure MPLS and public tunnels to carry PWs. In this example, LDP LSPs are used between PEs.</p>
</li><li><p>Configure PE1, PE2, and PE3 to form an LDP VPLS network.</p>
</li><li><p>Configure BGP AD VPLS among PE2, PE3, and PE4.</p>
</li><li><p>Configure PW redundancy (master/slave) on PE1.</p>
</li><li><p>Configure Media Access Control (MAC) Withdraw.</p>
</li></ol>
</div></div>
<div class="context"><a name="EN-US_TASK_0172370275__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IP address, OSPF process ID (1), and OSPF area ID (0) of each interface, and LSR ID of each PE</p>
</li><li><p>VSI name, VSI ID, VPLS ID, VPN targets, and BGP AS number</p>
</li><li><p>Number and VLAN ID of each interface bound to a VSI</p>
</li><li><p>PW redundancy protection group name, revertive switching mode, revertive switching delay, and PW priorities</p>
</li></ul>
</div></div>
<div class="steps"><a name="EN-US_TASK_0172370275__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure an IP address and a routing protocol for each involved interface on the backbone network so that PEs can communicate at the network layer.</span><p><p>OSPF is used in this example. For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display ip routing-table</strong> command on PEs. The command output shows that the PEs have learned each other's loopback interface address.</p>
</p></li><li><span>Configure MPLS and public tunnels.</span><p><p>This example uses LDP LSPs as public network tunnels. For detailed configurations, see Configuration Files.</p>
<p>After the configuration is complete, run the <strong>display mpls ldp session</strong> command on PEs. The command output shows that <strong>Status</strong> is <strong>Operational</strong> for the peer relationship between PEs, indicating that the peer relationship has been set up. Run the <strong>display mpls lsp</strong> command. The command output shows whether LSPs have been set up.</p>
</p></li><li><span>Configure PE1, PE2, and PE3 to form an LDP VPLS network.</span><p><p># Configure PE1.</p>
<pre class="screen">&lt;PE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>vsi vsi1 static</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>peer 2.2.2.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">&lt;PE3&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>vsi-id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>peer 1.1.1.1 upe</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># On PE1, bind the attachment circuit (AC) interface to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure BGP AD VPLS among PE2, PE3, and PE4.</span><p><ol type="a"><li><p>Enable BGP peers to exchange VPLS information.</p>
<p># Configure PE2.</p>
<pre class="screen">&lt;PE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 3.3.3.3 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>peer 4.4.4.4 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 2.2.2.2 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 4.4.4.4 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>peer 4.4.4.4 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>peer 4.4.4.4 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<p># Configure PE4.</p>
<pre class="screen">&lt;PE4&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>bgp 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 2.2.2.2 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 2.2.2.2 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 3.3.3.3 as-number 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>peer 3.3.3.3 connect-interface loopback0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>l2vpn-ad-family</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>peer 2.2.2.2 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>peer 3.3.3.3 enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp-af-l2vpn-ad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-bgp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</li><li><p>Create VSIs and configure the BGP AD signaling.</p>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1--bgpad] <strong>vpls-id 192.168.0.0:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1--bgpad] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1--bgpad] <strong>vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1--bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>On PE2, the LDP and BGP AD PWs must be configured in the same VSI.</p>
</div></div>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>vpls-id 192.168.0.0:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1--bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>On PE3, the LDP and BGP AD PWs must be configured in the same VSI.</p>
</div></div>
<p># Configure PE4.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>bgp-ad</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>vpls-id 192.168.0.0:1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>vpn-target 100:1 import-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>vpn-target 100:1 export-extcommunity</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1--bgpad] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</li><li><p># On PE4, bind the AC interface to the VSI.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE4] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>.1] <strong>l2 binding vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE4] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Configure PW redundancy (master/slave) on PE1.</span><p><ol type="a"><li><p>Configure a PW redundancy protection group on PE1 and specify the PW redundancy mode as master/slave. Add specified PWs to the PW redundancy protection group, specify the priorities of the PWs, and set the revertive switching delay to 60s.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>pwsignal ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>protect-group vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp-protect-group-vsi1] <strong>protect-mode pw-redundancy master</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 2.2.2.2 preference 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp-protect-group-vsi1] <strong>peer 3.3.3.3 preference 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp-protect-group-vsi1] <strong>reroute delay 60</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp-protect-group-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</li><li><p>Configure BFD for primary PW.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>bfd p1 bind pw vsi vsi1 peer 2.2.2.2 remote-peer 2.2.2.2 pw-ttl auto-calculate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-p1] <strong>discriminator local 104</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-p1] <strong>discriminator remote 401</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-bfd-lsp-session-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-bfd-lsp-session-p1] <strong>quit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>bfd</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>bfd p1 bind pw vsi vsi1 peer 1.1.1.1 remote-peer 1.1.1.1 pw-ttl auto-calculate</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-p1] <strong>discriminator local 401</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-p1] <strong>discriminator remote 104</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-bfd-lsp-session-p1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2-bfd-lsp-session-p1] <strong>quit</strong></pre>
</li><li><p>Check the primary/secondary status of PWs.</p>
<p># On PE1, check the PW status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display vsi verbose</strong></pre>
<pre class="screen"> ***VSI Name               : vsi1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : <strong>ldp</strong>
    Member Discovery Style : static
<span>    Bridge-domain Mode     : disable</span>
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 1 hours, 12 minutes, 47 seconds
    VSI State              : up

    VSI ID                 : 1
   *Peer Router ID         : 2.2.2.2
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 1028
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800808
    Broadcast Tunnel ID    : 0x800808
    Broad BackupTunnel ID  : 0x0
    CKey                   : 2
    NKey                   : 1
    Stp Enable             : 0
    PwIndex                : 0
<span>    Control Word           : disable</span>

  *Peer Router ID         : 3.3.3.3
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 1029
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800809
    Broadcast Tunnel ID    : 0x800809
    Broad BackupTunnel ID  : 0x0
    CKey                   : 4
    NKey                   : 3
<span>    Stp Enable             : 0</span>
    PwIndex                : 0
<span>    Control Word           : disable</span>

    Interface Name         : GigabitEthernet<span>0/1/2</span>.1
    State                  : up
    Access Port            : false
    Last Up Time           : 2012/12/24 19:06:41
    Total Up Time          : 0 days, 1 hours, 3 minutes, 5 seconds

  **PW Information:

   *Peer Ip Address        : 3.3.3.3
    PW State               : <strong>backup</strong>
    Local VC Label         : 1029
    Remote VC Label        : 1028
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x800809
    Broadcast Tunnel ID    : 0x800809
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x4
    Nkey                   : 0x3
    Main PW Token          : 0x800809
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/1</span>
    Backup OutInterface    :
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/24 19:06:41
    PW Total Up Time       : 0 days, 1 hours, 3 minutes, 5 seconds
   *Peer Ip Address        : 2.2.2.2
    PW State               : up
    Local VC Label         : 1028
    Remote VC Label        : 1032
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x800808
    Broadcast Tunnel ID    : 0x800808
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x2
    Nkey                   : 0x1
    Main PW Token          : 0x800808
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/0</span>
    Backup OutInterface    :
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/24 19:52:15
    PW Total Up Time       : 0 days, 0 hours, 17 minutes, 33 seconds</pre>
<p># On PE2, check the PW status.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>display vsi verbose</strong></pre>
<pre class="screen"> ***VSI Name               : vsi1
    Administrator VSI      : no
    Isolate Spoken         : disable
    VSI Index              : 0
    PW Signaling           : <strong>ldp bgpad</strong>
    Member Discovery Style : --
<span>    Bridge-domain Mode     : disable</span>
    PW MAC Learn Style     : unqualify
    Encapsulation Type     : vlan
    MTU                    : 1500
    Diffserv Mode          : uniform
    Service Class          : --
    Color                  : --
    DomainId               : 255
    Domain Name            :
    Ignore AcState         : disable
    P2P VSI                : disable
    Create Time            : 0 days, 1 hours, 15 minutes, 29 seconds
    VSI State              : up

    VPLS ID                : 192.168.0.0:1
    RD                     : 192.168.0.0:1
    Import vpn target      : 100:1
    Export vpn target      : 100:1
    BGPAD VSI ID           : 2.2.2.2

   *Peer Router ID         : 4.4.4.4
    VPLS ID                : 192.168.0.0:1
    SAII                   : 2.2.2.2
    TAII                   : 4.4.4.4
    VC Label               : 1034
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x80081a
    Broadcast Tunnel ID    : 0x80081a
    CKey                   : 10
    NKey                   : 9

   *Peer Router ID         : 3.3.3.3
    VPLS ID                : 192.168.0.0:1
    SAII                   : 2.2.2.2
    TAII                   : 3.3.3.3
    VC Label               : 1035
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x80081b
    Broadcast Tunnel ID    : 0x80081b
    CKey                   : 11
    NKey                   : 7

    VSI ID                 : 1
   *Peer Router ID         : 1.1.1.1
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 1032
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800818
    Broadcast Tunnel ID    : 0x800818
    Broad BackupTunnel ID  : 0x0
    CKey                   : 6
    NKey                   : 5
<span>    Stp Enable             : 0</span>
    PwIndex                : 0
<span>    Control Word           : disable</span>
   *Peer Router ID         : 3.3.3.3
    primary or secondary   : primary
    ignore-standby-state   : no
    VC Label               : 1033
    Peer Type              : dynamic
    Session                : up
    Tunnel ID              : 0x800819
    Broadcast Tunnel ID    : 0x800819
    Broad BackupTunnel ID  : 0x0
    CKey                   : 8
    NKey                   : 7
<span>    Stp Enable             : 0</span>
    PwIndex                : 0
<span>    Control Word           : disable</span>

  **PW Information:

   *Peer Ip Address        : 1.1.1.1
    PW State               : <strong>up</strong>
    Local VC Label         : 1032
    Remote VC Label        : 1028
<span>    Remote Control Word    : disable</span>
    PW Type                : MEHVPLS
    Tunnel ID              : 0x800818
    Broadcast Tunnel ID    : 0x800818
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x6
    Nkey                   : 0x5
    Main PW Token          : 0x800818
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/0</span>
    Backup OutInterface    :
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/24 19:52:15
    PW Total Up Time       : 0 days, 0 hours, 20 minutes, 34 seconds
   *Peer Ip Address        : 3.3.3.3
    PW State               : up
    Local VC Label         : 1033
    Remote VC Label        : 1037
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x800819
    Broadcast Tunnel ID    : 0x800819
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0x8
    Nkey                   : 0x7
    Main PW Token          : 0x800819
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/2</span>
    Backup OutInterface    :
    Stp Enable             : 0
    PW Last Up Time        : 2012/12/24 19:52:59
    PW Total Up Time       : 0 days, 0 hours, 20 minutes, 18 seconds
   *Peer Ip Address        : 3.3.3.3
    PW State               : up
    Local VC Label         : 1035
    Remote VC Label        : 1038
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x80081b
    Broadcast Tunnel ID    : 0x80081b
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0xb
    Nkey                   : 0x7
    Main PW Token          : 0x80081b
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/2</span>
    Backup OutInterface    :
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/24 19:59:01
    PW Total Up Time       : 0 days, 0 hours, 13 minutes, 50 seconds
   *Peer Ip Address        : 4.4.4.4
    PW State               : up
    Local VC Label         : 1034
    Remote VC Label        : 1037
<span>    Remote Control Word    : disable</span>
    PW Type                : label
    Tunnel ID              : 0x80081a
    Broadcast Tunnel ID    : 0x80081a
    Broad BackupTunnel ID  : 0x0
    Ckey                   : 0xa
    Nkey                   : 0x9
    Main PW Token          : 0x80081a
    Slave PW Token         : 0x0
    Tnl Type               : LSP
    OutInterface           : GigabitEthernet<span>0/1/1</span>
    Backup OutInterface    :
<span>    Stp Enable             : 0</span>
    PW Last Up Time        : 2012/12/24 20:00:19
    PW Total Up Time       : 0 days, 0 hours, 12 minutes, 33 seconds</pre>
</li></ol>
</p></li><li><span>Configure MAC Withdraw.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>mac-withdraw propagate enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure PE3.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE3] <strong>vsi vsi1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>mac-withdraw enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>mac-withdraw propagate enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3-vsi-vsi1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE3] <strong>commit</strong></pre>
</p></li><li><span>Configure CEs.</span><p><p># Configure CE1.</p>
<pre class="screen">&lt;CE1&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>.1] <strong>ip address 192.168.10.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p># Configure CE2.</p>
<pre class="screen">&lt;CE2&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet<span>0/1/2</span></strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>undo shutdown</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>interface gigabitethernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>.1] <strong>vlan-type dot1q 10</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>.1] <strong>ip address 192.168.10.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
</p></li><li><span>Verify the configuration.</span><p><p>Ping CE2 from CE1. The command output shows that the ping is successful.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>ping 192.168.10.2</strong></pre>
<pre class="screen">  PING 192.168.10.2: 56  data bytes, press CTRL_C to break
    Reply from 192.168.10.2: bytes=56 Sequence=1 ttl=255 time=140 ms
    Reply from 192.168.10.2: bytes=56 Sequence=2 ttl=255 time=140 ms
    Reply from 192.168.10.2: bytes=56 Sequence=3 ttl=255 time=140 ms
    Reply from 192.168.10.2: bytes=56 Sequence=4 ttl=255 time=110 ms
    Reply from 192.168.10.2: bytes=56 Sequence=5 ttl=255 time=180 ms

  --- 192.168.10.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 110/142/180 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0172370275__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
bfd
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
vsi vsi1 static
 pwsignal ldp
  vsi-id 1
  peer 2.2.2.2
  peer 3.3.3.3
  protect-group vsi1
   protect-mode pw-redundancy master
   reroute delay 60
   peer 2.2.2.2 preference 1
   peer 3.3.3.3 preference 2
 mac-withdraw enable
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255
#
ospf 1
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.2.0 0.0.0.255
#
bfd p1 bind pw vsi vsi1 peer 2.2.2.2 remote-peer 2.2.2.2 pw-ttl auto-calculate
 discriminator local 104
 discriminator remote 401
 commit
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
bfd
#
mpls lsr-id 2.2.2.2
#
mpls
#
mpls l2vpn
#
vsi vsi1
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe
 bgp-ad
  vpls-id 192.168.0.0:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
 mac-withdraw enable
 mac-withdraw propagate enable
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.1.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.4.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.3.2 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
bgp 100
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 3.3.3.3 enable
  peer 4.4.4.4 enable
#
ospf 1
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 192.168.1.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
  network 192.168.4.0 0.0.0.255
#
bfd p1 bind pw vsi vsi1 peer 1.1.1.1 remote-peer 1.1.1.1 pw-ttl auto-calculate
 discriminator local 401
 discriminator remote 104
 commit
#
return</pre>
</li><li><p>PE3 configuration file</p>
<pre class="screen">#
sysname PE3
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
vsi vsi1
 pwsignal ldp
  vsi-id 1
  peer 1.1.1.1 upe
 bgp-ad
  vpls-id 192.168.0.0:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
 mac-withdraw enable
 mac-withdraw propagate enable
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.5.1 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.2.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
 ip address 192.168.3.1 255.255.255.0
 mpls
 mpls ldp
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 4.4.4.4 as-number 100
 peer 4.4.4.4 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 2.2.2.2 enable
  peer 4.4.4.4 enable
#
ospf 1
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 192.168.2.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
  network 192.168.4.0 0.0.0.255
  network 192.168.5.0 0.0.0.255
#
return</pre>
</li><li><p>PE4 configuration file</p>
<pre class="screen">#
sysname PE4
#
mpls lsr-id 4.4.4.4
#
mpls
#
mpls l2vpn
#
vsi vsi1
 bgp-ad
  vpls-id 192.168.0.0:1
  vpn-target 100:1 import-extcommunity
  vpn-target 100:1 export-extcommunity
#
mpls ldp
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 192.168.5.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 192.168.4.2 255.255.255.0
 mpls
 mpls ldp
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 l2 binding vsi vsi1
#
interface LoopBack0
 ip address 4.4.4.4 255.255.255.255
#
bgp 100
 peer 2.2.2.2 as-number 100
 peer 2.2.2.2 connect-interface LoopBack0
 peer 3.3.3.3 as-number 100
 peer 3.3.3.3 connect-interface LoopBack0
 #
 ipv4-family unicast
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
 #
 l2vpn-ad-family
  policy vpn-target
  peer 2.2.2.2 enable
  peer 3.3.3.3 enable
#
ospf 1
 area 0.0.0.0
  network 4.4.4.4 0.0.0.0
  network 192.168.4.0 0.0.0.255
  network 192.168.5.0 0.0.0.255
  network 192.168.6.0 0.0.0.255
#
return</pre>
</li><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 ip address 192.168.10.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/2</span>
 undo shutdown
#
interface GigabitEthernet<span>0/1/2</span>.1
 vlan-type dot1q 10
 ip address 192.168.10.2 255.255.255.0
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5029.html">Configuration Examples for VPLS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5068.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpls_cfg_5072.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>