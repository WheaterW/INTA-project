
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring a Dynamic VPWS SS-PW over an SR-MPLS TE Policy">
<meta name="abstract" content="This section provides an example for configuring a dynamic VPWS SS-PW over an SR-MPLS TE Policy.">
<meta name="description" content="This section provides an example for configuring a dynamic VPWS SS-PW over an SR-MPLS TE Policy.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_4000.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3016.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="VPWS">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001294669453">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring a Dynamic VPWS SS-PW over an SR-MPLS TE Policy</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001294669453"></a><a name="EN-US_TASK_0000001294669453"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring a Dynamic VPWS SS-PW over an SR-MPLS TE Policy</h1>
<div class="taskbody"><p>This section provides an example for configuring a dynamic VPWS SS-PW over an SR-MPLS TE Policy.</p>
<div class="context"><a name="EN-US_TASK_0000001294669453__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001294669453__fig_dc_vrp_vpws_cfg_301501">Figure 1</a>, PE1, the P, and PE2 belong to the same AS and run OSPF for IPv4 network connectivity. It is required that a bidirectional SR-MPLS TE Policy be deployed between PE1 and PE2 to carry VPWS services.</p>
<div class="fignone" id="EN-US_TASK_0000001294669453__fig_dc_vrp_vpws_cfg_301501"><a name="EN-US_TASK_0000001294669453__fig_dc_vrp_vpws_cfg_301501"></a><a name="fig_dc_vrp_vpws_cfg_301501"></a><span class="figcap"><b>Figure 1 </b>Configuring a dynamic VPWS SS-PW over an SR-MPLS TE Policy</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interfaces 1 and 2 represent GE<span>0/1/0</span> and GE<span>0/2/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001248189750.png"></span></div>
<p></p>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001294669453__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li><p>Enable IPv4 forwarding and configure an IPv4 address for each interface on PE1, the P, and PE2.</p>
</li><li><p>Enable OSPF on PE1, the P, and PE2 to ensure route reachability between them.</p>
</li><li><p>Configure SR-MPLS TE Policies and tunnel policies on PE1 and PE2.</p>
</li><li>Set up LDP sessions between PEs.</li><li>Enable L2VPN on PEs and establish a VPWS connection.</li></ol>
<h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>IPv4 addresses of interfaces on PE1, the P, and PE2</p>
</li><li>OSPF area where SR-MPLS TE Policy is enabled</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001294669453__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable IPv4 forwarding and configure IPv4 addresses for interfaces.</span><p><p># Configure PE1. The configurations of the P and PE2 are similar to the configuration of PE1. For configuration details, see the configuration files.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>sysname PE1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>interface gigabitethernet <span>0/1/0</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.1.1.1 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface LoopBack 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>ip address 1.1.1.1 32</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-LoopBack1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p></li><li><span>Configure an IGP on the MPLS backbone network to ensure route reachability between devices.</span><p><p>OSPF is used in this example.</p>
</p><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 1.1.1.1 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>ospf 1</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 2.2.2.2 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 10.1.1.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>network 10.2.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>ospf 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>opaque-capability enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>area 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 3.3.3.3 0.0.0.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>network 10.2.2.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1-area-0.0.0.0] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-ospf-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p><p><p>After the configuration is complete, perform the following operations to check whether OSPF is successfully configured.</p>
<p># Display OSPF neighbor information. The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display ospf peer</strong></pre>
<pre class="screen"> 
(M) Indicates MADJ neighbor
 
 
          OSPF Process 1 with Router ID 10.1.1.1
                Neighbors
 
 Area 0.0.0.0 interface 10.1.1.1 (GE<span>0/1/0</span>)'s neighbors
 Router ID: 10.1.1.2             Address: 10.1.1.2
   State: Full           Mode:Nbr is Master     Priority: 1
   DR: 10.1.1.2          BDR: 10.1.1.1          MTU: 0
   Dead timer due in  35  sec
   Retrans timer interval: 5
   Neighbor is up for 01h46m50s
   Neighbor Up Time : 2022-04-26 04:58:15
   Authentication Sequence: [ 0 ]</pre>
</p></li><li><span>Configure SR on the MPLS backbone network.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr</strong> <strong>10.1.1.2 sid 330000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure the P.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>P] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid 330002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.2.1 remote-ip-addr 10.2.2.2 sid 330003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>P] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>ipv4 adjacency local-ip-addr 10.2.2.2 remote-ip-addr 10.2.2.1 sid 330000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
</p></li><li><span>Configure SR-MPLS TE Policies.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>segment-routing</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>segment-list pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list-pe1] <strong>index 10 sid label 330000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list-pe1] <strong>index 20 sid label 330003</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-segment-list-pe1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>sr-te policy policy100 endpoint 3.3.3.3 color 100</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy-policy100] <strong>candidate-path preference 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy-policy100-path] <strong>segment-list pe1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy-policy100-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing-te-policy-policy100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
</p><p><p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>segment-routing</strong> </pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>segment-list pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list-pe2] <strong>index 10 sid label 330000</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list-pe2] <strong>index 20 sid label 330002</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-segment-list-pe2] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>sr-te policy policy100 endpoint 1.1.1.1 color 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy-policy100] <strong>candidate-path preference 200</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy-policy100-path] <strong>segment-list pe2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy-policy100-path] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing-te-policy-policy100] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-segment-routing] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, run the <a href="cmdqueryname=display+sr-te+policy"><b><span class="cmdname">display sr-te policy</span></b></a> command to check SR-MPLS TE Policy information.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display sr-te policy </strong></pre>
<pre class="screen">PolicyName : policy100
Endpoint             : 3.3.3.3                        Color                : 100
TunnelId             : 1                              TunnelType           : SR-TE Policy
Binding SID          : 115                            MTU                  : -
Policy State         : Up                             State Change Time    : 2022-04-26 04:56:54
Admin State          : Up                             Traffic Statistics   : Disable
BFD                  : Disable                        Backup Hot-Standby   : Disable
DiffServ-Mode        : -
Candidate-path Count : 1
 
Candidate-path Preference: 200
Path State           : Active                         Path Type            : Primary
Protocol-Origin      : Configuration(30)              Originator           : 0, 0.0.0.0
Discriminator        : 200                            Binding SID          : 115
GroupId              : 1                              Policy Name          : policy100
Template ID          : -
Segment-List Count   : 1
 Segment-List        : pe1
  Segment-List ID    : 66                             XcIndex              : 2000066
  List State         : Up                             BFD State            : -
  EXP                : -                              TTL                  : -
  DeleteTimerRemain  : -                              Weight               : 1
  Label : 330000, 330003 </pre>
</p></li><li><span>Establish an LDP session.</span><p><p>Establish a remote session between PE1 and PE2.</p>
<p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>mpls lsr-id</strong> <strong>1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls ldp remote-peer 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.3] <strong>remote-ip 3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-mpls-ldp-remote-3.3.3.3] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>mpls lsr-id</strong> <strong>3.3.3.3</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls ldp remote-peer 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.1] <strong>remote-ip 1.1.1.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-mpls-ldp-remote-1.1.1.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p>After the configuration is complete, an LDP session is successfully set up between the PEs.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls ldp session</strong></pre>
<pre class="screen"> LDP Session(s) in Public Network
 Codes: LAM(Label Advertisement Mode), SsnAge Unit(DDDD:HH:MM)
 An asterisk (*) before a session means the session is being deleted.
 --------------------------------------------------------------------------
 PeerID             Status      LAM  SsnRole  SsnAge       KASent/Rcv
 --------------------------------------------------------------------------
 3.3.3.3:0          Operational DU   Passive  0000:02:43   655/656
 --------------------------------------------------------------------------
 TOTAL: 1 Session(s) Found</pre>
</p></li><li><span>Configure a tunnel policy and establish a VPWS connection.</span><p><p># Configure PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>tunnel-policy tp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-tp1] <strong>tunnel select-seq sr-te-policy load-balance-number 1 unmix</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-tunnel-policy-tp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>interface gigabitethernet <span>0/2/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>mpls l2vc 3.3.3.3 200 tunnel-policy tp1 endpoint 3.3.3.3 color 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE1] <strong>commit</strong></pre>
<p># Configure PE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE2] <strong>tunnel-policy tp1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-tp1] <strong>tunnel select-seq sr-te-policy load-balance-number 1 unmix</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-tunnel-policy-tp1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>mpls l2vpn</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-l2vpn] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>interface gigabitethernet <span>0/2/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>mpls l2vc 1.1.1.1 200 tunnel-policy tp1 endpoint 1.1.1.1 color 100</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2-GigabitEthernet<span>0/2/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>PE2] <strong>commit</strong></pre>
<p># Configure CE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1] <strong>interface gigabitethernet <span>0/1/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE1] <strong>commit</strong></pre>
<p>Configure CE2.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE2] <strong>interface gigabitethernet <span>0/1/0</span></strong><strong>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span>CE2] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>The VC IDs at the two ends of a VPWS connection must be the same. Otherwise, the VC cannot go up.</p>
</li><li><p>No IP address needs to be configured on PE interfaces connecting to CEs.</p>
</li></ul>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p>View VPWS connection information on PEs. The command output shows that a VC has been established and its status is up.</p>
<p>The following example uses the command output on PE1.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>PE1] <strong>display mpls l2vc interface gigabitethernet </strong><strong><span>0/2/0</span></strong><strong>.1</strong></pre>
<pre class="screen"> *client interface       : GigabitEthernet<span>0/2/0</span>.1 is up
  Administrator PW       : no
  session state          : up
  AC status              : up
  VC state               : up
  Label state            : 0
  Token state            : 0
  VC ID                  : 200
  VC type                : VLAN
  destination            : 3.3.3.3
  local group ID         : 0            remote group ID      : 0
  local VC label         : 48060        remote VC label      : 48000
  local AC OAM State     : up
  local PSN OAM State    : up
  local forwarding state : forwarding
  local status code      : 0x0 (forwarding)
  remote AC OAM state    : up
  remote PSN OAM state   : up
  remote forwarding state: forwarding
  remote status code     : 0x0 (forwarding)
  remote interface       : GigabitEthernet<span>0/2/0</span>.1
  ignore standby state   : no
  BFD for PW             : unavailable
  VCCV State             : up
  manual fault           : not set
  active state           : active
  forwarding entry       : exist
  OAM Protocol           : --
  OAM Status             : --
  OAM Fault Type         : --
  PW APS ID              : --
  PW APS Status          : --
  TTL Value              : 1
  link state             : up
  local VC MTU           : 1500         remote VC MTU        : 1500
  local VCCV             : alert ttl lsp-ping bfd
  remote VCCV            : alert ttl lsp-ping bfd
  local control word     : disable      remote control word  : disable
  tunnel policy name     : tp1
  PW template name       : --
  primary or secondary   : primary
  load balance type      : flow
  Access-port            : false
  Switchover Flag        : false
  VC tunnel info         : 1 tunnels
    NO.0  TNL type       : srtepolicy     , TNL ID : 0x000000003200000001
  create time            : 0 days, 2 hours, 57 minutes, 19 seconds
  up time                : 0 days, 0 hours, 41 minutes, 31 seconds
  last change time       : 0 days, 0 hours, 41 minutes, 31 seconds
  VC last up time        : 2022/04/26 07:12:43
  VC total up time       : 0 days, 2 hours, 46 minutes, 58 seconds
  CKey                   : 65
  NKey                   : 16777373
  PW redundancy mode     : frr
  AdminPw interface      : --
  AdminPw link state     : --
  Forward state          : send active, receive active
  Diffserv Mode          : uniform
  Service Class          : --
  Color                  : --
  DomainId               : --
  Domain Name            : -- </pre>
<p>CE1 and CE2 can ping each other.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>CE1]<strong> ping 10.10.1.2</strong></pre>
<pre class="screen">  PING 10.10.1.2: 56  data bytes, press CTRL_C to break
    Reply from 10.10.1.2: bytes=56 Sequence=1 ttl=255 time=4 ms
    Reply from 10.10.1.2: bytes=56 Sequence=2 ttl=255 time=3 ms
    Reply from 10.10.1.2: bytes=56 Sequence=3 ttl=255 time=3 ms
    Reply from 10.10.1.2: bytes=56 Sequence=4 ttl=255 time=4 ms
    Reply from 10.10.1.2: bytes=56 Sequence=5 ttl=255 time=3 ms
 
  --- 10.10.1.2 ping statistics ---
    5 packet(s) transmitted
    5 packet(s) received
    0.00% packet loss
    round-trip min/avg/max = 3/3/4 ms</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001294669453__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li><p>CE1 configuration file</p>
<pre class="screen">#
sysname CE1
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 1
 ip address 10.10.1.1 255.255.255.0
#
return</pre>
</li><li><p>CE2 configuration file</p>
<pre class="screen">#
sysname CE2
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 2
 ip address 10.10.1.2 255.255.255.0
#
return</pre>
</li><li><p>PE1 configuration file</p>
<pre class="screen">#
sysname PE1
#
mpls lsr-id 1.1.1.1
#
mpls
#
mpls l2vpn
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer 3.3.3.3
 remote-ip 3.3.3.3
#
segment-routing
 ipv4 adjacency local-ip-addr 10.1.1.1 remote-ip-addr 10.1.1.2 sid 330000
 segment-list pe1
  index 10 sid label 330000
  index 20 sid label 330003
 sr-te policy policy100 endpoint 3.3.3.3 color 100
  candidate-path preference 200
   segment-list pe1
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.1 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
#
interface GigabitEthernet<span>0/2/0</span>.1
 vlan-type dot1q 1
 mpls l2vc 3.3.3.3 200 tunnel-policy tp1 endpoint 3.3.3.3 color 100 
#
interface LoopBack0
 ip address 1.1.1.1 255.255.255.255 
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 1.1.1.1 0.0.0.0
  network 10.1.1.0 0.0.0.255 
#
tunnel-policy tp1
 tunnel select-seq sr-te-policy load-balance-number 1 unmix 
#
return</pre>
</li><li><p>P configuration file</p>
<pre class="screen">#
sysname P
#
segment-routing
 ipv4 adjacency local-ip-addr 10.1.1.2 remote-ip-addr 10.1.1.1 sid 330002
 ipv4 adjacency local-ip-addr 10.2.2.1 remote-ip-addr 10.2.2.2 sid 330003
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.1.1.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown
 ip address 10.2.2.1 255.255.255.0
#
interface LoopBack0
 ip address 2.2.2.2 255.255.255.255
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 2.2.2.2 0.0.0.0
  network 10.1.1.0 0.0.0.255
  network 10.2.2.0 0.0.0.255
#
return</pre>
</li><li><p>PE2 configuration file</p>
<pre class="screen">#
sysname PE2
#
mpls lsr-id 3.3.3.3
#
mpls
#
mpls l2vpn
#
mpls ldp
 #
 ipv4-family
#
mpls ldp remote-peer 1.1.1.1
 remote-ip 1.1.1.1
#
segment-routing
 ipv4 adjacency local-ip-addr 10.2.2.2 remote-ip-addr 10.2.2.1 sid 330000
 segment-list pe2
  index 10 sid label 330000
  index 20 sid label 330002
 sr-te policy policy100 endpoint 1.1.1.1 color 100
  candidate-path preference 200
   segment-list pe2
#
interface GigabitEthernet<span>0/1/0</span>
 undo shutdown
 ip address 10.2.2.2 255.255.255.0
#
interface GigabitEthernet<span>0/2/0</span>
 undo shutdown 
#
interface GigabitEthernet<span>0/2/0</span>.1
 vlan-type dot1q 2
 mpls l2vc 1.1.1.1 200 tunnel-policy tp1 endpoint 1.1.1.1 color 100
#
interface LoopBack0
 ip address 3.3.3.3 255.255.255.255
#
ospf 1
 opaque-capability enable
 area 0.0.0.0
  network 3.3.3.3 0.0.0.0
  network 10.2.2.0 0.0.0.255
#
tunnel-policy tp1
 tunnel select-seq sr-te-policy load-balance-number 1 unmix
#
return</pre>
</li></ul>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3012.html">Configuration Examples for VPWS
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_4000.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_vpws_cfg_3016.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>