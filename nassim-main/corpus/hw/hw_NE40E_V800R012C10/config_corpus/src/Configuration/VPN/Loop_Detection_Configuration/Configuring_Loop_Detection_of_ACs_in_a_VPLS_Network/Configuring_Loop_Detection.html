
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Configuring Loop Detection">
<meta name="abstract" content="Loop detection and blocking priorities can be configured in the interface view.">
<meta name="description" content="Loop detection and blocking priorities can be configured in the interface view.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loop-detect_cfg_5005.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loop-detect_cfg_5006.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loop-detect_cfg_5008.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">
<meta name="featurename" content="Loop Detection">
<meta name="featuretype" content="VPN">
<meta name="OWNER" content="l00415692">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="l00415692">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001785512189">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Configuring Loop Detection</title>
</head>
<body><a name="EN-US_TASK_0000001785512189"></a><a name="EN-US_TASK_0000001785512189"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Configuring Loop Detection</h1>
<div class="taskbody"><p>Loop detection and blocking priorities can be configured in the interface view.</p>
<div class="context"><a name="EN-US_TASK_0000001785512189__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>Perform the following steps on PEs.</p>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001785512189__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> { <strong><span>ethernet</span></strong> | <strong><span>gigabitethernet</span></strong> | <strong><span>eth-trunk</span></strong> } <i><span class="varname">interface-number</span></i> or <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> { <strong><span>ethernet</span></strong> | <strong><span>gigabitethernet</span></strong> | <strong><span>eth-trunk</span></strong> } <i><span class="varname">interface-number.subnum</span></i></span><p><p>The interface view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=loop-detect+enable"><b><span class="cmdname">loop-detect enable</span></b></a></span><p><p>Loop detection is enabled on the interface.</p>
</p></li><li><span>Run <a href="cmdqueryname=loop-detect+mac-withdraw+enable"><b><span class="cmdname">loop-detect mac-withdraw enable</span></b></a></span><p><p>The sub-interface<span> or main interface</span> is enabled to delete MAC address entries when its loop detection status changes.</p>
</p><p><p>After a sub-interface<span> or main interface</span> is configured to delete MAC address entries when its loop detection status changes, traffic switching is accelerated.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=loop-detect+priority"><b><span class="cmdname">loop-detect priority</span></b></a> <em>priority-value</em></span><p><p>The blocking priority of the interface is configured.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>A smaller <i><span class="varname">priority</span></i> value indicates a higher blocking priority. The interface with a higher blocking priority is preferentially blocked when a loop is detected. The default <i><span class="varname">priority</span></i> value is 0.</p>
</li><li><p>If two interfaces have the same blocking priority value, the one with the smaller MAC address is determined to have a higher blocking priority and is therefore preferentially blocked.</p>
</li><li><p>If their MAC addresses are also the same, the interface with the smaller interface index (used in loop detection configuration) is determined to have a higher blocking priority and is therefore preferentially blocked.</p>
</li></ul>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=loop-detect+block"><b><span class="cmdname">loop-detect block</span></b></a> [ <i><span class="varname">block-time</span></i> ]</span><p><p>The device is enabled to block the interface when a loop is detected.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li><p>The interface is unblocked if it receives no loop detection packet during <i><span class="varname">block-time</span></i>. To prevent interface flapping when the interface is enabled to temporarily go down (see Step 7), <i><span class="varname">block-time</span></i> should be no shorter than 10s.</p>
</li><li><p>If <i><span class="varname">block-time</span></i> is not set, the interface is blocked permanently. That is, the interface remains blocked after the loop is eliminated and no further loop detection packets are received.</p>
</li><li><p>For an interface in the permanent blocking state, if the blocking priorities of the interfaces on the network are adjusted, the interface is unblocked when another interface is set with a higher blocking priority. The interface with a higher blocking priority is then blocked permanently. </p>
</li></ul>
</div></div>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=loop-detect+trigger+interface-down+enable"><b><span class="cmdname">loop-detect trigger interface-down enable</span></b></a></span><p><p>The interface is enabled to temporarily go down after being blocked.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>By default, a blocked interface stops forwarding traffic but remains in the up state, meaning its tables (for example, the MAC address table) cannot be updated immediately. Consequently, user traffic is still sent to the blocked interface, leading to traffic interruption. If an interface is configured to temporarily go down after being blocked, relevant tables on the interface are updated after it goes down. When the corresponding timer times out (approximately 5s), the interface goes up again, preventing user traffic loss.</p>
<div class="p">Do not add member interfaces to or delete member interfaces from an Eth-Trunk interface when it is temporarily down. This is because all member interfaces go down when the Eth-Trunk interface is temporarily down and go up again when it recovers.<ul><li>If you add member interfaces to an Eth-Trunk interface when it is temporarily down, after the Eth-Trunk interface recovers, all its member interfaces automatically go up.</li><li>If you delete member interfaces from an Eth-Trunk interface when it is temporarily down, the deleted interfaces remain down and cannot go up automatically.</li></ul>
You can add member interfaces to or delete member interfaces from an Eth-Trunk interface after it recovers.</div>
</div></div>
</p></li><li><span>Run <span><a href="cmdqueryname=loop-detect+only-alarm"><b><span class="cmdname">loop-detect only-alarm</span></b></a></span></span><p><p>The interface is enabled to report an alarm without blocking itself when detecting a loop.</p>
</p><p><div class="p">If the interface detects a loop after the <a href="cmdqueryname=loop-detect+only-alarm"><b><span class="cmdname">loop-detect only-alarm</span></b></a> command is run in the interface view, it only reports an alarm and does not block itself. This command configuration has the following impact:<ul><li>If a loop is detected on an interface after the <a href="cmdqueryname=loop-detect+only-alarm"><b><span class="cmdname">loop-detect only-alarm</span></b></a> command is run on the interface, the interface only reports an alarm and does not block itself.</li><li>Running the <a href="cmdqueryname=loop-detect+only-alarm"><b><span class="cmdname">loop-detect only-alarm</span></b></a> command on a blocked interface unblocks the interface. In this case, if you run the <a href="cmdqueryname=undo+loop-detect+only-alarm"><b><span class="cmdname">undo loop-detect only-alarm</span></b></a> command to restore the default configuration on the interface, you need to block the interface again to prevent loops.</li></ul>
</div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The <a href="cmdqueryname=loop-detect+block"><b><span class="cmdname">loop-detect block</span></b></a> and <b><span class="cmdname">loop-detect only-alarm</span></b> commands must be both configured so that the alarm reporting function can take effect. If only the <b><span class="cmdname">loop-detect only-alarm</span></b> command is configured, no alarm can be reported.</p>
</div></div>
</p></li><li><span>Run <a href="cmdqueryname=loop-detect+identifier"><b><span class="cmdname">loop-detect identifier</span></b></a> <em>identifier-value</em></span><p><p>An authentication identifier for interface-based L2VPN loop detection is configured.</p>
</p><p><p>If an authentication identifier for L2VPN loop detection is configured in both the interface view and global view, the configuration in the interface view takes effect.</p>
<p>After an authentication identifier is configured on the local device, if the authentication identifier in the loop detection packet received from a peer device is different from the local one, the local device discards the packet.</p>
</p></li><li><span>(Optional) Run <a href="cmdqueryname=loop-detect+detection+vid"><b><span class="cmdname">loop-detect detection vid</span></b></a><i><span class="varname"> low-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-vid</span></i> ]</span><p><p>A VLAN range is configured for the main interface to send loop detection packets.</p>
</p><p><p>This command can be configured only on dot1q VLAN tag termination sub-interfaces and main interfaces.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loop-detect_cfg_5005.html">Configuring Loop Detection on the VPLS Access Side
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loop-detect_cfg_5006.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_loop-detect_cfg_5008.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>