
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring NAT over EDSG">
<meta name="abstract" content="This section provides an example for configuring NAT over EDSG. The BRAS performs NAT for EDSG service traffic and translates private IP addresses into public IP addresses so that users can access the public network.">
<meta name="description" content="This section provides an example for configuring NAT over EDSG. The BRAS performs NAT for EDSG service traffic and translates private IP addresses into public IP addresses so that users can access the public network.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0031.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">
<meta name="OWNER" content="l00425560">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0253046914">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring NAT over EDSG</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0253046914"></a><a name="EN-US_TASK_0253046914"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring NAT over EDSG</h1>
<div class="taskbody"><p>This section provides an example for configuring NAT over EDSG. The BRAS performs NAT for EDSG service traffic and translates private IP addresses into public IP addresses so that users can access the public network.</p>
<div class="context"><a name="EN-US_TASK_0253046914__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0253046914__fig_dc_ne_cfg_edsg_000801">Figure 1</a>, PPPoE users access network 1 at 192.168.100.0/24 and network 2 at 192.168.200.0/24. Different fees need to be charged for traffic over networks 1 and 2. The users have different bandwidth requirements for networks 1 and 2. The uplink and downlink traffic bandwidths for access to network 1 and network 2 are limited to 1 Mbit/s and 2 Mbit/s, respectively. The RADIUS server delivers EDSG service policies, in which the accounting modes, authentication modes, and uplink and downlink bandwidths are specified. The BRAS is equipped with a NAT service board to implement NAT following authentication, authorization, and accounting. The BRAS implements NAT on EDSG service traffic to translate private IP addresses to public IP addresses so that users can access the public network.</p>
<div class="fignone" id="EN-US_TASK_0253046914__fig_dc_ne_cfg_edsg_000801"><a name="EN-US_TASK_0253046914__fig_dc_ne_cfg_edsg_000801"></a><a name="fig_dc_ne_cfg_edsg_000801"></a><span class="figcap"><b>Figure 1 </b>Configuring NAT over EDSG</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In this example, interface1, interface2, interface3, subinterface3.1, and subinterface3.2 represent GE<span>0/1/2</span>, GE<span>0/1/1</span>, GE<span>0/1/0</span>, GE<span>0/1/0</span>.1, and GE<span>0/1/0</span>.2, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0253046919.png"></span></div>
</div></div>
<div class="context"><a name="EN-US_TASK_0253046914__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Configuration Roadmap</h4><div class="p">The configuration roadmap is as follows:<ol><li>Enable the VAS function.</li><li>Configure policy servers.</li><li>Configure an EDSG traffic policy.</li><li>Configure AAA authentication and accounting schemes.</li><li>Configure a mode in which EDSG service policies are downloaded and configure EDSG service policies.</li><li>Configure a local address pool.</li><li>Bind the local address pool and RADIUS server group to an AAA domain.</li><li>Configure uplink and downlink interfaces.</li><li>Create a NAT instance and bind it to the AAA domain.</li><li>Configure a NAT traffic diversion policy.</li><li>Configure access users.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0253046914__1.4.3"></a><a name="1.4.3"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><div class="p">To complete the configuration, you need the following data:<ul><li><p>Policy server parameters, such as the IP address and port number</p>
</li><li><p>Authentication scheme name, authentication mode, accounting scheme name, and accounting mode used for an EDSG service policy</p>
</li><li><p>Name of the local address pool used in the domain, gateway address, and address pool range</p>
</li><li><p>EDSG service policy parameters, such as the mode in which EDSG service policies are downloaded, EDSG service policy name, name of the bound RADIUS server group, RADIUS authentication scheme, RADIUS accounting scheme, and bandwidths for uplink and downlink traffic rate limiting for EDSG services</p>
</li><li><p>NAT instance name</p>
</li><li><p>NAT address pool's number and start and end IP addresses</p>
</li><li><p>NAT traffic diversion policy parameters, such as the user group name, ACL rule, traffic classifier, traffic behavior, and traffic policy</p>
</li></ul>
</div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0253046914__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Enable the VAS function.</span><p><pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>system-view</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>value-added-service enable</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure policy servers.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>radius-server group rad_group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rad_group1] <strong>radius-server authentication 10.10.10.2 1812</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rad_group1] <strong>radius-server accounting 10.10.10.2 1813</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rad_group1] <strong>radius-server shared-key-cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-radius-rad_group1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-radius-rad_group1] <strong>quit</strong></pre>
</p></li><li><span>Configure an EDSG traffic policy.</span><ol type="a"><li class="substepexpand"><span>Create service groups.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>service-group s_1m</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>service-group s_2m</strong>
[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</p></li><li class="substepexpand"><span>Configure ACL rules for service groups.</span><p><p># Configure ACL 6020 and define ACL rules for the service group <strong>s_1m</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl number 6020</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6020] <strong>rule 10 permit ip source service-group s_1m destination ip-address 192.168.100.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6020] <strong>rule 20 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group s_1m</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6020] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6020] <strong>quit</strong></pre>
<p># Configure ACL 6021 and define ACL rules for the service group <strong>s_2m</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl number 6021</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6021] <strong>rule 15 permit ip source service-group s_2m destination ip-address 192.168.200.0 0.0.0.255</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6021] <strong>rule 25 permit ip source ip-address 192.168.200.0 0.0.0.255 destination service-group s_2m</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6021] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6021] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure traffic classifiers.</span><p><p># Configure a traffic classifier named <strong>c1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic classifier c1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c1] <strong>if-match acl 6020</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-c1] <strong>quit</strong></pre>
<p># Configure a traffic classifier named <strong>c2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic classifier c2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c2] <strong>if-match acl 6021</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-c2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-c2] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure traffic behaviors.</span><p><p># Configure a traffic behavior named <strong>b1</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic behavior b1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-b1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-b1] <strong>quit</strong></pre>
<p># Configure a traffic behavior named <strong>b2</strong>.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic behavior b2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-b2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-b2] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure an EDSG traffic policy.</span><p><p># Configure an EDSG traffic policy named <strong>traffic_policy_edsg_nat</strong>, and associate traffic classifiers <strong>c1</strong> and <strong>c2</strong> with traffic behaviors <strong>b1</strong> and <strong>b2</strong>, respectively.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic policy traffic_policy_edsg_nat</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>share-mode</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>classifier c1 behavior b1</strong> <strong>precedence 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>classifier c2 behavior b2</strong> <strong>precedence 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure AAA authentication and accounting schemes.</span><p><p># Configure an AAA authentication scheme named <strong>auth1</strong> and specify RADIUS authentication as the authentication mode.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa] <strong>authentication-scheme auth1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth1] <strong>authentication-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-authen-auth1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-authen-auth1] <strong>quit</strong></pre>
</p><p><p># Configure an AAA accounting scheme named <strong>acct1</strong> and specify RADIUS accounting as the accounting mode.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>accounting-scheme acct1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct1] <strong>accounting-mode radius</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-accounting-acct1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure a mode in which EDSG service policies are downloaded.</span><p><p># Configure the RADIUS mode for downloading EDSG service policies. In this mode, EDSG service policies are downloaded from the RADIUS server through authentication packets.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>service-policy download radius rad_group1 password cipher YsHsjx_202206</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure EDSG service policies. (This step is performed on the RADIUS server.)</span><ol type="a"><li class="substepexpand"><span>Configure an EDSG service policy for access to network 1.</span><p><p># Configure the RADIUS server to deliver the RADIUS attribute User-Password with a value of <strong>YsHsjx_202206</strong> for the service policy <strong>service_edsg1</strong>.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The shared key configured for a RADIUS server group determines the value of the User-Password attribute.</p>
</div></div>
<div class="p"># Configure the RADIUS server to deliver the RADIUS attribute Huawei-AVpair (vendor ID=2011; attribute number=188) for the service policy <strong>service_edsg1</strong>.<ul><li><p>&lt;service:service-group&gt;: The service group <strong>s_1m</strong> is bound to the service policy <strong>service_edsg1</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:service-group=s_1m</strong>.</p>
</li><li><p>&lt;service:authentication-scheme&gt;: The authentication scheme <strong>auth1</strong> is set for the service policy <strong>service_edsg1</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:authentication-scheme=auth1</strong>.</p>
</li><li><p>&lt;service:accounting-scheme&gt;: The accounting scheme <strong>acct1</strong> is set for the service policy <strong>service_edsg1</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:accounting-scheme=acct1</strong>.</p>
</li><li><p>&lt;service:radius-server-group&gt;: The RADIUS server group <strong>rad_group1</strong> is set for the service policy <strong>service_edsg1</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:radius-server-group=rad_group1</strong>.</p>
</li></ul>
</div>
<p></p>
<p># Configure the RADIUS server to deliver the RADIUS attribute HW-Input-Committed-Information-Rate (vendor ID=2011; attribute number=2) for the service policy <strong>service_edsg1</strong>. The value of HW-Input-Committed-Information-Rate is 1000000 bits. This attribute indicates that the uplink bandwidth is set to 1 Mbit/s for the service policy <strong>service_edsg1</strong>.</p>
<p># Configure the RADIUS server to deliver the RADIUS attribute HW-Output-Committed-Information-Rate (vendor ID=2011; attribute number=5) for the service policy <strong>service_edsg1</strong>. The value of HW-Output-Committed-Information-Rate is 1000000 bits. This attribute indicates that the downlink bandwidth is set to 1 Mbit/s for the service policy <strong>service_edsg1</strong>.</p>
</p></li><li class="substepexpand"><span>Configure an EDSG service policy for access to network 2.</span><p><p># Configure the RADIUS server to deliver the RADIUS attribute User-Password with a value of <strong>YsHsjx_202206</strong> for the service policy <strong>service_edsg2</strong>.</p>
<div class="p"># Configure the RADIUS server to deliver the RADIUS attribute Huawei-AVpair (vendor ID=2011; attribute number=188) for the service policy <strong>service_edsg2</strong>.<ul><li><p>&lt;service:service-group&gt;: The service group <strong>s_2m</strong> is bound to the service policy <strong>service_edsg2</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:service-group=s_2m</strong>.</p>
</li><li><p>&lt;service:authentication-scheme&gt;: The authentication scheme <strong>auth1</strong> is set for the service policy <strong>service_edsg2</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:authentication-scheme=auth1</strong>.</p>
</li><li><p>&lt;service:accounting-scheme&gt;: The accounting scheme <strong>acct1</strong> is set for the service policy <strong>service_edsg2</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:accounting-scheme=acct1</strong>.</p>
</li><li><p>&lt;service:radius-server-group&gt;: The RADIUS server group <strong>rad_group1</strong> is set for the service policy <strong>service_edsg2</strong>.</p>
<p>The value of Huawei-AVpair is <strong>service:radius-server-group=rad_group1</strong>.</p>
</li></ul>
</div>
<p></p>
<p># Configure the RADIUS server to deliver the RADIUS attribute HW-Input-Committed-Information-Rate (vendor ID=2011; attribute number=2) for the service policy <strong>service_edsg2</strong>. The value of HW-Input-Committed-Information-Rate is 2000000 bits. This attribute indicates that the uplink bandwidth is set to 2 Mbit/s for the service policy <strong>service_edsg2</strong>.</p>
<p># Configure the RADIUS server to deliver the RADIUS attribute HW-Output-Committed-Information-Rate (vendor ID=2011; attribute number=5) for the service policy <strong>service_edsg2</strong>. The value of HW-Output-Committed-Information-Rate is 2000000 bits. This attribute indicates that the downlink bandwidth is set to 2 Mbit/s for the service policy <strong>service_edsg2</strong>.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For details about the RADIUS attribute dictionary used in this step, see User Access &gt; Appendix: RADIUS Attributes &gt; RADIUS Attribute Dictionary.</p>
<p>The RADIUS attribute names displayed in this step must be the same as those in the RADIUS attribute dictionary loaded to the RADIUS server. If they are different, change the RADIUS attribute names to be the same as those in the RADIUS attribute dictionary based on the vendor ID and attribute number.</p>
</div></div>
</p></li></ol>
</li><li><span>Configure a local address pool.</span><p><p># Configure a local address pool named <strong>edsg_pool</strong>, set the gateway address to 172.31.0.1/16, and specify the address range as 172.31.0.2 to 172.31.255.255.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>ip pool edsg_pool bas local</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-edsg_pool] <strong>gateway 172.31.0.1 255.255.0.0</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-edsg_pool] <strong>section 0 172.31.0.2 172.31.255.255</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-ip-pool-edsg_pool] <strong>quit</strong></pre>
</p></li><li><span>Bind the local address pool and RADIUS server group to an AAA domain.</span><p><p># Bind the local address pool <strong>edsg_pool</strong> and the RADIUS server group <strong>rad_group1</strong> to an AAA domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>domain domain1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>ip-pool edsg_pool</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>radius-server group rad_group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure interfaces.</span><ol type="a"><li class="substepexpand"><span>Configure a BAS interface.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface GigabitEthernet<span>0/1/2</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1] <strong>user-vlan 1000 2000</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1-vlan-1000-2000] <strong>user-vlan 1 1000 qinq 100</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1-vlan-1-1000-QinQ-100-100] <strong>bas</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1-bas] <strong>access-type layer2-subscriber default-domain pre-authentication domain1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1-bas] <strong>authentication-method ppp web</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1-bas] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/2</span>.1] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure uplink interfaces.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface GigabitEthernet<span>0/1/0</span>.1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>vlan-type dot1q 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>ip address 192.168.100.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface GigabitEthernet<span>0/1/0</span>.2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>vlan-type dot1q 2</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>ip address 192.168.200.2 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/0</span>.2] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure the interface connecting the BRAS to the policy server, RADIUS server, and portal server.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>interface GigabitEthernet<span>0/1/1</span></strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/1</span>] <strong>ip address 10.10.10.1 255.255.255.0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/1</span>] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-GigabitEthernet<span>0/1/1</span>] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Configure basic NAT functions.</span><p><ol type="a"><li><div class="p">Set the maximum number of sessions that can be created on the service board in slot <strong><span>3</span></strong> to 6M.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>license</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-license] <strong>active nat session-table size 6 slot <span>3</span> engine 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-license] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-license] <strong>quit</strong></pre>
</div>
</li><li><div class="p">Create a NAT instance named <strong>nat1</strong>, bind the service board to the NAT instance, and configure an address pool in which the IP addresses range from 22.22.22.0 to 22.22.22.255 for the NAT instance.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-location-1] <strong>location slot <span>3</span> engine 0</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-location-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-service-location-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-instance-group-1] <strong>service-location 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-service-instance-group-1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-service-instance-group-1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>nat instance nat1 id 1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat-instance-nat1] <strong>service-instance-group group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat-instance-nat1] <strong>nat address-group </strong><strong>address-group1</strong> <strong>group-id 1 22.22.22.0 mask 24</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat-instance-nat1] <strong>nat outbound any address-group address-group1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-nat-instance-nat1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-nat-instance-nat1] <strong>quit</strong></pre>
</div>
</li></ol>
</p></li><li><span>Bind the NAT instance to a user group in the AAA domain.</span><p><ol type="a"><li>Create a user group named <strong>usergroup1</strong>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>user-group usergroup1</strong></pre>
</li><li>Bind the NAT instance <strong>nat1</strong> to the user group <strong>usergroup1</strong> in the AAA domain <strong>domain1</strong>.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>aaa</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>domain domain1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>user-group </strong><strong>usergroup1</strong><strong> bind nat instance nat1</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>traffic match user-group</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa-domain-domain1] <strong>quit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-aaa] <strong>quit</strong></pre>
</li></ol>
</p></li><li><span>Configure a NAT traffic diversion policy on the inbound interface.</span><ol type="a"><li class="substepexpand"><span>Configure ACL 6001 to match the traffic originated from the user group <strong>usergroup1</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>acl number 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6001] <strong>rule 10 permit ip source user-group usergroup1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-acl-ucl-6001] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-acl-ucl-6001] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a traffic classifier named <strong>nat</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic classifier nat</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-nat] <strong>if-match acl 6001</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-classifier-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-classifier-nat] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Configure a traffic behavior named <strong>nat</strong> and bind it to the NAT instance <strong>nat1</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic behavior nat</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-nat] <strong>nat bind instance nat1</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-behavior-nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-behavior-nat] <strong>quit</strong></pre>
</p></li><li class="substepexpand"><span>Associate the traffic classifier with the traffic behavior of the NAT service in the traffic policy <strong>traffic_policy_edsg_nat</strong>.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic policy traffic_policy_edsg_nat</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>classifier nat behavior nat</strong> <strong>precedence 3</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>commit</strong></pre>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>-policy-traffic_policy_edsg_nat] <strong>quit</strong></pre>
</p></li></ol>
</li><li><span>Apply the EDSG traffic policy globally.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span><span class="keyword">HUAWEI</span>] <strong>traffic-policy traffic_policy_edsg_nat inbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>traffic-policy traffic_policy_edsg_nat outbound</strong></pre>
<pre class="screen">[<span class="keyword">*</span><span class="keyword">HUAWEI</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure access users. (This step is performed on the RADIUS server.)</span><p><p># Configure the RADIUS server to deliver the RADIUS attribute User-Password with a value of <strong>YsHsjx_202206</strong> for PPPoE user 1.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The shared key configured for a RADIUS server group determines the value of the User-Password attribute.</p>
</div></div>
<p># Configure the RADIUS server to deliver the RADIUS attribute Huawei-Account-Info (vendor ID=2011; attribute number=184) with the value of Aservice_edsg1;d1;huawei and Aservice_edsg2;d2;huawei for PPPoE user 1.</p>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The Huawei-Account-Info attribute starting with <strong>A</strong> followed by the service policy name <strong>service_edsg1</strong> is used in authentication response packets to deliver EDSG services that automatically take effect after being delivered; <strong>d1</strong> and <strong>huawei</strong> indicate the authentication name and password, respectively, to be used for service authentication.</p>
<p>The Huawei-Account-Info attribute starting with <strong>A</strong> followed by the service policy name <strong>service_edsg2</strong> is used in authentication response packets to deliver EDSG services that automatically take effect after being delivered; <strong>d2</strong> and <strong>huawei</strong> indicate the authentication name and password, respectively, to be used for service authentication.</p>
</div></div>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>For details about the RADIUS attribute dictionary used in this step, see User Access &gt; Appendix: RADIUS Attributes &gt; RADIUS Attribute Dictionary.</p>
<p>The RADIUS attribute names displayed in this step must be the same as those in the RADIUS attribute dictionary loaded to the RADIUS server. If they are different, change the RADIUS attribute names to be the same as those in the RADIUS attribute dictionary based on the vendor ID and attribute number.</p>
</div></div>
</p></li><li><span>Verify the configuration.</span><p><p># View the ID of the online user.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display value-added-service user</strong></pre>
<pre class="screen">The used user id table are:
   128000
</pre>
<p># View the service group name and service status information of the user with an ID of 128000.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display value-added-service user user-id 128000 edsg </strong></pre>
<pre class="screen">-------------------------------------------------------                        
  User access index                  : 128000                                    
  User name                          : user1                                  
 -------------------------------------------------------                        
  Traffic rate mode                  : Separate                                 
  Traffic statistic mode             : Separate                                 
  Inbound rate limit mode            : Car                                      
  Outbound rate limit mode           : Car                                      
  Service change mode                : Stop-start                               
 -------------------------------------------------------                        
  User edsg service table:                                                       
 -------------------------------------------------------                        
  Index          Service name        State                                      
 -------------------------------------------------------                        
  0              service_edsg1       Active                                     
  1              service_edsg2       Active                                     
 -------------------------------------------------------
</pre>
<p># View detailed information about the EDSG service with a service index of 0 and a user ID of 128000.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display value-added-service user user-id 128000 edsg service-index 0</strong></pre>
<pre class="screen">-------------------------------------------------------
  Service index                      : 0
  Service name                       : service_edsg1
  Service type                       : EDSG
  Service state                      : Active
  Service group                      : s_1m
  Service group priority             : 0
  Authentication method              : auth1
  Account method                     : Radius
  Radius server template             : rad_group1
  Account session id                 : <span class="keyword">HUAWEI</span>05001SSG000100d39d7b128000
  Service online time(HH:MM:SS)      : 00:04:36
  Up committed information rate      : 1000(kbps)
  Up Peak information rate           : 1000(kbps)
  Up committed burst size            : 187000(bytes)
  Up Peak burst size                 : 187000(bytes)
  Down committed information rate    : 1000(kbps)
  Down Peak information rate         : 1000(kbps)
  Down committed burst size          : 187000(bytes)
  Down Peak burst size               : 187000(bytes)
  Up flow packets(high, low)         : (0, 0)
  Up flow bytes(high, low)           : (0, 0)
  Down flow packets(high, low)       : (0, 0)
  Down flow bytes(high, low)         : (0, 0)
 ----------------------------------------------
</pre>
<p># View traffic information of the online user.</p>
<pre class="screen">&lt;<span class="keyword">HUAWEI</span>&gt; <strong>display access-user domain domain1 verbose</strong></pre>
<pre class="screen">-------------------------------------------------------------------
Flow Statistic:
  If flow info contain l2-head  : Yes
  Flow-Statistic-Up             : Yes
  Flow-Statistic-Down           : Yes
  Up packets number(high,low)   : (0,670580346)
  Up bytes number(high,low)     : (19,4229905664)
  Down packets number(high,low) : (0,670597972)
  Down bytes number(high,low)   : (21,3689402864)
  IPV6 Up packets number(high,low)     : (0,0)
  IPV6 Up bytes number(high,low)       : (0,0)
  IPV6 Down packets number(high,low)   : (0,0)
  IPV6 Down bytes number(high,low)     : (0,0)

Value-added-service Flow Statistic:
  EDSG(service1) Up packets number(high,low)   : (0,12774777)
  EDSG(service1) Up bytes number(high,low)     : (2,4069869415)
  EDSG(service1) Down packets number(high,low) : (0,0)
  EDSG(service1) Down bytes number(high,low)   : (0,0)
</pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0253046914__1.4.5"></a><a name="1.4.5"></a><h4 class="sectiontitle">Configuration Files</h4><p><span class="keyword">HUAWEI</span> configuration file</p>
<pre class="screen">#
sysname <span class="keyword">HUAWEI</span>
#
radius-server group rad_group1
 radius-server shared-key-cipher %^%#/@aaSf_t=7;.A3Z6;`bR;1Q'Tf[1E&gt;tLhc71lu2@%^%#
 radius-server authentication 10.10.10.2 1812 weight 0
 radius-server accounting 10.10.10.2 1813 weight 0
#
service-policy download radius rad_group1 password cipher %^%#Uuo@Qh\,eK@5DcKnGf:AfR5eVA@rlFLlx{(YtM6W%^%#
#
service-location 1
 location slot <strong><span>3</span></strong> engine 0
#
service-instance-group group1
 service-location 1
#
nat instance nat1 id 1
 service-instance-group group1
 nat address-group address-group1 group-id 1 22.22.22.0 mask 24 
 nat outbound any address-group address-group1
#
ip pool edsg_pool bas local
 gateway 172.31.0.1 255.255.0.0
 section 0 172.31.0.2 172.31.255.255
#
value-added-service enable
#
service-group s_1m
service-group s_2m
#
acl number 6001
 rule 10 permit ip source user-group usergroup1
#
acl number 6020
 rule 10 permit ip source service-group s_1m destination ip-address 192.168.100.0 0.0.0.255
 rule 20 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group s_1m
#
acl number 6021
 rule 15 permit ip source service-group s_2m destination ip-address 192.168.200.0 0.0.0.255
 rule 25 permit ip source ip-address 192.168.200.0 0.0.0.255 destination service-group s_2m
#
traffic classifier c1 operator or
 if-match acl 6020 precedence 1
#
traffic classifier c2 operator or
 if-match acl 6021 precedence 1
#
traffic classifier nat operator or
 if-match acl 6001 precedence 1
#
traffic behavior b1
#
traffic behavior b2
#
traffic behavior nat
 nat bind instance nat1
#
traffic policy traffic_policy_edsg_nat
 share-mode
 classifier c1 behavior b1 precedence 1
 classifier c2 behavior b2 precedence 2
 classifier nat behavior nat precedence 3
#
user-group usergroup1
#
aaa
 #
 authentication-scheme auth1
  authentication-mode radius
 #
 accounting-scheme acct1
  accounting-mode radius
 #
 domain domain1
  radius-server group rad_group1
  ip-pool edsg_pool
  user-group usergroup1 bind nat instance nat1
  traffic match user-group
#
license
 active nat session-table size 6 slot <strong><span>3</span></strong> engine 0
#
interface GigabitEthernet<span>0/1/2</span>.1
 statistic enable
 user-vlan 1000 2000
 user-vlan 1 1000 qinq 100
 bas
 #
  access-type layer2-subscriber default-domain pre-authentication domain1
  authentication-method ppp web
 #
#
interface GigabitEthernet<span>0/1/0</span>.1
 vlan-type dot1q 1
 ip address 192.168.100.1 255.255.255.0
#
interface GigabitEthernet<span>0/1/0</span>.2
 vlan-type dot1q 2
 ip address 192.168.200.2 255.255.255.0
#
interface GigabitEthernet<span>0/1/1</span>
 undo shutdown
 ip address 10.10.10.1 255.255.255.0
 undo dcn
#
traffic-policy traffic_policy_edsg_nat inbound
traffic-policy traffic_policy_edsg_nat outbound
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0016.html">EDSG Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0031.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0019.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>