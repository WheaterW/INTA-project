
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Example for Configuring PPPoE Dual-Stack User Access (ND Unshared+PD) in a Dual-Device Cold Backup Scenario with Distributed CGN and EDSG Services Deployed">
<meta name="abstract" content="This section provides an example for configuring PPPoE dual-stack user access (ND unshared+PD) in a dual-device cold backup scenario with distributed CGN and EDSG services deployed.">
<meta name="description" content="This section provides an example for configuring PPPoE dual-stack user access (ND unshared+PD) in a dual-device cold backup scenario with distributed CGN and EDSG services deployed.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0016.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0019.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00800033,w00606909">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">

<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">
<meta name="featurename" content="EDSG">
<meta name="featuretype" content="Value-Added-Service">
<meta name="OWNER" content="c00549182">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="c00549182">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0000001220590118">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Example for Configuring PPPoE Dual-Stack User Access (ND Unshared+PD) in a Dual-Device Cold Backup Scenario with Distributed CGN and EDSG Services Deployed</title>

<style type="text/css">
			<!--	pre.screen,pre.codeblock{
					word-wrap:break-word;
					word-break:break-all;
					white-space:pre-wrap !important;
				}-->
		</style>
</head>
<body><a name="EN-US_TASK_0000001220590118"></a><a name="EN-US_TASK_0000001220590118"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Example for Configuring PPPoE Dual-Stack User Access (ND Unshared+PD) in a Dual-Device Cold Backup Scenario with Distributed CGN and EDSG Services Deployed</h1>
<div class="taskbody"><p>This section provides an example for configuring PPPoE dual-stack user access (ND unshared+PD) in a dual-device cold backup scenario with distributed CGN and EDSG services deployed.</p>
<div class="context"><a name="EN-US_TASK_0000001220590118__1.4.1"></a><a name="1.4.1"></a>
<div class="p"><div class="p"><h4 class="sectiontitle">Networking Requirements</h4><p>On the network shown in <a href="#EN-US_TASK_0000001220590118__fig624412481872">Figure 1</a>, User1 and User2 access BRAS1 through SW1. BRAS1 uses RADIUS for authentication and accounting. It assigns to the users IPv4 addresses through the local address pool, IPv6 prefixes through DHCPv6 IA_PD, and IPv6 addresses through ND.</p>
<p>EDSG services need to be deployed to meet users' different requirements for network service traffic. ACLs need to be configured to match destination addresses of user traffic so that network segments accessed by users can be differentiated, thereby implementing independent rate limiting and accounting for different network segments. To enable private network users to access the Internet, deploy distributed CGN on the network to translate private addresses into public addresses. In addition, deploy dual-device cold backup to improve network reliability. This function allows the users to go online through the other device if a device fails.</p>
<div class="fignone" id="EN-US_TASK_0000001220590118__fig624412481872"><a name="EN-US_TASK_0000001220590118__fig624412481872"></a><a name="fig624412481872"></a><span class="figcap"><b>Figure 1 </b>PPPoE dual-stack user access (ND unshared+PD) in a dual-device cold backup scenario with distributed CGN and EDSG services deployed</span><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>Interfaces 1 and 2 in this example represent Eth-Trunk 2 and GE <span>0/1/0</span>, respectively.</p>
</div></div>
<br><span><img class="vsd" src="figure/en-us_image_0000001269767213.png"></span></div>
<h4 class="sectiontitle">Configuration Roadmap</h4><p>The configuration roadmap is as follows:</p>
<ol><li>Configure AAA schemes, and specify RADIUS authentication and RADIUS accounting.</li><li>Configure RADIUS.</li><li>Configure address pools.</li><li>Configure devices to generate DUIDs in DUID-LLT mode.</li><li>Configure a domain.</li><li>Configure interfaces.</li><li>Configure EDSG services.</li><li>Configure distributed CGN services.</li><li>Enable the devices to advertise public routes.</li></ol>
</div>
</div></div>
<div class="context"><a name="EN-US_TASK_0000001220590118__1.4.2"></a><a name="1.4.2"></a>
<div class="p"><h4 class="sectiontitle">Data Preparation</h4><p>To complete the configuration, you need the following data:</p>
<ul><li><p>User access parameters</p>
</li><li><p>CGN service parameters</p>
</li><li>EDSG service parameters</li></ul>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The configuration on BRAS2 is similar to that on BRAS1. The configuration procedure on BRAS1 is used as an example. For details about the configuration on BRAS2, see the configuration file.</p>
</div></div>
</div></div>
<div class="steps"><a name="EN-US_TASK_0000001220590118__1.4.3"></a><a name="1.4.3"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Configure AAA schemes.</span><p><p># Configure two authentication schemes, one with the authentication mode set to RADIUS, and that of the other one set to none.</p>
<pre class="screen">&lt;HUAWEI&gt; <strong>system-view</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>HUAWEI] <strong>sysname</strong> <strong>BRAS1</strong>
[<span class="keyword">*</span>HUAWEI] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> authentication-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-auth1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> authentication-scheme none</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-none]<strong> authentication-mode none</strong>
[<span class="keyword">*</span>BRAS1-aaa-authen-none]<strong> quit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>commit</strong></pre>
<p># Configure an accounting scheme and set the accounting mode to RADIUS.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1]<strong> accounting-mode radius</strong>
[<span class="keyword">*</span>BRAS1-aaa-accounting-acct1]<strong> quit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>commit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>quit</strong></pre>
</p></li><li><span>Configure RADIUS.</span><p><p># Create UDP sockets with the local port numbers 1645, 1646, and 3799 and with any local IP address.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>radius local-ip all</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure a RADIUS server group.</p>
</p><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server authentication 192.168.7.249 1812 weight 0</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server accounting 192.168.7.249 1813 weight </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> radius-server shared-key-cipher YsHsjx_202206 </strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> commit </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> radius-server calling-station-id include mac</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> </strong><strong>radius-server user-name original</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1]<strong> commit </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-radius-rd1]<strong> </strong><strong>radius-server class-as-car</strong>
[<span class="keyword">*</span>BRAS1-radius-rd1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p><p><p># Configure a RADIUS authorization server.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1]<strong> </strong><strong>radius-server authorization 192.168.8.249 shared-key-cipher </strong><strong>YsHsjx_202206</strong><strong> server-group rd1</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure address pools.</span><p><p># Configure a local address pool for IPv4 users.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ip pool </strong><strong>pool_v4</strong> <strong>bas local</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-pool_v4] <strong>gateway 172.16.0.1 255.255.255.0</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-pool_v4] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-pool_v4] <strong>section 0 172.16.0.2 172.16.0.200</strong> 
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ip-pool-pool_v4] <strong>dns-server 10.179.155.161 10.179.155.177</strong>
[<span class="keyword">*</span>BRAS1-ip-pool-pool_v4] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure address pools for IPv6 users.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 prefix </strong><strong>pre_nd</strong><strong>_1</strong> <strong>delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd] <strong>prefix 2001:db8:1::/48</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd] <strong>slaac-unshare-only</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_nd] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 pool pool_nd_1 bas delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd] <strong>prefix pre_nd</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd] <strong>dns-server 2001:db8::2:2 2001:db8::2:3</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_nd] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 prefix </strong><strong>pre_pd</strong><strong>_1</strong> <strong>delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_pd] <strong>prefix 2001:db8:2::/48</strong>
[<span class="keyword">*</span>BRAS1-ipv6-prefix-pre_pd] <strong>commi</strong><strong>t</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pre_pd] <strong>pd-unshare-only</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-ipv6-prefix-pre_pd] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>ipv6 pool pool_pd bas delegation</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd] <strong>prefix pre_pd_1</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd] <strong>dns-server 2001:db8::2:2 2001:db8::2:3</strong>
[<span class="keyword">*</span>BRAS1-ipv6-pool-pool_pd] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commi</strong><strong>t</strong></pre>
</p></li><li><span>Configure the device to generate a DUID in DUID-LLT mode. (This step is not required if a DUID has been configured on the device.)</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>dhcpv6 duid llt</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</p></li><li><span>Configure a domain.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> domain isp1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> authentication-scheme auth1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> radius-server group rd1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>prefix-assign-mode unshared  </strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1]<strong> ip-pool pool_v4</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>ipv6-pool </strong><strong>pool_nd</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>ipv6-pool pool_pd</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>accounting-start-delay 10 online user-type ppp</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1] <strong>accounting-start-delay traffic-forward before-start-accounting</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1] <strong>user-basic-service-ip-type ipv4</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1]<strong> quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> quit</strong></pre>
</p></li><li><span>Configure interfaces.</span><p><p># Configure a VT.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface virtual-template 5</strong>
[<span class="keyword">*</span>BRAS1-virtual-template5]<strong> </strong><strong>ppp authentication-mode chap</strong>
[<span class="keyword">*</span>BRAS1-virtual-template5]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
<p># Configure the Eth-Trunk interface to work in static LACP mode and set a protocol packet timeout period.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface Eth-Trunk2</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2]<strong> mode lacp-static</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2]<strong> lacp timeout fast</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2]<strong> </strong><strong>commit</strong></pre>
<p># Configure IPv6 on the Eth-Trunk interface's sub-interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2]<strong> </strong><strong>interface Eth-Trunk2.10</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>ipv6 enable</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>pppoe-server bind Virtual-Template 5</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.10]<strong> user-vlan 1000 4000 qinq 2000 2001</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.10-user-vlan-1000-4000-qinq-2000-2001]<strong> </strong><strong>quit</strong></pre>
<p># Configure a BAS interface. In a dual-device cold backup scenario, configure delayed access for users with even-numbered MAC addresses and delayed access for users with odd-numbered MAC addresses on BRAS1 and BRAS2, respectively.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.10] <strong>bas</strong>
[<strong><span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span></strong>BRAS1-Eth-Trunk2.10-bas]<strong> access-type layer2-subscriber default-domain authentication isp1</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10-bas]<strong> </strong><strong>client-option82 basinfo-insert cn-telecom</strong>
[<span class="keyword">*</span>BRAS1-Eth-Trunk2.10-bas]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.10-bas]<strong> access-delay 100 even-mac</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-Eth-Trunk2.10-bas]<strong> </strong><strong>quit</strong></pre>
<p># Configure the network-side interface.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>interface gigabitEthernet <span>0/1/0</span></strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 enable</strong> 
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address 2001:db8:8::7 128</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ipv6 address auto link-local</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>ip address 10.2.1.1 24</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-GigabitEthernet<span>0/1/0</span>] <strong>commit</strong></pre>
</p></li><li><span>Configure EDSG services.</span><p><p># Enable the value-added service function.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>value-added-service enable</strong>
<strong>[</strong><span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
<p># Configure the HW-Policy-Name attribute to support EDSG service delivery.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>radius-attribute hw-policy-name support-type edsg</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
<p># Configure an EDSG traffic policy.</p>
<ol type="a"><li>Create a service group.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-group edsg</strong>
[<span class="keyword">*</span>BRAS1]<strong> </strong><strong>commit</strong></pre>
</li><li>Configure ACL rules for the service group.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6100</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>description edsg</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>rule 5 permit ip source service-group edsg destination ip-address 192.168.100.0 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>rule 10 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group edsg</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6100] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl ipv6 number 6100</strong>
[<span class="keyword">*</span>BRAS1-acl6-ucl-6100] <strong>rule 5 permit ipv6 source service-group edsg destination ipv6-address 2001:db8::/32</strong>
[<span class="keyword">*</span>BRAS1-acl6-ucl-6100] <strong>rule 10 permit ipv6 source ipv6-address 2001:db8::/32 destination service-group edsg</strong>
[<span class="keyword">*</span>BRAS1-acl6-ucl-6100] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a traffic classifier.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier edsg-c1</strong>
[<span class="keyword">*</span>BRAS1-classifier-edsg-c1] <strong>if-match acl 6100</strong>
[<span class="keyword">*</span>BRAS1-classifier-edsg-c1] <strong>if-match ipv6 acl 6100</strong>
[<span class="keyword">*</span>BRAS1-classifier-edsg-c1] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a traffic behavior.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior edsg-b1</strong>
[<span class="keyword">*</span>BRAS1-edsg-b1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure an EDSG traffic policy.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic</strong><strong> policy p1</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>classifier edsg-c1 behavior edsg-b1</strong> <strong>precedence 1</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Apply the EDSG traffic policy globally.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic-policy </strong><strong>p1</strong><strong> inbound</strong>
[<span class="keyword">*</span>BRAS1] <strong>traffic-policy </strong><strong>p1</strong><strong> outbound</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li></ol>
<p># Configure an EDSG service policy.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-policy name service_edsg1 edsg</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-policy-service_edsg1] <strong>radius-server group rd1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-service-policy-service_edsg1] <strong>authentication-scheme none</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>accounting-scheme acct1</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>service-group edsg</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>rate-limit cir 100000 pir 100000 inbound</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>rate-limit cir 100000 pir 100000 outbound</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-service-policy-service_edsg1] <strong>commit</strong></pre>
</p></li><li><span>Configure distributed CGN services.</span><p><p># Set the session table sizes of the CPUs on the NAT service boards in slots <span>3</span> and <span>2</span> to 16M.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>license</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat session-table size 16 slot <span>3</span> engine </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat session-table size 16 slot <span>2</span> engine </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat bandwidth-enhance slot <span>3</span> engine 0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>active nat bandwidth-enhance slot <span>2</span> engine 0</strong>
[<span class="keyword">*</span>BRAS1-license] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create service-location group 1 and bind it to service boards.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 1</strong>
[<span class="keyword">*</span>BRAS1-service-location-1] <strong>location slot <span>3</span> engine 0</strong> <strong>backup</strong> <strong>slot <span>2</span> engine </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-service-location-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create service-location group 2 and bind it to service boards.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-location 2</strong>
[<span class="keyword">*</span>BRAS1-service-location-2] <strong>location slot <span>2</span> engine 0</strong> <strong>backup</strong> <strong>slot <span>3</span> engine </strong><strong>0</strong>
[<span class="keyword">*</span>BRAS1-service-location-2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Create service instance groups and bind service-location groups to them.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group nat444-group1</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-1] <strong>service-location 1</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-1]<strong> commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>service-instance-group nat444-group2</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-2] <strong>service-location 2</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-service-instance-group-nat444-2]<strong> commit</strong></pre>
<p># Create a NAT instance named <strong>nat444-1</strong>, bind the service instance group <strong>nat444-group1</strong> to it to specify the corresponding service board resources, and configure a port range.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>nat instance nat444-1 id 1</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>service-instance-group nat444-group1</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>port-range 4096</strong> </pre>
<p># Configure public addresses.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>nat address-group pppoe-public-1 group-id 1</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>section 0 10.1.1.0 mask 24</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>section 1 10.3.1.0 mask 24</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1-nat-address-group-pppoe-public-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>nat outbound 3000 address-group pppoe-public-1</strong></pre>
<p># Enable ALG for all protocols and configure the 3-tuple mode.</p>
<pre class="screen">[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>nat alg all</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>nat filter mode full-cone</strong>
[<span class="keyword">*</span>BRAS1-nat-instance-nat444-1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The procedure for configuring a NAT instance named <strong>nat444-2</strong> is similar to that for configuring a NAT instance named <strong>nat444-1</strong>. For details, see the configuration files.</p>
</div></div>
<p># Configure user groups from which the users go online.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>user-group pppoe-nat-1</strong>
[<span class="keyword">*</span>BRAS1] <strong>user-group pppoe-nat-2</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Bind NAT instances to user groups in an AAA domain.</p>
<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>aaa</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa]<strong> domain isp1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-aaa-domain-isp1]<strong> </strong><strong>user-group pppoe-nat-1 bind nat instance nat444-1</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> </strong><strong>user-group pppoe-nat-2 bind nat instance nat444-2</strong>
[<span class="keyword">*</span>BRAS1-aaa-domain-isp1]<strong> </strong><strong>quit</strong>
[<span class="keyword">*</span>BRAS1-aaa] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
<p># Configure a NAT traffic policy.</p>
<ol type="a"><li>Define ACL rules for specified user groups.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6000</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6000] <strong>description for_pppoe-nat-1</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6000] <strong>rule 5 permit ip source user-group pppoe-nat-1</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6000] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6001</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6001] <strong>description for_pppoe-nat-2</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6001] <strong>rule 5 permit ip source user-group pppoe-nat-2</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6001] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>acl number 6002</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>description for_pppoe-no-nat</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>rule 5 permit ip source user-group pppoe-nat-2 destination ip-address 192.168.200.0 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>rule 10 permit ip source user-group pppoe-nat-2 destination ip-address 10.168.200.0 0.0.0.255</strong>
[<span class="keyword">*</span>BRAS1-acl4-basic-6002] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure traffic classifiers.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier nat-c1</strong>
[<span class="keyword">*</span>BRAS1-classifier-nat-c1] <strong>if-match acl 6000</strong>
[<span class="keyword">*</span>BRAS1-classifier-nat-c1] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier nat-c2</strong>
[<span class="keyword">*</span>BRAS1-classifier-nat-c2] <strong>if-match acl 6001</strong>
[<span class="keyword">*</span>BRAS1-classifier-nat-c2] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic cl</strong><strong>assifier no-nat</strong>
[<span class="keyword">*</span>BRAS1-classifier-no-nat] <strong>if-match acl 6002</strong>
[<span class="keyword">*</span>BRAS1-classifier-no-nat] <strong>q</strong><strong>uit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure traffic behaviors.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior nat-b1</strong>
[<span class="keyword">*</span>BRAS1-nat-b1]  <strong>nat bind instance</strong> <strong>nat444-1</strong>
[<span class="keyword">*</span>BRAS1-nat-b1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior nat-b2</strong>
[<span class="keyword">*</span>BRAS1-nat-b2]  <strong>nat bind instance</strong> <strong>nat444-2</strong>
[<span class="keyword">*</span>BRAS1-nat-b2] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic behavior no-nat</strong>
[<span class="keyword">*</span>BRAS1-no-nat] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Configure a NAT traffic policy.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic</strong><strong> policy p1</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1-traffic-policy-p1] <strong>classifier no-nat behavior no-nat</strong> <strong>precedence 2</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>classifier nat-c1 behavior nat-b1</strong> <strong>precedence 3</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>classifier nat-c2 behavior nat-b2</strong> <strong>precedence 4</strong>
[<span class="keyword">*</span>BRAS1-traffic-policy-p1] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li><li>Apply the NAT traffic policy in the upstream direction.<pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>traffic-policy </strong><strong>p1</strong><strong> inbound</strong>
[<span class="keyword">*</span>BRAS1] <strong>commit</strong></pre>
</li></ol>
</p></li><li><span>Enable the device to advertise public routes.</span><p><pre class="screen">[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>bgp 65008</strong>
[<span class="keyword">*</span>BRAS1-bgp] <strong>ipv4-family unicast</strong>
[<span class="keyword">*</span>BRAS1-bg-af-ipv4] <strong>network </strong><strong>0 10.1.1.0 </strong><strong>255.255.255.0</strong>
[<span class="keyword">*</span>BRAS1-bg-af-ipv4] <strong>network </strong><strong>0 10.3.1.0</strong><strong> 255.255.255.0</strong>
[<span class="keyword">*</span>BRAS1-bg-af-ipv4] <strong>quit</strong>
[<span class="keyword">*</span>BRAS1-bg] <strong>quit</strong>
[<span class="keyword"><font style="font-size:8pt" Face="Courier New" >~</font></span>BRAS1] <strong>commit</strong></pre>
</p></li></ol></div>
<div class="example"><a name="EN-US_TASK_0000001220590118__1.4.4"></a><a name="1.4.4"></a><h4 class="sectiontitle">Configuration Files</h4><ul><li>BRAS1 configuration file</li></ul>
<pre class="screen">#
sysname BRAS1
# 
license  
 active nat session-table size 16 slot <span>3</span> engine 0  
 active nat session-table size 16 slot <strong><span>2</span></strong> engine 0  
 active nat bandwidth-enhance slot <span>3</span> engine 0
 active nat bandwidth-enhance slot <strong><span>2</span></strong> engine 0
#
radius local-ip all
#
radius-attribute hw-policy-name support-type edsg
#
radius-server group rd1                                                       
 radius-server shared-key-cipher %^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^%
#                                                                               
 radius-server authentication 192.168.7.249 1812 weight 0                       
 radius-server accounting 192.168.7.249 1813 weight 0                           
 radius-server class-as-car                                                     
 radius-server calling-station-id include mac                                   
 radius-server user-name original                                               
# 
radius-server authorization 192.168.8.249 shared-key-cipher<strong> </strong>%^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^% server-group rd1
#
service-location 1  
 location slot <span>3</span> engine 0 backup slot <strong><span>2</span></strong> engine 0 
# 
service-location 2  
 location slot <strong><span>2</span></strong> engine 0 backup slot <span>3</span> engine 0 
# 
service-instance-group nat444-group1  
 service-location 1 
#
service-instance-group nat444-group2  
 service-location 2 
# 
nat instance nat444-1 id 1  
 service-instance-group nat444-group1  
 port-range 4096  
 nat address-group pppoe-public-1 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-1  
 nat alg all  
 nat filter mode full-cone 
#
nat instance nat444-2 id 1  
 service-instance-group nat444-group2  
 port-range 4096  
 nat address-group pppoe-public-2 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-2  
 nat alg all  
 nat filter mode full-cone 
# 
user-group pppoe-nat-1 
user-group pppoe-nat-2 
#                                                                               
ip pool pool_v4 bas local                                                       
 gateway 172.16.0.1 255.255.255.0                                               
 section 0 172.16.0.2 172.16.0.200                                              
 dns-server 10.179.155.161 10.179.155.177                                       
#                                                                               
ipv6 prefix pre_nd_1 delegation                                                   
 prefix 2001:DB8:1::/48                                                         
 slaac-unshare-only                                                             
#                                                                               
ipv6 pool pool_nd_1 bas delegation                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_nd                                                                  
#                                                                               
ipv6 prefix pre_pd_1 delegation                                                   
 prefix 2001:DB8:2::/48                                                         
 pd-unshare-only                                                                
#                                                                               
ipv6 pool pool_pd bas delegation                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_pd_1                                                                  
# 
value-added-service enable
#
service-group edsg
#                                                                               
acl number 6100                                                                 
 description edsg                                                               
 rule 5 permit ip source service-group edsg destination ip-address 192.168.100.0 0.0.0.255   
 rule 10 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group edsg
#                                                                                
acl ipv6 number 6100                                                            
 rule 5 permit ipv6 source service-group edsg destination ipv6-address 2001:DB8::/32
 rule 10 permit ipv6 source ipv6-address 2001:DB8::/32 destination service-group edsg
#
acl number 6000                                                                 
 description for_pppoe-nat-1                                                               
 rule 5 permit ip source user-group pppoe-nat-1
#
acl number 6001                                                                 
 description for_pppoe-nat-2                                                               
 rule 5 permit ip source user-group pppoe-nat-2
#
acl number 6002                                                                 
 description for_pppoe-no-nat                                                             
 rule 5 permit ip source user-group pppoe-nat-2 destination ip-address 192.168.200.0 0.0.0.255
 rule 10 permit ip source user-group pppoe-nat-2 destination ip-address 10.168.200.0 0.0.0.255
#
dhcpv6 duid 00010001280ef7a400e0fc904b50
#                                                                               
traffic classifier edsg-c1 operator or                                          
 if-match acl 6100 precedence 1                                                 
 if-match ipv6 acl 6100 precedence 2                                            
#
traffic classifier nat-c1 operator or                                          
 if-match acl 6000 precedence 1                                                                                  
# 
traffic classifier nat-c2 operator or                                          
 if-match acl 6001 precedence 1                                                                                  
# 
traffic classifier no-nat operator or                                          
 if-match acl 6002 precedence 1                                                                                  
# 
traffic behavior edsg-b1
#
traffic behavior nat-b1
 nat bind instance nat444-1
#
traffic behavior nat-b2
 nat bind instance nat444-2
# 
traffic behavior no-nat
# 
traffic policy p1                                                               
 share-mode                                                                     
 classifier edsg-c1 behavior edsg-b1 precedence 1
 classifier no-nat behavior no-nat precedence 2
 classifier nat-c1 behavior nat-b1 precedence 3
 classifier nat-c2 behavior nat-b2 precedence 4
#                                                                              
aaa
 #
 authentication-scheme auth1
  authentication-mode radius
 #
 authentication-scheme none
  authentication-mode none
 #
 accounting-scheme acct1
<em> </em>#                                                                              
 domain isp1                                                                  
  authentication-scheme auth1                                                 
  accounting-scheme acct1                                                     
  radius-server group rd1                                                     
  prefix-assign-mode unshared                                                   
  ip-pool pool_v4                                                               
  ipv6-pool pool_nd                                                             
  ipv6-pool pool_pd
  user-group pppoe-nat-1 bind nat instance nat444-1
  user-group pppoe-nat-2 bind nat instance nat444-2   
  accounting-start-delay 10 online user-type ppp                                
  accounting-start-delay traffic-forward before-start-accounting                
  user-basic-service-ip-type ipv4                                               
#  
interface Virtual-Template5
 ppp authentication-mode chap
#                                                                               
interface Eth-Trunk2
 mode lacp-static                                                               
 lacp timeout fast                                                              
#                                                                               
interface Eth-Trunk2.10                                                         
 ipv6 enable                                                                    
 ipv6 address auto link-local                                                   
 statistic enable
 pppoe-server bind Virtual-Template 5                                                                 
 user-vlan 1000 4000 qinq 2000 2001                                             
 bas                                                                            
 #                                                                              
  access-type layer2-subscriber default-domain authentication isp1            
  client-option82 basinfo-insert cn-telecom                                     
  access-delay 100 even-mac                                                     
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ip address 10.2.1.1 255.255.255.0                                              
 ipv6 address 2001:DB8:8::7/128                                                 
 ipv6 address auto link-local
#    
traffic-policy p1 inbound
traffic-policy p1 outbound
#
service-policy name service_edsg1 edsg                                          
 authentication-scheme none  
 accounting-scheme acct1                                                 
 radius-server group rd1   
<strong> </strong>service-group edsg                                                
 rate-limit cir 100000 pir 100000 inbound                                       
 rate-limit cir 100000 pir 100000 outbound                                      
#   
bgp 65008 
 #  
  ipv4-family unicast     
 <strong> </strong>network 0 10.1.1.0 255.255.255.0   
  network 0 10.3.1.0 255.255.255.0   
#
return</pre>
<ul><li>BRAS2 configuration file</li></ul>
<pre class="screen">#
sysname BRAS2
# 
license  
 active nat session-table size 16 slot <span>3</span> engine 0  
 active nat session-table size 16 slot <strong><span>2</span></strong> engine 0  
 active nat bandwidth-enhance slot <span>3</span> engine 0
 active nat bandwidth-enhance slot <strong><span>2</span></strong> engine 0
#
radius local-ip all
#
radius-attribute hw-policy-name support-type edsg
#
radius-server group rd1                                                       
 radius-server shared-key-cipher %^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^%
#                                                                               
 radius-server authentication 192.168.7.249 1812 weight 0                       
 radius-server accounting 192.168.7.249 1813 weight 0                           
 radius-server class-as-car                                                     
 radius-server calling-station-id include mac                                   
 radius-server user-name original                                               
# 
radius-server authorization 192.168.8.249 shared-key-cipher<strong> </strong>%^%#e,yC%f9z4M2)b)2<font style="font-size:8pt" Face="Courier New" >~</font>r+lA{$g*Fzc+5/bu7VHAN&lt;%(%^% server-group rd1
#
service-location 1  
 location slot <span>3</span> engine 0 backup slot <strong><span>2</span></strong> engine 0 
# 
service-location 2  
 location slot <strong><span>2</span></strong> engine 0 backup slot <span>3</span> engine 0 
# 
service-instance-group nat444-group1  
 service-location 1 
#
service-instance-group nat444-group2  
 service-location 2 
# 
nat instance nat444-1 id 1  
 service-instance-group nat444-group1  
 port-range 4096  
 nat address-group pppoe-public-1 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-1  
 nat alg all  
 nat filter mode full-cone 
#
nat instance nat444-2 id 1  
 service-instance-group nat444-group2  
 port-range 4096  
 nat address-group pppoe-public-2 group-id 1   
 section 0 10.1.1.0 mask 24
 section 1 10.3.1.0 mask 24  
 nat outbound 3000 address-group pppoe-public-2  
 nat alg all  
 nat filter mode full-cone 
# 
user-group pppoe-nat-1 
user-group pppoe-nat-2 
#                                                                               
ip pool pool_v4 bas local                                                       
 gateway 172.16.0.1 255.255.255.0                                               
 section 0 172.16.0.2 172.16.0.200                                              
 dns-server 10.179.155.161 10.179.155.177                                       
#                                                                               
ipv6 prefix pre_nd delegation                                                   
 prefix 2001:DB8:1::/48                                                         
 slaac-unshare-only                                                             
#                                                                               
ipv6 pool pool_nd bas delegation                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_nd                                                                  
#                                                                               
ipv6 prefix pre_pd delegation                                                   
 prefix 2001:DB8:2::/48                                                         
 pd-unshare-only                                                                
#                                                                               
ipv6 pool pool_pd bas delegation                                                
 dns-server 2001:DB8::2:2 2001:DB8::2:3                                         
 prefix pre_pd_1                                                                  
# 
value-added-service enable
#
service-group edsg
#                                                                               
acl number 6100                                                                 
 description edsg                                                               
 rule 5 permit ip source service-group edsg destination ip-address 192.168.100.0 0.0.0.255   
 rule 10 permit ip source ip-address 192.168.100.0 0.0.0.255 destination service-group edsg
#                                                                                
acl ipv6 number 6100                                                            
 rule 5 permit ipv6 source service-group edsg destination ipv6-address 2001:DB8::/32
 rule 10 permit ipv6 source ipv6-address 2001:DB8::/32 destination service-group edsg
#
acl number 6000                                                                 
 description for_pppoe-nat-1                                                               
 rule 5 permit ip source user-group pppoe-nat-1
#
acl number 6001                                                                 
 description for_pppoe-nat-2                                                               
 rule 5 permit ip source user-group pppoe-nat-2
#
acl number 6002                                                                 
 description for_pppoe-no-nat                                                             
 rule 5 permit ip source user-group pppoe-nat-2 destination ip-address 192.168.200.0 0.0.0.255
 rule 10 permit ip source user-group pppoe-nat-2 destination ip-address 10.168.200.0 0.0.0.255
#
dhcpv6 duid 00010001280ef7a400e0fc904b50
#                                                                               
traffic classifier edsg-c1 operator or                                          
 if-match acl 6100 precedence 1                                                 
 if-match ipv6 acl 6100 precedence 2                                            
#
traffic classifier nat-c1 operator or                                          
 if-match acl 6000 precedence 1                                                                                  
# 
traffic classifier nat-c2 operator or                                          
 if-match acl 6001 precedence 1                                                                                  
# 
traffic classifier no-nat operator or                                          
 if-match acl 6002 precedence 1                                                                                  
# 
traffic behavior edsg-b1
#
traffic behavior nat-b1
 nat bind instance nat444-1
#
traffic behavior nat-b2
 nat bind instance nat444-2
# 
traffic behavior no-nat
# 
traffic policy p1                                                               
 share-mode                                                                     
 classifier edsg-c1 behavior edsg-b1 precedence 1
 classifier no-nat behavior no-nat precedence 2
 classifier nat-c1 behavior nat-b1 precedence 3
 classifier nat-c2 behavior nat-b2 precedence 4
#                                                                                
aaa
 #
 authentication-scheme auth1
  authentication-mode radius
 #
 authentication-scheme none
  authentication-mode none
 #
 accounting-scheme acct1
<em> </em>#                                                                              
 domain isp1                                                                  
  authentication-scheme auth1                                                 
  accounting-scheme acct1                                                     
  radius-server group rd1                                                     
  prefix-assign-mode unshared                                                   
  ip-pool pool_v4                                                               
  ipv6-pool pool_nd                                                             
  ipv6-pool pool_pd
  user-group pppoe-nat-1 bind nat instance nat444-1
  user-group pppoe-nat-2 bind nat instance nat444-2   
  accounting-start-delay 10 online user-type ppp                                
  accounting-start-delay traffic-forward before-start-accounting                
  user-basic-service-ip-type ipv4                                               
#  
interface Virtual-Template5
 ppp authentication-mode chap
#                                                                               
interface Eth-Trunk2
 mode lacp-static                                                               
 lacp timeout fast                                                              
#                                                                               
interface Eth-Trunk2.10                                                         
 ipv6 enable                                                                    
 ipv6 address auto link-local                                                   
 statistic enable
 pppoe-server bind Virtual-Template 5                                                                 
 user-vlan 1000 4000 qinq 2000 2001                                             
 bas                                                                            
 #                                                                              
  access-type layer2-subscriber default-domain authentication isp1            
  client-option82 basinfo-insert cn-telecom                                     
  access-delay 100 odd-mac                                                     
 #                                                                              
#                                                                               
interface GigabitEthernet<span>0/1/0</span>                                                  
 undo shutdown                                                                  
 ipv6 enable                                                                    
 ip address 10.4.1.1 255.255.255.0                                              
 ipv6 address 2001:DB8:9::7/128                                                 
 ipv6 address auto link-local
#    
traffic-policy p1 inbound
traffic-policy p1 outbound
#
service-policy name service_edsg1 edsg                                          
 authentication-scheme none  
 accounting-scheme acct1                                                 
 radius-server group rd1   
<strong> </strong>service-group edsg                                                
 rate-limit cir 100000 pir 100000 inbound                                       
 rate-limit cir 100000 pir 100000 outbound                                      
# 
bgp 65008 
 #  
  ipv4-family unicast     
 <strong> </strong>network 0 10.1.1.0 255.255.255.0   
  network 0 10.3.1.0 255.255.255.0   
#
return</pre>
</div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0016.html">EDSG Configuration Examples
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_edsg_cfg_0019.html"><span class="font-st">&lt; </span>Previous topic</a>
</div>
</div>
</body>
</html>