
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Defining a Traffic Behavior and Configuring Actions">
<meta name="abstract" content="This section describes the traffic behaviors supported by a device and how to configure actions for a traffic behavior.">
<meta name="description" content="This section describes the traffic behaviors supported by a device and how to configure actions for a traffic behavior.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0040.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0042.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0044.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="OWNER" content="l00425560,m00390128">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00915594">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172371248">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/jquery.min.idp.js"></script>
<script type="text/javascript" src="../../../../public_sys-resources/RowOrColfreezeSupport.js"></script>

<script type="text/javascript">
setTimeout(function(){
	jQueryHW(document).ready(function(){
		jQueryHW("table[rowfreeze='yes']").rowfreeze();
		jQueryHW("table[colfreeze='yes']").colfreeze();
	});
},500);
</script>
<title>Defining a Traffic Behavior and Configuring Actions</title>
</head>
<body><a name="EN-US_TASK_0172371248"></a><a name="EN-US_TASK_0172371248"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Defining a Traffic Behavior and Configuring Actions</h1>
<div class="taskbody"><p>This section describes the traffic behaviors supported by a device and how to configure actions for a traffic behavior.</p>
<div class="context"><a name="EN-US_TASK_0172371248__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Context</h4>
<div class="p"><p>A device supports various types of actions for a traffic behavior. You can configure one or more types of actions as required.</p>
</div></div>
<div class="steps-unordered"><a name="EN-US_TASK_0172371248__1.4.2"></a><a name="1.4.2"></a><h4 class="sectiontitle">Procedure</h4>
<ul><li><span>Run <a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span><p><p>The system view is displayed.</p>
</p></li><li><span>Run <a href="cmdqueryname=traffic+behavior"><b><span class="cmdname">traffic behavior</span></b></a> <i><span class="varname">behavior-name</span></i></span><p><p>A traffic behavior is configured and its view is displayed.</p>
</p></li><li><span>Configure a packet filtering action.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=permit"><b><span class="cmdname">permit</span></b></a> | <strong>deny</strong></span><p><p>Packets are permitted or denied.</p>
</p><p><div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If both the <strong>if-match any</strong> and <strong>deny</strong> commands are configured, the MF classification function prevents all packets (including protocol packets) from passing through an interface. Therefore, exercise caution when using a combination of the preceding commands.</p>
<p>If the permit or deny action is configured in both the <strong>rule</strong> command and the traffic behavior view, only the packets permitted by the <strong>rule</strong> command are processed based on the traffic behavior. If the deny action is configured in either the <strong>rule</strong> command or the traffic behavior view, all matched packets are discarded.</p>
</div></div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure a traffic policing action.</span><p><p>For details, see <a href="dc_ne_qos_cfg_0010.html">Defining a Traffic Behavior and Configuring Traffic Policing Actions</a> in "Traffic Policing and Traffic Shaping Configuration."</p>
</p></li><li><span>Configure suppression for broadcast, multicast, and unknown unicast packets.</span><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=broadcast-suppression"><b><span class="cmdname">broadcast-suppression</span></b></a> <strong><span>cir</span></strong> <i><span class="varname">cir-value</span></i> [ <strong><span>cbs</span></strong> <i><span class="varname">cbs-value</span></i> ] [ <strong><span>green</span></strong> { <strong><span>discard</span></strong> | <strong><span>pass</span></strong> [ <strong><span>service-class</span></strong> <i><span class="varname">class</span></i> <strong><span>color</span></strong> { <strong><span>green</span></strong> | <strong><span>yellow</span></strong> | <strong><span>red</span></strong> } ] } | <strong><span>red</span></strong> { <strong><span>discard</span></strong> | <strong><span>pass</span></strong> [ <strong><span>service-class</span></strong> <i><span class="varname">class</span></i> <strong><span>color</span></strong> { <strong><span>green</span></strong> | <strong><span>yellow</span></strong> | <strong><span>red</span></strong> } ] } ] <sup>*</sup></span><p><p>The rate at which broadcast packets are transmitted is restricted.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=multicast-suppression"><b><span class="cmdname">multicast-suppression</span></b></a> <strong><span>cir</span></strong> <i><span class="varname">cir-value</span></i> [ <strong><span>cbs</span></strong> <i><span class="varname">cbs-value</span></i> ] [ <strong><span>green</span></strong> { <strong><span>discard</span></strong> | <strong><span>pass</span></strong> [ <strong><span>service-class</span></strong> <i><span class="varname">class</span></i> <strong><span>color</span></strong> { <strong><span>green</span></strong> | <strong><span>yellow</span></strong> | <strong><span>red</span></strong> } ] } | <strong><span>red</span></strong> { <strong><span>discard</span></strong> | <strong><span>pass</span></strong> [ <strong><span>service-class</span></strong> <i><span class="varname">class</span></i> <strong><span>color</span></strong> { <strong><span>green</span></strong> | <strong><span>yellow</span></strong> | <strong><span>red</span></strong> } ] } ] <sup>*</sup></span><p><p>The rate at which multicast packets are transmitted is restricted.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=unknown-unicast-suppression"><b><span class="cmdname">unknown-unicast-suppression</span></b></a> <strong><span>cir</span></strong> <i><span class="varname">cir-value</span></i> [ <strong><span>cbs</span></strong> <i><span class="varname">cbs-value</span></i> ] [ <strong><span>green</span></strong> { <strong><span>discard</span></strong> | <strong><span>pass</span></strong> [ <strong><span>service-class</span></strong> <i><span class="varname">class</span></i> <strong><span>color</span></strong> { <strong><span>green</span></strong> | <strong><span>yellow</span></strong> | <strong><span>red</span></strong> } ] } | <strong><span>red</span></strong> { <strong><span>discard</span></strong> | <strong><span>pass</span></strong> [ <strong><span>service-class</span></strong> <i><span class="varname">class</span></i> <strong><span>color</span></strong> { <strong><span>green</span></strong> | <strong><span>yellow</span></strong> | <strong><span>red</span></strong> } ] } ] <sup>*</sup></span><p><p>The rate at which unknown unicast packets are transmitted is restricted.</p>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
<p><p>The configured traffic behavior can be applied to the incoming or outgoing traffic on an interface.</p>
<p>After traffic suppression is applied to an interface, the packets matching the rules are processed based on the traffic behavior, and the packets not matching the rules are forwarded.</p>
</p></li><li id="EN-US_TASK_0172371248__qos_01"><span id="EN-US_TASK_0172371248__cmd784275385214057">Configure forcible traffic classification.</span><ol id="EN-US_TASK_0172371248__substeps465199205214057"><li class="substepexpand" id="EN-US_TASK_0172371248__substep1966525415214057"><span id="EN-US_TASK_0172371248__cmd1619322575214057">Run <a href="cmdqueryname=service-class"><b><span class="cmdname" id="EN-US_TASK_0172371248__cmdname1730434652214057">service-class</span></b></a> <i><span class="varname" id="EN-US_TASK_0172371248__varname1636189692214057">service-class</span></i> <strong><span id="EN-US_TASK_0172371248__cmdparmname850086083214057">color</span></strong> <i><span class="varname" id="EN-US_TASK_0172371248__varname1371659563214057">color</span></i></span><p><p id="EN-US_TASK_0172371248__p3529810151218">Packets with a certain CoS are colored.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172371248__substep106286018214057"><span id="EN-US_TASK_0172371248__cmd15302816425">(Optional) Run <a href="cmdqueryname=service-class"><b><span class="cmdname" id="EN-US_TASK_0172371248__cmdname1880588154214057">service-class</span></b></a> <i><span class="varname" id="EN-US_TASK_0172371248__varname41516796214057">service-class</span></i> <strong><span id="EN-US_TASK_0172371248__cmdparmname38838244214057">color</span></strong> <i><span class="varname" id="EN-US_TASK_0172371248__varname1870693011214057">color</span></i> <strong><span id="EN-US_TASK_0172371248__cmdparmname654234838214057">track</span></strong> { <strong><span id="EN-US_TASK_0172371248__cmdparmname1198736899214057">master</span></strong> | <strong><span id="EN-US_TASK_0172371248__cmdparmname1709332567214057">slave</span></strong> } <strong><span id="EN-US_TASK_0172371248__cmdparmname56904496214057">bfd-session</span></strong> <strong><span id="EN-US_TASK_0172371248__cmdparmname73929228214057">session-name</span></strong> <i><span class="varname" id="EN-US_TASK_0172371248__varname306166898214057">bfd-session-name</span></i></span><p><p id="EN-US_TASK_0172371248__p23232124216">The CoS and color of packets matching the traffic policy are marked based on the status of a specified BFD session.</p>
</p><p></p></li><li class="substepexpand" id="EN-US_TASK_0172371248__substep933110416214057"><span id="EN-US_TASK_0172371248__cmd1861171318214057">Run <a href="cmdqueryname=commit"><b><span class="cmdname" id="EN-US_TASK_0172371248__cmdname1184819451758">commit</span></b></a></span><p><p id="EN-US_TASK_0172371248__p554164481211">The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure packet re-marking.</span><p></p><ol><li class="substepexpand"><span>IP packets support multiple re-marking actions. Select the corresponding configurations in the following table based on service requirements on the network.</span><p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 1 </b>IP packet re-marking configurations</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.2.7.3.1.2.1.2.3.1.1" liSelected="liSelected"><p>Service Requirement</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.4.2.7.3.1.2.1.2.3.1.2" liSelected="liSelected"><p>Configuration Command</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>The original precedence of packets needs to be changed.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><a href="cmdqueryname=remark+ip-precedence"><b><span class="cmdname">remark ip-precedence</span></b></a> <i><span class="varname">ip-precedence</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>The DSCP value carried in packets needs to be changed.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><a href="cmdqueryname=remark"><b><span class="cmdname">remark</span></b></a> [ <strong><span>ipv6</span></strong> ] <strong><span>dscp</span></strong> <i><span class="varname">dscp-value</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>The ToS value carried in packets needs to be changed.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><a href="cmdqueryname=remark+tos"><b><span class="cmdname">remark tos</span></b></a> <i><span class="varname">tos</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>Whether packets can be fragmented needs to be set.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><a href="cmdqueryname=remark+ip-df"><b><span class="cmdname">remark ip-df</span></b></a> <em>dfvalue</em></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>The TE class ID of a flow needs to be identified in SPR-based traffic diversion.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><a href="cmdqueryname=remark+te-class"><b><span class="cmdname">remark te-class</span></b></a> <i><span class="varname">classid</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>5-tuple-based ACL matching needs to be configured for slice ID allocation.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><a href="cmdqueryname=remark+network-slice"><b><span class="cmdname">remark network-slice</span></b></a> <i><span class="varname">sliceId</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>The TTL value of packets needs to be changed.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><a href="cmdqueryname=remark+ttl"><b><span class="cmdname">remark ttl</span></b></a> <i><span class="varname">ttl-value</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.1 "><p>IPv6 APN information needs to be marked in packets.</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.4.2.7.3.1.2.1.2.3.1.2 "><p><strong><span>remark apn-id-ipv6</span></strong> <strong><span>instance</span></strong> <i><span class="varname">instance-name</span></i></p>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li class="substepexpand"><span>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure redirection actions for packets.</span><p></p><ol><li class="substepexpand"><span>IP packets support multiple redirection actions. Select the corresponding configurations in the following table based on packet types and service scenarios on the network.</span><p>
<div class="tableBorder"><table cellpadding="4" cellspacing="0" summary="" rowfreeze="yes" frame="border" border="1" rules="all"><caption><b>Table 2 </b>IP packet redirection configurations</caption><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="10.08%" id="mcps1.4.2.8.3.1.2.1.2.4.1.1" liSelected="liSelected"><p>Packet Type</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="32.68%" id="mcps1.4.2.8.3.1.2.1.2.4.1.2" liSelected="liSelected"><p>Redirection Scenario</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="57.24%" id="mcps1.4.2.8.3.1.2.1.2.4.1.3" liSelected="liSelected"><p>Configuration Command</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" rowspan="5" valign="top" width="10.08%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.1 "><p>IPv4 packets</p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
</td>
<td class="cellrowborder" valign="top" width="32.68%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure the IPv4 address and outbound interface, VPN instance<span>, and NQA test instance</span> on a single next hop for redirecting IPv4 packets.</p>
</td>
<td class="cellrowborder" valign="top" width="57.24%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><ul><li><a href="cmdqueryname=redirect+ip-nexthop"><b><span class="cmdname">redirect ip-nexthop</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> [ <strong><span>route-forward</span></strong> ] [ <strong><span>pri-type common</span></strong> ]</li><li><a href="cmdqueryname=redirect+ip-nexthop"><b><span class="cmdname">redirect ip-nexthop</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ]  [ <strong><span>pri-type common</span></strong> ] [ <strong><span>public-network</span></strong> ]</li><li><a href="cmdqueryname=redirect+ip-nexthop"><b><span class="cmdname">redirect ip-nexthop</span></b></a> <i><span class="varname">ip-address</span></i> <strong><span>vpn</span></strong> <i><span class="varname">vpn-instance-name</span></i> <span>[ <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> ] </span>[ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>In a scenario in which packets are redirected to a single next hop whose IP address matches a default route or a black-hole route, configure the packets to be forwarded based on the destination IP address.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+ip-nexthop"><b><span class="cmdname">redirect ip-nexthop</span></b></a> <i><span class="varname">ip-address</span></i> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ] [ <strong><span>public-network</span></strong> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure the IPv4 addresses and outbound interfaces, VPN instances<span>, and NQA test instances</span> on multiple next hops for redirecting IPv4 packets.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><ul><li><a href="cmdqueryname=redirect+ipv4-multinhp"><b><span class="cmdname">redirect ipv4-multinhp</span></b></a> { <strong><span>nhp</span></strong> <i><span class="varname">ip-address</span></i> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> } &amp;2-<span>42</span> [ <strong><span>loadbalance</span></strong><span> [ <strong><span>sip-hash</span></strong> ] <span>[ <strong><span>unequal-cost <span>| ecmp-stateful</span>  </span></strong>]</span></span> ]<span> [ <strong><span>route-forward</span></strong> ]</span><span> [ <strong><span>pri-type common</span></strong> ]</span></li><li><a href="cmdqueryname=redirect+ipv4-multinhp"><b><span class="cmdname">redirect ipv4-multinhp</span></b></a> { <strong><span>nhp</span></strong> <i><span class="varname">ip-address</span></i> <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> } &amp;2-<span>42</span> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ]<span> [ <strong><span>pri-type common</span></strong> ]</span></li><li><a href="cmdqueryname=redirect+ipv4-multinhp"><b><span class="cmdname">redirect ipv4-multinhp</span></b></a> { <strong><span>nhp</span></strong> <i><span class="varname">ip-address</span></i> <strong><span>vpn</span></strong> <i><span class="varname">vpn-instance-name</span></i> <span>[ <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> ] </span>} &amp;2-<span>42</span> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]<span> [ <strong><span>non-revertive</span></strong> ]</span></li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure IPv4 packets to be directly redirected to a specified outbound interface.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+to+interface"><b><span class="cmdname">redirect to interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> } [ <strong><span>route-forward</span></strong> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>In a scenario in which packets are redirected to multiple next hops whose IP addresses match default or black-hole routes, configure the packets to be forwarded based on the destination IP address.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+ipv4-multinhp"><b><span class="cmdname">redirect ipv4-multinhp</span></b></a> { <strong><span>nhp</span></strong> <i><span class="varname">ip-address</span></i> } &amp;2-<span>42</span> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="5" valign="top" width="10.08%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.1 "><p>IPv6 packets</p>
</td>
<td class="cellrowborder" valign="top" width="32.68%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure the IPv6 address and outbound interface, VPN instance<span>, and NQA test instance</span> on a single next hop for redirecting IPv6 packets.</p>
</td>
<td class="cellrowborder" valign="top" width="57.24%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><ul><li><a href="cmdqueryname=redirect+ipv6-nexthop"><b><span class="cmdname">redirect ipv6-nexthop</span></b></a> <i><span class="varname">ipv6-address</span></i> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i><span> [ <strong><span>route-forward</span></strong> ]</span> [ <strong><span>pri-type common</span></strong> ]</li><li><a href="cmdqueryname=redirect+ipv6-nexthop"><b><span class="cmdname">redirect ipv6-nexthop</span></b></a> <i><span class="varname">ipv6-address</span></i> <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]</li><li><a href="cmdqueryname=redirect+ipv6-nexthop"><b><span class="cmdname">redirect ipv6-nexthop</span></b></a> <i><span class="varname">ipv6-address</span></i> <strong><span>vpn</span></strong> <i><span class="varname">vpn-instance-name</span></i> <span>[ <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> ] </span>[ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>In a scenario in which packets are redirected to a single next hop whose IPv6 address matches a default route or a black-hole route, configure the packets to be forwarded based on the destination IPv6 address.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><ul><li><a href="cmdqueryname=redirect+ipv6-nexthop"><b><span class="cmdname">redirect ipv6-nexthop</span></b></a> <i><span class="varname">ip-address</span></i> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ] [ <strong><span>public-network</span></strong> ]</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure the IPv6 addresses and outbound interfaces, VPN instances<span>, and NQA test instances</span> on multiple next hops for redirecting IPv6 packets.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><ul><li><a href="cmdqueryname=redirect+ipv6-multinhp"><b><span class="cmdname">redirect ipv6-multinhp</span></b></a> { <strong><span>nhp</span></strong> <i><span class="varname">ipv6-address</span></i> <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> } &amp;2-16 [ <strong><span>loadbalance</span></strong> <span>[ <strong><span>sip-hash</span></strong> ] </span><span>[ <strong><span>unequal-cost<span> | ecmp-stateful</span> </span></strong>]</span> ] [ <strong><span>route-forward</span></strong> ] [ <strong><span>pri-type common</span></strong> ]</li><li><a href="cmdqueryname=redirect+ipv6-multinhp"><b><span class="cmdname">redirect ipv6-multinhp</span></b></a> { <strong><span>nhp</span></strong> <i><span class="varname">ipv6-address</span></i> <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> } &amp;2-16 [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]</li><li><a href="cmdqueryname=redirect+ipv6-multinhp"><b><span class="cmdname">redirect ipv6-multinhp</span></b></a> { <strong><span>nhp</span></strong> <i><span class="varname">ipv6-address</span></i> <strong><span>vpn</span></strong> <i><span class="varname">vpn-instance-name</span></i> <span>[ <strong><span>nqa</span></strong> <i><span class="varname">nqa-test-administer-name</span></i> <i><span class="varname">name-of-nqa-test-instance</span></i> ] </span>} &amp;2-16 [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>In a scenario in which packets are redirected to multiple next hops whose IPv6 addresses match default or black-hole routes, configure the packets to be forwarded based on the destination IPv6 address.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+ipv6-multinhp"><b><span class="cmdname">redirect ipv6-multinhp</span></b></a> <strong><span>nhp</span></strong> <i><span class="varname">ipv6-address</span></i> [ <strong><span>routing-filter</span></strong> { <strong><span>default-routing</span></strong> | <strong><span>blackhole-routing</span></strong> } * ] [ <strong><span>pri-type common</span></strong> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure IPv6 packets to be directly redirected to a specified outbound interface.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+ipv6+to+interface"><b><span class="cmdname">redirect ipv6 to interface</span></b></a> { <i><span class="varname">interface-name</span></i> | <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> } [ <strong><span>route-forward</span></strong> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" rowspan="8" valign="top" width="10.08%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.1 "><p>IPv4 and IPv6 packets</p>
</td>
<td class="cellrowborder" valign="top" width="32.68%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure IPv4 or IPv6 packets forwarded by private network routes to be redirected to public network routes' outbound interfaces.</p>
</td>
<td class="cellrowborder" valign="top" width="57.24%" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect"><b><span class="cmdname">redirect</span></b></a> { <strong><span>ip</span></strong> | <strong><span>ipv6</span></strong> } <strong><span>public-network</span></strong></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure IP data flows to be redirected to the public network's target LSP.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+lsp+public"><b><span class="cmdname">redirect lsp public</span></b></a> <i><span class="varname">dest-ipv4-address</span></i> [ <i><span class="varname">nexthop-address</span></i> | <strong><span>interface</span></strong> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> | <strong><span>secondary</span></strong> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure packets to be redirected to a specified VPN group.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+vpn-group"><b><span class="cmdname">redirect vpn-group</span></b></a> <i><span class="varname">vpn-group-name</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure packets to be redirected to a specified VSI.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+vsi"><b><span class="cmdname">redirect vsi</span></b></a> <i><span class="varname">vsi-name</span></i></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure packets to be redirected to a specified tunnel.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+interface+tunnel"><b><span class="cmdname">redirect interface tunnel</span></b></a> <i><span class="varname">tunnelname</span></i><span> [ <strong><strong><span>destination-ip</span></strong></strong><em> <i><span class="varname">destination-ip-address</span></i></em><em> <i><span class="varname">address-mask-length</span></i></em><strong> <strong><span>vpn-instance</span></strong> </strong><em><i><span class="varname">vpn-instance-name</span></i></em> ] [ <strong><span>route-forward</span></strong> ]</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure public network IPv4<span>/IPv6</span> packets to be redirected to a single SR-MPLS TE Policy.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+sr-te+policy"><b><span class="cmdname">redirect sr-te policy</span></b></a> <i><span class="varname">endpoint</span></i> <i><span class="varname">color</span></i> [ <strong><span>label</span></strong> <i><span class="varname">label</span></i> ] [ <strong><span>route-forward</span></strong> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure public network IPv4<span>/IPv6</span> packets to be redirected to a single SRv6 TE Policy.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect+srv6-te+policy"><b><span class="cmdname">redirect srv6-te policy</span></b></a> <i><span class="varname">endpoint</span></i> <i><span class="varname">color</span></i> [ { <strong><span>sid</span></strong> | <strong><span>vpnsid</span></strong> } <i><span class="varname">sid-ip</span></i> ]</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.2 "><p>Configure IPv4<span>/IPv6</span> packets to be redirected to multiple SRv6 TE Policies for load balancing.</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.4.2.8.3.1.2.1.2.4.1.3 "><p><a href="cmdqueryname=redirect-template+srv6-te"><b><span class="cmdname">redirect-template srv6-te</span></b></a> <i><span class="varname">template-name</span></i></p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><div class="p">Before performing this configuration, you need to create an SRv6 TE Policy redirection template in the system and specify SRv6 TE Policies.<ol type="a"><li>Run the <a href="cmdqueryname=redirect+template"><b><span class="cmdname">redirect template</span></b></a> <i><span class="varname">template-name</span></i> <strong><span>srv6-te</span></strong> command to create an SRv6 TE Policy redirection template and enter its view.</li><li>Run the <a href="cmdqueryname=endpoint"><b><span class="cmdname">endpoint</span></b></a><i><span class="varname"> endpoint</span></i> <strong><span>color</span></strong> <i><span class="varname">color</span></i> [ { <strong><span>sid</span></strong> | <strong><span>vpnsid</span></strong> } <i><span class="varname">sid-ip</span></i> ] command to configure an SRv6 TE Policy to which IPv4/IPv6 packets are redirected.</li><li>Run the <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a> command to commit the configuration.</li></ol>
</div>
</div></div>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure the load balancing mode of packets.</span><ol><li class="substepexpand"><span>Run <span><a href="cmdqueryname=load-balance"><b><span class="cmdname">load-balance</span></b></a> { <strong><span>flow</span></strong> [ <strong><span>l2</span></strong> | <strong><span>l3</span></strong> ] | <strong><span>packet</span></strong> }</span></span><p><p>A load balancing mode is set for packets.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure a cascaded traffic policy.</span><p><p>ACL rules are generally used for redirection in a traffic behavior. However, the specifications of ACL rules are limited. When ACL rules defined for MF classification do not meet the live network requirements, you can redirect the traffic behavior to a configured traffic policy to implement cascaded MF classification.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> [ <strong><span>ip-layer</span></strong> [ <strong><span>srv6-inner</span></strong> ] | <strong><span>link-layer</span></strong> <strong><span>srv6-inner</span></strong> ]</span><p><p>The traffic behavior is redirected to the traffic policy.</p>
</p><p><div class="p"><ul><li>Cascading a traffic policy over another will cause the device forwarding performance to deteriorate.</li><li>When the traffic on an interface matches the cascaded traffic policy:<ul><li>The traffic is forwarded based on the traffic behavior in the cascaded traffic policy.</li><li>If the traffic behaviors in the two traffic policies are different, they can be individually implemented.</li><li>If the traffic behaviors in the two traffic policies are the same, the specific behavior configuration in the cascaded traffic policy takes effect.</li></ul>
</li><li>On an interface, only one traffic policy can be applied to outgoing or incoming packets. If the traffic policy cascades over another traffic policy and is applied to an interface, both traffic policies take effect on the direction-specific interface.</li><li><p>The parameters specified for a traffic policy to be applied to an interface, such as <strong>inbound</strong>, <strong>outbound</strong>, mpls-layer, <span>all-layer, </span>and <strong>link-layer</strong>, are inherited by a cascaded traffic policy.</p>
</li><li><p>When the traffic behaviors for two-level ACLs are <strong>service-class</strong>, level-1 <strong>service-class</strong> preferentially takes effect. However, if level-1 <strong>service-class</strong> carries <strong>no-remark</strong>, level-2 <strong>service-class</strong> preferentially takes effect.</p>
</li></ul>
</div>
</p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=hierarchical-car+enable"><b><span class="cmdname">hierarchical-car enable</span></b></a></span><p><p>Hierarchical CAR is enabled in the cascaded traffic policy.</p>
</p><p><p>When a traffic policy is configured in a traffic behavior, CAR can also be configured in the traffic policy to implement hierarchical CAR.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Configure the sampling function of NetStream statistics.</span><p><p>To charge the subscribers or collect traffic statistics based on traffic classifiers, you can configure the corresponding traffic classifier and run the following commands to enable NetStream sampling:</p>
</p><ol><li class="substepexpand"><span>Run <span>{ <a href="cmdqueryname=ip"><b><span class="cmdname">ip</span></b></a> | <a href="cmdqueryname=ipv6"><b><span class="cmdname">ipv6</span></b></a> } <strong><span>netstream sampler</span></strong> { <strong><span>fix-packets</span></strong> <i><span class="varname">packet-interval</span></i> | <strong><span>fix-time</span></strong> <i><span class="varname">time-interval</span></i> | <strong><span>random-packets</span></strong> <i><span class="varname">packet-interval</span></i> }</span></span><p><p>The sampling function of NetStream statistics is configured.</p>
</p><p><p>Traffic sampling using a traffic policy in shared mode is not supported.</p>
</p><p></p></li><li class="substepexpand"><span>(Optional) Run <a href="cmdqueryname=ip+netstream+sampler+except+deny-action"><b><span class="cmdname">ip netstream sampler except deny-action</span></b></a></span><p><p>NetStream is not applied to traffic matching the ACL rule or traffic behavior that contains <strong>deny</strong>.</p>
</p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Increase the priority of the traffic behavior.</span><p><p>If both BGP flow specification and MF classification are configured on a device, you can run the <a href="cmdqueryname=increase-priority"><b><span class="cmdname">increase-priority</span></b></a> command to allow the traffic behavior configured in MF classification to preferentially take effect.</p>
</p><ol><li class="substepexpand"><span>Run <a href="cmdqueryname=increase-priority"><b><span class="cmdname">increase-priority</span></b></a></span><p><p>The priority of the traffic behavior is increased.</p>
</p><p></p></li><li class="substepexpand"><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol>
</li><li><span>Enable the logging of the first packet that matches an ACL.</span><p></p><p><ol><li>Run <a href="cmdqueryname=log+first-packet"><b><span class="cmdname">log first-packet</span></b></a><p>The device is enabled to log the first packet that matches an ACL.</p>
<p>After this function is enabled, a log is recorded when the first packet matches an ACL. The log contains the inbound/outbound interface name, source IP address, destination IP address, protocol number, source port number (TCP/UDP), destination port number (TCP/UDP), time when the first packet was received (in milliseconds), and number of packets within the specified period.</p>
</li><li>Run <a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a><p>Return to the system view.</p>
</li><li>(Optional) Run <a href="cmdqueryname=traffic-behavior+log"><b><span class="cmdname">traffic-behavior log</span></b></a> { <strong><span>entries</span></strong> <i><span class="varname">number-of-entries</span></i> | <strong><span>interval</span></strong> <i><span class="varname">interval-time</span></i> } <sup>*</sup><p>The maximum number of flows and the interval for collecting packet statistics recorded by the log are configured.</p>
</li><li>Run <a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a><p>The configuration is committed.</p>
</li></ol>
</p></li></ul></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0040.html">Configuring MF Classification-based Traffic Policies for IP Packets
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0042.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0044.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>