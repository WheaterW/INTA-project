
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Applying a Traffic Policy">
<meta name="abstract" content="A class-based policy does not take effect unless it is applied to an interface.">
<meta name="description" content="A class-based policy does not take effect unless it is applied to an interface.">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0040.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0044.html">
<meta name="DC.Relation" scheme="URI" content="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0047.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="Product Documentation-V8R23C00">
<meta name="DC.Creator" content="w00606909,m00390128">
<meta name="DC.Publisher" content="20240229">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="DC.Audience.Job" content="Configuration">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="featurename" content="Class-based QoS">
<meta name="featuretype" content="QOS">
<meta name="OWNER" content="m00390128">
<meta name="IA" content="">
<meta name="SE" content="">
<meta name="TE" content="">
<meta name="LASTMODIFIER" content="m00915594">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TASK_0172371252">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="../../../../public_sys-resources/commonltr.css">
<script language="javascript" type="text/javascript" src="../../../../public_sys-resources/browseVersion.js"></script>
<title>Applying a Traffic Policy</title>
</head>
<body><a name="EN-US_TASK_0172371252"></a><a name="EN-US_TASK_0172371252"></a>

<div class="articleBoxWithoutHead">
<h1 class="topicTitle-h1">Applying a Traffic Policy</h1>
<div class="taskbody"><p>A class-based policy does not take effect unless it is applied to an interface.</p>
<div class="steps"><a name="EN-US_TASK_0172371252__1.4.1"></a><a name="1.4.1"></a><h4 class="sectiontitle">Procedure</h4>
<ol><li><span>Run <span><a href="cmdqueryname=system-view"><b><span class="cmdname">system-view</span></b></a></span></span><p><p>The system view is displayed.</p>
</p></li><li id="EN-US_TASK_0172371252__step1481542876214057"><span id="EN-US_TASK_0172371252__cmd2036469940214057">(Optional) Configure packet information to be matched when a traffic policy is applied to a board.</span><p></p><ol type="a" id="EN-US_TASK_0172371252__substeps1795943250214057"><li class="substepexpand" id="EN-US_TASK_0172371252__substep1742735032214057"><span id="EN-US_TASK_0172371252__cmd921034351214057">Run <a href="cmdqueryname=slot"><b><span class="cmdname" id="EN-US_TASK_0172371252__cmdname718154212214057">slot</span></b></a> <i><span class="varname" id="EN-US_TASK_0172371252__varname9110420194517">slot-id</span></i></span><p><p id="EN-US_TASK_0172371252__p1655345344619">The slot view is displayed.</p>
</p></li><li class="substepexpand" id="EN-US_TASK_0172371252__substep614946345214057"><span id="EN-US_TASK_0172371252__cmd103131651214057">Select one of the following configurations as required:</span><p><ul id="EN-US_TASK_0172371252__ul722914143214057"><li id="EN-US_TASK_0172371252__li832434638214057"><p id="EN-US_TASK_0172371252__p2020484308214057"><a name="EN-US_TASK_0172371252__li832434638214057"></a><a name="li832434638214057"></a>Run the <a href="cmdqueryname=traffic-policy+match-ip-layer"><b><span class="cmdname" id="EN-US_TASK_0172371252__cmdname1830291400214057">traffic-policy match-ip-layer</span></b></a> { <strong><span id="EN-US_TASK_0172371252__cmdparmname16747019214057">mpls-pop</span></strong> | <strong><span id="EN-US_TASK_0172371252__cmdparmname1475968395214057">mpls-push</span></strong> } <sup id="EN-US_TASK_0172371252__sup1403726457214057">*</sup> command to configure MF classification based only on IP layer (Layer 3) information for incoming/outgoing traffic on the public network.</p>
</li><li id="EN-US_TASK_0172371252__li1476365078214057"><div class="p" id="EN-US_TASK_0172371252__p1241808508214057"><a name="EN-US_TASK_0172371252__li1476365078214057"></a><a name="li1476365078214057"></a>Configure MF classification based on IP and MPLS information for incoming/outgoing packets on the public network. Select one or two of the following configurations as required.<ul id="EN-US_TASK_0172371252__ul944217124214057"><li id="EN-US_TASK_0172371252__li38357772214057"><p id="EN-US_TASK_0172371252__p433979904214057"><a name="EN-US_TASK_0172371252__li38357772214057"></a><a name="li38357772214057"></a>Run the <a href="cmdqueryname=traffic-policy+match-mpls-layer"><b><span class="cmdname" id="EN-US_TASK_0172371252__cmdname1440410964214057">traffic-policy match-mpls-layer</span></b></a> <span>{ </span><strong><span id="EN-US_TASK_0172371252__cmdparmname61159330214057">mpls-push</span></strong><span> | <strong><span id="EN-US_TASK_0172371252__cmdparmname1659682242214057">mpls-pop</span></strong> } <sup id="EN-US_TASK_0172371252__sup446215121214057">*</sup></span> command to configure MF classification based on both IP and MPLS information for incoming<span>/outgoing</span> traffic on the public network.</p>
</li><li id="EN-US_TASK_0172371252__li126416417434"><p id="EN-US_TASK_0172371252__p13264124110435"><a name="EN-US_TASK_0172371252__li126416417434"></a><a name="li126416417434"></a>Run the <a href="cmdqueryname=traffic-policy+match-mpls-layer+l2-inbound"><b><span class="cmdname" id="EN-US_TASK_0172371252__cmdname165545014435">traffic-policy match-mpls-layer l2-inbound</span></b></a> command to configure MF classification based on MPLS information for outgoing packets on the public network in Layer 2 forwarding scenarios.</p>
</li></ul>
</div>
</li></ul>
</p></li><li class="substepexpand" id="EN-US_TASK_0172371252__substep1954565811522"><span id="EN-US_TASK_0172371252__cmd8545165865219">Run <a href="cmdqueryname=quit"><b><span class="cmdname" id="EN-US_TASK_0172371252__cmdname1064682055317">quit</span></b></a></span><p><p id="EN-US_TASK_0172371252__p2061334144515">Exit the slot view.</p>
</p></li></ol>
</li><li><span>Perform the following operations based on the interfaces on which a traffic policy is used:</span><p><ul><li>Apply an MF classification-based traffic policy to a Layer 3 interface.<ol type="a"><li>To enter the Layer 3 interface view, run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command.</li><li><div class="p">(Optional) To apply an MF classification-based traffic policy to incoming traffic based on the source and destination QoS policy IDs, run the <a href="cmdqueryname=qppb-policy+qos-local-id+both+inbound"><b><span class="cmdname">qppb-policy qos-local-id both inbound</span></b></a> command.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>In <a href="dc_ne_qos_cfg_0042.html">Configuring a Traffic Classifier</a>, the <a href="cmdqueryname=qppb-policy+qos-local-id+both+inbound"><b><span class="cmdname">qppb-policy qos-local-id both inbound</span></b></a> command takes effect only after the <a href="cmdqueryname=if-match+qos-local-id"><b><span class="cmdname">if-match qos-local-id</span></b></a> <strong><span>source</span></strong> <i><span class="varname">source-qos-local-id</span></i> <strong><span>destination</span></strong> <i><span class="varname">destination-qos-local-id</span></i> command is run.</p>
</div></div>
</div>
</li><li>To apply a traffic policy to the Layer 3 interface, run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } [ <span><strong><span>all-layer</span></strong> | </span><strong><span>link-layer</span></strong> | <strong><span>mpls-layer</span></strong> ] command.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>If <strong>link-layer</strong> is configured, the device performs MF classification based on Layer 2 information of packets.</li><li>If <strong>mpls-layer</strong> is configured, the device performs MF classification based on MPLS packet header information.</li><li>If <strong><span>all-layer</span></strong> is configured, the device first performs MF classification based on Layer 2 information of packets. If packets do not match any rule based on Layer 2 information, the device performs MF classification based on Layer 3 information of packets.</li></ul>
</div></div>
</li></ol>
</li><li>Apply an MF classification-based traffic policy to a Layer 2 interface, with a VLAN ID range specified.<ol type="a"><li>To enter the Layer 3 interface view, run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number</span></i> command.</li><li>To change the interface mode from Layer 3 to Layer 2, run the <a href="cmdqueryname=portswitch"><b><span class="cmdname">portswitch</span></b></a> command.</li><li>To add the Layer 2 interface to a specific VLAN in tagged mode, run the <a href="cmdqueryname=port+trunk+allow-pass+vlan"><b><span class="cmdname">port trunk allow-pass vlan</span></b></a> { { <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] } &amp;&lt;1-10&gt; | <strong><span>all</span></strong> } command.</li><li>To apply a traffic policy to the Layer 2 interface, run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } <strong><span>vlan</span></strong> { <i><span class="varname">vlan-id1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">vlan-id2</span></i> ] | <strong><span>all</span></strong> } [ <span><strong><span>all-layer</span></strong> | </span><strong><span>link-layer</span></strong> | <strong><span>mpls-layer</span></strong> ] command.</li></ol>
</li><li>Apply an MF classification-based traffic policy to an EVC Layer 2 sub-interface, with the bandwidth allocation mode specified.<ol type="a"><li>To enter the EVC Layer 2 sub-interface view, run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type interface-number.subnum</span></i> <strong><span>mode l2</span></strong> command.</li><li>To apply a traffic policy to the EVC Layer 2 sub-interface, run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> }<span> <strong><span>identifier</span></strong> { <strong><span>none</span></strong> | <strong><span>vid</span></strong> | <strong><span>ce-vid</span></strong> | <strong><span>vid-ce-vid</span></strong> }</span> [ <span><strong><span>all-layer</span></strong> | </span><strong><span>link-layer</span></strong> | <strong><span>mpls-layer</span></strong> ] command.<div class="note"><img src="../../../../public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>The bandwidth allocation mode specified using the <strong><span>identifier</span></strong> parameter must be the same as the one configured on the EVC Layer 2 sub-interface.</p>
</div></div>
</li></ol>
</li><li>Apply an MF classification-based traffic policy to a QinQ VLAN tag termination sub-interface, with the PVLAN ID and CVLAN ID ranges specified.<ol type="a"><li>To enter the sub-interface view, run the <a href="cmdqueryname=interface"><b><span class="cmdname">interface</span></b></a> <i><span class="varname">interface-type</span></i> <i><span class="varname">interface-number.subinterface-number</span></i> command.</li><li>To set a VLAN ID range for the sub-interface and configure the sub-interface to remove the tags from double-tagged packets, run the <a href="cmdqueryname=encapsulation"><b><span class="cmdname">encapsulation</span></b></a> <strong><span>qinq-termination</span></strong> [ <span><strong><span>local-switch</span></strong> | </span><strong><span>rt-protocol</span></strong> ] command.</li><li>To configure the sub-interface as a QinQ VLAN tag termination sub-interface, run the <a href="cmdqueryname=qinq+termination+pe-vid"><b><span class="cmdname">qinq termination pe-vid</span></b></a> <i><span class="varname">pe-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-pe-vid</span></i> ] <strong><span>ce-vid</span></strong> <i><span class="varname">ce-vid</span></i> [ <strong><span>to</span></strong> <i><span class="varname">high-ce-vid</span></i> ] [ <strong><span>vlan-group</span></strong> <i><span class="varname">group-id</span></i> ] command.</li><li>To apply a traffic policy to the QinQ VLAN tag termination sub-interface, run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } <strong><span>pe-vid</span></strong> <i><span class="varname">pe-vid</span></i> <strong><span>ce-vid</span></strong> <i><span class="varname">ce-vid1</span></i> [ <strong><span>to</span></strong> <i><span class="varname">ce-vid2</span></i> ] [ <span><strong><span>all-layer</span></strong> | </span><strong><span>link-layer</span></strong> | <strong><span>mpls-layer</span></strong> ] command.</li></ol>
</li><li>Apply an MF classification-based traffic policy to a VBDIF interface.<ol type="a"><li>To create a bridge domain (BD), run the <a href="cmdqueryname=bridge-domain"><b><span class="cmdname">bridge-domain</span></b></a> <i><span class="varname">bd-id</span></i> command.</li><li>To return to the system view, run the <span><a href="cmdqueryname=quit"><b><span class="cmdname">quit</span></b></a></span> command.</li><li>To create a VBDIF interface and enter the VBDIF interface view, run the <a href="cmdqueryname=interface+vbdif"><b><span class="cmdname">interface vbdif</span></b></a> <i><span class="varname">bd-id</span></i> command.</li><li>To apply a traffic policy to the VBDIF interface, run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } command.</li></ol>
</li><li>(Optional) Apply an MF classification-based traffic policy to a VPN instance.<ol type="a"><li>To enter the VPN instance view, run the <a href="cmdqueryname=ip+vpn-instance"><b><span class="cmdname">ip vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> command.</li><li>To apply a traffic policy to the VPN instance, run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>network</span></strong> <strong><span>inbound</span></strong> command.</li></ol>
</li><li>(Optional) Apply an MF classification-based traffic policy to a VSI.<ol type="a"><li>To enter the VSI view, run the <a href="cmdqueryname=vsi"><b><span class="cmdname">vsi</span></b></a> <em>vsi-name</em> command.</li><li>Perform either of the following operations as required:<ul><li>Run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>network</span></strong> <strong><span>inbound</span></strong> <strong><span>link-layer</span></strong> command to apply a network-side traffic policy to the VSI.</li><li>Run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a><i><span class="varname"> policy-name</span></i> <a href="cmdqueryname=ac-mode"><b><span class="cmdname">ac-mode</span></b></a> { <strong><span>inbound</span></strong> | <strong><span>outbound</span></strong> } [ <strong><span>link-layer</span></strong> | <strong><span>all-layer</span></strong> ] command to apply a user-side traffic policy to the VSI.</li></ul>
</li></ol>
</li><li>(Optional) Apply an MF classification-based traffic policy to an EVPN instance.<ol type="a"><li>To enter the EVPN instance view, run the <a href="cmdqueryname=evpn+vpn-instance"><b><span class="cmdname">evpn vpn-instance</span></b></a> <i><span class="varname">vpn-instance-name</span></i> <strong><span>bd-mode</span></strong> command.</li><li>To apply a traffic policy to the EVPN instance, run the <a href="cmdqueryname=traffic-policy"><b><span class="cmdname">traffic-policy</span></b></a> <i><span class="varname">policy-name</span></i> <strong><span>network</span></strong> <strong><span>inbound</span></strong> command.</li></ol>
</li></ul>
</p></li><li><span>(Optional) In the Eth-Trunk interface view, run <a href="cmdqueryname=qos+traffic-car+member-link-scheduler+distribute"><b><span class="cmdname">qos traffic-car member-link-scheduler distribute</span></b></a></span><p><p>Weight-based bandwidth allocation is configured for trunk member interfaces when CAR in a traffic policy is applied to the trunk interface.</p>
</p></li><li><span>Run <span><a href="cmdqueryname=commit"><b><span class="cmdname">commit</span></b></a></span></span><p><p>The configuration is committed.</p>
</p></li></ol></div>
</div>

</div>
<div class="footerNavBar clearfix">

<div class="parentlink">
Parent Topic:
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0040.html">Configuring MF Classification-based Traffic Policies for IP Packets
</a>
</div>
<div class="copyrightBottomBar">
Copyright &copy; Huawei Technologies Co., Ltd.</div>
<div class="bottomNavBtn clearfix">
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0044.html"><span class="font-st">&lt; </span>Previous topic</a>
<a href="../../../../software/nev8r10_vrpv8r16/user/ne/dc_ne_qos_cfg_0047.html">Next topic<span class="font-st"> &gt;</span></a>
</div>
</div>
</body>
</html>