Configuring a DCP
=================

A Data Collecting Point (DCP) manages and controls Target Logical Ports (TLPs), collects statistics generated by TLPs, and reports the statistics to a Measurement Control Point (MCP).

#### Context

On the network shown in [Figure 1](#EN-US_TASK_0172372893__fig_dc_vrp_ipfpm_cfg_000701), IP Flow Performance Measurement (FPM) hop-by-hop performance statistics collection is implemented. The target flow enters the transport network through Device A, travels across Device B, and leaves the transport network through Device C. To locate faults when network performance deteriorates, configure IP FPM hop-by-hop performance statistics collection on Device A, Device B, and Device C to measure packet loss and delay hop by hop. Device A, Device B, and Device C function as DCPs. Device A manages and controls TLP100, Device B manages and controls TLP200, and Device C manages and control TLP300 and TLP310. Device A, Device B, and Device C collect statistics generated by these TLPs and report the statistics to the MCP.**Figure 1** IP FPM hop-by-hop performance statistics collection  
![](images/fig_dc_vrp_ipfpm_cfg_000701.png)  

Perform the following steps on Device A, Device B, and Device C:


#### Procedure

1. Run [**system-view**](cmdqueryname=system-view)
   
   
   
   The system view is displayed.
2. Run [**nqa ipfpm dcp**](cmdqueryname=nqa+ipfpm+dcp)
   
   
   
   DCP is enabled globally, and the IPFPM-DCP view is displayed.
3. Run [**dcp id**](cmdqueryname=dcp+id) *id-value*
   
   
   
   A DCP ID is configured.
   
   Using the Router ID of a device that is configured as a DCP as its DCP ID is recommended.
   
   The DCP ID configured on a DCP must be the same as that specified in the [**dcp**](cmdqueryname=dcp) *dcp-id* command run in the IP FPM instance view of the MCP associated with this DCP. Otherwise, the MCP cannot process the statistics reported by the DCP.
4. (Optional) Run [**authentication-mode**](cmdqueryname=authentication-mode) **hmac-sha256** **key-id** *key-id* [ **cipher** ] [ *password* | **password** ]
   
   
   
   An authentication mode and password are configured on the DCP.
   
   
   
   The authentication mode and password configured on the DCP must be the same as those configured using the [**authentication-mode**](cmdqueryname=authentication-mode) **hmac-sha256** **key-id** *key-id* [ **cipher** ] [ *password* | **password** ] command on the MCP to which the DCP belongs. Otherwise, the MCP cannot process the statistics reported by the DCP.
5. (Optional) Run [**color-flag**](cmdqueryname=color-flag) **loss-measure** { **tos-bit** *tos-bit* | **flags-bit0** } **delay-measure** { **tos-bit** *tos-bit* | **flags-bit0** }
   
   
   
   IP FPM measurement flags are configured.
   
   The loss and delay measurement flags cannot use the same bit, and the bits used for loss and delay measurement must not have been used in other measurement tasks.
6. Run [**mcp**](cmdqueryname=mcp) *mcp-id* [ **port** *port-number* ] [ **vpn-instance** *vpn-instance-name* | **net-manager-vpn** ]
   
   
   
   An MCP ID is specified for the DCP, and the UDP port number is configured for the DCP to communicate with the MCP.
   
   The UDP port number configured on the DCP must be the same as that configured in the [**protocol udp port**](cmdqueryname=protocol+udp+port) *port-number* command run on the MCP associated with this DCP. Otherwise, the DCP cannot report the statistics to the MCP.
   
   The VPN instance has been created on the DCP before you configure **vpn-instance** *vpn-instance-name* or **net-manager-vpn** to allow the DCP to report the statistics to the MCP through the specified VPN or management VPN.
7. (Optional) Run [**period source**](cmdqueryname=period+source) **ntp**
   
   
   
   The DCP is configured to select NTP as the clock source when calculating an IP FPM statistical period ID.
   
   In P2MP (MP being two points) delay measurement scenarios, if the ingress of the service traffic uses NTP as the clock source, but the egresses use a different clock source, for example, NTP or 1588v2, you must configure the egresses to select NTP as the clock source when calculating an IP FPM statistical period ID to ensure consistent clock sources on the ingress and egresses.
8. Run [**instance**](cmdqueryname=instance) *instance-id*
   
   
   
   An IP FPM instance is created, and the instance view is displayed.
   
   *instance-id* must be unique on an MCP and all its associated DCPs. The MCP and all its associated DCPs must have the same IP FPM instance configured. Otherwise, statistics collection does not take effect.
9. (Optional) Run [**description**](cmdqueryname=description) *text*
   
   
   
   The description is configured for the IP FPM instance.
   
   The description of an IP FPM instance can contain the functions of the instance, facilitating applications.
10. (Optional) Run [**interval**](cmdqueryname=interval) *interval*
    
    
    
    The statistical period is configured for the IP FPM instance.
11. Perform either of the following operations to configure the target flow characteristics in the IP FPM instance.
    
    Configure the forward or backward target flow characteristics.
    * When **protocol** is specified as TCP or UDP, run:
      
      [**flow**](cmdqueryname=flow) { **forward** | **backward** } { **protocol** { **tcp** | **udp** } { **source-port** *src-port-number1* [ **to** *src-port-number2* ] | **destination-port** *dest-port-number1* [ **to** *dest-port-number2* ] } \* | **dscp** *dscp-value* | **source** *src-ip-address* [ *src-mask-length* ] | **destination** *dest-ip-address* [ *dest-mask-length* ] } \*
    * When **protocol** is specified as any protocol other than TCP or UDP, run:
      
      [**flow**](cmdqueryname=flow) { **forward** | **backward** } { **protocol** *protocol-number* | **dscp** *dscp-value* | **source** *src-ip-address* [ *src-mask-length* ] | **destination** *dest-ip-address* [ *dest-mask-length* ] } \*
    Configure the characteristics for the bidirectional target flow.
    * When **protocol** is specified as TCP or UDP, run:
      
      [**flow**](cmdqueryname=flow) **bidirectional** { **protocol** { **tcp** | **udp** } { **source-port** *src-port-number1* [ **to** *src-port-number2* ] | **destination-port** *dest-port-number1* [ **to** *dest-port-number2* ] } \* | **dscp** *dscp-value* | **source** *src-ip-address* [ *src-mask-length* ] | **destination** *dest-ip-address* [ *dest-mask-length* ] } \*
    * When **protocol** is specified as any protocol other than TCP or UDP, run:
      
      [**flow**](cmdqueryname=flow) **bidirectional** { **protocol** *protocol-number* | **dscp** *dscp-value* | **source** *src-ip-address* [ *src-mask-length* ] | **destination** *dest-ip-address* [ *dest-mask-length* ] } \*
    ![](../../../../public_sys-resources/note_3.0-en-us.png) 
    * If the target flow in an IP FPM instance is unidirectional, only **forward** can be specified.
    * If the target flow in an IP FPM instance is bidirectional, two situations are available:
      + If the bidirectional target flow is asymmetrical, you must configure **forward** and **backward** in two command instances to configure the characteristics for the forward and backward flows, respectively.
      + If the bidirectional target flow is symmetrical, you can specify **bidirectional** to configure the bidirectional target flow characteristics. By default, the characteristics specified are used for the forward flow, and the reverse of those are used for the backward flow. Specifically, the source and destination IP addresses and port numbers specified for the forward flow are used respectively as the destination and source IP addresses and port numbers for the backward flow. If the target flow is symmetrical bidirectional, set *src-ip-address* to specify a source IP address and *dest-ip-address* to specify a destination IP address for the target flow.
12. Run the following commands to configure TLPs for the IP FPM instance.
    
    
    * To configure a TLP and specify it as an in-point or out-point for the IP FPM instance, run the [**tlp**](cmdqueryname=tlp) *tlp-id* { **in-point** | **out-point** } { **ingress** | **egress** } [ **vpn-label** *vpn-label* ] [ **backward-vpn-label** *backward-vpn-label* ] command.
      
      On the network shown in [Figure 1](#EN-US_TASK_0172372893__fig_dc_vrp_ipfpm_cfg_000701), TLP100 is the in-point, and TLP310 is the out-point.
    * To configure a TLP and specify it as a mid-point for the IP FPM instance, run the [**tlp**](cmdqueryname=tlp) *tlp-id* **mid-point** **flow** { **forward** | **backward** } { **ingress** | **egress** } [ **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] ] command. To configure a TLP and specify it as a mid-point for the IP FPM instance in load balancing co-routed scenarios, run the [**tlp**](cmdqueryname=tlp) *tlp-id* **index** *index-id* **mid-point** **flow** { **forward** | **backward** } { **ingress** | **egress** } **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] ] command. 
      
      On the network shown in [Figure 1](#EN-US_TASK_0172372893__fig_dc_vrp_ipfpm_cfg_000701), TLP200 and TLP300 are mid-points.
    * To configure a TLP and specify it as a mid-point for the bidirectional target flow in the IP FPM instance, run the [**tlp**](cmdqueryname=tlp) *tlp-id* **mid-point** **flow** **bidirectional** { **ingress** | **egress** } [ **forward** { **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] } ] [ **backward** { **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] } ] command.
      
      To configure a TLP and specify it as a mid-point for the bidirectional target flow in the IP FPM instance in load balancing co-routed scenarios, run the [**tlp**](cmdqueryname=tlp) *tlp-id* **index** *index-id* **mid-point** **flow** **bidirectional** { **ingress** | **egress** } { **forward** **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] | **backward** **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] | **forward** **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] **backward** **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** *lsp-label2* ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] } command.
    * To configure the TE label of a TLP in the IP FPM instance as a wildcard label, run the [**tlp**](cmdqueryname=tlp) *tlp-id* **mid-point** **flow** { **forward** | **backward** } { **ingress** | **egress** } [ **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** { *lsp-label2* | **any** } ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] ] or [**tlp**](cmdqueryname=tlp) *tlp-id* **mid-point** **flow** **bidirectional** { **ingress** | **egress** } [ **forward** **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** { *lsp-label2* | **any** } ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] ] [ **backward** **vpn-label** *vpn-label* [ **lsp-label** *lsp-label* [ **lsp-label2** { *lsp-label2* | **any** } ] ] [ **flow-label** ] [ **control-word** ] [ **l2vpn** [ **tpid** *tpid* ] ] ] command.![](../../../../public_sys-resources/note_3.0-en-us.png) 
    * Label overlapping may occur when performance measurement is performed on packets carrying labels on the downstream interface. In this case, run the [**tlp nexthop**](cmdqueryname=tlp+nexthop) command to specify a next hop address.
    * If *tlp-id* is set to the same value in the preceding commands, the configurations of the command run later overwrite the configurations of the command run earlier.
13. Run [**quit**](cmdqueryname=quit)
    
    
    
    Return to the IPFPM-DCP view.
14. Run [**quit**](cmdqueryname=quit)
    
    
    
    Return to the system view.
15. Bind a TLP to an interface.
    
    
    1. Run the [**interface**](cmdqueryname=interface) { *interface-name* | *interface-type* *interface-number* } command to enter the view of the interface to which a TLP is to be bound.
    2. Run either of the following commands to bind a TLP to the interface:
       * If the interface is a Layer 3 interface, run the [**ipfpm tlp**](cmdqueryname=ipfpm+tlp) *tlp-id* command.
       * If the interface is a Layer 2 interface, run the [**ipfpm tlp**](cmdqueryname=ipfpm+tlp) *tlp-id* { **ce-default-vlan** | **vlan-id** *vlan-id* } command.
    3. Run the [**quit**](cmdqueryname=quit) command to return to the system view.
16. Configure IP FPM hop-by-hop performance statistics collection.
    
    
    1. Run the [**nqa ipfpm dcp**](cmdqueryname=nqa+ipfpm+dcp) command to enter the IPFPM-DCP view.
    2. Run the [**instance**](cmdqueryname=instance) *instance-id* command to enter the IP FPM instance view.
    3. Run the [**loss-measure enable mid-point**](cmdqueryname=loss-measure+enable+mid-point) [ **time-range** *time-range* | **continual** ] command to enable hop-by-hop packet loss measurement.
    4. Enable delay measurement.
       
       If the target flow is unidirectional, run either of the following commands:
       * To enable on-demand one-way delay measurement, run the [**delay-measure enable one-way tlp mid-point**](cmdqueryname=delay-measure+enable+one-way+tlp+mid-point) [ **time-range** *time-range* ] command.
       * To enable proactive one-way delay measurement, run the [**delay-measure enable one-way tlp mid-point**](cmdqueryname=delay-measure+enable+one-way+tlp+mid-point) **continual** command.
         
         ![](../../../../public_sys-resources/note_3.0-en-us.png) 
         
         In NE40E implementation, hop-by-hop delay measurement can be performed after you enable this function on the TLP in-point (TLP100 in [Figure 1](#EN-US_TASK_0172372893__fig_dc_vrp_ipfpm_cfg_000701)) from which the target flow enters the network.
       If the target flow is a bidirectional, run either of the following commands:
       * To enable on-demand two-way delay measurement, run the [**delay-measure enable two-way**](cmdqueryname=delay-measure+enable+two-way) **tlp** **mid-point** [ **time-range** *time-range* ] command.
       * To enable proactive two-way delay measurement, run the [**delay-measure enable two-way**](cmdqueryname=delay-measure+enable+two-way) **tlp** **mid-point** [**continual**](cmdqueryname=continual) command.