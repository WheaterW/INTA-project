Configuring an SR-MPLS TE Policy (Dynamic Delivery by a Controller)
===================================================================

SR-MPLS TE Policy is a tunneling technology developed based on SR.

#### Usage Scenario

An SR-MPLS TE Policy can either be manually configured on a forwarder through CLI or NETCONF, or be delivered to a forwarder after being dynamically generated by a protocol, such as BGP, on a controller. The dynamic mode facilitates network deployment.

The candidate paths in an SR-MPLS TE Policy are identified using <Protocol-Origin, originator, discriminator>. If SR-MPLS TE Policies generated in both modes exist, the forwarder selects an SR-MPLS TE Policy based on the following rules in descending order:

* Protocol-Origin: The default value of Protocol-Origin is 20 for a BGP-delivered SR-MPLS TE Policy and is 30 for a manually configured SR-MPLS TE Policy. A larger value indicates a higher preference.
* <ASN, node-address> tuple: originator of an SR-MPLS TE Policy's primary path. ASN indicates an AS number, and node-address indicates the address of the node where the SR-MPLS TE Policy is generated.
  + The ASN and node-address values of a manually configured SR-MPLS TE Policy are fixed at 0 and 0.0.0.0, respectively.
  + For an SR-MPLS TE Policy delivered by a controller through BGP, the ASN and node-address values are as follows:
    1. If a BGP SR-MPLS TE Policy peer relationship is established between the headend and controller, the ASN and node-address values are the AS number of the controller and the BGP router ID, respectively.
    2. If the headend receives an SR-MPLS TE Policy through a multi-segment EBGP peer relationship, the ASN and node-address values are the AS number and BGP router ID of the original EBGP peer, respectively.
    3. If the controller sends an SR-MPLS TE Policy to a reflector and the headend receives the SR-MPLS TE Policy from the reflector through the IBGP peer relationship, the ASN and node-address values are the AS number and BGP originator ID of the controller, respectively.For both ASN and node-address, a smaller value indicates a higher preference.
* Distinguisher: A larger value indicates a higher preference. For a manually configured SR-MPLS TE Policy, the value of Distinguisher is the same as the preference value.

The process for a controller to dynamically generate and deliver an SR-MPLS TE Policy to a forwarder is as follows:

1. The controller collects information, such as network topology and label information, through BGP-LS.
2. The controller and headend forwarder establish an IPv4 SR-MPLS TE Policy address family-specific BGP peer relationship.
3. The controller computes an SR-MPLS TE Policy and delivers it to the headend forwarder through the BGP peer relationship. The headend forwarder then generates SR-MPLS TE Policy entries.

#### Pre-configuration Tasks

Before configuring an SR-MPLS TE Policy, complete the following tasks:

* Configure an IGP to ensure that all nodes can communicate with each other at the network layer.
* Configure a routing protocol between the controller and forwarder to ensure that they can communicate with each other.


[Configuring TE Attributes](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0200_4.html)

Configure TE attributes for links so that SR-MPLS TE paths can be adjusted based on the TE attributes during path computation.

[Configuring IGP SR](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0068.html)

This section describes how to configure IGP SR.

[Configuring IGP SR-MPLS TE and Topology Reporting](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0167.html)

Before an SR-MPLS TE tunnel is established, you need to enable IGP SR-MPLS TE and topology reporting through BGP-LS.

[(Optional) Configuring ORF for the BGP IPv4 SR-Policy Address Family](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0272.html)

When a device advertises BGP IPv4 SR-Policy address family routes to peers, you can configure the outbound route filtering (ORF) function to enable the device to advertise only routes carrying the BGP router IDs of peers. This function helps reduce the network load.

[Configuring a BGP IPv4 SR-MPLS TE Policy Peer Relationship Between a Controller and a Forwarder](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0069.html)

This section describes how to configure a BGP IPv4 SR-MPLS TE Policy peer relationship between a controller and a forwarder, so that the controller can deliver SR-MPLS TE Policies to the forwarder. This improves SR-MPLS TE Policy deployment efficiency.

[(Optional) Configuring Cost Values for SR-MPLS TE Policies](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0267a.html)

Configure cost values for SR-MPLS TE Policies so that the ingress can select the optimal SR-MPLS TE Policy based on the values.

[Configuring the Color Extended Community](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0070.html)

This section describes how to configure the Color Extended Community for a route through a route-policy, enabling the route to recurse to an SR-MPLS TE Policy based on the color value and next-hop address in the route.

[Verifying the SR-MPLS TE Policy Configuration](../../../../software/nev8r10_vrpv8r16/user/vrp/dc_vrp_sr_all_cfg_0073.html)

After configuring SR-MPLS TE Policies, verify the configuration.