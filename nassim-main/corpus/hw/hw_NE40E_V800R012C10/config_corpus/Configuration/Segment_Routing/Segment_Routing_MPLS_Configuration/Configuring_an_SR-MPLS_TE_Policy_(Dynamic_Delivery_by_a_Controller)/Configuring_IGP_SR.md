Configuring IGP SR
==================

This section describes how to configure IGP SR.

#### Context

An SR-MPLS TE Policy may contain multiple candidate paths that are defined using segment lists. Because adjacency and node SIDs are required for SR-MPLS TE Policy configuration, you need to configure the IGP SR function. Node SIDs need to be configured manually, whereas adjacency SIDs can either be generated dynamically by an IGP or be configured manually.

* In scenarios where SR-MPLS TE Policies are configured manually, if dynamic adjacency SIDs are used, the adjacency SIDs may change after an IGP restart. To keep the SR-MPLS TE Policies up, you must adjust them manually. The adjustment workload is heavy if a large number of SR-MPLS TE Policies are configured manually. Therefore, you are advised to configure adjacency SIDs manually and not to use adjacency SIDs generated dynamically.
* In scenarios where SR-MPLS TE Policies are delivered by a controller dynamically, you are also advised to configure adjacency SIDs manually. Although the controller can use BGP-LS to detect adjacency SID changes, the adjacency SIDs dynamically generated by an IGP change randomly, causing inconvenience in routine maintenance and troubleshooting.


#### Procedure

1. Enable MPLS.
   1. Run [**system-view**](cmdqueryname=system-view)
      
      
      
      The system view is displayed.
   2. Run [**mpls lsr-id**](cmdqueryname=mpls+lsr-id) *lsr-id*
      
      
      
      An LSR ID is configured for the device.
      
      
      
      Note the following during LSR ID configuration:
      * Configuring LSR IDs is the prerequisite for all MPLS configurations.
      * LSRs do not have default IDs. LSR IDs must be manually configured.
      * Using a loopback interface address as the LSR ID is recommended for an LSR.
   3. Run [**mpls**](cmdqueryname=mpls)
      
      
      
      MPLS is enabled globally, and its view is displayed.
      
      
      
      Because SR-MPLS uses the MPLS forwarding plane, it requires MPLS to be enabled globally and on specific interfaces.
      
      To avoid the complex configuration of enabling MPLS on interfaces one by one, an optimization has been made, so that MPLS can be automatically enabled on an interface when either of the following conditions is met:
      
      * An IGP is enabled on the interface, and Segment Routing is enabled for the IGP.
      * A static adjacency label is configured for the interface in the Segment Routing view.
   4. Run [**commit**](cmdqueryname=commit)
      
      
      
      The configuration is committed.
   5. Run [**quit**](cmdqueryname=quit)
      
      
      
      Return to the system view.
2. Enable SR globally.
   1. Run [**segment-routing**](cmdqueryname=segment-routing)
      
      
      
      Segment Routing is enabled globally, and the Segment Routing view is displayed.
   2. (Optional) Run [**local-block**](cmdqueryname=local-block) *begin-value* *end-value* [ **ignore-conflict** ]
      
      
      
      An SR-MPLS-specific SRLB range is configured.
      
      
      
      If the system displays a message indicating that the SRLB is used, run the [**display segment-routing local-block**](cmdqueryname=display+segment-routing+local-block) command to view the SRLB ranges that can be set. Alternatively, delete unwanted configurations related to the used label to release the label space.
      
      When the **ignore-conflict** parameter is specified in the [**local-block**](cmdqueryname=local-block) command, if a label conflict occurs, the configuration is forcibly delivered but does not occupy label resources. This function is mainly used for pre-deployment, and the configuration takes effect after the device is restarted.
   3. Run [**commit**](cmdqueryname=commit)
      
      
      
      The configuration is committed.
   4. Run [**quit**](cmdqueryname=quit)
      
      
      
      Return to the system view.
3. Configure IGP SR.
   * If the IGP is IS-IS, configure IGP SR by referring to [Configuring Basic SR-MPLS TE Functions](dc_vrp_sr_all_cfg_0026.html).
     
     In scenarios where SR-MPLS TE Policies need to be manually configured, you are advised to use manually configured adjacency SIDs. In scenarios where a controller dynamically delivers SR-MPLS TE Policies, you are advised to preferentially use manually configured adjacency SIDs. However, you can also use IS-IS to dynamically generate adjacency SIDs.
   * If the IGP is OSPF, configure IGP SR by referring to [Configuring Basic SR-MPLS TE Functions](dc_vrp_sr_all_cfg_0027.html).
     
     Because OSPF cannot advertise manually configured adjacency SIDs, only dynamically generated adjacency SIDs can be used.