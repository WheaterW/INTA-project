Configuring an ESI
==================

An ESI must be configured for a PE interface connecting to a CE or the BD to which such an interface is bound. The PE interfaces connecting to the same CE or the BDs to which such interfaces are bound must have the same ESI configured.

#### Context

After PEs exchange routes that carry ESIs, a PE learns about other PEs connecting to the same CE as itself, helping implement load balancing or FRR.

The interface with an ESI configured is in the up state. Otherwise, Ethernet segment routes cannot be generated.

An ESI can be obtained for an interface in the following ways:

* Static ESI configuration
* Dynamic ESI generation

Static ESI configuration is recommended. Compared with dynamic ESI generation, static configuration allows EVPN to implement faster traffic switching during a DF election in a dual-homing scenario with active-active PEs.

![](../../../../public_sys-resources/note_3.0-en-us.png) 

The features required in an EVPN dual-homing scenario, such as fast convergence, split horizon, and DF election, all become invalid in a single-homing scenario. In such a scenario, configuring an ESI is optional on the single-homing PE.



#### Procedure

* Configure an interface to dynamically generate an ESI.
  1. Run [**system-view**](cmdqueryname=system-view)
     
     
     
     The system view is displayed.
  2. Run [**interface**](cmdqueryname=interface) **eth-trunk** *trunk-id*
     
     
     
     The Eth-Trunk interface view is displayed.
  3. Run [**mode**](cmdqueryname=mode) **lacp-static**
     
     
     
     The working mode of the Eth-Trunk interface is set to static LACP.
     
     
     
     After this command is run in the Eth-Trunk interface view, a dynamic ESI is automatically generated.
  4. (Optional) Run [**ignore dynamic-esi**](cmdqueryname=ignore+dynamic-esi)
     
     
     
     The device is configured to ignore dynamically generated ESIs.
     
     
     
     After the [**mode**](cmdqueryname=mode) **lacp-static** command is run on an interface, an ESI is dynamically generated by default. In a single-homing scenario, ESIs are not required. To enable an interface to ignore dynamically generated ESIs, run this command. In an EVPN VPLS scenario, no ESIs are generated for Ethernet A-D and Ethernet segment routes, and MAC routes carry all-0 ESIs.
  5. Run [**commit**](cmdqueryname=commit)
     
     
     
     The configuration is committed.
* Statically configure an ESI for an interface.
  
  
  
  Perform this configuration if a VLAN is used to access an EVPN.
  
  
  
  1. Run [**system-view**](cmdqueryname=system-view)
     
     
     
     The system view is displayed.
  2. Run [**interface**](cmdqueryname=interface) *interface-type* *interface-number*
     
     
     
     The interface view is displayed.
  3. Run [**esi**](cmdqueryname=esi) *esi*
     
     
     
     An ESI is configured.
  4. Run [**commit**](cmdqueryname=commit)
     
     
     
     The configuration is committed.
* Manually configure an ESI in a BD.
  
  
  
  Perform this configuration if VXLAN is used to access an EVPN and the EVPN transmits ARP or MAC routes.
  
  
  
  1. Run [**system-view**](cmdqueryname=system-view)
     
     
     
     The system view is displayed.
  2. Run [**bridge-domain**](cmdqueryname=bridge-domain) *bd-id*
     
     
     
     The BD view is displayed.
  3. Run [**esi**](cmdqueryname=esi) *esi*
     
     
     
     An ESI is configured.
  4. Run [**commit**](cmdqueryname=commit)
     
     
     
     The configuration is committed.