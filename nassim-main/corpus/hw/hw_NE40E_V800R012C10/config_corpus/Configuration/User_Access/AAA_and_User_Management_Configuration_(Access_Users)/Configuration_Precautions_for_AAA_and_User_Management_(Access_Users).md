Configuration Precautions for AAA and User Management (Access Users)
====================================================================

Configuration Precautions for AAA and User Management (Access Users)

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| Layer 3 leased line users do not support UCL matching based on source IP addresses. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. Modifying the whitelist for UCL matching based on the source IP address in a domain and enabling IPv4/IPv6 do not take effect for online users. The whitelist and IPv4/IPv6 enabling status is re-obtained only when users switch between pre-authentication and authentication domains or CoA re-authentication is performed.  2. When the user group of a user changes, the system checks whether the new user group is in the whitelist. If the new user group is in the whitelist, UCL matching based on the source IP address takes effect. If the new user group is not in the whitelist, UCL matching based on the source IP address does not take effect. Modifying a member in the whitelist takes effect in real time, that is, when the user group of a user changes, the latest member in the whitelist is used to determine whether the new user group is in the whitelist. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the MIB triggers the hwAccessUserSummaryTable to query the number of users (hwNormalUserNum, hwLocalRegistrationUserNum, and hwRemoteRegistrationUserNum) on a device, if the number of users is queried again within 10s, the statistics remain unchanged. As a result, the MIB query result may be different from the display access-user summary command output. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| UCL matching based on user source IP addresses cannot be used together with distributed NAT, distributed DS-Lite, DAA, HTTP redirection, HTTPS redirection, or DNS redirection. After UCL matching based on user source IP addresses is configured, distributed NAT, distributed DS-Lite, HTTP redirection, HTTPS redirection, and DNS redirection do not take effect. After DAA services are configured, UCL matching based on users' source IP addresses does not take effect. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. In a disaster recovery or RUI scenario, if the accounting-start-delay <delay-time> offline [ user-type { ppp | ipoe | l2tp | static } \* ] command is run in a domain and an active/standby switchover occurs between the time when a user goes online from the first stack and the time when the user goes online from the second stack, the user is logged out after the delay expires. Then, the user can go online successfully after going online again.  2. In a dual-main control board scenario, if the accounting-start-delay offline [ user-type { ppp | ipoe | l2tp | static } \* ] command is run in a domain and an active/standby switchover occurs between the time when a user goes online from the first stack and the time when the user goes online from the second stack, the user is logged out after the delay time expires if the accounting-start-delay traffic-forward before-start-accounting command is run in the domain. If the accounting-start-delay traffic-forward before-start-accounting command is not run in the domain, the user is logged out after an active/standby switchover. Then, the user can go online successfully after going online again. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the Diameter server delivers a traffic quota for a value-added service, the traffic quota that takes effect for the value-added service has a deviation of less than 1024 bytes. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. When the device reports the traffic usage of value-added services to the Diameter server, there is a delay in reporting the traffic usage. As a result, the reported traffic volume is greater than the traffic quota delivered by the Diameter server last time. The following uses 256K online users on a board as an example:  If the flow-statistic frequency fast command is run in the slot/UP-board view, that is, traffic statistics of 320 users are reported every second, the interval for reporting traffic statistics of the same user on the board is 256000/320 = 800s = 13 min.  2. When the device reports the online duration of value-added services to the Diameter server, there is a delay in processing timer timeout messages. As a result, the reported online duration is longer than the duration quota delivered by the server last time. The following is an example:  If there are 500 online users and each user carries 12 services, the current CPU can process 500 timer timeout messages per second. When the duration quotas of all services of all users are exhausted at the same time, the service online duration reported in the CCR-U packet of the last service has a 12s error. If the current CPU load of the device is high, the error further increases. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Defects in the scenario where Diameter supports link-based packet retransmission:  1. After a user goes online, the link goes down. After the user uses up the quota, the user goes offline, and the link goes up again. In this scenario, no CCRT packet is sent, and the user loses some quotas. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Defects in the scenario where Diameter interworks with a Diameter server  1. Diameter of the current version supports interworking with Huawei Diameter servers only. Interworking with non-Huawei Diameter servers needs to be tested and evaluated. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. If the priority mode and four-queue mode (4 CoS queue) are configured in the QoS profile, the FQ parameters delivered by the RADIUS server do not take effect.  2. Both RADIUS-delivered and configured FQ parameters take effect. If RADIUS-delivered FQ parameters are different from those configured on the device, RADIUS-delivered FQ parameters do not take effect. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When an upstream VPN is deployed for CGN users, the upstream VPN does not take effect, and CGN users still use the original public VPN. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Layer 2 leased line users, Layer 3 leased line users, Layer 2 VPN leased line users, and PPPoLNS users do not support bandwidth adjustment based on time ranges. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a Layer 2 or Layer 3 leased line user is online and a CoA message is used to switch the QoS profile, if the rate limit modes before and after the switching are different (SQ to CAR or CAR to SQ), a CoA ACK message is returned. The display access-user command output also displays the QoS profile after the switching; however, it does not take effect. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When IPoE user names are generated based on the format configured using the vlanpvc-to-username command, the system name in a user name can contain a maximum of 17 bytes. Excessive bytes will be truncated. Therefore, properly configure the mode in which user names are generated for IPoE users and properly set the system name of a device. If a user name needs to contain the system name, it is recommended that the system name contain no more than 17 characters.  If the parameters specified in the default-user-name command cannot be obtained from user sessions, the generated user names do not contain these parameters. For example, if no IP address is assigned to a DHCP user before the user goes online, the IP address cannot be used to generate the user name.  Otherwise, communication between IPoE users and the RADIUS server is affected. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If load balancing is configured for RADIUS servers: In a single-device scenario, the device sends accounting start and stop packets to the corresponding RADIUS servers based on the load balancing result. In disaster recovery or RUI scenarios, load balancing results are not backed up to the backup device. As a result, the load balancing results on the master and backup devices may be different. After a master/backup device switchover, the RADIUS server to which accounting packets are copied is different from that before the switchover. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The BRAS does not support multiple VSs. After BRAS is enabled in the admin-VS, services in other VSs are affected. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function of uploading user login and logout logs has the following restrictions:  1. IPv6 addresses are not recorded for IPv6 users.  2. For dual-stack users, user information of the stacks from which users go online first and go offline last is recorded only.  3. Information about Layer 2 leased line users is not recorded and user information is not recorded on the RUI backup device.  4. The user names recorded in the logs can contain a maximum of 63 bytes. Excessive bytes will be truncated. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The flexible interoperation function of RADIUS attributes does not support the processing of attributes in RADIUS packets in the following scenarios:  1. The aaa route-download now force command is run to force the device to synchronize static routes delivered by the RADIUS server once.  2. The value-added-service accounting-merge command is run to enable accounting packet merging for value-added services.  3. The test-aaa command is run to check whether a user can pass the authentication of the RADIUS server group.  4. A dynamic address pool applies for address segments through a RADIUS server.  5. A BRAS sends an accounting-on/Accouting-off packet to an accounting server. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Among physical interfaces, 40GE interfaces (interface 40GE x/x/x or interface 40GE x/x/x/x) do not support BRAS access. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. The same authentication server can be configured in multiple RADIUS server groups. The same authentication server is configured in multiple server groups, but only one authentication server is created on the device. If the authentication server is down, all server groups consider that the authentication server is down.  If the source interface of a server group is incorrectly configured and this causes the authentication server to go down, all server groups consider the authentication server down. As a result, the sending of RADIUS packets is affected.  2. The same accounting server can be configured in multiple RADIUS server groups. The same accounting server is configured in multiple server groups, but only one accounting server is created on the device. If the accounting server is down, all server groups consider that the accounting server is down.  If the source interface of a server group is incorrectly configured and this causes the accounting server to go down, all server groups consider that the accounting server is down. As a result, the sending of RADIUS packets is affected. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In the following scenarios, DHCP users on the BRAS go offline, but 802.1X users on the AC do not go offline synchronously.  1. The username of an 802.1X user is updated during roaming. The BRAS does not update the username of the DHCP user. When a DHCP user on the BRAS goes offline, the BRAS sends a DM packet carrying the old username to the AC. When processing the DM packet, the AC fails to verify the username. As a result, the 802.1X user on the AC does not go offline synchronously.  2. All ACs connected to the BRAS correspond to the same interface and VLAN of the BRAS. 802.1X users on the ACs are not charged. When an 802.1X user roams between ACs, the BRAS cannot update the 802.1X user information (including the AC's IP address, VPN, NAS-IP-Address, NAS-Identifier, and Acct-Session-Id) corresponding to the DHCP user. When the DHCP user on the BRAS goes offline, the DM packet is not sent to the AC to which the user belongs. As a result, the 802.1X user on the AC does not go offline synchronously. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The real-time rate of home users is inaccurate. It is the rate after session-level rate limiting and before home-level rate limiting. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| A NAT instance is bound to a user group in a domain. If the NAT instance is unavailable (for example, the CGN board fails), BRAS users in the domain cannot go online. | NE40E-M2 | NE40E-M2K/NE40E-M2K-B |