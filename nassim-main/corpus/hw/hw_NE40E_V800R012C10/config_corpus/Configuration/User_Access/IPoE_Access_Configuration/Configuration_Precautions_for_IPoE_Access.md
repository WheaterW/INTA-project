Configuration Precautions for IPoE Access
=========================================

Configuration Precautions for IPoE Access

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| If the active and standby forcible direction page servers are configured in an AAA domain and bound to web authentication servers, web users who go online from this domain obtain the forcible redirection page based on the detection status of the web authentication server. If the states of the web authentication servers are different, the web authentication server in the up state has a higher priority than that in the down state. If the states of the web authentication servers are the same, the active web authentication server has a higher priority than the standby one. In addition, forcible page changes caused by configuration or server status changes take effect only for new online users. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| WLAN user roaming switchover supports only IPoE user access (excluding static users for whom the device initiates ARP packets to trigger user login, static users with the same MAC address but different IP addresses, and all leased line users).  Roaming procedures cannot be triggered for static users for whom the device initiates ARP packets to trigger user login and static users with the same MAC address but different IP addresses on the BAS interface with roaming switchover configured. The interface configuration of leased line users is mutually exclusive with the roaming switchover configuration.  It is recommended that roaming be properly planned during deployment. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Option 82 information can be updated for online Layer 2 DHCPv4 users and Layer 2 leased line DHCPv4 users.  1. Option 82 information update for online users cannot be used together with lawful interception. When Option 82 information is updated online and lawful interception based on the circuit ID and remote ID is configured, the updated Option 82 information cannot be used to deliver the lawful interception configuration again. As a result, the current lawful interception rule cannot be matched again.  2. Option 82 information update for online users cannot be configured together with HQoS for home users. When Option 82 information is updated for online users and HQoS is configured for home users based on Option 82, the updated Option 82 information cannot be used to update the HQoS configuration for home users. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If a DHCPv6 packet carries both IA\_NA and IA\_PD fields, a home gateway cannot send two Solicit messages to obtain an IPv6 address and prefix. If two Solicit messages are sent, the address type requested in the first Solicit message is assigned for the second Solicit message. Users may fail to go online.  The client needs to carry both the address and prefix information. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| L2VPN leased lines do not support access through main interfaces. After L2VPN is configured on a main interface, BAS access cannot be configured. After BAS access is configured, L2VPN cannot be configured. Therefore, you need to configure L2VPN leased line access on a sub-interface. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Restrictions on IPv6 web authentication users:  1. Users who obtain IPv6 addresses with shared prefixes through ND are not supported.  2. A dual-stack web user goes online in the pre-authentication domain and is switched to the authentication domain from the IPv6 stack. After the user goes offline from the IPv6 stack by sending a Release message, the user cannot be switched to the pre-authentication domain from the IPv4 stack. A dual-stack web user is switched to the authentication domain from the IPv4 stack. After the user goes offline from the IPv4 stack by sending a Release message, the user cannot be switched to the pre-authentication domain from the IPv6 stack.  3. If the IP address of the web server configured in the pre-authentication domain is the same as that of the portal server configured in the authentication domain, after users are redirected to the specified portal server address when they access an external network for the first time, they will be forcibly redirected to the same portal server address for the number of times specified by the "portal-server redirect-limit <limit>" command. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The auto save feature supports only Layer 2 DHCPv4 users who access the network in non-authentication and non-accounting modes. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| VPN instances can be dynamically delivered for IPoEv4 Layer 3 static users.  1. Only GE, Eth-Trunk, and VE interfaces are supported. PW-VE interfaces are not supported.  2. RUI is not supported.  3. Only IPv4 Layer 3 static users are supported.  This may lead to:  1. After this feature is enabled, Layer 3 static users fail to go online through a PW-VE interface if a VPN instance is delivered by the RADIUS server.  2. After this feature is enabled, Layer 3 static users are allowed to go online in RUI scenarios. If the VPN instance delivered by the RADIUS server is the same as the interface VPN instance, user information can be backed up to the backup device. If they are inconsistent, user information cannot be backed up. To ensure that the VPN instances on the master and backup devices are the same, the VPN instance of a Layer 3 static user cannot be changed through a CoA message for an RUI user. If the VPN instance of a Layer 3 static user is changed through a CoA message, the CoA message does not take effect.  3. IPv6 Layer 3 static users do not support this feature. If the VPN instance delivered by the RADIUS server is different from the interface VPN instance, the users fail to go online. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. In DHCPv6 protocol interaction, only advertise and reply packets carry DHCPv6 options delivered by the RADIUS server, and other packets do not carry DHCPv6 options.  2. A maximum of eight DHCPv6 options can be delivered.  3. Options can be delivered only in an authentication response packet, but not in a CoA packet. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| WLAN user roaming supports only IPoEv4/v6 users (including static users with proactive detection are configured).  Properly plan services when deploying roaming. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Roaming between different interface types is not supported. There are restrictions on roaming between different interface types. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. WLAN user roaming cannot be configured together with one-to-many mapping between one MAC address and many sessions for IPoE access services.  2. WLAN user roaming cannot be deployed together with DHCP lease proxy.  3. WLAN user roaming cannot be deployed together with dual-device hot backup.  Properly plan services when deploy roaming. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Static users do not support multiple next hops. When the next hop of a static route is a user, route load balancing is not supported.  Do not configure static routes with the next hops pointing to static users for load balancing. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If a Layer 3 DHCPv6 user goes online by sending a DHCPv6 packet carrying IA\_NA, IA\_PD, or IA\_NA+IA\_PD, the user cannot be directly connected to a BAS device and must be connected to a Layer 3 device.  If a client uses a method other than LLT or LL to generate a DUID, the first-hop relay agent must use DHCPv6 Option 37 to send the client's MAC address to the BRAS for user access. Otherwise, user access is not supported.  As such, IPv6 clients are required obtain IPv6 addresses using DHCPv6. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Flexible access to a VPN supports only PPPoEv4 users and Layer 2 dynamic and static IPoEv4 users. When unsupported users go online, this feature does not take effect. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| DHCPv6 Option 16 can be sent to the RADIUS server:  1. Only IPoE DHCPv6 users are supported.  2. This option can be carried only in authentication request packets, but not in accounting request packets.  This may lead to:  1. RADIUS authentication has been performed during PPPoE authentication. Therefore, subsequent PPPoE Solicit packets carrying the option corresponding to the radius-attribute include hw-dhcpv6-option configuration will not be sent to the RADIUS server.  2. The DHCPv6 option can be carried only in authentication request packets, but not in accounting request packets. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If DHCP proxy is disabled (using the undo dhcp-proxy enable command), clients' Request messages (including Renew, Rebind, and Release messages) may be denied and discarded. To resolve this issue, Lease renewal and release packets are discarded. As a result, the client goes offline only when the lease expires. A UCL rule needs to be configured to allow such packets destined for a DHCP server to pass. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Separate collection of statistics about IPv4 and IPv6 traffic is not supported for Layer 3 leased line users.  It is recommended that separate accounting be disabled for Layer 3 leased line dual-stack users. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the function of triggering user logouts upon Option 82 information changes is enabled using the dhcp option82-mismatch action offline command, the following problems occur for users who go online in autosave mode:  (1) When the client-option82 basinfo-insert cn-telecom command is run to configure a device to encapsulate access-line-id information in the telecom format, if the length of the Option 82 field generated based on the format exceeds 255 bytes, the device truncates part of the Option 82 field to meet the maximum length requirement. For users who go online in autosave mode, the Option 82 information generated by the device based on the format is used for comparison. When the Option 82 information of a user changes, the Option 82 information may be truncated because the generated Option 82 information is too long. As a result, the device may fail to compare the Option 82 information.  (2) When the client-option82 basinfo-insert version3 command is run to configure the device to encapsulate access-line-id information in version 3 format and the length of the Option 82 field generated based on the format exceeds 200 bytes, the device truncates part of the Option 82 field to meet the maximum length requirement. For users who go online in autosave mode, the Option 82 information generated by the device based on the format is used for comparison. When the Option 82 information of a user changes, the Option 82 information may be truncated because the generated Option 82 information is too long. As a result, the device may fail to compare the Option 82 information. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Accounting stop packets of IPoE dual-stack users cannot carry all IP addresses of the users in the following scenarios. If these scenarios are not supported, RADIUS source tracing cannot be used to trace the addresses used by the users.  1. IPv6 ND shared addresses assigned to users that have gone offline earlier cannot be carried.  2. The IPv6 NA (EUI-64) addresses assigned to users that have gone offline earlier cannot be carried.  3. This function cannot be used together with DUID address reservation.  4. The address obtained from an IPv4/IPv6 dynamic address pool cannot carry an offline address.  5. The address obtained from an IPv4/IPv6 remote address pool cannot carry an offline IP address.  6. If the IPv4/IPv6 address of an online user changes, the original address cannot be carried.  7. This function cannot be used together with the inter-chassis address borrowing feature.  8. This function cannot be used together with DHCPv6 address allocation based on circuit IDs or remote IDs. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If a user is triggered to go online within 2 hours after a device restarts and the packets sent by the user do not carry Option 82 information, the user fails to go online or the first lease renewal fails.  Plan services properly. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a leased line user sends Framed-Route attribute, user-to-network traffic does not support source IP address check (URPF).  Do not enable a leased line user to deliver the Framed-Route attribute if you have high requirements for source IP address check. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| HTTPS redirection in RUI scenarios:  a. The HTTPS redirection function is related only to the local configuration. Therefore, the HTTPS configurations on the master and backup devices must be the same. Otherwise, the behavior may be inconsistent after an active/standby switchover.  b. Redirection information is not backed up to the backup device. Therefore, if an active/standby switchover occurs during the redirection process (including the process in which the client establishes a connection with the device and the device pushes redirection information to the client), the client needs to re-establish a connection with the device after the switchover. | NE40E-M2 | NE40E-M2K/NE40E-M2K-B |
| HTTP Strict Transport Security (HSTS) does not allow users to ignore warnings. Therefore, browsers or websites that execute HSTS do not support HTTPS redirection. | NE40E-M2 | NE40E-M2K/NE40E-M2K-B |
| HTTPS redirection supports request packets whose destination port is well-known port 443. If the destination port is not 443, HTTPS redirection cannot be performed. | NE40E-M2 | NE40E-M2K/NE40E-M2K-B |
| HTTPS redirection does not support forcible push. (A user is redirected to the authentication page. After the user passes authentication, the specified URL is forcibly pushed to the user when the user accesses the network for the first time.) | NE40E-M2 | NE40E-M2K/NE40E-M2K-B |
| When the link address configured using the link-address command is used as the source IP address and the polling mode is configured for the DHCPv6 server group:  1. If multiple DHCPv6 servers are configured in a DHCPv6 server group, and some DHCPv6 servers belong to the same VPN instance as the user and some do not belong to the same VPN instance as the user, the VPN instance carried in the response packet sent by the DHCPv6 server to the BRAS is the user's VPN instance. Therefore, the user considers that: The DHCPv6 server that belongs to the same VPN as the user is reachable and is recorded in the DHCPv6 server information in the user table. When the BRAS receives a renewal packet, it uses the DHCPv6 server information recorded in the user entry to send a packet to the DHCPv6 server. If the DHCPv6 server is unreachable, the renewal fails. In this case, the BRAS needs to send a rebind packet to renew the lease.  2. If multiple DHCPv6 servers are configured in a DHCPv6 server group and the VPNs to which the DHCPv6 servers belong are different from the VPNs to which users belong, the response packets sent by the DHCPv6 servers to the BRAS carry the users' VPNs, the BRAS matches the user's VPN instance in the response packet with the VPN instance on the DHCPv6 server. The VPN instance on the BRAS is different from that on the DHCPv6 server. As a result, the user fails to go online.  The preceding implementation affects user access and lease renewal in the DHCPv6 server group working in polling mode.  It is recommended that the DHCPv6 server and the user be configured with the same VPN or only one DHCPv6 server be configured in a DHCPv6 server group. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Only the following commands take effect for DHCPv6 lease proxy users in real time. The other commands take effect only after the original T1/T2 lease renewal packets are sent to the remote or local server for processing.  (1) The dhcpv6 user-identify-policy command run on the user access BAS interface  (2) The trust 8021p-protocol command run on the user access BAS interface  (3) The 8021p <8021p-value> command run on the user access interface or on the main interface of the user access sub-interface  (4) The ipv6 link-loca command run on the user access interface | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After a user switches to the authentication domain and obtains IPv6 authorization, if the client cannot automatically dial up through the IPv6 stack, the client may fail to obtain an IPv6 address and cannot access the network through IPv6. In this case, external methods (such as disconnecting the network, restarting the network adapter, restarting the computer, and running commands) are required. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The IPv6 address delivered by the RADIUS server cannot be the same as the IPv6 address configured on any interface. Otherwise, the downstream traffic of the user fails to be forwarded, affecting the forwarding of a single user.  You are advised to plan the configuration properly. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function to carry all IP addresses that have been assigned to an IPoE user (including the IP addresses of offline stacks) in an Accounting Stop packet is not supported (that is, the addresses used by a user cannot be source traced through RADIUS) in the following scenarios:  (1) The IPv6 ND shared addresses used by offline stacks cannot be carried.  (2) The IPv6 NA (EUI-64) addresses used by offline stacks cannot be carried.  (3) This function cannot be used together with DUID-based address reservation.  (4) The addresses obtained from an IPv4/IPv6 dynamic address pool used by offline stacks cannot be carried.  (5) The addresses obtained from an IPv4/IPv6 remote address pool used by offline stacks cannot be carried.  (6) If the IPv4/IPv6 addresses of online users change, the original addresses cannot be carried.  (7) This function cannot be used together with inter-chassis address unnumbered.  (8) This function cannot be used together with circuit ID/remote ID-based address allocation through DHCPv6. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In cn-telecom Option 82 replacement mode, when RUI is configured, only DHCPv6 users who have a level-1 relay agent in the upstream of a BRAS are supported. When multiple levels of relay agents are connected to a BRAS and a user proactively goes offline from the BRAS, an inconsistency occurs on the number of relay header levels carried in the Release packets constructed by the master and backup RUI devices and destined for the DHCPv6 server. If the outer relay header of a DHCPv6 packet received by the BRAS does not carry the Option 18 information but the inner relay header carries the Option 18 information, the RADIUS NAS-PORT-ID (No. 87) attributes constructed by the master and backup devices are inconsistent, and the Option 18 information constructed in the outer relay header of DHCPv6 packets sent to the DHCPv6 server is inconsistent.  You are advised to properly plan relay information. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After an IPoE/IPoEv6 user goes online, changing the system time may cause the user's lease to expire. As a result, the user is logged out.  After an IPoE/IPoEv6 lease proxy user goes online, if the system time is adjusted forward, the proxy lease of the user may expire. As a result, the user is logged out.  If a user needs to go online after going offline, the user needs to dial up again or be triggered to go online through IP/ARP/IPv6/ND packets. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. The function to log out an online user when a new user in the same VLAN goes online from the same BAS interface takes effect only after the client-replace enable and access-limit 1 commands are run. This function takes effect for subsequent users.  2. After the function to log out an online user when a new user in the same VLAN goes online from the same BAS interface is enabled, if an unauthorized user in the same VLAN keeps dialing up on the BAS interface, the unauthorized user can log out an authorized user. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Restrictions on the function to log out an online user when a new user in the same VLAN goes online from the same BAS interface:  For dual-stack users, if only one stack has specific configuration, the system considers that this function is not enabled for the user if the user goes online from the other stack first. As a result, the existing user cannot be logged out when this new user requests to log in.  Therefore, if this function is enabled for IPoE dual-stack user access and specific configuration exists on the interface, ensure that the following configurations coexist:  access-limit xx start-vlan xx [end-vlan xx] [qinq xx] user-type ipoe ipv4  access-limit xx start-vlan xx [end-vlan xx] [qinq xx] user-type ipoe ipv6 | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| RIP can be enabled on a BRAS interface to advertise routes to a CPE for Layer 2 DHCP user access. The restrictions are as follows:  1. After the rip over ipoe command is run on an interface, if no new borrowed IP address is configured, the IPv4 protocol on the BAS interface goes down, and all IPv4 users cannot go online.  2. The IP addresses assigned to users and the IP address of the BAS interface must be on the same network segment so that the users can learn network-side routes advertised by RIP.  3. After the ip unr remote-pool-tag command is run in the system view, the command does not take effect for the route tag of the remote address pool with gateway unnumbered configured.  4. When a VPN instance is bound to a remote address pool, the VPN instance must be the same as that bound to the loopback interface with gateway unnumbered configured. Otherwise, gateway unnumbered does not take effect.  5. The gateway addresses in different address pools must be unique. As such, each address pool must be configured with a loopback interface, and each interface can be bound to only one remote address pool with gateway unnumbered configured.  6. The number of leaf tables on the device is limited. If too many sub-interface VLANs are configured and leaf resources are exhausted (the number of leaf tables used for protocol hardware replication is greater than 32K), the HWMC leaf is rolled back. As a result, RIP packets cannot be replicated in the VLAN segment. If the HWMC leaf of an interface has been rolled back, the HWMC function cannot be restored on the interface unless the VLAN on the interface is deleted and reconfigured, or the interface is deleted and reconfigured.  7. RIP can be enabled on a maximum of 500 interfaces on a device. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the access-limit 1 command is run, restrictions on the function to log out an online user when a new user in the same VLAN goes online from the same BAS interface are as follows:  1. In dual-device hot backup scenarios, the configurations on the master and backup devices must be consistent.  2. In the dual-device hot backup non-load balancing scenario, a user goes online from the master device but is not triggered to go online from the backup device. In this case, if a master/backup device switchover occurs and the CPE updates its MAC address, the CPE may need to dial up multiple times for a successful login. In the dual-device hot backup load balancing scenario, the CPE may need to dial up multiple times for a successful login after updating its MAC address.  Cause: When an online user is waiting to be triggered to go online from the backup device, a master/backup device switchover is performed, and the user uses a different MAC address for dialup. The backup device becomes the master device. After receiving a new login request from the user, the device logs out the new user when the existing user is triggered to go online. The new user needs to dial up again to log out the existing user before the new user can log in. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Among physical interfaces, 40GE interfaces (interface 40GE x/x/x or interface 40GE x/x/x/x) do not support BRAS access. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Functions that are not supported by IPoE user access:  Addresses delivered by the RADIUS server for IPoE users cannot be reserved. | NE40E-M2 | NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |