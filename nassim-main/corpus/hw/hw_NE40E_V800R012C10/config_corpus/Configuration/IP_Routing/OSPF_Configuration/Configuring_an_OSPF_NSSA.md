Configuring an OSPF NSSA
========================

Configuring a non-backbone area on the border of an AS as an NSSA can reduce entries in the routing table and the amount of routing information to be transmitted. This section describes how to set the cost of the default route to an NSSA and adjust the selection of the default route.

#### Usage Scenario

An excessive number of entries in a routing table wastes network resources and causes high CPU usage. To reduce entries in a routing table, configure a non-backbone area on the border of an AS as a stub area or an NSSA to reduce the amount of routing information to be transmitted. For details on how to configure an OSPF stub area, see [Configuring an OSPF Stub Area](dc_vrp_ospf_cfg_2046.html).

An OSPF Not-So-Stubby Area (NSSA) is a special OSPF area. Similar to a stub area, an NSSA does not transmit external routes from other areas on an OSPF network. The difference is that the stub area cannot import external routes, whereas the NSSA can import AS external routes and advertise them in the entire OSPF AS.

As defined in OSPF, stub areas cannot import external routes. If external routes need to be imported and the resource consumption caused by external routes needs to be avoided, stub areas cannot meet the requirements. In this case, you can configure these areas as NSSAs.

Type 7 link state advertisements (LSAs) are used to carry imported AS external routes in the NSSA. Type 7 LSAs are generated by ASBRs of NSSAs and flooded only in the NSSAs where ASBRs reside. The ABR in an NSSA selects Type 7 LSAs from those received, and translates them into Type 5 LSAs in order to advertise external routes to other areas over the OSPF network.

![](../../../../public_sys-resources/note_3.0-en-us.png) 

* A Type 7 LSA was introduced to support NSSAs and describe imported external routes.
* Default routes can also be represented by Type 7 LSAs to guide traffic to other ASs.

To configure an area as an NSSA, configure NSSA attributes on all the Routers in this area.


#### Pre-configuration Tasks

Before configuring an OSPF NSSA, complete the following tasks:

* Configure an address for each involved interface to ensure that neighboring devices can communicate with each other at the network layer.
* [Configure basic OSPF functions](dc_vrp_ospf_cfg_0003.html).

#### Procedure

1. Run [**system-view**](cmdqueryname=system-view)
   
   
   
   The system view is displayed.
2. Run [**ospf**](cmdqueryname=ospf) [ *process-id* ]
   
   
   
   The OSPF view is displayed.
3. Run [**area**](cmdqueryname=area) *area-id*
   
   
   
   The OSPF area view is displayed.
4. Run [**nssa**](cmdqueryname=nssa) [ { **default-route-advertise** [ **backbone-peer-ignore** ] } | **no-import-route** | **no-summary** | **set-n-bit** | **suppress-forwarding-address** | **translator-always** | **translator-interval** *interval-value* | **zero-address-forwarding** ] \*
   
   
   
   The area is configured as an NSSA.
   
   
   
   ![](../../../../public_sys-resources/note_3.0-en-us.png) 
   * NSSA attributes must be configured on all Routers in the NSSA using the [**nssa**](cmdqueryname=nssa) command.
   * Configuring or deleting NSSA attributes may trigger area update and neighbor relationship interruption. You can perform the configuration again or cancel the configuration only after the last area update is complete.
   
   The parameters in the [**nssa**](cmdqueryname=nssa) command are used in the following scenarios:
   
   * The **default-route-advertise** parameter is used to generate default Type 7 LSAs on the ABR or ASBR and advertise them to the NSSA.
     
     The conditions for generating default Type 7 LSAs and advertising them to the NSSA are as follows:
     
     1. Neighbors in Full state and interfaces in Up state must exist in the backbone area.
     2. The **default-route-advertise** parameter is configured.
     3. Other default routes (destined for 0.0.0.0) exist in the local routing table.
     
     If condition 1 is met, the ABR can generate default Type 7 LSAs and advertise them to the NSSA. If conditions 2 and 3 are met, the ASBR can generate default Type 7 LSAs and advertise them to the NSSA.
   * The **backbone-peer-ignore** parameter is used to ignore the check on the neighbor status in the backbone area. That is, the ABR automatically generates default Type 7 LSAs and advertises them to the NSSA as long as an interface that is Up exists in the backbone area, regardless of whether a neighbor in the Full state exists.
   * If an ASBR also functions as an ABR, specifying **no-import-route** prevents OSPF from advertising the external routes imported using the [**import-route**](cmdqueryname=import-route) command to the NSSA.
   * To reduce the number of LSAs to be transmitted to the NSSA, specify **no-summary** on an ABR. This prevents the ABR from transmitting Summary LSAs (Type 3 LSAs) to the NSSA.![](../../../../public_sys-resources/note_3.0-en-us.png) 
     
     After the [**nssa**](cmdqueryname=nssa) **default-route-advertise** **backbone-peer-ignore** **no-summary** command is run, the ABR generates both the default Type 7 LSA and default Type 3 LSA as long as the backbone area contains interfaces that are up, regardless of whether neighbor relationships in Full state exist. In this case, the default Type 3 LSA preferentially takes effect.
   * After the **set-n-bit** parameter is set, the N-bit is set in the DD packets during the synchronization between the Router and neighboring Router.
   * The **suppress-forwarding-address** parameter sets the forwarding address (FA) of the Type 5 LSAs translated by the NSSA ABR to 0.0.0.0.
   * If there are multiple ABRs in an NSSA, the system automatically selects an ABR as the translator according to certain rules (generally, the device with the largest router ID is selected in the NSSA) to translate Type 7 LSAs into Type 5 LSAs. You can configure the **translator-always** parameter on an ABR to specify the ABR as an all-the-time translator. To allow two ABRs to participate in load balancing, configure **translator-always** on the ABRs. You can use this command to pre-configure a fixed translator to prevent LSA flooding caused by translator role changes.
   * To ensure service continuity during translator switching, specify the **translator-interval** parameter. The value of *interval-value* must be greater than the flooding interval.
   * The **zero-address-forwarding** parameter is used to set the FA of the generated NSSA LSAs to 0.0.0.0 when external routes are imported to the ABR in an NSSA.
5. (Optional) Run [**default-cost**](cmdqueryname=default-cost) *cost*
   
   
   
   The cost of the default route corresponding to Type 3 LSAs that are transmitted by the ABR to the NSSA is set.
   
   To ensure the reachability of AS external routes, the ABR in the NSSA generates a default route and advertises it to other Routers in the NSSA. Setting the cost helps control route selection.
6. Run [**commit**](cmdqueryname=commit)
   
   
   
   The configuration is committed.

#### Verifying the Configuration

* Run the [**display ospf**](cmdqueryname=display+ospf) [ *process-id* ] **lsdb** [ **brief**] command to check OSPF LSDB information.
* Run the [**display ospf**](cmdqueryname=display+ospf) [ *process-id*] **routing** command to check information about the OSPF routing table.

* Run the [**display ospf**](cmdqueryname=display+ospf) [ *process-id* ] **interface** command to check OSPF interface information.