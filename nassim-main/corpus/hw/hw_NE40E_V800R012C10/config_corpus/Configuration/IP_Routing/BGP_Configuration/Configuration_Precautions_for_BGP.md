Configuration Precautions for BGP
=================================

Configuration Precautions for BGP

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| BGP IPv4 unicast, BGP VPNv4, and BGP EVPN IPv4 peers cannot receive routes with IPv6 next hops. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Before enabling the Add-Path function, you need to set the number of paths for use according to the actual requirement. The maximum number of paths cannot be set; otherwise, memory resources may be exhausted. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The protocol defines the prefix limit. Currently, the EVPN/VPN4/VPN6/L2VPN-AD/MVPN/SRv6 Policy IRT is saved together regardless of the address family. The implementation is the same as that in the protocol. This rule may cause all RT filters in the EVPN/VPNv4/VPNv6/L2VPN-AD/MVPN/SRv6 Policy address family to take effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| An EVPN RR cannot reflect routes learned from IPv4 peers to IPv6 peers. Similarly, an EVPN RR cannot reflect routes learned from IPv6 peers to IPv4 peers. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If a feature is not configured for a peer or the default value is configured for the peer, and then the peer is added to a peer group which has a non-default value of the feature configured, the peer inherits the feature configuration from the peer group.  If a peer in a peer group has the same configuration of a feature with the peer group, and then the feature is modified for the peer group, the feature configuration of the peer changes accordingly.  If a peer in a peer group and the peer group have different configurations of a feature, and then the feature is modified for the peer group, the feature configuration of the peer remains inconsistent with that of the peer group. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the AS-SET parameter is configured during route summarization, the AS\_Path attributes of all specific routes with the same sequence number form AS\_SEQUENCE, and the other ASs form AS\_SET, which is used as the AS\_Path attribute of the summarized route. The number of AS\_Path attributes after aggregation cannot exceed 2000. Otherwise, the AS\_Path attribute is set to null. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a scenario where a BGP IPv4 VPN unicast route is iterated to an MPLS local IFNET tunnel, the tunnel ID in the FIB table is different from that in the IP routing table. The tunnel ID in the FIB table does not carry a VPN instance ID, and the tunnel ID in the IP routing table is used. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The peer allow-as-loop command enables BGP to check the count of the local AS number in the routes received from EBGP peers or confederation EBGP peers. The command does not apply to IBGP peers or confederation IBGP peers. If the command is not run, the implementation is equivalent to the peer allow-as-loop 0 configuration. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| EBGP peers do not support the following features: Route reflector, Best-external, Add-path.  IBGP peers do not support the following features: EBGP-max-hop, MPLS local IFNET, Fake AS.  Feature exclusiveness: The ebgp-max-hop and valid-ttl-hops functions are mutually exclusive. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| To advertise default routes, you need to run both the default-route imported and import-route commands. If either command is not run, default routes cannot be advertised even when they are available in the routing table. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The undo peer x.x.x.x group command keeps the behavior of the peer unchanged before and after the operation, instead of removing the peer from the group. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BGP routes cannot be iterated to SRv6 BE routes. After iteration, the routes are inactive. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| (1) Configuration restrictions:  A maximum of 100 regions can be configured in a VS.  A maximum of 100 ASs can be configured in a region, regardless of 4-byte or 2-byte ASs.  A maximum of 100 regional confederations can be configured in a VS, and a maximum of 100 regions can be configured in a regional confederation.  An AS cannot be added to different regions repeatedly. (The display format is not affected. For example, 1.0 and 65536 are the same AS.)  A region cannot be added to different regional confederations repeatedly. When a region is added to a regional confederation, the region must exist.  If a region has been added to a regional confederation, the region information in the regional confederation is also deleted when the region is deleted.  (2) Regional validation depends on the reliability of the origin AS in the route. In actual applications, the RPKI ROA function must be deployed together with regional validation to ensure the correctness of the origin AS in the route.  (3) The regional validation configuration is a global configuration. The scenario where the ASs of the public and private networks overlap is not considered.  (4) Regional validation can be enabled only in the address family view. Regional validation cannot be enabled or disabled for a single peer. Currently, the following address families are supported:  IPv4 unicast address family/IPv6 unicast address family/VPN instance IPv4 address family/VPN instance IPv6 address family/VPN instance IPv4 address family in BGP multi-instance. Labeled routes in the IPv4/IPv6 unicast address family support regional validation.  (5) Regional validation must be configured on the border router that is directly connected to the external domain router. Internal risky routes cannot be identified.  (6) When the import policy (for example, AS modification) is configured together with the regional validation function, the regional validation check is performed before the import policy takes effect (after the ROA validation).  (7) Regional validation affects the route learning performance of EBGP peers (the learning performance decreases by no more than 5% after regional validation is configured), but does not affect the convergence performance, RR reflection performance, or IBGP peer route learning performance. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The route-policy with the apply cost-type med-inherit-aigp configuration takes effect on IPv4 or IPv6 VPN routes. The AIGP attributes of the VPN routes are advertised by PEs to CEs through the MED attribute. The route-policy does not take effect in other address families. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Currently, among the 11 types of segments specified in the protocol, only Type 1 SIDs (MPLS label SIDs) and Type 2 SIDs (IPv6 address SIDs) are supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a public network IP over SRv6 TE Policy scenario, mirror-SID-based egress protection and service FRR-based egress protection are not supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| For a peer in the SR-MPLS TE Policy address family, if the configured routing policy contains if-match ip-prefix/acl/rd-filter, the route is matched. This is because the IP prefix, ACL, or RD filter cannot be used for matching for NLRI in the SR-MPLS TE Policy address family. If the if-match as-path or cost command is configured in the routing policy, the routing policy is matched only when the matching conditions are met.  You are advised to properly plan routing policies and do not use unsupported matching modes. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Load balancing is not supported between MPLS and SRv6 tunnels. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Only BGP IPv4 public network unicast routes, BGP IPv4 VPN remotely leaked routes, BGP IPv4 public network labeled routes (6PE), and BGP IPv6 VPN remotely leaked routes can be recursed to SR-MPLS TE Policies using nexthop+color.  You are advised to plan tunnel-policy and tunnel-selector properly. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| By default, static routes cannot be iterated to SRv6 BE routes. After the ip route-static recursive-lookup inherit-label-route segment-routing-ipv6 command is run, static routes can be iterated to SRv6 BE routes. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BGP IPv4 public network unicast routes, BGP IPv4 VPN remote cross routes, BGP IPv6 public network labeled routes, and BGP IPv6 VPN remote cross routes that can be recursed to SR-MPLS TE Policy tunnels carry multiple color extended community attributes, only the largest color value is used to recurse routes to SR-MPLS TE Policy tunnels. If the CO flag (defined in draft-ietf-idr-segment-routing-te-policy) of a received route is any value, the route is processed as 00.  You are advised to properly plan the color attribute added to routes on the egress node. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The function that DX4 SIDs are applied for BGP public network IPv4 routes based on the next hop and the add-path function are mutually exclusive. If the add-path function is enabled first, a DX4 SID will not be applied for. If a DX4 SID is obtained before the add-path function is enabled, the obtained DX4 SID is released. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After a route is imported between VPN and public network instances, the next hop or color extended community attribute of the route cannot be changed through a route-policy.  Properly plan the route-policy to be used during the route import between VPN and public network instances. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| IPv4 and IPv6 neighbor functions cannot be enabled at the same time in the VPNv4 address family. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Scenario 1: The as-number command is run in the BGP-VPN instance IPv4 address family view and BGP-VPN instance IPv6 address family view to configure a private AS number, and the bgp yang-mode enable command is run to configure the YANG management mode for the BGP VPN instance.  Restrictions:  1. After the bgp yang-mode enable command is run, the sequence of the peer as-number and as-number commands in the configuration file changes. As a result, the configurations fail to be pasted. To solve this problem, configure a private AS number and then run other commands.  2. BGP peer relationships cannot be enabled in the BGP-Flow VPN instance IPv4 address family view, BGP-Flow VPN instance IPv6 address family view, or BGP-Labeled-VPN instance IPv4 address family view. VPN IPv4 peers cannot be enabled in the BGP-VPN instance IPv6 address family view.  3. Before deleting a VPN AS number, delete the peers or peer groups in the VPN address family and the peers in the BGP-VPN instance view.  4. Before running the undo bgp yang-mode enable command, delete the private AS number.  Scenario 2: A private AS number is configured in the BGP-VPN instance IPv4 address family view and BGP-VPN instance IPv6 address family view, and the YANG management mode is configured for the BGP VPN instance, and then the YANG management mode is disabled.  Restrictions:  1. After the bgp yang-mode enable command is run, the sequence of the peer as-number and as-number commands in the configuration file changes. As a result, the configurations fail to be pasted. You can run the peer as-number command in the BGP-VPN instance IPv4 address family view or BGP-VPN instance IPv6 address family view to configure a new peer or peer group. However, you cannot configure a new peer or peer group in the BGP-VPN instance view.  2. BGP peer relationships cannot be enabled in the BGP-Flow VPN instance IPv4 address family view, BGP-Flow VPN instance IPv6 address family view, or BGP-Labeled-VPN instance IPv4 address family view. VPN IPv4 peers cannot be enabled in the BGP-VPN instance IPv6 address family view.  3. Before deleting a private AS number, delete the peers or peer groups in the VPN address family and the peers in the BGP-VPN instance view.  Note: The address families listed in this restriction are all restricted BGP address families. The actual address families depend on the address family capabilities supported by the device. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Pay attention to the following points when using BGP EPE:  1. Confederation Member ASN is not supported.  2. Peer groups cannot be enabled.  3. Only node labels are generated for directly connected EBGP peers. Adjacency labels are not generated.  4. BGP EPE takes effect only after the BGP-LS address family is enabled.  5. BGP EPE supports only two directly connected devices, and multi-hop EBGP supports only two directly connected devices.  6. BGP EPE label forwarding takes effect only after segment routing is enabled in the system view.  7. When the next hop to which the BGP EPE peer address is recursed is an IPv6 address, no link route is generated. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After the peer fake-as command is run and the prepend-fake-as or prepend-global-as parameter is modified, the BGP peer relationship is reestablished. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If IPv6 routes received from IPv6 peers recurse to 6PE routes, the Pop-Go forwarding mode is not supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The second carrier accesses the first carrier in IGP+LDP mode. Load balancing or FRR from the second carrier to the first carrier is not supported: 1->n+1. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The original community value contained in all BGP public network routes on the device is different from the community value configured for the peer. Otherwise, the original community will be replaced or routes will be incorrectly filtered. The community value must be unique and depends on the overall network planning. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| During BGP peer relationship establishment, specifying the local address is only optional. Therefore, when binding a TWAMP Light test instance to a connection based on the virtual link of the peer, the device cannot check whether the local and remote addresses of the peer match those of the TWAMP Light test instance. However, the generated link routes do not contain delay information. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In BGP EPEv6 scenarios, only End/End.X SIDs support compression. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| UNRs do not support POPGO. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. If a device on the looped path does not support loop detection or is not enabled with loop detection, the low priority of the looped route may be lost. As a result, the loop cannot be eliminated.  Workaround: Ensure that loop detection is enabled on each device on the looped path and the number of devices on the looped path does not exceed four.  Impact: The loop detection function does not take effect.  2. If the local preference or MED of a looped route is reduced and then changed to another value using a route-policy, the priority of the looped route cannot be reduced. As a result, the loop cannot be eliminated.  Workaround: Do not use a route-policy to modify the local-preference or MED of the looped route.  Impact: The loop detection function does not take effect.  3. If the priority of the original route is the lowest, the priority cannot be reduced to eliminate the loops.  Workaround: None  Impact: The loop detection function does not take effect.  4. After the clear route loop-detect bgp alarm command is executed, the switchover is performed immediately. Some looped route records may not be cleared. In this case, you need to run the command again to clear the alarm.  Workaround: None  Impact: Even if a route does not carry the loop attribute, the route is incorrectly considered as a looped route. As a result, the route is never selected.  5. The maximum number of looped routes that can be recorded is controlled by the PAF file. Excess looped routes are not recorded. As a result, loops may fail to be removed for some routes.  Workaround: None  Impact: The loop detection function does not take effect.  6. The loop attribute values of BGP/IS-IS/OSPF are randomly generated. There is a low probability that the random numbers of different devices are the same. As a result, the loop attributes of BGP and BGP, IS-IS/OSPF and IS-IS/OSPF, and BGP and IS-IS/OSPF are the same, which may cause misjudgment of looped routes.  Workaround: None  Impact: Looped routes are incorrectly determined.  7. If both a source route and a looped route exist on a device and the source route is deleted, the looped route may be preferentially selected. In this case, enabling loop detection cannot prevent loops, and looped routes cannot be withdrawn.  Workaround: If both source routes and looped routes exist on a device, remove the loop first and then delete the routes.  Impact: The looped route flaps on the looped path, and the route cannot be withdrawn after a loop occurs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If no public SID is carried, SRv6 BE escape cannot be performed when BGP public network IPv6 over SRv6 TE Policy/SRv6 TE Flow Group (USD-capable tunnels) are used. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| ROA verification is not performed on the routes received from IBGP peers and locally imported routes. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |