Configuring IS-IS Auto FRR
==========================

This section describes how to configure IS-IS Auto FRR.

#### Usage Scenario

As networks develop, services such as voice over IP (VoIP) and online video services have higher requirements for real-time transmission. On a live network, to switch traffic to a new link after a failure occurs, IS-IS must complete a series of operations involving failure detection, LSP update, LSP flooding, route calculation, and FIB entry delivery. This is a lengthy process, in which the traffic interruption time is much longer than 50 ms. As a result, the requirements for real-time transmission cannot be met.

With IS-IS Auto FRR, devices can rapidly switch traffic from a faulty link to an alternate one without interrupting the traffic, which significantly improves IS-IS network reliability.

IS-IS Auto FRR is suitable for IP services that are sensitive to delay and packet loss.


#### Pre-configuration Tasks

Before configuring IS-IS Auto FRR, complete the following tasks:

* Configure addresses for interfaces to ensure that neighboring devices are reachable at the network layer.
* [Configure basic IPv4 IS-IS functions](dc_vrp_isis_cfg_1000.html).
* [Configure a local LDP session](dc_vrp_ldp-p2p_cfg_0003.html) on the source node, the PQ node, and the nodes between them if remote LFA FRR is required.

#### Procedure

1. Run [**system-view**](cmdqueryname=system-view)
   
   
   
   The system view is displayed.
2. Run [**isis**](cmdqueryname=isis) [ *process-id* ]
   
   
   
   An IS-IS process is created, and the IS-IS view is displayed.
3. Run [**frr**](cmdqueryname=frr)
   
   
   
   The IS-IS FRR view is displayed.
4. (Optional) Run [**ecmp disable**](cmdqueryname=ecmp+disable) { **level-1** | **level-2** }
   
   
   
   IS-IS ECMP FRR is disabled.
   
   
   
   With ECMP FRR,
   IS-IS pre-calculates backup paths for load balancing links based on
   the LSDBs on the entire network. The backup paths are stored in the
   forwarding table and are used for traffic protection in the case of
   link failures. If the network topology changes, ECMP FRR triggers
   calculation of new backup paths, which increases the system calculation
   pressure. In addition, the backup entries generated by the ECMP FRR
   function increase the memory usage of the system. In this case, you
   can run the **ecmp disable** command to disable the
   ECMP FRR function.
5. Run [**loop-free-alternate**](cmdqueryname=loop-free-alternate) [ **level-1** | **level-2** | **level-1-2** ]
   
   
   
   IS-IS Auto FRR is enabled to generate a loop-free backup link.
   
   
   
   If no level is specified, IS-IS Auto FRR is enabled for Level-1 and Level-2 to generate backup routes.
   
   ![](../../../../public_sys-resources/note_3.0-en-us.png) 
   
   IS-IS can create loop-free backup links only if the traffic protection inequality of IS-IS Auto FRR is met.
6. (Optional) Run [**frr-policy route**](cmdqueryname=frr-policy+route) **route-policy** *route-policy-name*
   
   
   
   A route-policy is configured to filter backup routes so that only the matched backup routes are added to the routing table.
7. To enable remote LFA Auto FRR, perform the following steps:
   1. Run [**remote-lfa**](cmdqueryname=remote-lfa) **tunnel** **ldp** [ **maximum-reachable-cost** *cost-value* ] [ **level-1** | **level-2** | **level-1-2** ]
      
      
      
      Remote LFA Auto FRR is enabled.
   2. (Optional) Run [**remote-lfa available-tunnel-destination**](cmdqueryname=remote-lfa+available-tunnel-destination) **ip-prefix** *ip-prefix-name* [ **level-1** | **level-2** | **level-1-2** ]
      
      
      
      A filtering policy is configured to filter PQ nodes.
      
      
      
      Only the PQ node that matches the filtering policy can be used as the next hop of an LFA link.
   3. Run [**quit**](cmdqueryname=quit)
      
      
      
      Return to the IS-IS view.
   4. (Optional) Run [**avoid-microloop frr-protected**](cmdqueryname=avoid-microloop+frr-protected)
      
      
      
      The IS-IS anti-microloop function is enabled.
   5. (Optional) Run [**avoid-microloop frr-protected rib-update-delay**](cmdqueryname=avoid-microloop+frr-protected+rib-update-delay) *rib-update-delay*
      
      
      
      The delay after which IS-IS delivers routes is configured.
      
      
      
      If IS-IS remote LFA FRR is enabled and the primary link fails, traffic is switched to the backup link. If route convergence occurs again, traffic is switched from the backup link to a new primary link. During the switchover, microloop may occur. To prevent this problem, IS-IS anti-microloop is enabled can be used to delay the switching. To configure the delay, run the [**avoid-microloop frr-protected rib-update-delay**](cmdqueryname=avoid-microloop+frr-protected+rib-update-delay) *rib-update-delay* command. After the command is run, IS-IS does not switch traffic to the backup link until the delay expires.
      
      Keeping the default delay is recommended.
   6. Run [**frr**](cmdqueryname=frr)
      
      
      
      The IS-IS FRR view is displayed.
8. (Optional) Run [**tiebreaker**](cmdqueryname=tiebreaker) { **node-protecting** | **lowest-cost** | **non-ecmp** | **srlg-disjoint** | **hold-max-cost** } **preference** *preference* [ **level-1** | **level-2** | **level-1-2** ]
   
   
   
   The solution of selecting a backup path for IS-IS Auto FRR is set.
9. (Optional) To prevent an interface from being calculated as a backup interface (after the preceding configurations are complete, all IS-IS interfaces participate in the calculation of the backup next hop by default), perform the following steps:
   1. Run [**quit**](cmdqueryname=quit)
      
      
      
      Exit the IS-IS FRR view.
   2. Run [**quit**](cmdqueryname=quit)
      
      
      
      Exit the IS-IS view.
   3. Run [**interface**](cmdqueryname=interface) *interface-type* *interface-number*
      
      
      
      The interface view is displayed.
   4. Run [**undo isis lfa-backup**](cmdqueryname=undo+isis+lfa-backup) [ **level-1** | **level-2** | **level-1-2** ]
      
      
      
      The interface is disabled from being calculated as an LFA or remote LFA next hop.
10. (Optional) Run [**isis remote-lfa disable**](cmdqueryname=isis+remote-lfa+disable) [ **level-1** | **level-2** | **level-1-2** ]
    
    
    
    The device is configured not to calculate a remote LFA backup next hop for an IS-IS route with the current interface as the outbound interface.
11. Run [**commit**](cmdqueryname=commit)
    
    
    
    The configuration is committed.

#### Verifying the Configuration

After configuring IS-IS Auto FRR, check the configurations.

* Run the [**display isis route**](cmdqueryname=display+isis+route) [ **level-1** | **level-2** ] [ *process-id* ] [ **verbose** ] command to check information about the primary and alternate links after IS-IS Auto FRR is enabled.
* Run the [**display isis spf-tree**](cmdqueryname=display+isis+spf-tree) [ [ **level-1** | **level-2** ] | **verbose** ] \* [ *process-id* | **vpn-instance** *vpn-instance-name* ] command to check the traffic protection type of IS-IS Auto FRR.
* Run the [**display isis frr summary**](cmdqueryname=display+isis+frr+summary) [ **level-1** | **level-2** | **level-1-2** ] [ *process-id* ] command to view the FRR protection rates of routes in an IS-IS process.
* Run the [**display isis**](cmdqueryname=display+isis) [ *process-id* ] **srlg** { *srlgGroupId* | **all** } command to check shared risk link group (SRLG) information.