Configuration Precautions for BFD
=================================

Configuration Precautions for BFD

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| Static BFD for VLL PW in control word mode does not support the CV type of 0x10 or 0x20. If the CV type of the PW negotiation result is 0x10 or 0x20, the BFD session cannot go up through negotiation. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The board migration function does not allow board migration beyond the specifications. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Static BFD for mPW can be associated with physical interfaces but cannot be associated with AC interfaces (including TTL and non-TTL modes). | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In static BFD for VPLS unicast packet detection scenarios, BFD between multi-segment VPLSs cannot be performed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Static BFD for MS-PW cannot detect overlapping PWs at the same time. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Dynamic BFD for static LSPs does not allow creation of dynamic BFD sessions for static LSPs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In TTL mode, interworking with non-Huawei devices cannot be performed in static BFD for PW scenarios. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BFD for VPLS in non-multicast mode supports only dynamic VSIs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Strict URPF cannot be configured on an interface with a one-arm BFD session configured. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Static BFD sessions (excluding static auto-negotiation BFD sessions) cannot interwork with dynamic BFD sessions or static BFD auto-negotiation sessions. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The local discriminator of the local device must be the same as the remote discriminator of the remote device, and the remote discriminator of the local device must be the same as the local discriminator of the remote device. Otherwise, the static BFD session cannot be established. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the WTR time is used, you need to manually set the same WTR time at both ends. Otherwise, when the session status changes at one end, the BFD session status detected by the applications at both ends is different. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Bit-error-triggered IGP cost-based switchback takes effect only after BFD is enabled globally. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| A Huawei device with the function to transmit return packets over an SBFD for SRv6 Policy configured cannot interwork with non-Huawei devices. BFD packets carry proprietary extensions in addition to protocol-defined parts. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| For a BFD session tracking a session group:  1. A session that has been added to a session group cannot track the session group.  2. A session that has been tracked by a session group cannot be added to the session group.  3. A session can track only one session group.  4. Static multi-hop IPv4 and IPv6 sessions that track interface cannot be added to session groups. Dynamic sessions cannot be added to session groups.  5. IPv4 and IPv6 static one-arm sessions cannot track session groups.  6. If link-bundle sessions are configured to track session groups, fast switching on the forwarding plane is not supported. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If a session group is not added to a session or the added session is not delivered to the forwarding plane, the SBFD reflector cannot track the session group. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| A soft reset is performed on the TM component corresponding to the BFD state machine. If the detection period of a BFD session is shorter than the soft reset duration of the TM component, the BFD session goes down 3s to 5s later than the soft reset duration of the TM component. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the TM component corresponding to the BFD state machine fails, the BFD session down time is delayed to the time when the TM component hard reset starts. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The BFD detection interval of the inner-layer link must be less than that of the outer-layer link. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the outbound interface of a BFD for peer IPv6 session is a dot1q/QinQ VLAN tag termination sub-interface and multiple VLANs are configured on the sub-interface, ensure that the VLAN IDs learned by the ARP modules on both ends are the same. If they are different, the BFD session cannot go up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| For a BFD for IP session, negotiation packets are forcibly transmitted over the primary service link. Detection packets are forwarded along the same path as the service path. This solution has the following limitations:  1. The S-BFD reflector has no state machine. Therefore, this solution cannot solve the problem that the S-BFD return traffic sent by the reflector is transmitted along a tunnel after the IP route recurses to the tunnel.  2. When no link fault occurs on the primary LSP but the BFD status is Down and a link fault occurs on the backup LSP, BFD can go up through negotiation if BFD negotiation packets are transmitted through the primary link. However, BFD detection packets cannot be sent. As a result, the BFD session flaps.  3. In a static protection group scenario, if IP over static protection group is configured and the ingress of BFD return packets forwards the packets to the tunnel in the static protection group based on the IP address, BFD negotiation fails if the primary tunnel in the static protection group goes down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BFD for IPv4/IPv6 cannot be bound to a local IP address.  bfd XX bind peer-ip/peer-ipv6 X.X.X.X  The configuration fails, and the message "Error: The IP address configured for the peer is the local IP address." is displayed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BFD for IPv4/IPv6 cannot be bound to VRRP virtual IP addresses. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the outbound interface of a BFD for peer IP session is a dot1q/QinQ VLAN tag termination sub-interface and multiple VLANs are configured on the sub-interface, ensure that the VLAN IDs learned by the ARP modules on both ends are the same. If they are different, the BFD session cannot go up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When SBFD for SR-MPLS BE tunnel sessions and SR-MPLS BE work in load balancing mode, SBFD packets are forwarded through one link based on the hash algorithm. If the link fails, the SBFD session goes down. As a result, the SR-MPLS BE tunnel is incorrectly detected as down, causing a service switchover. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In SBFD for SR-MPLS BE tunnel scenarios, the configured packet sending interval must be greater than the switching time inside the tunnel. Otherwise, SBFD is incorrectly detected as Down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SBFD supports the scenario where one reflector connects to multiple initiators. The total number of sessions on the initiator cannot exceed the maximum number of sessions on the reflector. Otherwise, session flapping may occur.  Properly plan the network to prevent the number of SBFD sessions on the initiators connected to the same reflector from exceeding the maximum number of SBFD sessions supported by the reflector. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a dot1q VLAN tag termination sub-interface is detected in default IP mode, the smallest VLAN IDs in the VLAN segments configured on both ends must be the same, and the sub-interface cannot be bound to a VSI. Otherwise, BFD cannot go up through negotiation. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In SBFD for SR-MPLS BE tunnel scenarios, packet loss occurs during switchback inside the SR-MPLS BE tunnel when upstream and downstream traffic is transmitted through different boards. As a result, the SBFD session may go down, which triggers service switching. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BFD packets do not support reassembly. The MTU of the outbound interface on the device that BFD packets pass through must be greater than or equal to 52 bytes. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The transmitting and reflection forwarding paths of an SBFD for SR-MPLS BE tunnel session are different. If the reflection path fails, the SR-MPLS BE tunnel is incorrectly detected as down, causing a service switchover. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If a FlexEth interface exists on a link monitored by BFD, the BFD detection parameters must be greater than the switching specification of FlexEth member interfaces (100 ms x 3 is recommended). This prevents BFD from going down unexpectedly due to member interface switching. | NE40E-M2 | NE40E-M2H/NE40E-M2K |
| If the board where the BFD state machine resides is faulty (for example, due to hot swap), the peer BFD session status will go Down, adversely affecting services bound to the BFD session. For example, routing protocol re-convergence, TE switchover, or FRR switchover may be triggered. The local end may fail to send fault messages to the main control board in a timely manner. As a result, the BFD session status on the main control board becomes incorrect. The fault can be rectified only after the scheduled query on the main control board times out. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K-B |
| In scenarios where BFD for IS-IS, OSPF, RIP, or BGP is configured, if the outbound interface of the link is an Eth-Trunk interface and the configured BFD detection interval is less than 3 x 100 ms, the BFD status may go down unexpectedly.  Run the bfd all-interfaces enable command in the IS-IS, OSPF, or RIP view.  Run the peer <ip-address> bfd enable command in the BGP view.  You are advised to set the BFD detection interval to a value greater than 3 x 100 ms. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| For the same detection object (LDP LSP, TE tunnel, or TE LSP), a maximum of eight static BFD sessions can be configured, and a maximum of 200 static BFD sessions of the IP type can be configured. This limit applies to configuration delivery not configuration restoration. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If BFD for default IP is configured on two indirectly connected devices, for the intermediate device, you are advised to disable BFD or configure a default IP address that is different from the default IP addresses of the two devices. Otherwise, BFD cannot go up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a static BFD for single-hop session is bound to a flexible access sub-interface, the priority of the BFD session must be included in the priority of the flexible access sub-interface. Otherwise, the BFD session cannot go up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SBFD for SRv6 TE Policy packets are not forwarded over local protection paths. For devices that do not support SRV6 node forwarding, this function does not take effect.  Cause: The no-bypass flag in the SRH header is used to identify whether packets are forwarded over local protection paths. This flag takes effect only on the node that can parse the SRH header. If the SRH header is not parsed, this flag cannot be identified. That is, IP FRR does not take effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The reflector cannot distinguish VSs when processing SBFD packets. On a physical device, the SBFD packets that are sent out of the tunnel through a VS are mismatched with the reflector discriminators configured in other VSs.  You are advised to properly plan the SBFD reflector and initiator configurations in VSs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In an SRv6 TE Policy loose path scenario, if SBFD for SRv6 TE Policy is configured not to use local protection and the primary path fails, BFD goes down first. After the route is converged to the backup path, BFD goes up through renegotiation. Traffic packets are still transmitted along the original backup path. Traffic is not switched to the segment list for E2E protection. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In MPLS tunnel label forwarding scenarios, the BFD receiving process cannot distinguish VSs. On a physical device, the BFD packets that are sent out of the tunnel through a VS are mismatched with the BFD descriptors configured in other VSs.  You are advised to properly plan BFD for VSs. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If the return paths of the active and standby S-BFD sessions are the same, both the active and standby S-BFD sessions go down when the return path is disconnected. This affects the detection of the primary/backup TE LSP status. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SBFD for SR-MPLS TE LSP supports transmission of return traffic over a tunnel. After this function is enabled, the SBFD session established between a Huawei device and a non-Huawei device may be down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| SBFD for SRv6 TE Policy packets are not forwarded over local protection paths. When the SBFD-monitored list works in multi-path load balancing mode, it may be inconsistent with the actual service traffic link. In this case, SBFD goes down and traffic can be forwarded, or traffic is interrupted but SBFD goes up. If SBFD goes up but the actual service path is unreachable, service traffic is switched to other load-balancing paths. If SBFD goes down, SBFD does not switch traffic back to load-balancing paths. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a scenario where BFD is configured and the local and remote discriminators of BFD are the same, when the loopback local command is run on the outbound interface, the local device can receive packets from the remote device and packets sent and looped back by the local device at the same time. As a result, the BFD status is unpredictable.  You are advised not to configure loopback local on the outbound interface of BFD packets. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In the network slicing scenario, the SBFD for SRv6 TE Policy forcibly uses the slice interface. If the link of the slice interface is disconnected, the SBFD detection is down. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Local protection is forcibly disabled for SBFD for SRv6 TE Policy in network slicing scenarios. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When a U-BFD session is deployed to track an SRv6 TE Policy and local protection (TE FRR/TI-LFA) is enabled on the detection path, the BFD no-bypass function needs to be configured. Otherwise, the link detected by BFD may be different from the actual link. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| U-BFD for SRv6 TE Policy list must be used together with the BFD no-bypass function. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The egress does not verify the discriminators in BFD packets. When the SID stack configuration is incorrect, the U-BFD session for SRv6 TE Policy list may incorrectly go up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| If strict URPF is enabled on the device that sends BFD Echo packets, the source IP address of BFD Echo packets must be different from the interface address. Otherwise, BFD Echo does not take effect. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BFD and OAM cannot be configured for the same tunnel link at the same time. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When SBFD monitors the segment list of an SRv6 TE Policy, SBFD packets may be forwarded to the endpoint based on the endpoint address in the following scenarios. In this case, the SBFD session status is Up, but service traffic may fail to be forwarded.  1. The SID stack of the segment list is incorrectly configured and packets cannot reach the endpoint.  2. The encapsulation mode of the SRv6 TE Policy is Insert, and TE FRR is enabled.  Properly plan the SID stack for an SRv6 TE Policy. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When BFD for BGP is configured to check peer { <group-name> | <ipv4-address> | <ipv6-address> } bfd valid-ttl-hops, BFD sessions can be shared by multiple protocols. For example, BGP can share a BFD session with static routes and IPsec. The TTL check function takes effect for the shared BFD session. If the TTL check fails, session flapping may occur. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. When the SRv6 TE Policy encapsulation mode is insert, U-BFD for SRv6 TE Policy list must be used together with the BFD no-bypass function.  2. Because the source and destination IPv6 addresses of U-BFD packets are the same, URPF cannot be deployed on the egress. Otherwise, BFD packets will be discarded.  3. The egress does not verify the discriminators in BFD packets. When the SID stack configuration is incorrect, the U-BFD session for SRv6 TE Policy list may incorrectly go up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| After a static BFD session is configured, if the number of dynamic BFD sessions on the device increases and then the static BFD session configuration is committed, the number of BFD sessions may exceed the device specification. The excess BFD sessions cannot be negotiated.  You are advised to delete the number of BFD sessions so that the total number of BFD sessions is less than the maximum number allowed by the device. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| To ensure normal LSP switching, the forward and return paths of BFD for LSP session packets must be consistent. If the forward and return paths are inconsistent and the return path fails, an incorrect forward LSP switchover may occur, causing service packets to be lost.  You are advised to perform the configuration according to the following rules:  When a BFD for LSP session is deployed on a network, the following requirements must be met:  For a dynamic BFD for LSP session, configure a route constraint mode to ensure that the forward and retrun paths are consistent (for example, use high-priority static routes).  For a static BFD for LSP session (excluding BFD for TE LSP), configure a route constraint mode to ensure that the forward and return paths are consistent (for example, use high-priority static routes).  For a static BFD for TE LSP session, configure strict explicit path constraints and a BFD for TE LSP session for both the forward and return paths to ensure that the paths are consistent. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| BFD for IP can track only the physical status of physical interfaces and Eth-Trunk interfaces. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When configuring SBFD to monitor the segment list of an SRv6 TE Policy, ensure that the endpoint address of the SRv6 TE Policy is the local IP address of the egress. Otherwise, the SBFD session cannot go Up. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In a BFD for primary/backup TE-LSP scenario, if the forward primary path is the same as the reverse backup path and the reverse primary path is the same as the forward backup path, the BFD detection results are incorrect. BFD on the primary and backup TE-LSPs detects a shared link. If the shared link is faulty, BFD on both the primary and backup TE-LSPs goes Down. As a result, packet loss occurs because a primary/backup TE-LSP switchover cannot be correctly performed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The mpls te bfd reverse-label command can be run to configure return traffic to enter an SBFD for SR-TE LSP. This function cannot be used for interworking with non-Huawei devices. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| For SBFD session negotiation authentication:  1. Only packets received before an SBFD session goes up can be authenticated.  2. The SBFD reflector cannot authenticate received packets. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In the U-BFD for Policy scenario where networking slicing is deployed and return packets are forwarded over the tunnel, for the forward SRv6 TE Policy, ensure that network slicing is deployed for this policy in E2E mode and that the primary path is working properly. For the reverse SRv6 TE Policy, if the encapsulation mode is Insert, ensure that network slicing is deployed for this policy in E2E mode and that the primary path is working properly. If the encapsulation mode is Encap, ensure that the primary path is working properly.  If the preceding requirements are not met, U-BFD fails. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |