Configuration Precautions for NG MVPN
=====================================

Configuration Precautions for NG MVPN

#### Feature Requirements

**Table 1** Feature requirements
| Feature Requirements | Series | Models |
| --- | --- | --- |
| In the NG MVPN dual-root 1+1 scenario, different RDs must be configured in the VPN instance views of the two root nodes. Otherwise, dual roots cannot be formed. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| In an NG MVPN scenario, extranet entries can use only static RPs. The RPs in the receiver VRF and source VRF must be the same. The RP must be in the source VRF. The routes to the source and RP are from the same VRF. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When P2MP TE FRR is used in an NG MVPN scenario, the carrier up-hold-time command must be run on a P2MP tunnel interface to configure a hold-off time for the system to respond to a primary P2MP tunnel interface Up event. Otherwise, packet loss occurs during a traffic switchback.  The configuration time depends on the number of VPN multicast groups carried on the tunnel. If there are 1000 VPN multicast groups, you are advised to set the time to 30s. If the number of VPN multicast groups increases, the configuration time needs to be prolonged. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| NG-MVPN-based dual-root 1+1 protection depends on P2MP BFD. If the inbound interface of a leaf PE is a trunk interface, the BFD detection interval must be greater than or equal to 100 ms x 3 to prevent a false 1+1 switchover. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| When the IPv4 NG MVPN SPMSI function is configured on a device, you are not advised to configure the loopback mode. If the loopback mode is configured on a device and the device functions as an IPv4 NG MVPN ingress, the device supports only IPv4 NG MVPN services of 256 tunnels. Excess multicast traffic cannot be forwarded. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| PIM DM does not support BAS interfaces. Enable PIM-SM on BAS interfaces.  In an NG MVPN scenario, PIM-DM cannot be configured for VPN PIM. Configure PIM-SM for VPN PIM in an NG MVPN. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The NG MVPN extranet does not support cross-iteration of IPv4 extranet (\*, G)/(S, G) entries. For example, for the same (\*, G)/(S, G) entry, VRFB is configured as the source VRF instance on VRFA, and VRFC is configured as the source VRF instance on VRFB. Especially in the static unicast routing scenario, prevent the situation that the outbound interface of VRFA resides in VRFB, and the outbound interface of VRFB resides in VRFC. Configure the outbound interface of the route of VRFA in VRFC. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| A leaking policy needs to be configured for NG MVPN A-D routes in the receiver VPN instance on a leaf PE and is different from the leaking policy of unicast routes. Ensure that the I-PMSI/S-PMSI A-D route in the VPN instance sent by the root PE is leaked to the source VPN of the leaf PE and not to the receiver VPN of the leaf PE. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| 1. The SSM range of the source VPN instance must be the same as that of the receiver VPN instance.  2. If the source VPN and receiver VPN use the same RP (non-anycast RP), the same static RP must be configured, and the RP cannot be deployed on the receive VPN of the leaf PE.  3. If the source VPN and receiver VPN use different RPs (including the anycast RP), the MSDP peer or PIM anycast RP mechanism is used to learn active source information. The RP cannot be deployed in the receive VPN instance of the leaf PE. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| Multicast services depend on unicast routes. When VPN unicast routes are iterated to an IPv4 public network, NG MVPN supports MLDP/RSVP-TE/BIER MPLS tunnels.  It is recommended that unicast routes be preferentially selected as supported routes. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |
| The deployment of multicast programs needs to be planned. The programs of different sources in the same group must be local cross-connections or remote cross-connections at the same time. | NE40E-M2 | NE40E-M2E/NE40E-M2F/NE40E-M2H/NE40E-M2K/NE40E-M2K-B |